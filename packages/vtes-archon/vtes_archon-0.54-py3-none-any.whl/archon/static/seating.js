!function(e,t,r,n,s,i,o,l){var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof f[n]&&f[n],u=a.i||{},h=a.cache||{},p="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function d(t,r){if(!h[t]){if(!e[t]){if(s[t])return s[t];var i="function"==typeof f[n]&&f[n];if(!r&&i)return i(t,!0);if(a)return a(t,!0);if(p&&"string"==typeof t)return p(t);var o=Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}u.resolve=function(r){var n=e[t][1][r];return null!=n?n:r},u.cache={};var l=h[t]=new d.Module(t);e[t][0].call(l.exports,u,l,l.exports,f)}return h[t].exports;function u(e){var t=u.resolve(e);if(!1===t)return{};if(Array.isArray(t)){var r={__esModule:!0};return t.forEach(function(e){var t=e[0],n=e[1],s=e[2]||e[0],i=d(n);"*"===t?Object.keys(i).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})}):"*"===s?Object.defineProperty(r,t,{enumerable:!0,value:i}):Object.defineProperty(r,t,{enumerable:!0,get:function(){return"default"===s?i.__esModule?i.default:i:i[s]}})}),r}return d(t)}}d.isParcelRequire=!0,d.Module=function(e){this.id=e,this.bundle=d,this.require=p,this.exports={}},d.modules=e,d.cache=h,d.parent=a,d.distDir=void 0,d.publicUrl=void 0,d.devServer=void 0,d.i=u,d.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(d,"root",{get:function(){return f[n]}}),f[n]=d;for(var _=0;_<t.length;_++)d(t[_]);if(r){var g=d(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=g:"function"==typeof define&&define.amd&&define(function(){return g})}}({"5liWw":[function(e,t,r,n){var s,i,o=e("@parcel/transformer-js/src/esmodule-helpers.js");o.defineInteropFlag(r),o.export(r,"RULE",()=>l),o.export(r,"shuffle_array",()=>d),o.export(r,"initial_seating",()=>c),o.export(r,"compute_issues",()=>R);var l=((s={})[s.R1_PREDATOR_PREY=0]="R1_PREDATOR_PREY",s[s.R2_OPPONENT_ALWAYS=1]="R2_OPPONENT_ALWAYS",s[s.R3_AVAILABLE_VPS=2]="R3_AVAILABLE_VPS",s[s.R4_OPPONENT_TWICE=3]="R4_OPPONENT_TWICE",s[s.R5_FIFTH_SEAT=4]="R5_FIFTH_SEAT",s[s.R6_SAME_POSITION=5]="R6_SAME_POSITION",s[s.R7_SAME_SEAT=6]="R7_SAME_SEAT",s[s.R8_STARTING_TRANSFERS=7]="R8_STARTING_TRANSFERS",s[s.R9_SAME_POSITION_GROUP=8]="R9_SAME_POSITION_GROUP",s),f=((i=f||{})[i.OPPONENT=0]="OPPONENT",i[i.PREY=1]="PREY",i[i.PREDATOR=2]="PREDATOR",i[i.GRAND_PREY=3]="GRAND_PREY",i[i.GRAND_PREDATOR=4]="GRAND_PREDATOR",i[i.CROSS_TABLE=5]="CROSS_TABLE",i[i.NEIGHBOUR=6]="NEIGHBOUR",i[i.NON_NEIGHBOUR=7]="NON_NEIGHBOUR",i[i.ROUNDS_PLAYED=0]="ROUNDS_PLAYED",i[i.VPS=1]="VPS",i[i.TRS=2]="TRS",i[i.SEAT_1=3]="SEAT_1",i[i.SEAT_2=4]="SEAT_2",i[i.SEAT_3=5]="SEAT_3",i[i.SEAT_4=6]="SEAT_4",i[i.SEAT_5=7]="SEAT_5",i);let a=new Map([[4,[[],[1,1,0,0,0,0,1,0],[1,0,0,0,0,1,0,1],[1,0,1,0,0,0,1,0]]],[5,[[],[1,1,0,0,0,0,1,0],[1,0,0,1,0,0,0,1],[1,0,0,0,1,0,0,1],[1,0,1,0,0,0,1,0]]]]),u=new Map([[4,[[1,4,1,1,0,0,0,0],[1,4,2,0,1,0,0,0],[1,4,3,0,0,1,0,0],[1,4,4,0,0,0,1,0]]],[5,[[1,5,1,1,0,0,0,0],[1,5,2,0,1,0,0,0],[1,5,3,0,0,1,0,0],[1,5,4,0,0,0,1,0],[1,5,4,0,0,0,0,1]]]]);function h(e,t){return e.map((e,r)=>e.map((e,n)=>e.map((e,s)=>e+t[r][n][s])))}class p{mapping=new Map;reverse=new Map;constructor(e){var t=0;for(const r of e)this.mapping.has(r)||(this.reverse.set(t,r),this.mapping.set(r,t++))}measure(e,t){let r=Array.from({length:this.mapping.size},e=>Array.from({length:this.mapping.size},e=>Array(8).fill(0)));for(let[s,i]of e.entries())if((!t||t.includes(s))&&u.has(i.length))for(let[e,t]of i.entries()){let s=this.mapping.get(t);r[s][s]=u.get(i.length)[e].slice();for(var n=1;n<i.length;n++){let t=this.mapping.get(i[(e+n)%i.length]);t>s||(r[s][t]=a.get(i.length)[n].slice())}}return r}measure_rounds(e){var t=void 0;for(let r of e){let e=this.measure(r);t=t?h(t,e):e}return t}issues(e){let t=Array.from({length:9},e=>[]);var r=0,n=0,s=0,i=0;for(let[t,o]of e.entries()){let e=o[t],l=e[0];l>0&&(r+=e[1]/l,n+=e[2]/l,s++,i=i<l?l:i)}for(let[o,l]of(r/=s,n/=s,e.entries()))for(let[e,f]of l.entries()){if(e>o)break;if(e===o){let e=f[0];Math.abs(r-f[1]/e)>1/e&&t[2].push([this.reverse.get(o)]),Math.abs(n-f[2]/e)>2/e&&t[7].push([this.reverse.get(o)]),f[3]>1&&t[6].push([this.reverse.get(o)]),f[4]>1&&t[6].push([this.reverse.get(o)]),f[5]>1&&t[6].push([this.reverse.get(o)]),f[6]>1&&t[6].push([this.reverse.get(o)]),f[7]>1&&(t[6].push([this.reverse.get(o)]),t[4].push([this.reverse.get(o)]))}else for(let[r,n]of f.entries())n>1&&(0==r?(s>20&&t[3].push([this.reverse.get(o),this.reverse.get(e)]),n>=i&&i>2&&t[1].push([this.reverse.get(o),this.reverse.get(e)])):r<=2?(t[0].push([this.reverse.get(o),this.reverse.get(e)]),t[5].push([this.reverse.get(o),this.reverse.get(e)])):r<=5?t[5].push([this.reverse.get(o),this.reverse.get(e)]):s>20&&t[8].push([this.reverse.get(o),this.reverse.get(e)]))}return t}fast_score(e){let t=Array(9).fill(0);var r=0,n=0,s=0,i=0;for(let[t,o]of e.entries()){let e=o[t],l=e[0];l>0&&(r+=e[1]/l,n+=e[2]/l,s++,i=i<l?l:i)}for(let[o,l]of(r/=s,n/=s,e.entries()))for(let[e,s]of l.entries()){if(e>o)break;if(e===o){let e=s[0];Math.abs(r-s[1]/e)>1/e&&t[2]++,Math.abs(n-s[2]/e)>2/e&&t[7]++,s[3]>1&&t[6]++,s[4]>1&&t[6]++,s[5]>1&&t[6]++,s[6]>1&&t[6]++,s[7]>1&&(t[6]++,t[4]++)}else for(let[e,r]of s.entries())r>1&&(0==e?(t[3]++,r>=i&&t[1]++):e<=2?(t[0]++,t[5]++):e<=5?t[5]++:t[8]++)}return t}}function d(e){for(let t=e.length-1;t>=0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}}function _(e){let t=e.length-4*(5-(e.length%5||5));var r=0;let n=[];for(;r<e.length;){let s=r<t?5:4,i=e.slice(r,r+s);if(i.length<4)throw Error("Invalid players count");n.push(i),r+=s}return n}class g{seat_index=new Map;player_index=new Map;seating;constructor(e){this.seating=e.map(e=>e.slice());var t=0;for(const[r,n]of e.entries())for(const[e,s]of n.entries())this.player_index.set(s,t),this.seat_index.set(t,[r,e]),t++}random_swap(e){let t=this.player_index.get(e);for(var r=t;r==t;)r=Math.floor(Math.random()*this.seat_index.size);this.swap(t,r)}shuffle(){for(var e=this.seat_index.size-1;e>=0;e--){let t=e,r=Math.floor(Math.random()*(e+1));this.swap(t,r)}}swap(e,t){let[r,n]=[this.seat_index.get(e),this.seat_index.get(t)],[s,i]=[this.seating[r[0]][r[1]],this.seating[n[0]][n[1]]];this.seating[r[0]][r[1]]=i,this.seating[n[0]][n[1]]=s,this.player_index.set(s,t),this.player_index.set(i,e)}}function c(e,t){if(t=t.slice(),e.length<=0)return d(t),_(t);let r=new Set(t),n=new Set(t);for(let t of e)for(let e of t)for(let t of e)n.add(t);let s=new p(n),i=s.measure_rounds(e);if(d(t),t.length<1)return _(t);for(var o=new g(_(t)),l=s.issues(h(i,s.measure(o.seating))),f=0;f<1e3;f++){var a=new g(o.seating);let e=new Set;for(let t of l)for(let n of t){let t=n.filter(e=>r.has(e));t.length<1||(t.length<2?e.add(n[0]):e.add(n[Math.floor(Math.random()*n.length)]))}for(let t of e)a.random_swap(t);let t=s.issues(h(i,s.measure(a.seating)));if(0>function(e,t){let r=e.length<t.length?e.length:t.length;for(var n=0;n<r;n++){let r=e[n].length,s=t[n].length;if(r<s)return -1;if(r>s)return 1}return 0}(t,l)&&(l=t,o=a),!l.some(e=>e.length>0))break}return console.log("best seating found",o.seating,l),o.seating}function R(e){let t=new Set;for(let r of e)for(let e of r)for(let r of e)t.add(r);let r=new p(t),n=r.measure_rounds(e);return r.issues(n)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"k3151"}],k3151:[function(e,t,r,n){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||Object.prototype.hasOwnProperty.call(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}]},["5liWw"],"5liWw","parcelRequire94c2",{});
//# sourceMappingURL=seating.js.map
