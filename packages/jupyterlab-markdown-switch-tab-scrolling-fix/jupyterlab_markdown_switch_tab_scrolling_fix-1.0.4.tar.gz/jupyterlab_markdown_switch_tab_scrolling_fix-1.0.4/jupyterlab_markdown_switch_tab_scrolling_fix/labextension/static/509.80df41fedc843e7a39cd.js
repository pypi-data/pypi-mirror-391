"use strict";(self.webpackChunkjupyterlab_markdown_switch_tab_scrolling_fix=self.webpackChunkjupyterlab_markdown_switch_tab_scrolling_fix||[]).push([[509],{509:(e,t,o)=>{o.r(t),o.d(t,{default:()=>l});const l={id:"jupyterlab_markdown_switch_tab_scrolling_fix:plugin",description:"Jupyterlab bugfix (disguised as extension) to help with the problem of Markdown files getting scrolled uncontrollably when images are gettng loaded into the view when switching tab back and forth",autoStart:!0,requires:[o(669).ILabShell],activate:(e,t)=>{console.log("JupyterLab extension jupyterlab_markdown_switch_tab_scrolling_fix is activated!");const o=new WeakMap;t.currentChanged.connect((e,t)=>{const{newValue:l}=t;(e=>{if(!e)return;const t=e.node.querySelector(".jp-RenderedMarkdown");if(!t)return;const l=o.get(e);void 0!==l&&(clearInterval(l),o.delete(e));const r=t.scrollTop,n=t.scrollLeft,s=Array.from(t.querySelectorAll("img"));if(0===s.length)return;console.log(`[SCROLL-LOCK] Markdown activated with ${s.length} images, locking scroll at ${r}px`);let a=0;const c=s.length;let i=!1;s.forEach((e,t)=>{const o=(e=>()=>{a++,console.log(`[IMAGE-LOAD] Image ${e+1}/${c} loaded`),a>=c&&console.log(`[IMAGES-COMPLETE] All ${c} images loaded, scroll lock will release soon`)})(t);e.addEventListener("load",o,{once:!0}),e.addEventListener("error",o,{once:!0}),e.complete&&0!==e.naturalHeight&&o()});const d=()=>{i=!0,console.log("[USER-SCROLL] User scroll detected, releasing lock")};t.addEventListener("wheel",d,{once:!0,passive:!0}),t.addEventListener("touchstart",d,{once:!0,passive:!0});let g=0,h=0;const u=window.setInterval(()=>{if(i)return clearInterval(u),o.delete(e),t.removeEventListener("wheel",d),t.removeEventListener("touchstart",d),void console.log("[GUARD-EXIT] User scroll detected");const l=t.scrollTop,s=Math.abs(l-r);if(s<1?h++:(h=0,t.scrollTop=r,t.scrollLeft=n,console.log(`[SCROLL-RESTORE] Corrected drift of ${s.toFixed(1)}px`)),a>=c&&h>=3)return clearInterval(u),o.delete(e),t.removeEventListener("wheel",d),t.removeEventListener("touchstart",d),void console.log(`[GUARD-COMPLETE] Scroll lock released after ${g} attempts`);g++,g>=30&&(clearInterval(u),o.delete(e),t.removeEventListener("wheel",d),t.removeEventListener("touchstart",d),console.log(`[GUARD-TIMEOUT] Scroll lock released after timeout (${a}/${c} images loaded)`))},100);o.set(e,u)})(l)}),console.log("[INIT] Markdown scroll lock handler registered on shell.currentChanged")}}}}]);