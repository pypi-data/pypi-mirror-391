import importlib.resources

from textual.app import ComposeResult
from textual.screen import Screen
from textual.containers import VerticalScroll
from textual.widgets import Markdown
from textual import events

from gigachat_cli.widgets.banner import Banner

# –ö–æ–Ω—Ç–µ–Ω—Ç —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
HELP_CONTENT = """
# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è GigaChat

## ‚öôÔ∏è –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ API-–∫–ª—é—á –≤ —Å–∏—Å—Ç–µ–º–µ:

```Bash
export GIGACHAT_API_KEY="YOUR_API_KEY"
```
## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ Tab):
- `/model` - –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ GigaChat (Lite/Pro/Max)
- `/menu` - –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥ –≤ –º–µ–Ω—é
- `/help` - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
- `/exit` - –≤—ã—Ö–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## ‚å®Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º

**–ù–∞–≤–∏–≥–∞—Ü–∏—è:**
- `Tab` / `Shift+Tab` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—é –∫–æ–º–∞–Ω–¥
- `‚Üë / ‚Üì` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–∞—Ö (—Å–µ–ª–µ–∫—Ç–æ—Ä–∞—Ö)
- `Enter` - –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä `/` –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
- `Escape` - –æ—Ç–º–µ–Ω–∞ `/` –≤–æ–∑–≤—Ä–∞—Ç `/` –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–ø—Ä–∞–≤–∫–∏

**–†–∞–±–æ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º:**
- –ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ `Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ (–Ω–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å `/`)

**–ü—Ä–∏–º–µ—Ä—ã –†–∞–±–æ—Ç—ã —Å –ø—Ä–æ–µ–∫—Ç–æ–º:**
- `–û–±—ä—è—Å–Ω–∏ —á—Ç–æ –¥–µ–ª–∞–µ—Ç main.py` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç –∏ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–∞–π–ª
- `–ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –∫–æ–¥ –≤ utils.py?` - –∞–Ω–∞–ª–∏–∑ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
- `–ü–æ–∫–∞–∂–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞` - –∞–Ω–∞–ª–∏–∑ –≤—Å–µ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- `–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ñ—É–Ω–∫—Ü–∏–∏ calculate()` - –ø–æ–∏—Å–∫ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ñ—É–Ω–∫—Ü

## üí° –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

1. **–ù–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥** - –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
2. **–§–æ—Ä–º–∞—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Enter –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫
3. **–û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - –Ω–∞–∂–º–∏—Ç–µ Shift+Enter –∫–æ–≥–¥–∞ —Ç–µ–∫—Å—Ç –≥–æ—Ç–æ–≤
4. **![command] [key]** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ! –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏
5. **/menu** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω—É /menu –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
6. **/model** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /model –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ API GigaChat
7. **/exit** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /exit –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---
*–î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –º–µ–Ω—é –Ω–∞–∂–º–∏—Ç–µ Escape*
"""

class HelpScreen(Screen):
    """–≠–∫—Ä–∞–Ω —Å–ø—Ä–∞–≤–∫–∏ —Å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    
    CSS = importlib.resources.files("gigachat_cli.styles").joinpath("help.css").read_text()

    def compose(self) -> ComposeResult:
        """
        –ö–æ–º–ø–æ–∑–∏—Ü–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤ —ç–∫—Ä–∞–Ω–∞ —Å–ø—Ä–∞–≤–∫–∏
        
        Returns:
            ComposeResult: –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª —Å –±–∞–Ω–Ω–µ—Ä–æ–º –∏ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º —Å–ø—Ä–∞–≤–∫–∏
        """
        yield VerticalScroll(
            Banner(),
            Markdown(HELP_CONTENT)
        )
    
    def on_key(self, event: events.Key) -> None:
        """
        –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å–ø—Ä–∞–≤–∫–∏
        
        Args:
            event: –°–æ–±—ã—Ç–∏–µ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à–∏
        """
        if event.key == "escape":
            # –í–æ–∑–≤—Ä–∞—Ç –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–∫—Ä–∞–Ω –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
            self.app.pop_screen()
