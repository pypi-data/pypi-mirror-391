.. include:: _substitutions.rst

.. _absorbers:

Cross Sections
==============

This page shows the full list of cross sections (also named
opacities) that can be included in ``Pyrat Bay`` runs.

- :ref:`cs_sampled`
- :ref:`cs_cia`
- :ref:`cs_alkali`
- :ref:`cs_rayleigh`
- :ref:`cs_h_ion`
- :ref:`cs_clouds`

----------------------------------------------------------------------

.. _cs_sampled:

Sampled cross sections
----------------------

Sampled cross sections are 3D arrays that provide the cross section
for a given species (in cm\ :sup:`2` molecule\ :sup:`-1` units),
sampled over a grid of temperature (K), pressure (bar), and wavenumber
(|kayser|) arrays.  Sampled cross sections in ``Pyrat Bay`` are Numpy
``.npz`` files, see :py:func:`write_opacity()
<pyratbay.io.write_opacity>` in the API for more details.


The Zenodo repositories `doi.org/10.5281/zenodo.16965390
<https://zenodo.org/records/16965390>`__ and
`doi.org/10.5281/zenodo.17060936
<https://zenodo.org/records/17060936>`__ provide pre-computed
cross-section files, intended for a broad range of applications.
See the list below for direct links to the files
for each molecule.

These cross sections have been computed assuming an
|H2|/He-dominated atmosphere, and terrestrial isotopic
ratios. The lines have Voigt profiles with a wing cut-off at 300
HWHM and at 25 |kayser|.  The grids sampling are:

- Wavelength: :math:`0.15-33` Î¼m, at a constant resolution of :math:`R=25.000`
- Temperature: :math:`200-5000` K, with :math:`\Delta T = 150` K
- Pressure: :math:`1.0^{-9}-1.0^{3}` bar, equally sampled in log(`p`) with 4 samples per dex.

.. list-table:: Cross section files
  :header-rows: 1

  * - Species
    - Source
    - References

  * - `AlF <https://zenodo.org/records/17060937/files/cross_section_0.15-33.0um_0200-5000K_R025K_AlF_exomol_mollist.npz>`__
    - Exomol, mollist
    - [Bernath2020]_

  * - `C2H2 <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_C2H2_exomol_acety.npz>`__
    - Exomol, acety
    - [Chubb2020]_

  * - `CH4 <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_CH4_exomol_mm.npz>`__
    - Exomol, mm
    - [Yurchenko2024a]_

  * - `CaH <https://zenodo.org/records/17060937/files/cross_section_0.15-33.0um_0200-5000K_R025K_CaH_exomol_xab.npz>`__
    - Exomol, xab
    - [Owens2022]_

  * - `CO <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_CO_hitemp_2019.npz>`__
    - HITEMP, li
    - [Li2015]_

  * - `CO2 <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_CO2_ames_ai3000k.npz>`__
    - ames, ai3000k
    - [Huang2023]_
 
  * - `CS <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_CS_exomol_jnk.npz>`__
    - Exomol, jnk
    - [Paulose2015]_

  * - `CS2 <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_CS2_hitran_2020.npz>`__
    - HITRAN, 2020
    - [ref]_

  * - `FeH <https://zenodo.org/records/17060937/files/cross_section_0.15-33.0um_0200-5000K_R025K_FeH_exomol_mollist.npz>`__
    - Exomol, mollist
    - [Dulic2003]_ [Bernath2020]_

  * - `HCl <https://zenodo.org/records/17060937/files/cross_section_0.15-33.0um_0200-5000K_R025K_HCl_exomol_hitran.npz>`__
    - Exomol, hitran
    - [Dulic2003]_ [Bernath2020]_

  * - `H2O <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_H2O_exomol_pokazatel.npz>`__
    - Exomol, pokazatel
    -  [Polyansky2018]_

  * - `H2S <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_H2S_exomol_ayt2.npz>`__
    - Exomol, ayt2
    - [Azzam2016]_ [Chubb2018]_

  * - `HCN <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_HCN_exomol_harris_larner.npz>`__
    - Exomol, harris larner
    - [Harris2008]_ [Barber2014]_

  * - `HF <https://zenodo.org/records/17060937/files/cross_section_0.15-33.0um_0200-5000K_R025K_HF_exomol_coxon_hajig.npz>`__
    - Exomol, coxon-hajig
    - [Li2013]_ [Coxon2015]_ [Somogyi2021]_

  * - `KCl <https://zenodo.org/records/17060937/files/cross_section_0.15-33.0um_0200-5000K_R025K_KCl_exomol_barton.npz>`__
    - Exomol, barton
    - [Barton2014]_

  * - `KOH <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_KOH_exomol_oyt4.npz>`__
    - Exomol, oyt4
    - [Owens2021]_

  * - `NaCl <https://zenodo.org/records/17060937/files/cross_section_0.15-33.0um_0200-5000K_R025K_NaCl_exomol_barton.npz>`__
    - Exomol, barton
    - [Barton2014]_

  * - `NaH <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_NaH_exomol_rivlin.npz>`__
    - Exomol, rivlin
    - [Rivlin2015]_

  * - `NH3 <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_NH3_exomol_coyute.npz>`__
    - Exomol, coyute
    - [Coles2019]_ [Yurchenko2024b]_

  * - `OCS <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_OCS_exomol_oyt8.npz>`__
    - Exomol, oyt8
    - [Owens2024]_

  * - `OH <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_OH_hitemp_2022.npz>`__
    - HITEMP, 2022
    - [ref]_

  * - `PH <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_PH_exomol_laty.npz>`__
    - Exomol, laty
    - [Langleben2019]_

  * - `PH3 <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_PH3_exomol_salty.npz>`__
    - Exomol, salty
    - [Sousa-Silva2014]_

  * - `PN <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_PN_exomol_pain.npz>`__
    - Exomol, pain
    - [Semenov2025]_

  * - `PO <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_PO_exomol_pops.npz>`__
    - Exomol, pops
    - [Prajapat2017]_

  * - `SH <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_SH_exomol_gyt.npz>`__
    - Exomol, gyt
    - [Gorman2019]_

  * - `SiH <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_SiH_exomol_sightly.npz>`__
    - Exomol, sightly
    - [Yurchenko2018]_

  * - `SiH4 <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_SiH4_exomol_oy2t.npz>`__
    - Exomol, oy2t
    - [Owens2017]_

  * - `SiO <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_SiO_exomol_siouvenir.npz>`__
    - Exomol, siouvenir
    - [Yurchenko2022]_

  * - `SiS <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_SiS_exomol_oy2t.npz>`__
    - Exomol, ucty
    - [Upadhyay2018]_

  * - `SO <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_SO_exomol_solis.npz>`__
    - Exomol, solis
    - [Brady2023]_

  * - `SO2 <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_SO2_exomol_exoames.npz>`__
    - Exomol, exoames
    - [Underwood2016]_

  * - `TiO <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_TiO_exomol_toto.npz>`__
    - Exomol, toto
    - [McKemmish2019]_

  * - `VO <https://zenodo.org/records/16965391/files/cross_section_0.15-33.0um_0200-5000K_R025K_VO_exomol_hyvo.npz>`__
    - Exomol, hyvo
    - [Bowesman2024]_


Other sources
~~~~~~~~~~~~~

- If this sampling (e.g., different ranges or higher resolution) is
  not suitable for a project or if cross sections for other species
  are needed, users can compute their own cross sections from line
  lists from Exomol or HITRAN/HITEMP. More details in this section:
  :doc:`line sampling <line_sampling>`.

- Alternatively, ``Pyrat Bay`` is also compatible with `petitRADTRANS <https://petitradtrans.readthedocs.io/en/latest/content/available_opacities.html#high-resolution-opacities-lbl-lambda-delta-lambda-10-6>`_ cross-section files [Molliere2019]_.

Use
~~~

In a configuration file, use the ``sampled_cross_sec`` key to list the
cross sections to be included in a run:

.. code-block:: ini

  # Line-sampled cross sections
  sampled_cross_sec =
      inputs/cross_section_0.15-33.0um_0200-5000K_R025K_H2O_exomol_pokazatel.npz
      inputs/cross_section_0.15-33.0um_0200-5000K_R025K_CO_hitemp_2019.npz
      inputs/cross_section_0.15-33.0um_0200-5000K_R025K_CO2_ames_ai3000k.npz
      inputs/cross_section_0.15-33.0um_0200-5000K_R025K_CH4_exomol_mm.npz
      inputs/cross_section_0.15-33.0um_0200-5000K_R025K_SO2_exomol_exoames.npz
      inputs/cross_section_0.15-33.0um_0200-5000K_R025K_H2S_exomol_ayt2.npz


Whenever sampled cross sections are used in ``Pyrat Bay``, output
spectra will be computed at the given wavelength sampling of the cross
sections.  This samping can be trimmed down or down sampled (if
desired) with the following keys:

.. code-block:: ini

    # Wavelength sampling (keep every second point between boundaries)
    wl_low = 1.0 um
    wl_high = 12.0 um
    wl_thinning = 2


Lastly, cross sections can also be used in stand-alone scripts. See
the following notebook for details:

- `Line-sample opacity <cookbooks/opacity_line_sample.ipynb>`__


.. _cs_cia:

Continuum cross sections
------------------------

Collision induced absorption

Use the ``csfile`` key to include opacities from cross-section files.
A cross-section file contains opacity (in |kayser| amagat\ :sup:`-2`
units) tabulated as a function of temperature and wavenumber.  Since
this format is tabulated in wavenumber, it is best suited for
opacities that vary smoothly with wavenumber, like collision-induced
absorption (CIA).  However, the code can also process LBL opacities,
as long as the files follow the right format (more on this later).

The following table list the most-commonly used CIA opacity sources:

========== ========== ========== ===================== =====================
Sources    Species    T range    |nu| range (|kayser|) References
========== ========== ========== ===================== =====================
`HITRAN`_  |H2|--|H2|  200--3000 1.0--500.0            [Richard2012]_ [Karman2019]_
`HITRAN`_  |H2|--H    1000--2500 1.0--100.0            [Richard2012]_ [Karman2019]_
`HITRAN`_  |H2|--He    200--9900 0.5--500.0            [Richard2012]_ [Karman2019]_
`Borysow`_ |H2|--|H2|   60--7000 0.6--500.0            [Borysow2001]_ [Borysow2002]_
`Borysow`_ |H2|--He     50--7000 0.5--31.25            [Borysow1988]_ [Borysow1989a]_ [Borysow1989b]_ [Jorgensen2000]_
========== ========== ========== ===================== =====================


.. _Borysow: https://www.astro.ku.dk/~aborysow/programs/index.html
.. _HITRAN: https://hitran.org/cia


For the **HITRAN** CIA database, ``Pyrat Bay`` provides these shell
commands to re-format the downloaded CIA files

.. code-block:: shell

    # Download and format HITRAN H2-H2 CIA file for Pyrat Bay:
    $ wget https://hitran.org/data/CIA/H2-H2_2011.cia
    $ pbay -cs hitran H2-H2_2011.cia

    # And for HITRAN H2-He CIA
    $ wget https://hitran.org/data/CIA/H2-H2_2011.cia
    $ pbay -cs hitran H2-He_2011.cia

For the **Borysow** CIA database, the code provides already-formatted
files for |H2|-|H2| in the 60--7000K and 0.6--500 um range \[`here
<https://github.com/pcubillos/pyratbay/blob/master/pyratbay/data/CIA/CIA_Borysow_H2H2_0060-7000K_0.6-500um.dat>`__\]
(this file pieces together the tabulated |H2|-|H2| files described in
the references above); and for |H2|-He in the 50--7000K and 0.5--31.25
um range \[`here
<https://github.com/pcubillos/pyratbay/blob/master/pyratbay/data/CIA/CIA_Borysow_H2He_0050-7000K_0.5-031um.dat>`__\]
(this file was created using a re-implementation of the code described
in the references above).  The user can access these files via the
``{ROOT}`` shortcut, as in the example below:

.. code-block:: python

    csfile =
        {ROOT}pyratbay/data/CIA/CIA_Borysow_H2H2_0060-7000K_0.6-500um.dat
        {ROOT}pyratbay/data/CIA/CIA_Borysow_H2He_0050-7000K_0.5-031um.dat


.. _cs_alkali:

Alkali
------

Use the ``alkali`` key to include opacities from alkali species.
Currently, the code provides the [Burrows2000]_ models for the sodium
and potassium resonant lines, based on van der Waals and statistical
theory.  The following table lists the available alkali model names:

====================  ========= =========================
Models (``alkali``)   Species   References
====================  ========= =========================
sodium_vdw            Na        [Burrows2000]_
potassium_vdw         K         [Burrows2000]_
====================  ========= =========================

This implementation adopts the line parameters from the VALD database
[Piskunov1995]_ and collisional-broadening half-width from [Iro2005]_.

.. _cs_rayleigh:

Rayleigh
--------

The ``rayleigh`` key sets Rayleigh opacity models.  The following
table lists the available Rayleigh model names:

===================== ======= ============================  ===
Models (``rayleigh``) Species Parameter names               References
===================== ======= ============================  ===
lecavelier            ---     ``log_k_ray``, ``alpha_ray``  [Lecavelier2008]_
dalgarno_H            H       ---                           [Dalgarno1962]_
dalgarno_He           He      ---                           [Kurucz1970]_
dalgarno_H2           |H2|    ---                           [Kurucz1970]_
===================== ======= ============================  ===

The Dalgarno Rayleigh models are tailored for H, He, and |H2| species,
and thus are not parametric.  The Lecavelier Rayleigh model is more flexible
and allows the user to modify the absorption strength and wavelength
dependency according to:

.. math::
    k(\lambda) = \kappa_{\rm ray} \kappa_0 \left(\frac{\lambda}{\lambda_0}\right)^{\alpha_{\rm ray}},

where :math:`\lambda_0=0.35` um and :math:`\kappa_0=5.31 \times
10^{-27}` cm\ :sup:`2` molecule\ :sup:`-1` are constants, and
:math:`\log(\kappa_{\rm ray})` and :math:`\alpha_{\rm ray}` are
fitting parameters that can be set through the ``rpars`` key.
Adopting values of :math:`\log(\kappa_{\rm ray})=0.0` and
:math:`\alpha_{\rm ray}=-4` reduces the Rayleigh opacity to that
expected for the |H2| molecule.

.. note:: Be aware that the implementation of the Lecavelier model
          uses the |H2| number-density profile (:math:`n_{\rm H2}`, in
          molecules cm\ :sup:`-3`) to compute the extinction
          coefficient (in |kayser| units) for a given atmospheric
          model: :math:`e(\lambda) = k(\lambda)\ n_{\rm H2}`.  We do
          this, because we are mostly interested in |H2|-dominated
          atmospheres, and most people consider a nearly constant |H2|
          profile.  Obviously, this needs to be fixed at some point in
          the future for a more general use.


.. _cs_h_ion:

|H-| opacity
------------

Set the ``fpatchy`` argument to compute transmission spectra from a
linear combination of a clear and cloudy/hazy spectra.  The
cloudy/hazy component will include the opacity defined by the
:ref:`cloud_opacity` and the ``lecavelier`` :ref:`rayleigh_opacity`.
For example, for a 45% cloudy / 55% clear atmosphere, set:

.. code-block:: python

  # Patchy fraction, value between [0--1]:
  fpatchy = 0.45


Flux dilution factor
~~~~~~~~~~~~~~~~~~~~

Set the ``f_dilution`` argument to set an flux dilution factor
[Taylor2020]_, with values between 0--1, which compensates for
emission from an inhomogeneous atmosphere.  The dilution factor
represents the fractional area of the hottest region on the planet
(assuming that the colder regions flux is negligible in comparison).

.. code-block:: python

  # Flux dilution factor, value between [0--1]:
  f_dilution = 0.85


.. _cs_clouds:

Clouds
------

Use the ``clouds`` key to include aerosol/haze/cloud opacities.
Currently, the code provides simple gray cloud models (listed below),
but soon we will include more complex Mie-scattering clouds for use in
forward- and retrieval modeling.  The following table lists the
currently available cloud model names:


And these are the available haze/cloud models (``clouds`` parameter):

=================== ============================================ =============================
Models (``clouds``) Parameter names                              Description
=================== ============================================ =============================
deck                ``log_p_cl``                                 Opaque gray cloud deck
ccsgray             ``log_k_gray``, ``log_p_top``, ``log_p_bot`` Constant gray cross-section
=================== ============================================ =============================

Use the ``cpars`` key to set the cloud model parameters.  The '*deck*'
model makes the atmosphere instantly opaque at the :math:`\log(p_{\rm cl})` pressure
(in bar units).

The '*ccsgray*' model creates a constant cross-section opacity between
the :math:`p_{\rm t}` and :math:`p_{\rm b}` pressures (in bar units),
and the |f| parameter scaling the opacity as: :math:`k = \kappa_{\rm gray}\ \kappa_0`, with
:math:`\kappa_0=5.31 \times 10^{-27}` cm\ :sup:`2` molecule\
:sup:`-1`.  This model uses the |H2| number-density profile to compute
the extinction coefficient as: :math:`e(\lambda) = k\ n_{\rm H2}` (in
|kayser| units).  Since the |H2| mixing ratio is generally constant,
the '*ccsgray*' opacity will scale linearly with pressure over the
atmosphere.

.. For any of these type of models, the user can include multiple
   models, simply by concatenating multiple models (and parameters)
   one after the other in the config file.


----------------------------------------------------------------------

Examples
--------

.. note:: Before running this example, make sure that you have
   generated the TLI file from the :ref:`tli_tutorial_example`,
   generated the atmospheric profiles from the
   :ref:`abundance_tutorial_example`, and download the configuration
   file shown above, e.g., with these shell commands:

   .. code-block:: shell

       tutorial_path=https://raw.githubusercontent.com/pcubillos/pyratbay/master/examples/tutorial
       wget $tutorial_path/spectrum_transmission.cfg


In an interactive run, a spectrum run returns a '*pyrat*' object that
contains all input, intermediate, and output variables used to compute
the spectrum.  The following Python script computes and plots a
transmission spectrum using the configuration file found at the top of
this tutorial:

.. code-block:: python

    import matplotlib.pyplot as plt
    plt.ion()

    import pyratbay as pb
    import pyratbay.constants as pc

    pyrat = pb.run('spectrum_transmission.cfg')

    # Plot the resulting spectrum:
    wl = 1.0 / (pyrat.spec.wn*pc.um)
    depth = pyrat.spec.spectrum / pc.percent
    wl_ticks = [0.3, 0.5, 0.7, 1.0, 2.0, 3.0, 5.0]

    plt.figure(-3, (7,4))
    plt.clf()
    ax = plt.subplot(111)
    plt.semilogx(wl, depth, "-", color='orange', lw=1.0)
    ax.get_xaxis().set_major_formatter(matplotlib.ticker.ScalarFormatter())
    ax.set_xticks(wl_ticks)
    plt.xlim(0.3, 5.0)
    plt.ylabel("Transit depth (Rp/Rs)$^2$ (%)")
    plt.xlabel("Wavelength (um)")

    # Or, alternatively:
    ax = pyrat.plot_spectrum()

And the results should look like this:

.. image:: ./figures/pyrat_transmission-spectrum_tutorial.png
    :width: 70%
    :align: center


.. note:: Note that although the user can define most input units,
          nearly all variables are stored in CGS units in the
          '*pyrat*' object.

The '*pyrat*' object is modular, and implements several convenience
methods to plot and display its content, as in the following example:

.. code-block:: python

    # pyrat object's string representation:
    print(pyrat)

    # String representation of the spectral variables:
    print(pyrat.spec)
