#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""Extract Eigenmike64 coordinates from official documentation"""

import numpy as np
import pandas as pd

# This dataframe contains measurements from the official document
columns = ["mic", "x", "y", "z", "theta", "phi", "weight"]
data = [
    [1, -0.011557241, -0.003634259, 0.040214702, 16.7656, 197.4561, 0.954],
    [2, -0.006821829, 0.014153239, 0.038950591, 21.9677, 115.734, 0.9738],
    [3, 0.003984595, 0.028035747, 0.031018059, 42.3941, 81.911, 1.0029],
    [4, 0.006624713, -0.007015439, 0.040876603, 13.2817, 313.3592, 1.0426],
    [5, 0.01180592, 0.011078169, 0.038754281, 22.6728, 43.1785, 1.0426],
    [6, 0.022897066, 0.02432533, 0.025455896, 52.6925, 46.7324, 1.0024],
    [7, 0.023518981, -0.010473407, 0.033183809, 37.806, 335.9958, 0.9738],
    [8, 0.027930555, 0.007244038, 0.030518977, 43.3944, 14.5398, 0.954],
    [9, -0.026528792, -0.012064556, 0.030243505, 43.9386, 204.4547, 1.009],
    [10, -0.035377244, -0.017670872, 0.014148888, 70.3132, 206.542, 0.9932],
    [11, -0.008872276, -0.021232674, 0.035134829, 33.2231, 247.3219, 1.0024],
    [12, -0.02147899, -0.029365592, 0.020983685, 60.0257, 233.817, 1.0324],
    [13, -0.003329298, -0.034854965, 0.023195849, 56.4763, 264.5437, 0.954],
    [14, -0.006515458, 0.038250201, 0.01607703, 67.4936, 99.6669, 1.0024],
    [15, -0.010629237, 0.040561896, -0.002398308, 93.2735, 104.6842, 1.0079],
    [16, -0.016145501, 0.026952875, 0.027872303, 48.423, 120.9227, 1.0268],
    [17, -0.024451299, 0.033028326, 0.008675458, 78.0793, 126.513, 1.0151],
    [18, -0.03154981, 0.019533694, 0.019673441, 62.0685, 148.2368, 0.9463],
    [19, -0.025073092, 0.007839137, 0.03277023, 38.7171, 162.6381, 1.012],
    [20, -0.037672903, 0.000953744, 0.018542999, 63.8004, 178.5498, 1.0253],
    [21, 0.036823528, 0.014335781, 0.014230711, 70.1946, 21.2715, 1.009],
    [22, 0.037594201, 0.018160279, -0.004569489, 96.246, 25.7834, 0.9932],
    [23, 0.02783995, 0.030768616, 0.00649841, 81.0992, 47.8607, 1.0324],
    [24, 0.022619641, 0.033418436, -0.011643021, 106.094, 55.9075, 1.0151],
    [25, 0.012380765, 0.036849368, 0.015900971, 67.7533, 71.4285, 0.954],
    [26, 0.00837538, 0.041137444, -0.001250487, 91.7061, 78.4921, 1.0079],
    [27, 0.010644033, -0.024809284, 0.032174585, 39.9985, 293.221, 1.0029],
    [28, 0.013754457, -0.036654662, 0.01520693, 68.7726, 290.5683, 1.0024],
    [29, 0.027326723, -0.024488403, 0.020434489, 60.8869, 318.1354, 1.0268],
    [30, 0.037408815, -0.018242135, 0.00563958, 82.2833, 334.0042, 0.9463],
    [31, 0.037068295, -0.005194603, 0.019051444, 63.0247, 352.0227, 1.012],
    [32, 0.041999728, 0, 0.000150987, 89.794, 0, 1.0253],
    [33, -0.028212155, 0.002948551, -0.030973868, 137.5166, 174.0335, 0.954],
    [34, -0.022826123, -0.014665642, -0.032060679, 139.7604, 212.7205, 0.9738],
    [35, -0.009183428, -0.028126445, -0.029808853, 135.2133, 251.9179, 1.0029],
    [36, -0.012302547, 0.006918823, -0.039557265, 160.3628, 150.6471, 1.0426],
    [37, -0.006130139, -0.010980567, -0.040073042, 162.577, 240.8266, 1.0426],
    [38, 0.010113875, -0.023754736, -0.03312736, 142.0685, 293.0625, 1.0024],
    [39, 0.011840051, -0.006560409, -0.039758953, 161.1987, 331.0098, 0.954],
    [40, 0.006130139, 0.010980566, -0.040073039, 162.577, 60.8266, 0.9738],
    [41, -0.025887652, -0.027677207, -0.018105291, 115.536, 226.9135, 1.0268],
    [42, -0.024678452, -0.03387427, 0.002740042, 86.2594, 233.9255, 1.0151],
    [43, -0.036679849, -0.008899681, -0.018422388, 116.0164, 193.6382, 1.012],
    [44, -0.036335686, -0.020699981, -0.003902395, 95.3313, 209.6696, 0.9463],
    [45, -0.041935747, -0.002321812, -4.67155e-05, 90.0637, 183.169, 1.0253],
    [46, -0.037520459, 0.010964305, -0.015362267, 111.4549, 163.7105, 1.009],
    [47, -0.038547052, 0.016400072, 0.003026973, 85.8671, 156.9524, 0.9932],
    [48, -0.024137073, 0.02066478, -0.02746577, 130.8398, 139.4318, 1.0024],
    [49, -0.029473784, 0.028489432, -0.00914595, 102.5775, 135.9729, 1.0324],
    [50, -0.00544157, 0.024900315, -0.033382085, 142.6375, 102.3273, 1.0029],
    [51, -0.01434762, 0.034551056, -0.019088482, 117.032, 112.5511, 0.954],
    [52, 0.0044431, 0.036967039, -0.019434429, 117.5631, 83.1464, 1.0024],
    [53, 0.023110697, -0.029893349, -0.018338031, 115.8884, 307.7078, 1.0324],
    [54, 0.026510308, -0.032575329, 0.000227251, 89.69, 309.1392, 1.0151],
    [55, 0.005300179, -0.036546219, -0.020007047, 118.4478, 278.2519, 0.954],
    [56, 0.009406824, -0.040831477, -0.002881338, 93.9338, 282.9735, 1.0079],
    [57, -0.011681846, -0.038563231, -0.011849547, 106.3875, 253.147, 1.0024],
    [58, -0.007155393, -0.040867068, 0.006533236, 81.0511, 260.0688, 1.0079],
    [59, 0.014708897, 0.025211, -0.03020023, 135.9764, 59.7394, 1.0268],
    [60, 0.024684172, 0.006257108, -0.033399704, 142.6771, 14.2241, 1.012],
    [61, 0.030475416, 0.019407585, -0.021414822, 120.6556, 32.4901, 0.9463],
    [62, 0.027225321, -0.013234437, -0.029114115, 133.8834, 334.0753, 1.009],
    [63, 0.037608328, 0.001368636, -0.0186478, 116.3591, 2.0842, 1.0253],
    [64, 0.036330318, -0.016888911, -0.012604466, 107.464, 335.0677, 0.9932],
]

df = pd.DataFrame(data, columns=columns)


def cart_to_spherical(x, y, z):
    r = np.sqrt(x * x + y * y + z * z)
    az = np.degrees(np.arctan2(y, x))  # azimuth in [-180, 180]
    el = np.degrees(np.arcsin(np.clip(z / r, -1.0, 1.0)))  # elevation
    return az, el, r


spherical = np.array(
    [cart_to_spherical(row.x, row.y, row.z) for _, row in df.iterrows()]
)
spherical_df = pd.DataFrame(
    spherical, columns=["azimuth_deg", "elevation_deg", "radius_m"]
)

spherical_df.to_csv("spherical_output.csv", index=False)
