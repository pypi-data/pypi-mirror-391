import{j as e}from"./ui-DTFgKa_e.js";import{f as I,j as $,r as h}from"./vendor-Dje7enk0.js";import{u as Z,d as q,a as w,B as N,C as z,S as G,A as H}from"./index-0yrTELIs.js";import{C as A,d as P,b as M,c as J,a as O}from"./card-HakkjSnQ.js";import{B as K}from"./badge-DYcv9hhs.js";import{V as W,I as Y}from"./VMCPDetailsDisplay-nJhE5jcz.js";import{T as Q}from"./triangle-alert-bbcaI3tC.js";import{A as V}from"./arrow-left-ChAqfb10.js";import{Z as X}from"./zap-C10tSVHS.js";import{L as ee}from"./lock-CHHgFfoZ.js";import{M as se}from"./message-square-aZRecKtB.js";import{C as te}from"./circle-check-big-CagfiKQs.js";import"./favicon-icon-Bs8D6XCE.js";import"./chevron-down-BUL9fqa3.js";import"./type-CY7MeKqs.js";import"./file-text-CdJnDdiQ.js";import"./wifi-DEKqDK__.js";function Ne(){const f=Z(),S=I(),[c]=$(),{error:g}=q(),i=S.vmcp_name,b=c.get("vmcp_username"),j=c.get("code"),l=c.get("state"),t=c.get("redirect_url"),u=c.get("user_id"),x=c.get("vmcp_type"),d=c.get("error"),[k,v]=h.useState(!0),[C,y]=h.useState(!1),[s,_]=h.useState(null);h.useEffect(()=>{E()},[]);const E=async()=>{try{if(v(!0),console.log("Loading VMCP data for:",i,b,u,d),d){v(!1);return}const r=c.get("fetch_vmcp_config_from");if(r){const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({original_state:l,vmcp_name:i,vmcp_username:b,user_id:u})});if(a.ok){const p=await a.json(),n=p.vmcp_config||{},L=Object.values(n.selected_tools||{}).reduce((m,o)=>m+(Array.isArray(o)?o.length:0),0),B=Object.values(n.selected_resources||{}).reduce((m,o)=>m+(Array.isArray(o)?o.length:0),0),D=Object.values(n.selected_prompts||{}).reduce((m,o)=>m+(Array.isArray(o)?o.length:0),0),F=n.name||n.selected_servers?.[0]?.name||i,U=n.description||n.selected_servers?.[0]?.description;_({id:p.vmcp_new_id||i,name:F,description:U,vmcp_config:n,total_tools:L,total_resources:B,total_prompts:D,environment_variables:n.environment_variables||[]})}else throw new Error("Failed to fetch VMCP configuration")}else{const a=await w.getVMCPConfiguration(i,{code:j,state:l,redirect_url:t,user_id:u,vmcp_type:x});a.success?_(a.data):g("Failed to load VMCP data")}}catch(r){console.error("Error loading VMCP data:",r),g("Error loading VMCP data")}finally{v(!1)}},T=async()=>{try{y(!0),console.log("Saving VMCP Configuration");const r=await w.saveVMCPConfiguration(i,{vmcp_config:s,code:j,state:l,user_id:u,vmcp_type:x});if(console.log("VMCP Configuration saved"),t){console.log("Redirecting to:",t);const a=t.includes("?")?"&":"?",p=t+(l?"&state="+l:"");window.location.href=p}else f.push(`/oauth_setup/${i}/callback?code=${j}&state=${l}&configured=true`)}catch(r){console.error("Error completing OAuth:",r),g("Error completing OAuth flow")}finally{y(!1)}},R=()=>{if(t){const r=t.includes("?")?"&":"?",a=t+r+"error="+encodeURIComponent(d||"OAuth setup failed");console.log("Returning to client:",a),window.location.href=a}else f.push("/vmcp")};return k?e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading OAuth configuration..."})]})}):d?e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-destructive/20 flex items-center justify-center mx-auto mb-4",children:e.jsx(Q,{className:"h-6 w-6 text-destructive"})}),e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"OAuth Setup Error"}),e.jsx("div",{className:"p-4 bg-destructive/10 border border-destructive/20 rounded-lg mb-6",children:e.jsx("p",{className:"text-destructive text-sm",children:d})}),e.jsx("div",{className:"flex gap-3 justify-center",children:t&&e.jsxs(N,{onClick:R,variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Return to Client"]})})]})}):s?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/20 flex items-center justify-center",children:e.jsx(z,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Complete OAuth Setup"}),e.jsxs("p",{className:"text-muted-foreground",children:["OAuth authentication for ",s.name]})]})]})}),e.jsxs(A,{className:"mb-6",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(M,{className:"text-xl",children:s.name}),e.jsx(J,{className:"text-sm mt-1",children:s.description||"No description available"})]}),e.jsx(K,{variant:"default",className:"text-xs px-2 py-1",children:x==="wellknown"?"Well-Known":"Public"})]})}),e.jsx(O,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(G,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:s.vmcp_config?.selected_servers?.length||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"MCP Servers"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(X,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:s.total_tools||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tools"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(ee,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:s.total_resources||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Resources"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-muted/30",children:[e.jsx(se,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("div",{className:"text-xl font-bold",children:s.total_prompts||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Prompts"})]})]})})]}),e.jsx("div",{className:"mb-8",children:e.jsx(W,{vmcpData:s,vmcpType:x||"public",isRemoteVMCP:!1,showExpandableLists:!1})}),e.jsxs(A,{className:"mb-8",children:[e.jsx(P,{children:e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-primary"}),"OAuth Setup Details"]})}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"By completing the OAuth flow, you will:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 pl-4",children:[e.jsx("li",{children:"• Authenticate with the VMCP service"}),e.jsx("li",{children:"• Grant necessary permissions for the VMCP to function"}),e.jsx("li",{children:"• Complete the setup process"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You can configure server authentication and environment variables after OAuth completion."})]})})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(N,{onClick:T,disabled:C,size:"lg",className:"px-8 py-3",children:C?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 mr-2 animate-spin"}),"Completing OAuth..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Complete OAuth Setup"]})})})]})}):e.jsx("div",{className:"min-h-screen bg-background text-foreground flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-destructive",children:"OAuth configuration not found"}),e.jsxs(N,{onClick:()=>f.push("/vmcp"),className:"mt-4",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Back to VMCP"]})]})})}export{Ne as default};
//# sourceMappingURL=OAuthSetupConfigurePage-rmAf-Wro.js.map
