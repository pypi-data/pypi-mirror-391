[tool.poetry]
name = "forging-blocks"
version = "0.3.6"
description = "Composable toolkit for clean, testable, and maintainable Python applications"
authors = ["ForgingBlocks Org <forgingblocksorganization91@gmail.com>"]
license = "MIT"
readme = "README.md"
repository = "https://github.com/forging-blocks-org/forging-blocks"
homepage = "https://forging-blocks-org.github.io/forging-blocks/"
packages = [{ include = "forging_blocks", from = "src" }]
keywords = [
  "python library",
  "clean architecture",
  "hexagonal architecture",
  "domain-driven design",
  "ddd",
  "framework-agnostic",
  "software architecture",
  "software design",
  "software engineering",
  "ports and adapters",
  "adapter pattern",
  "application service",
  "repository pattern",
  "message bus",
  "notifier pattern",
  "data mapper",
  "result pattern",
  "result monad",
  "ok",
  "err",
  "either type",
  "debuggable",
  "use case",
  "domain layer",
  "application layer",
  "presentation layer",
  "foundation",
  "forging blocks",
]

[tool.poetry.dependencies]
python = "^3.12"

[tool.poetry.group.dev.dependencies]
mypy = "^1.16.1"
ruff = "^0.14.3"
black = "^25.1.0"
pytest = "^8.3.3"
pytest-cov = "^5.0.0"
pytest-asyncio = "^0.25.0"
bandit = "^1.7.10"
pre-commit = "^4.2.0"
pyright = "^1.1.404"
poethepoet = "^0.37.0"
libcst = "^1.8.6"

[tool.poetry.group.docs.dependencies]
mkdocs = "^1.6.1"
mkdocs-material = "^9.6.23"
mkdocstrings = {extras = ["python"], version = "^0.30.1"}
mkdocs-gen-files = "^0.5.0"
mkdocs-literate-nav = "^0.6.2"
mkdocs-autorefs = "^1.4.3"
mkdocs-mermaid2-plugin = "^1.2.3"
mkdocs-section-index = "^0.3.10"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.ruff]
target-version = "py312"
line-length = 100
src = ["src", "tests", "scripts"]
fix = true
extend-exclude = ["site"]

[tool.ruff.lint]
select = ["E", "W", "F", "I", "B", "C4", "D"]
ignore = [
    "B008",
    "D105",
    "D106",
    "D107",
    "D203",
    "D213",
]

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.ruff.lint.isort]
known-first-party = ["forging_blocks"]

[tool.ruff.lint.per-file-ignores]
"tests/**/*" = ["D"]
"scripts/*.py" = ["D100", "D101", "D102", "D103", "D104", "D105", "D106", "D107"]

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
docstring-code-format = true

# ---------------------------------------------------------------------------
# Mypy Configuration
# ---------------------------------------------------------------------------
[tool.mypy]
python_version = "3.12"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
disallow_incomplete_defs = false
allow_untyped_globals = true
check_untyped_defs = false
no_implicit_optional = true
warn_redundant_casts = true
warn_unused_ignores = true
strict_equality = true
show_error_codes = true
mypy_path = "src"
exclude = ["^tests/"]

[[tool.mypy.overrides]]
module = "src.*"
disallow_incomplete_defs = true
check_untyped_defs = true

[[tool.mypy.overrides]]
module = "tests.*"
disallow_untyped_defs = true
disallow_incomplete_defs = false
check_untyped_defs = false
allow_untyped_globals = true

# ---------------------------------------------------------------------------
# Pytest Configuration
# ---------------------------------------------------------------------------
[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
asyncio_mode = "auto"
addopts = [
  "--strict-markers",
  "--strict-config",
  "--cov=forging_blocks",
  "--cov-report=term-missing",
]

# ---------------------------------------------------------------------------
# Coverage Configuration
# ---------------------------------------------------------------------------
[tool.coverage.report]
exclude_lines = [
    "@abstractmethod"
]

[tool.coverage.run]
omit = [
    "src/forging_blocks/application/ports/inbound/*.py",
    "src/forging_blocks/application/ports/outbound/*.py",
    "src/forging_blocks/foundation/mapper.py",
    "src/forging_blocks/foundation/result_mapper.py",
    "src/forging_blocks/foundation/ports.py",
    "src/forging_blocks/foundation/debuggable.py"
]

[tool.black]
line-length = 100
target-version = ["py312"]

[tool.flake8]
max-line-length = 100
extend-ignore = "E203,W503"
class-order-style = "google"

[tool.flake8-class-attributes-order]
order = [
  "__new__",
  "__init__",
  "classmethod",
  "staticmethod",
  "property",
  "method",
  "dunder"
]

class_attributes_order_style = "custom"

[tool.poe.tasks]
lint = { cmd = "ruff check ." }

"lint:docs" = { cmd = "ruff check --select D100,D101,D102,D103,D104 src" }

"lint:fix" = { cmd = "ruff check . --fix" }

format.sequence = [
  { cmd = "ruff check . --fix" },
  { cmd = "ruff check --fix --unsafe-fixes src" },
]
"format:docs" = { cmd = "ruff check --select D --fix --unsafe-fixes src" }
"type:mypy" = { cmd = "mypy --config-file pyproject.toml src" }
"type:pyright" = { cmd = "pyright" }
bandit = { cmd = "bandit -r src -x tests" }
pre-commit = { cmd = "pre-commit run --all-files" }
test = { cmd = "pytest -q" }
"test:quick" = { cmd = "pytest -x -q" }
"test:strict" = { cmd = "pytest -x --strict-markers" }
"test:nocov" = { cmd = "pytest -q --no-cov" }
"test:pipeline" = { cmd = "pytest --cov=src --cov-report=xml --cov-fail-under=80" }
"mkdocs:serve" = { cmd = "mkdocs serve" }
"mkdocs:build" = { cmd = "mkdocs build" }
"mkdocs:clean" = { cmd = "mkdocs build --clean" }
"mkdocs:deploy" = { cmd = "mkdocs gh-deploy --clean" }
"docs:generate" = { cmd = "python scripts/generate_autodoc_pages.py" }
"docs:serve".sequence = [
    { cmd = "mkdocs build --clean" },
    { cmd = "mkdocs serve" },
]
"docs:check".sequence = [
  { cmd = "ruff check --select D" },
  { cmd = "mkdocs build --strict" },
]
"docs:clean" = { cmd = "git restore mkdocs.yml" }
"ci:simulate".sequence = [
  { cmd = "poetry install --with dev,docs" },
  { cmd = "poetry run poe lint" },
  { cmd = "poetry run poe type:mypy" },
  { cmd = "poetry run poe test:pipeline" },
  { cmd = "poetry run python scripts/generate_autodoc_pages.py" },
  { shell = "poetry run mkdocs build --strict || echo '‚ùå MkDocs build failed (warnings treated as errors). See log above.'" },
  { cmd = "git restore mkdocs.yml" }  # revert autogenerated changes
]
"ci:clean".sequence = [
  { cmd = "rm -rf .venv ~/.cache/pypoetry" },
  { cmd = "poetry env use 3.12" },
  { cmd = "poetry lock --no-update" },
  { cmd = "poetry install --with dev,docs" },
  { cmd = "poetry run poe lint" },
  { cmd = "poetry run poe type:mypy" },
  { cmd = "poetry run poe test:pipeline" },
  { cmd = "poetry run python scripts/generate_autodoc_pages.py" },
  { cmd = "poetry run mkdocs build --strict" },
  { cmd = "git restore mkdocs.yml" }  # clean after run
]
