"use strict";(self.webpackChunkjupyterlab_refresh_view_extension=self.webpackChunkjupyterlab_refresh_view_extension||[]).push([[509],{509:(e,o,t)=>{t.r(o),t.d(o,{default:()=>i});var r=t(986),n=t(249),l=t(138),c=t(560);const s={id:"jupyterlab_refresh_view_extension:plugin",description:"A JupyterLab to allow context menu option to refresh markdown or notebook",autoStart:!0,requires:[l.IDocumentManager],optional:[r.ICommandPalette,n.IFileBrowserFactory,c.ISettingRegistry],activate:(e,o,t,r,n)=>{console.log("JupyterLab extension jupyterlab_refresh_view_extension is activated!");let l={notebookScrollRestoration:!0,markdownScrollRestoration:!0,notebookTimeout:5e3,markdownTimeout:5e3};n&&n.load(s.id).then(e=>{l.notebookScrollRestoration=e.get("notebookScrollRestoration").composite,l.markdownScrollRestoration=e.get("markdownScrollRestoration").composite,l.notebookTimeout=e.get("notebookTimeout").composite,l.markdownTimeout=e.get("markdownTimeout").composite,console.log("[SETTINGS] Loaded:",l),e.changed.connect(()=>{l.notebookScrollRestoration=e.get("notebookScrollRestoration").composite,l.markdownScrollRestoration=e.get("markdownScrollRestoration").composite,l.notebookTimeout=e.get("notebookTimeout").composite,l.markdownTimeout=e.get("markdownTimeout").composite,console.log("[SETTINGS] Updated:",l)})}).catch(e=>{console.error("[SETTINGS] Failed to load settings:",e)});const{commands:c}=e,i="jupyterlab_refresh_view:refresh";c.addCommand(i,{label:"Refresh View",caption:"Refresh the current document view without scrolling",execute:async()=>{const t=e.shell.currentWidget;if(!t)return;const r=o.contextForWidget(t);if(!r)return;const n=t.node.querySelector(".jp-WindowedPanel-outer")||t.node.querySelector(".jp-RenderedMarkdown")||t.node.querySelector(".jp-FileEditor");let c=0,s=0,i=-1,a=0;if(n){c=n.scrollTop,s=n.scrollLeft;const e=Array.from(t.node.querySelectorAll(".jp-Cell"));if(e.length>0){const o=n.getBoundingClientRect();for(let t=0;t<e.length;t++){const r=e[t].getBoundingClientRect(),n=r.top-o.top;if(n>=-r.height&&n<=o.height){i=t,a=n;break}}}}try{await r.revert();const e=i>=0;if(n&&(e&&l.notebookScrollRestoration||!e&&l.markdownScrollRestoration&&c>0)){const o=()=>{if(e){const e=Array.from(t.node.querySelectorAll(".jp-Cell"));if(i<e.length){const o=e[i],t=n.getBoundingClientRect(),r=o.getBoundingClientRect().top-t.top;return n.scrollTop+=r-a,n.scrollLeft=s,!0}return!1}return n.scrollTop=c,n.scrollLeft=s,!1};o();let r=0,d=0,m=n.scrollHeight,u=n.scrollTop;const p=null!==t.node.querySelector(".jp-RenderedMarkdown pre code.language-mermaid"),g=Array.from(t.node.querySelectorAll(".jp-RenderedMarkdown img")),h=g.length>0;let f=0;const k=g.length,w=(e,o)=>()=>{f++,f>=k&&(d=0)};g.forEach((e,o)=>{const t=w(e,o);e.addEventListener("load",t,{once:!0}),e.addEventListener("error",t,{once:!0}),e.complete&&0!==e.naturalHeight&&t()});const T=e?l.notebookTimeout:l.markdownTimeout,b=Math.floor(T/100),S=h||p?5:3,R=setInterval(()=>{const t=n.scrollHeight,i=n.scrollTop,a=o(),p=Math.abs(i-u)<1,g=Math.abs(t-m)<1,h=a?n.scrollTop:c;if(Math.abs(i-h)<1&&p&&g){if(d++,d>=S){if(clearInterval(R),!e&&l.markdownScrollRestoration){let e=0;const o=Math.floor(l.markdownTimeout/100),t=setInterval(()=>{const r=n.scrollTop;Math.abs(r-c)>1&&(n.scrollTop=c,n.scrollLeft=s),e++,e>=o&&clearInterval(t)},100)}return}}else d=0;u=i,m=t,r++,r>=b&&(clearInterval(R),setTimeout(()=>{console.log(`[SNAPSHOT-3s] scrollTop=${n.scrollTop}px, height=${n.scrollHeight}px, drift=${Math.abs(n.scrollTop-c).toFixed(2)}px`)},3e3))},100)}}catch(e){console.error("Failed to refresh document:",e)}},isEnabled:()=>{const t=e.shell.currentWidget;return!!t&&void 0!==o.contextForWidget(t)}}),t&&t.addItem({command:i,category:"File Operations"}),e.contextMenu.addItem({command:i,selector:".jp-Document",rank:0}),console.log("Context menu items registered for refresh view extension")}},i=s}}]);