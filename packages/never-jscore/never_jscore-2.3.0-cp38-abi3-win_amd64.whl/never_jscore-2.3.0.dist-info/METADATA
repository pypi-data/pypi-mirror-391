Metadata-Version: 2.4
Name: never-jscore
Version: 2.3.0
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: Implementation :: CPython
Classifier: Programming Language :: Rust
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: Software Development :: Interpreters
Classifier: Typing :: Typed
Summary: High-performance Python JavaScript execution engine based on Deno Core (V8) with full Promise/async support - py_mini_racer style API
Keywords: javascript,execjs,deno,v8,js,python,rust,promise,async,py_mini_racer
License: MIT
Requires-Python: >=3.8
Description-Content-Type: text/markdown; charset=UTF-8; variant=GFM
Project-URL: Homepage, https://github.com/neverl805/never-jscore
Project-URL: Repository, https://github.com/neverl805/never-jscore
Project-URL: Documentation, https://github.com/neverl805/never-jscore#readme
Project-URL: Bug Tracker, https://github.com/neverl805/never-jscore/issues

# never_jscore ä¸­æ–‡æ–‡æ¡£

åŸºäº Deno Core (V8) çš„é«˜æ€§èƒ½ Python JavaScript æ‰§è¡Œå¼•æ“ï¼Œ**ä¸“ä¸º JS é€†å‘å·¥ç¨‹å’Œè¡¥ç¯å¢ƒä¼˜åŒ–**ã€‚
åŠªåŠ›æˆä¸ºPyExecJSä¸Šä½æ›¿ä»£å“,ç›®çš„ä»…ä¸ºäº†å­¦ä¹ æŠ€æœ¯ç ”ç©¶,è¯·å‹¿ç”¨äºè¿æ³•ç”¨é€”,åæœè‡ªè´Ÿ


åŠ vè¿›äº¤æµç¾¤: xu970821582
## é¡¹ç›®ç‰¹ç‚¹

- âš¡ **æè‡´æ€§èƒ½**:
  - ä½¿ç”¨ Rust + Deno Core (V8 å¼•æ“)
  - å®ä¾‹åŒ– Context å¤ç”¨ä¼˜åŒ–
  - **æ¯” PyExecJS å¿« 100-300å€**
  - **ä¸ PyMiniRacer æ€§èƒ½ç›¸å½“ï¼Œéƒ¨åˆ†åœºæ™¯æ›´å¿«**
- ğŸ”„ **Promise/async æ”¯æŒ**:
  - å®Œæ•´æ”¯æŒ Promise å’Œ async/await
  - è‡ªåŠ¨ç­‰å¾…å¼‚æ­¥ç»“æœ
  - **å”¯ä¸€é«˜æ€§èƒ½ Promise æ–¹æ¡ˆ**ï¼ˆPyMiniRacer ä¸æ”¯æŒï¼‰
- ğŸ£ **Hook æ‹¦æˆªä¸æå‰è¿”å›** (v2.2.2):
  - æ”¯æŒåœ¨ä»»æ„ä½ç½®ç»ˆæ­¢JSæ‰§è¡Œå¹¶è¿”å›ç»“æœ
  - Hook XMLHttpRequest.send æ‹¦æˆªåŠ å¯†æ•°æ®
  - Hook åŠ å¯†å‡½æ•°è·å–ä¸­é—´å€¼
  - å®Œç¾é€‚é… JS é€†å‘å·¥ç¨‹åœºæ™¯
- ğŸ² **ç¡®å®šæ€§éšæœºæ•°** (v2.3.0):
  - æ”¯æŒå›ºå®šéšæœºæ•°ç§å­ï¼ˆrandom_seedï¼‰
  - Math.randomã€crypto.randomUUIDã€crypto.getRandomValues å…¨éƒ¨å¯æ§
  - ç›¸åŒç§å­äº§ç”Ÿç›¸åŒéšæœºæ•°åºåˆ—
  - å®Œç¾ç”¨äºè°ƒè¯•åŠ¨æ€å‚æ•°ç®—æ³•å’Œå¯é‡ç°æµ‹è¯•
- ğŸŒ **å®Œæ•´ Web API æ‰©å±•** (v2.2.0):
  - âœ… **Node.js APIs**: require()ã€fsã€pathã€fetch()
  - âœ… **æµè§ˆå™¨å­˜å‚¨**: localStorageã€sessionStorage
  - âœ… **æµè§ˆå™¨ç¯å¢ƒ(ç®€æ˜“å®ç°)**: navigatorã€locationã€documentã€windowã€screen
  - âœ… **URL å¤„ç†**: URLã€URLSearchParams
  - âœ… **è¡¨å•æ•°æ®**: FormData
  - âœ… **äº‹ä»¶ç³»ç»Ÿ**: Eventã€EventTarget
  - âœ… **ç½‘ç»œè¯·æ±‚**: fetch()ã€XMLHttpRequest
  - âœ… **æ€§èƒ½ç›‘æ§** (v2.2.1): performance.now()ã€performance.mark()ã€performance.measure()
  - âœ… **Crypto APIs**: Base64ã€MD5ã€SHA1/256/512ã€HMACã€Hex
  - âœ… **URL ç¼–ç **: encodeURIComponentã€encodeURI ç­‰
  - âœ… **å®šæ—¶å™¨**: setTimeoutã€setIntervalï¼ˆç«‹å³æ‰§è¡Œç‰ˆæœ¬ï¼‰
  - âœ… **éšæœºæ•°**: crypto.randomUUID()ã€crypto.getRandomValues()
  - ğŸ¯ ä¸“ä¸º JS é€†å‘å’Œè¡¥ç¯å¢ƒè®¾è®¡ï¼Œæ— éœ€é¢å¤– polyfill
- ğŸ“¦ **ä¸Šä¸‹æ–‡éš”ç¦»**: æ¯ä¸ª Context ç‹¬ç«‹çš„ V8 æ‰§è¡Œç¯å¢ƒï¼Œäº’ä¸å¹²æ‰°
- ğŸ¯ **py_mini_racer å…¼å®¹**: API è®¾è®¡ç±»ä¼¼ py_mini_racerï¼Œå®ä¾‹åŒ–ä½¿ç”¨
- ğŸ§¹ **è‡ªåŠ¨å†…å­˜ç®¡ç†**: åŸºäº Rust çš„è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œæ— å†…å­˜æ³„æ¼
- ğŸ›¡ï¸ **ç±»å‹å®‰å…¨**: æä¾›å®Œæ•´çš„ç±»å‹æç¤ºï¼ˆ.pyi æ–‡ä»¶ï¼‰


## ç‰¹æ€§å¯¹æ¯”è¡¨

| ç‰¹æ€§ | never_jscore | PyExecJS | PyMiniRacer | js2py | dukpy |
|------|--------------|----------|-------------|-------|-------|
| å¼•æ“ | V8           | Node/V8ç­‰ | V8 | çº¯Python | Duktape |
| Promise | âœ… å®Œæ•´         | âŒ | âš ï¸ æœ‰é™ | âŒ | âŒ |
| async/await | âœ…            | âŒ | âš ï¸ | âŒ | âŒ |
| require() | âœ… å®Œæ•´         | âœ… | âŒ | âŒ | âŒ |
| fetch() | âœ…            | âŒ | âŒ | âŒ | âŒ |
| localStorage | âœ…            | âŒ | âŒ | âŒ | âŒ |
| æµè§ˆå™¨ç¯å¢ƒ | ï¸ âš ï¸å¤§éƒ¨åˆ†      | âŒ | âŒ | âš ï¸ éƒ¨åˆ† | âŒ |
| æ€§èƒ½ | âš¡âš¡âš¡âš¡âš¡        | âš¡âš¡ | âš¡âš¡âš¡âš¡âš¡ | âš¡ | âš¡âš¡âš¡ |
| å®‰è£…éš¾åº¦ | ç®€å•           | éœ€Node.js | ç®€å• | ç®€å• | ç®€å• |
| ä¸Šä¸‹æ–‡å¤ç”¨ | âœ…            | âœ… | âœ… | âœ… | âœ… |
| ç±»å‹è½¬æ¢ | è‡ªåŠ¨           | è‡ªåŠ¨ | è‡ªåŠ¨ | è‡ªåŠ¨ | è‡ªåŠ¨ |
| ES6+ | âœ… å®Œæ•´         | âœ… | âœ… | âš ï¸ éƒ¨åˆ† | âš ï¸ éƒ¨åˆ† |

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆ PyMiniRacer åœ¨æŸäº›æµ‹è¯•ä¸­æ›´å¿«ï¼Ÿ
A: PyMiniRacer æ˜¯ V8 çš„ç›´æ¥ç»‘å®šï¼Œå¼€é”€æœ€å°ã€‚never_jscore ä½¿ç”¨ rustå¼€å‘ä»¥åŠDeno Coreï¼Œæœ‰è½»é‡çº§åŒ…è£…å±‚ï¼Œä½†æä¾›äº†æ›´å¤šåŠŸèƒ½ï¼ˆå¦‚ Promise æ”¯æŒï¼‰ã€‚

### Q: ä»€ä¹ˆæ—¶å€™é€‰æ‹© never_jscoreï¼Ÿ
A: å½“ä½ éœ€è¦:
- Promise/async æ”¯æŒï¼ˆç°ä»£ JS åº“ï¼‰
- é«˜æ€§èƒ½ + Rust ç¨³å®šæ€§
- å®Œæ•´çš„ Node.js ç¯å¢ƒï¼ˆrequireã€fsã€pathï¼‰
- æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿï¼ˆè¡¥ç¯å¢ƒï¼‰
- fetch() ç½‘ç»œè¯·æ±‚
- localStorage/sessionStorage
- JS é€†å‘å·¥ç¨‹

### Q: PyExecJS ä¸ºä»€ä¹ˆè¿™ä¹ˆæ…¢ï¼Ÿ
A: PyExecJS é€šè¿‡è¿›ç¨‹è°ƒç”¨å¤–éƒ¨ JS è¿è¡Œæ—¶ï¼Œæ¯æ¬¡éƒ½æœ‰è¿›ç¨‹é€šä¿¡å¼€é”€ã€‚



## å¯ç”¨æµ‹è¯•æ–‡ä»¶
- [benchmark.py](examples/benchmark.py) - æ€§èƒ½åŸºå‡†æµ‹è¯•
- [hook_examples.py](examples/hook_examples.py) - Hookæ‹¦æˆªä½¿ç”¨ç¤ºä¾‹ï¼ˆv2.2.2 æ–°å¢ï¼‰
- [test_async_simple.py](tests/test_async_simple.py) - å¼‚æ­¥åŠŸèƒ½æµ‹è¯•
- [test_extensions.py](tests/test_extensions.py) - æ‰©å±• API æµ‹è¯•
- [test_new_apis.py](tests/test_new_apis.py) - æ–° API æµ‹è¯•
- [test_all_features.py](tests/test_all_features.py) - å®Œæ•´åŠŸèƒ½æµ‹è¯•å¥—ä»¶
- [test_browser_apis.py](tests/test_browser_apis.py) - æµè§ˆå™¨ API æµ‹è¯•
- [test_high_priority_apis.py](tests/test_high_priority_apis.py) - é«˜ä¼˜å…ˆçº§ API æµ‹è¯•
- [test_hook_interception.py](tests/test_hook_interception.py) - Hookæ‹¦æˆªåŠŸèƒ½æµ‹è¯•ï¼ˆv2.2.2 æ–°å¢ï¼‰
- [test_random_seed.py](tests/test_random_seed.py) - éšæœºæ•°ç§å­åŠŸèƒ½æµ‹è¯•ï¼ˆv2.3.0 æ–°å¢ï¼‰
- [test_wasm.py](tests/test_wasm.py) - WebAssembly æµ‹è¯•
- [use_polyfill.py](examples/use_polyfill.py) - Polyfill ä½¿ç”¨ç¤ºä¾‹




## æ€§èƒ½å¯¹æ¯”
![img.png](img.png)

| æµ‹è¯•é¡¹ç›®                         | never_jscore   | PyMiniRacer | PyExecJS |
|------------------------------|----------------|------------|----------|
| ç®€å•è®¡ç®—                         | 0.007ms        | 0.005ms    | 2.3ms    |
| å­—ç¬¦ä¸²æ“ä½œ                        | **0.004ms** ğŸ† | 0.008ms    | 2.3ms    |
| æ•°ç»„æ“ä½œ                         | **0.004ms** ğŸ† | 0.006ms    | 2.3ms    |
| å¤æ‚ç®—æ³•å‚æ•°ç”Ÿæˆ<br/>(1000æ¬¡å¾ªç¯ )<br/>[benchmark.py](examples/benchmark.py) | **0.0111s** ğŸ† | 0.0383s    | 69.4735s |
| Promise                      | **âœ… 0.003ms**  | âŒ ä¸æ”¯æŒ      | âŒ ä¸æ”¯æŒ    |


## å®‰è£…
```bash
pip install never-jscore
```

### ä»æºç å®‰è£…

```bash
pip install maturin
maturin develop --release
```

## å¿«é€Ÿå¼€å§‹

### 0. åˆ›å»º Contextï¼ˆå¯ç”¨æ‰©å±•ï¼‰

```python
import never_jscore

# å¯ç”¨ Web API æ‰©å±•ï¼ˆé»˜è®¤ï¼Œæ¨èç”¨äº JS é€†å‘ï¼‰
ctx = never_jscore.Context(enable_extensions=True)

# æˆ–ç¦ç”¨æ‰©å±•ï¼ˆçº¯å‡€ V8 ç¯å¢ƒï¼‰
ctx = never_jscore.Context(enable_extensions=False)

# å¯ç”¨æ—¥å¿—è¾“å‡ºï¼ˆè°ƒè¯•æ¨¡å¼ï¼Œv2.2.0+ï¼‰
ctx = never_jscore.Context(enable_logging=True)

# ä½¿ç”¨å›ºå®šéšæœºæ•°ç§å­ï¼ˆç¡®å®šæ€§æ‰§è¡Œï¼Œv2.3.0+ï¼‰
ctx = never_jscore.Context(random_seed=12345)

# ç»„åˆä½¿ç”¨
ctx = never_jscore.Context(
    enable_extensions=True,  # å¯ç”¨æ‰©å±•
    enable_logging=False,    # å…³é—­æ—¥å¿—
    random_seed=42          # å›ºå®šç§å­
)
```

### 1. åŸºæœ¬ç”¨æ³•ï¼ˆå®ä¾‹åŒ– Contextï¼‰

```python
import never_jscore

# åˆ›å»º JavaScript æ‰§è¡Œä¸Šä¸‹æ–‡
ctx = never_jscore.Context()

# ä¸€æ¬¡æ€§æ±‚å€¼
result = ctx.evaluate("1 + 2 + 3")
print(result)  # 6

# å­—ç¬¦ä¸²æ“ä½œ
result = ctx.evaluate("'Hello'.toUpperCase()")
print(result)  # HELLO

# æ•°ç»„æ“ä½œ
result = ctx.evaluate("[1, 2, 3].map(x => x * 2)")
print(result)  # [2, 4, 6]
```

### 2. ç¼–è¯‘å’Œè°ƒç”¨

```python
import never_jscore

# åˆ›å»ºä¸Šä¸‹æ–‡
ctx = never_jscore.Context()

# ç¼–è¯‘ JavaScript ä»£ç 
ctx.compile("""
    function add(a, b) {
        return a + b;
    }

    function greet(name) {
        return "Hello, " + name + "!";
    }
""")

# è°ƒç”¨å‡½æ•°
print(ctx.call("add", [5, 3]))        # 8
print(ctx.call("greet", ["World"]))   # Hello, World!
```

### 3. å¼‚æ­¥æ”¯æŒï¼ˆPromise/async/awaitï¼‰

```python
import never_jscore

ctx = never_jscore.Context()

# async å‡½æ•°
ctx.compile("""
    async function fetchData(id) {
        // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
        return await Promise.resolve({id: id, name: "User" + id});
    }
""")

# Promise è‡ªåŠ¨ç­‰å¾…
result = ctx.evaluate("Promise.resolve(42)")
print(result)  # 42

result = ctx.call("fetchData", [123])
print(result)  # {'id': 123, 'name': 'User123'}

# Promise é“¾
result = ctx.evaluate("""
    Promise.resolve(10)
        .then(x => x * 2)
        .then(x => x + 5)
""")
print(result)  # 25

# Promise.all å¹¶å‘
result = ctx.evaluate("""
    Promise.all([
        Promise.resolve(1),
        Promise.resolve(2),
        Promise.resolve(3)
    ])
""")
print(result)  # [1, 2, 3]
```

### 4. ä¸Šä¸‹æ–‡çŠ¶æ€ç®¡ç†

```python
import never_jscore

ctx = never_jscore.Context()
ctx.compile("""
    var counter = 0;

    function increment() {
        return ++counter;
    }

    function getCounter() {
        return counter;
    }
""")

print(ctx.call("increment", []))  # 1
print(ctx.call("increment", []))  # 2
print(ctx.call("getCounter", []))  # 2
```

### 5. å¤æ‚å¯¹è±¡å¤„ç†

```python
import never_jscore

ctx = never_jscore.Context()
ctx.compile("""
    function processUser(name, age, tags) {
        return {
            name: name,
            age: age,
            isAdult: age >= 18,
            tags: tags,
            summary: name + ' (' + age + 'å²)'
        };
    }
""")

result = ctx.call("processUser", ["å¼ ä¸‰", 25, ["Python", "JavaScript"]])
print(result)
# {
#     'name': 'å¼ ä¸‰',
#     'age': 25,
#     'isAdult': True,
#     'tags': ['Python', 'JavaScript'],
#     'summary': 'å¼ ä¸‰ (25å²)'
# }
```

### 6. æ€§èƒ½ç›‘æ§

```python
import never_jscore

ctx = never_jscore.Context()
ctx.compile("function compute(n) { return n * n; }")

# æ‰§è¡Œå¤šæ¬¡
for i in range(100):
    ctx.call("compute", [i])

# æŸ¥çœ‹ç»Ÿè®¡
stats = ctx.get_stats()
print(f"æ‰§è¡Œæ¬¡æ•°: {stats[0]}")  # 100

# è¯·æ±‚åƒåœ¾å›æ”¶ï¼ˆå¯é€‰ï¼‰
ctx.gc()

# é‡ç½®ç»Ÿè®¡
ctx.reset_stats()
```

### 7. Hookæ‹¦æˆªä¸æå‰è¿”å›ï¼ˆv2.2.2 æ–°å¢ï¼‰

```python
import never_jscore

ctx = never_jscore.Context()

# ç¤ºä¾‹1: Hook XMLHttpRequest.send æ‹¦æˆªåŠ å¯†æ•°æ®
result = ctx.evaluate("""
    (async () => {
        // å®šä¹‰åŠ å¯†å‡½æ•°
        function encrypt(data) {
            return btoa(JSON.stringify(data));
        }

        // Hook XMLHttpRequest.send
        const originalSend = XMLHttpRequest.prototype.send;
        XMLHttpRequest.prototype.send = function(data) {
            // æ‹¦æˆªåˆ°åŠ å¯†åçš„æ•°æ®ï¼Œç«‹å³è¿”å›åˆ°Python
            __neverjscore_return__({
                method: this._method,
                url: this._url,
                encrypted_data: data  // æ‹¦æˆªçš„åŠ å¯†æ•°æ®
            });

            // ä¸‹é¢çš„ä»£ç ä¸ä¼šæ‰§è¡Œ
            originalSend.call(this, data);
        };

        // æ‰§è¡ŒåŠ å¯†å’Œå‘é€æµç¨‹
        const sensitiveData = {
            username: 'test@example.com',
            password: 'secret123',
            timestamp: Date.now()
        };

        const encrypted = encrypt(sensitiveData);
        const xhr = new XMLHttpRequest();
        xhr.open('POST', 'https://api.example.com/login');
        xhr.send(encrypted);  // åœ¨è¿™é‡Œè¢«æ‹¦æˆªå¹¶æå‰è¿”å›

        // ä¸ä¼šæ‰§è¡Œåˆ°è¿™é‡Œ
        return { status: 'sent' };
    })()
""")

print(f"æ‹¦æˆªåˆ°çš„URL: {result['url']}")
print(f"æ‹¦æˆªåˆ°çš„åŠ å¯†æ•°æ®: {result['encrypted_data']}")

# ç¤ºä¾‹2: HookåŠ å¯†å‡½æ•°è·å–ä¸­é—´å€¼
result = ctx.evaluate("""
    function multiLayerEncrypt(data) {
        const layer1 = btoa(data);
        const layer2 = md5(layer1);

        // åœ¨ç¬¬äºŒå±‚åŠ å¯†åç«‹å³è¿”å›
        $return({
            layer: 2,
            result: layer2,
            original: data
        });

        // ç¬¬ä¸‰å±‚ä¸ä¼šæ‰§è¡Œ
        const layer3 = sha256(layer2);
        return layer3;
    }

    multiLayerEncrypt('sensitive_data');
""")

print(f"æ‹¦æˆªåˆ°ç¬¬{result['layer']}å±‚åŠ å¯†: {result['result']}")

# ç¤ºä¾‹3: æ¡ä»¶æ‹¦æˆª
result = ctx.evaluate("""
    function processData(data) {
        // åªæœ‰å½“æ•°æ®åŒ…å«ç›®æ ‡æ ‡è®°æ—¶æ‰æ‹¦æˆª
        if (data.includes('TARGET')) {
            $exit({
                found: true,
                data: data,
                position: data.indexOf('TARGET')
            });
        }
        return data.toUpperCase();
    }

    processData('normal data');
    processData('this contains TARGET marker');  // åœ¨è¿™é‡Œæ‹¦æˆª
    processData('will not reach here');  // ä¸ä¼šæ‰§è¡Œ
""")

print(f"æ¡ä»¶æ‹¦æˆªç»“æœ: {result}")
```

**Hook APIè¯´æ˜ï¼š**
- `__neverjscore_return__(value)` - å®Œæ•´å‡½æ•°å
- `$return(value)` - ç®€çŸ­åˆ«åï¼ˆæ¨èï¼‰
- `$exit(value)` - æ›¿ä»£åˆ«å

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- âœ… ç«‹å³ç»ˆæ­¢JavaScriptæ‰§è¡Œ
- âœ… å°†æ‹¦æˆªåˆ°çš„å€¼è¿”å›åˆ°Python
- âœ… è·³è¿‡åç»­æ‰€æœ‰ä»£ç ï¼ˆåŒ…æ‹¬å¼‚æ­¥æ“ä½œï¼‰
- âœ… æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ¨¡å¼
- âœ… è‡ªåŠ¨å¤„ç†JSONåºåˆ—åŒ–

**é€‚ç”¨åœºæ™¯ï¼š**
- ğŸ¯ HookåŠ å¯†å‡½æ•°è·å–ä¸­é—´å€¼
- ğŸ¯ æ‹¦æˆªXMLHttpRequest.sendè·å–è¯·æ±‚æ•°æ®
- ğŸ¯ æå–Akamaiç­‰åçˆ¬è™«çš„ä¼ æ„Ÿå™¨æ•°æ®
- ğŸ¯ åœ¨æ»¡è¶³æ¡ä»¶æ—¶æå‰ç»ˆæ­¢å¹¶è¿”å›ç»“æœ

æ›´å¤šç¤ºä¾‹è¯·æŸ¥çœ‹ [hook_examples.py](examples/hook_examples.py)

### 8. ç¡®å®šæ€§éšæœºæ•°ï¼ˆv2.3.0 æ–°å¢ï¼‰

```python
import never_jscore

# ä½¿ç”¨å›ºå®šç§å­åˆ›å»ºä¸Šä¸‹æ–‡ï¼ˆç¡®å®šæ€§æ‰§è¡Œï¼‰
ctx = never_jscore.Context(random_seed=12345)

# Math.random() ä¼šåŸºäºç§å­ç”Ÿæˆç¡®å®šæ€§éšæœºæ•°
result = ctx.evaluate("""
    const r1 = Math.random();  // 0.8831156266...
    const r2 = Math.random();  // 0.5465919174...
    const r3 = Math.random();  // 0.2821271724...
    [r1, r2, r3]
""")
print(result)  # [0.8831156266, 0.5465919174, 0.2821271724]

# ä½¿ç”¨ç›¸åŒç§å­çš„å¦ä¸€ä¸ªä¸Šä¸‹æ–‡ä¼šäº§ç”Ÿç›¸åŒçš„éšæœºæ•°åºåˆ—
ctx2 = never_jscore.Context(random_seed=12345)
result2 = ctx2.evaluate("""
    const r1 = Math.random();
    const r2 = Math.random();
    const r3 = Math.random();
    [r1, r2, r3]
""")
print(result2)  # [0.8831156266, 0.5465919174, 0.2821271724] - å®Œå…¨ç›¸åŒï¼

# crypto API ä¹Ÿéµå®ˆç§å­
ctx3 = never_jscore.Context(random_seed=99999)
uuid1 = ctx3.evaluate("crypto.randomUUID()")
print(uuid1)  # "a2c9d035-05e8-416d-9395-58db68d61c19"

# ç›¸åŒç§å­äº§ç”Ÿç›¸åŒçš„ UUID
ctx4 = never_jscore.Context(random_seed=99999)
uuid2 = ctx4.evaluate("crypto.randomUUID()")
print(uuid2)  # "a2c9d035-05e8-416d-9395-58db68d61c19" - ç›¸åŒï¼

# å®é™…åº”ç”¨ï¼šè°ƒè¯•åŠ¨æ€å‚æ•°ç®—æ³•
ctx5 = never_jscore.Context(random_seed=42)
result = ctx5.evaluate("""
    function generateToken(userId) {
        const random1 = Math.random();
        const random2 = Math.random();
        const hash = Math.floor((random1 + random2 + userId) * 1000000);
        return hash.toString(16);
    }

    generateToken(12345);
""")
print(result)  # "2dfe3be76"

# å†æ¬¡è¿è¡Œï¼Œç»“æœå®Œå…¨ç›¸åŒï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰
ctx6 = never_jscore.Context(random_seed=42)
result2 = ctx6.evaluate("""
    function generateToken(userId) {
        const random1 = Math.random();
        const random2 = Math.random();
        const hash = Math.floor((random1 + random2 + userId) * 1000000);
        return hash.toString(16);
    }

    generateToken(12345);
""")
print(result2)  # "2dfe3be76" - å®Œå…¨ç›¸åŒï¼

# ä¸ä½¿ç”¨ç§å­æ—¶ï¼Œéšæœºæ•°æ˜¯éç¡®å®šæ€§çš„ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰
ctx7 = never_jscore.Context()  # æ—  random_seed
random1 = ctx7.evaluate("Math.random()")
random2 = ctx7.evaluate("Math.random()")
print(f"éç¡®å®šæ€§: {random1} != {random2}")  # æ¯æ¬¡è¿è¡Œéƒ½ä¸åŒ
```

**æ”¯æŒçš„éšæœºæ•° APIï¼š**
- âœ… `Math.random()` - æ ‡å‡†éšæœºæ•°ï¼ˆ0 åˆ° 1ï¼‰
- âœ… `crypto.randomUUID()` - UUID v4 ç”Ÿæˆ
- âœ… `crypto.getRandomValues()` - éšæœºå­—èŠ‚æ•°ç»„

**ä½¿ç”¨åœºæ™¯ï¼š**
- ğŸ¯ è°ƒè¯•åŒ…å«éšæœºæ•°çš„åŠ å¯†ç®—æ³•
- ğŸ¯ å¯é‡ç°çš„æµ‹è¯•ç”¨ä¾‹
- ğŸ¯ å¯¹æ¯”ä¸åŒå‚æ•°ä¸‹çš„ç®—æ³•è¡Œä¸º
- ğŸ¯ JS é€†å‘ä¸­çš„åŠ¨æ€å‚æ•°åˆ†æ
- ğŸ¯ Akamai ç­‰åçˆ¬è™«ç®—æ³•çš„ç¡®å®šæ€§æ‰§è¡Œ

æ›´å¤šç¤ºä¾‹è¯·æŸ¥çœ‹ [test_random_seed.py](tests/test_random_seed.py)

## API å‚è€ƒ

### Context ç±»

#### `never_jscore.Context(enable_extensions: bool = True, enable_logging: bool = False, random_seed: int = None)`

åˆ›å»ºä¸€ä¸ªæ–°çš„ JavaScript æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚

**å‚æ•°**:
- `enable_extensions` (å¯é€‰): æ˜¯å¦å¯ç”¨å†…ç½® Web API æ‰©å±•ï¼ˆé»˜è®¤ Trueï¼‰
  - `True`: å¯ç”¨ Cryptoã€URL ç¼–ç ã€setTimeoutã€Worker ç­‰æ‰©å±•
  - `False`: çº¯å‡€ V8 ç¯å¢ƒï¼Œåªæœ‰ ECMAScript æ ‡å‡† API
- `enable_logging` (å¯é€‰): æ˜¯å¦å¯ç”¨æ“ä½œæ—¥å¿—è¾“å‡ºï¼ˆé»˜è®¤ Falseï¼‰
  - `True`: è¾“å‡ºæ‰€æœ‰æ‰©å±•æ“ä½œçš„æ—¥å¿—ï¼ˆç”¨äºè°ƒè¯•ï¼‰
  - `False`: ä¸è¾“å‡ºæ—¥å¿—ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
- `random_seed` (å¯é€‰): éšæœºæ•°ç§å­ï¼ˆé»˜è®¤ Noneï¼‰
  - `None`: ä½¿ç”¨ç³»ç»Ÿéšæœºæ•°ï¼ˆéç¡®å®šæ€§ï¼‰
  - `int`: ä½¿ç”¨å›ºå®šç§å­ï¼ˆç¡®å®šæ€§ï¼‰ï¼Œæ‰€æœ‰éšæœºæ•° API å°†åŸºäºæ­¤ç§å­ç”Ÿæˆ

**è¿”å›**: Context å¯¹è±¡

**ç¤ºä¾‹**:
```python
# å¯ç”¨æ‰©å±•ï¼ˆé»˜è®¤ï¼Œæ¨èç”¨äº JS é€†å‘ï¼‰
ctx = never_jscore.Context()
ctx = never_jscore.Context(enable_extensions=True)

# ç¦ç”¨æ‰©å±•ï¼ˆçº¯å‡€ V8ï¼‰
ctx = never_jscore.Context(enable_extensions=False)

# å¯ç”¨æ—¥å¿—ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰
ctx = never_jscore.Context(enable_logging=True)

# ä½¿ç”¨å›ºå®šç§å­ï¼ˆç¡®å®šæ€§éšæœºæ•°ï¼‰
ctx = never_jscore.Context(random_seed=12345)

# ç»„åˆä½¿ç”¨
ctx = never_jscore.Context(enable_extensions=True, enable_logging=False, random_seed=42)
```

#### `compile(code: str) -> None`

ç¼–è¯‘ JavaScript ä»£ç å¹¶åŠ å…¥å…¨å±€ä½œç”¨åŸŸã€‚

**å‚æ•°**:
- `code`: JavaScript ä»£ç å­—ç¬¦ä¸²

**ç¤ºä¾‹**:
```python
ctx.compile('''
    function add(a, b) { return a + b; }
''')
```

#### `eval(code: str, return_value: bool = False, auto_await: bool = True) -> Any`

æ‰§è¡Œä»£ç å¹¶å°†å…¶åŠ å…¥å…¨å±€ä½œç”¨åŸŸã€‚

**å‚æ•°**:
- `code`: JavaScript ä»£ç å­—ç¬¦ä¸²
- `return_value`: æ˜¯å¦è¿”å›æœ€åè¡¨è¾¾å¼çš„å€¼ï¼ˆé»˜è®¤ Falseï¼‰
- `auto_await`: æ˜¯å¦è‡ªåŠ¨ç­‰å¾… Promiseï¼ˆé»˜è®¤ Trueï¼‰

**è¿”å›**: å¦‚æœ return_value=Trueï¼Œè¿”å›æ‰§è¡Œç»“æœï¼›å¦åˆ™è¿”å› None

**ç¤ºä¾‹**:
```python
ctx.eval("var x = 10;")  # æ·»åŠ åˆ°å…¨å±€ä½œç”¨åŸŸ
result = ctx.eval("x * 2", return_value=True)  # è¿”å› 20
```

#### `evaluate(code: str, auto_await: bool = True) -> Any`

æ‰§è¡Œä»£ç å¹¶è¿”å›ç»“æœï¼ˆä¸å½±å“å…¨å±€ä½œç”¨åŸŸï¼‰ã€‚

**å‚æ•°**:
- `code`: JavaScript ä»£ç å­—ç¬¦ä¸²
- `auto_await`: æ˜¯å¦è‡ªåŠ¨ç­‰å¾… Promiseï¼ˆé»˜è®¤ Trueï¼‰

**è¿”å›**: è¡¨è¾¾å¼çš„å€¼

**ç¤ºä¾‹**:
```python
result = ctx.evaluate("1 + 2 + 3")  # 6
result = ctx.evaluate("Promise.resolve(42)")  # 42
```

#### `call(name: str, args: list, auto_await: bool = True) -> Any`

è°ƒç”¨ JavaScript å‡½æ•°ã€‚

**å‚æ•°**:
- `name`: å‡½æ•°åç§°
- `args`: å‚æ•°åˆ—è¡¨
- `auto_await`: æ˜¯å¦è‡ªåŠ¨ç­‰å¾… Promiseï¼ˆé»˜è®¤ Trueï¼‰

**è¿”å›**: å‡½æ•°è¿”å›å€¼

**ç¤ºä¾‹**:
```python
result = ctx.call("add", [1, 2])
result = ctx.call("asyncFunc", [arg], auto_await=True)
```

#### `gc() -> None`

è¯·æ±‚ V8 åƒåœ¾å›æ”¶ã€‚

**æ³¨æ„**: è¿™åªæ˜¯æç¤ºï¼ŒV8 ä¼šæ ¹æ®è‡ªå·±çš„ç­–ç•¥å†³å®šæ˜¯å¦æ‰§è¡Œã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ— éœ€æ‰‹åŠ¨è°ƒç”¨ã€‚

#### `get_stats() -> tuple[int]`

è·å–æ‰§è¡Œç»Ÿè®¡ä¿¡æ¯ã€‚

**è¿”å›**: `(exec_count,)` æ‰§è¡Œæ¬¡æ•°å…ƒç»„

#### `reset_stats() -> None`

é‡ç½®ç»Ÿè®¡ä¿¡æ¯ã€‚

## ç±»å‹è½¬æ¢

Python å’Œ JavaScript ä¹‹é—´çš„ç±»å‹è‡ªåŠ¨è½¬æ¢ï¼š

| Python ç±»å‹ | JavaScript ç±»å‹ | è¯´æ˜ |
|------------|----------------|------|
| None       | null           | ç©ºå€¼ |
| bool       | boolean        | å¸ƒå°”å€¼ |
| int        | number         | æ•´æ•° |
| float      | number         | æµ®ç‚¹æ•° |
| str        | string         | å­—ç¬¦ä¸² |
| list       | Array          | æ•°ç»„ |
| dict       | Object         | å¯¹è±¡ |

**ç¤ºä¾‹**:
```python
# Python -> JavaScript
ctx.call("func", [None, True, 42, 3.14, "hello", [1, 2], {"key": "value"}])

# JavaScript -> Python
result = ctx.evaluate("{name: 'John', age: 30}")  # dict
result = ctx.evaluate("[1, 2, 3]")  # list
result = ctx.evaluate("null")  # None
```

## ä½¿ç”¨é™åˆ¶

### âš ï¸ å¤š Context é™åˆ¶ï¼ˆé‡è¦ï¼ï¼‰

ç”±äº V8 å¼•æ“çš„ thread-local storage é™åˆ¶å’Œå†…å­˜ç®¡ç†æœºåˆ¶ï¼Œ**å¤šä¸ª Context å¿…é¡»éµå¾ªç‰¹å®šçš„ä½¿ç”¨æ¨¡å¼**ã€‚

#### é™åˆ¶ 1: ä¸èƒ½äº¤å‰ä½¿ç”¨

**ä¸€æ—¦åˆ›å»ºäº†ç¬¬äºŒä¸ª Contextï¼Œå°±ä¸èƒ½å†ä½¿ç”¨ç¬¬ä¸€ä¸ª Contextï¼**

```python
# âŒ é”™è¯¯ç”¨æ³•ï¼šäº¤å‰ä½¿ç”¨ä¼šå´©æºƒ
ctx1 = never_jscore.Context()
ctx1.compile("function f1() { return 1; }")
result1 = ctx1.call("f1", [])  # OK

ctx2 = never_jscore.Context()
ctx2.compile("function f2() { return 2; }")
result2 = ctx2.call("f2", [])  # OK

result1 = ctx1.call("f1", [])  # âŒ å´©æºƒï¼ä¸èƒ½å›åˆ° ctx1
```

#### é™åˆ¶ 2: LIFO åˆ é™¤é¡ºåº

**å¤šä¸ª Context å¿…é¡»æŒ‰ LIFO é¡ºåºåˆ é™¤ï¼ˆååˆ›å»ºå…ˆåˆ é™¤ï¼‰**

```python
# âŒ é”™è¯¯ï¼šæŒ‰åˆ›å»ºé¡ºåºåˆ é™¤ä¼šå´©æºƒ
ctx1 = never_jscore.Context()
ctx2 = never_jscore.Context()
ctx3 = never_jscore.Context()

del ctx1  # âŒ å´©æºƒï¼
del ctx2
del ctx3

# âœ… æ­£ç¡®ï¼šLIFO é¡ºåºï¼ˆåè¿›å…ˆå‡ºï¼‰
ctx1 = never_jscore.Context()
ctx2 = never_jscore.Context()
ctx3 = never_jscore.Context()

# ä½¿ç”¨æœ€ååˆ›å»ºçš„ Context
result = ctx3.call("func", [])

# æŒ‰é€†åºåˆ é™¤
del ctx3  # âœ… æœ€ååˆ›å»ºï¼Œæœ€å…ˆåˆ é™¤
del ctx2  # âœ…
del ctx1  # âœ…

# âŒ é”™è¯¯ï¼šè®© Python è‡ªåŠ¨æ¸…ç†ï¼ˆé¡ºåºä¸ç¡®å®šï¼‰
# ç¨‹åºç»“æŸæ—¶ä¼šå´©æºƒ
```

#### æ¨èçš„ä½¿ç”¨æ¨¡å¼

**æ¨¡å¼ 1: å• Context æ¨¡å¼ï¼ˆæœ€æ¨èï¼‰**

å°†æ‰€æœ‰å‡½æ•°å®šä¹‰åœ¨ä¸€ä¸ª Context ä¸­ï¼š

```python
import never_jscore

ctx = never_jscore.Context()
ctx.compile("""
    function f1() { return 1; }
    function f2() { return 2; }
    function f3() { return 3; }
""")

# å¯ä»¥ä»»æ„è°ƒç”¨
ctx.call("f1", [])  # OK
ctx.call("f2", [])  # OK
ctx.call("f1", [])  # OK - å¯ä»¥é‡å¤è°ƒç”¨
```

**æ¨¡å¼ 2: é¡ºåºä½¿ç”¨ï¼ˆç”¨å®Œå³åˆ ï¼‰**

```python
import never_jscore

# ä½¿ç”¨ç¬¬ä¸€ä¸ª Context
ctx1 = never_jscore.Context()
ctx1.compile("function f1() { return 1; }")
result = ctx1.call("f1", [])
del ctx1  # ç”¨å®Œç«‹å³åˆ é™¤

# ä½¿ç”¨ç¬¬äºŒä¸ª Context
ctx2 = never_jscore.Context()
ctx2.compile("function f2() { return 2; }")
result = ctx2.call("f2", [])
del ctx2  # ç”¨å®Œç«‹å³åˆ é™¤
```

**æ¨¡å¼ 3: LIFO æ‰¹é‡æ¸…ç†ï¼ˆé«˜çº§ç”¨æ³•ï¼‰**

```python
import never_jscore

# åˆ›å»ºå¤šä¸ª Contextï¼ˆæ³¨æ„ï¼šåˆ›å»ºç¬¬äºŒä¸ªåä¸èƒ½å†ç”¨ç¬¬ä¸€ä¸ªï¼‰
ctx1 = never_jscore.Context()
ctx1.compile("function f1() { return 1; }")
r1 = ctx1.call("f1", [])  # åœ¨åˆ›å»º ctx2 ä¹‹å‰å®Œæˆæ‰€æœ‰æ“ä½œ

ctx2 = never_jscore.Context()
ctx2.compile("function f2() { return 2; }")
r2 = ctx2.call("f2", [])  # ctx1 å·²ä¸å¯ç”¨

ctx3 = never_jscore.Context()
ctx3.compile("function f3() { return 3; }")
r3 = ctx3.call("f3", [])  # ctx1, ctx2 å·²ä¸å¯ç”¨

# LIFO é¡ºåºåˆ é™¤ï¼ˆåè¿›å…ˆå‡ºï¼‰
del ctx3
del ctx2
del ctx1
```

## v2.2.0 æ–°åŠŸèƒ½ï¼šNode.js å’Œæµè§ˆå™¨ API

### 1. require() - CommonJS æ¨¡å—ç³»ç»Ÿ

å®Œæ•´çš„ Node.js æ¨¡å—è§£æå®ç°ï¼Œæ”¯æŒç›¸å¯¹è·¯å¾„ã€node_modulesã€package.jsonï¼š

```python
import never_jscore

ctx = never_jscore.Context()

# åˆ›å»ºæµ‹è¯•æ¨¡å—
with open('my_module.js', 'w') as f:
    f.write('''
        module.exports = {
            add: function(a, b) { return a + b; },
            version: '1.0.0'
        };
    ''')

# ä½¿ç”¨ require() åŠ è½½æ¨¡å—
result = ctx.evaluate("""
    const myModule = require('./my_module.js');
    myModule.add(10, 20)
""")
print(result)  # 30

# ä½¿ç”¨å†…ç½®æ¨¡å— fs å’Œ path
ctx.compile("""
    const fs = require('fs');
    const path = require('path');

    function readConfig() {
        const filePath = path.join('.', 'config.json');
        if (fs.existsSync(filePath)) {
            return fs.readFileSync(filePath);
        }
        return '{}';
    }
""")
```

**æ”¯æŒçš„åŠŸèƒ½**ï¼š
- âœ… ç›¸å¯¹è·¯å¾„ï¼š`./module.js`, `../lib/utils.js`
- âœ… ç»å¯¹è·¯å¾„ï¼š`/path/to/module.js`
- âœ… node_modules æŸ¥æ‰¾ï¼ˆé€’å½’å‘ä¸Šï¼‰
- âœ… package.json ä¸»å…¥å£è§£æ
- âœ… è‡ªåŠ¨æ‰©å±•åï¼ˆ`.js`, `.json`ï¼‰
- âœ… ç›®å½•å…¥å£ï¼ˆ`index.js`ï¼‰
- âœ… æ¨¡å—ç¼“å­˜ï¼ˆ`require.cache`ï¼‰

**å†…ç½®æ¨¡å—**ï¼š
- `fs` - æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- `path` - è·¯å¾„å¤„ç†

### 2. fetch() - HTTP ç½‘ç»œè¯·æ±‚

ç°ä»£ HTTP APIï¼Œå…¼å®¹æµè§ˆå™¨æ ‡å‡†ï¼š

```python
import never_jscore

ctx = never_jscore.Context()

# GET è¯·æ±‚
result = ctx.evaluate("""
    (async () => {
        const response = await fetch('https://api.github.com/users/github');
        const data = await response.json();
        return {
            status: response.status,
            username: data.login,
            followers: data.followers
        };
    })()
""")
print(result)

# POST è¯·æ±‚
result = ctx.evaluate("""
    (async () => {
        const response = await fetch('https://httpbin.org/post', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer token123'
            },
            body: JSON.stringify({
                username: 'test',
                password: 'pass'
            }),
            timeout: 30000
        });

        const data = await response.json();
        return data;
    })()
""")
```

**æ”¯æŒçš„åŠŸèƒ½**ï¼š
- âœ… GET/POST/PUT/DELETE/PATCH ç­‰æ‰€æœ‰ HTTP æ–¹æ³•
- âœ… è‡ªå®šä¹‰è¯·æ±‚å¤´
- âœ… JSON è‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ–
- âœ… Response å¯¹è±¡ï¼ˆ`text()`, `json()`, `blob()`, `arrayBuffer()`ï¼‰
- âœ… çŠ¶æ€ç å’ŒçŠ¶æ€æ–‡æœ¬
- âœ… è¶…æ—¶æ§åˆ¶

### 3. localStorage / sessionStorage

æµè§ˆå™¨å­˜å‚¨ APIï¼Œç”¨äºè¡¥ç¯å¢ƒï¼š

```python
import never_jscore

ctx = never_jscore.Context()

# localStorage - æŒä¹…åŒ–å­˜å‚¨
ctx.eval("""
    localStorage.setItem('token', 'abc123');
    localStorage.setItem('user', JSON.stringify({name: 'John', id: 123}));
""")

# è·å–å€¼
token = ctx.evaluate("localStorage.getItem('token')")
print(token)  # 'abc123'

# sessionStorage - ä¼šè¯å­˜å‚¨
ctx.eval("""
    sessionStorage.setItem('sessionId', '999');
""")

# å®Œæ•´ç¤ºä¾‹
result = ctx.evaluate("""
    // å­˜å‚¨ç”¨æˆ·åå¥½
    localStorage.setItem('theme', 'dark');
    localStorage.setItem('language', 'zh-CN');

    // è¯»å–åå¥½
    const preferences = {
        theme: localStorage.getItem('theme'),
        language: localStorage.getItem('language'),
        itemCount: localStorage.length
    };

    JSON.stringify(preferences);
""")
print(result)  # {"theme":"dark","language":"zh-CN","itemCount":2}
```

**API æ–¹æ³•**ï¼š
- `setItem(key, value)` - è®¾ç½®å€¼
- `getItem(key)` - è·å–å€¼ï¼ˆä¸å­˜åœ¨è¿”å› nullï¼‰
- `removeItem(key)` - åˆ é™¤é”®
- `clear()` - æ¸…ç©ºæ‰€æœ‰
- `key(index)` - æŒ‰ç´¢å¼•è·å–é”®å
- `length` - è·å–é”®æ•°é‡

### 4. æµè§ˆå™¨ç¯å¢ƒå¯¹è±¡

æ¨¡æ‹Ÿå®Œæ•´çš„æµè§ˆå™¨ç¯å¢ƒï¼ˆè¡¥ç¯å¢ƒå¿…å¤‡ï¼‰ï¼š

```python
import never_jscore

ctx = never_jscore.Context()

# navigator - æµè§ˆå™¨ä¿¡æ¯
result = ctx.evaluate("""
    JSON.stringify({
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        language: navigator.language,
        onLine: navigator.onLine,
        cookieEnabled: navigator.cookieEnabled,
        hardwareConcurrency: navigator.hardwareConcurrency
    })
""")
print(result)
# {"userAgent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36","platform":"Win32",...}

# location - URL ä¿¡æ¯
result = ctx.evaluate("""
    JSON.stringify({
        href: location.href,
        protocol: location.protocol,
        hostname: location.hostname,
        pathname: location.pathname
    })
""")

# document - DOM æ–‡æ¡£å¯¹è±¡
result = ctx.evaluate("""
    JSON.stringify({
        readyState: document.readyState,
        title: document.title,
        URL: document.URL,
        domain: document.domain,
        characterSet: document.characterSet
    })
""")

# window - çª—å£å¯¹è±¡
result = ctx.evaluate("""
    JSON.stringify({
        innerWidth: window.innerWidth,
        innerHeight: window.innerHeight,
        devicePixelRatio: window.devicePixelRatio
    })
""")

# screen - å±å¹•ä¿¡æ¯
result = ctx.evaluate("""
    JSON.stringify({
        width: screen.width,
        height: screen.height,
        colorDepth: screen.colorDepth
    })
""")
```

**å¯ç”¨å¯¹è±¡**ï¼š
- `navigator` - æµè§ˆå™¨ç”¨æˆ·ä»£ç†ä¿¡æ¯
- `location` - é¡µé¢ URL ä¿¡æ¯
- `document` - DOM æ–‡æ¡£å¯¹è±¡ï¼ˆæ–¹æ³•è¿”å› null/ç©ºæ•°ç»„ï¼‰
- `window` - çª—å£å¯¹è±¡
- `screen` - å±å¹•ä¿¡æ¯

### 5. URL / URLSearchParams

å®Œæ•´çš„ URL å¤„ç† APIï¼š

```python
import never_jscore

ctx = never_jscore.Context()

# URL è§£æ
result = ctx.evaluate("""
    const url = new URL('https://api.example.com:8080/search?q=test&page=1#results');

    JSON.stringify({
        href: url.href,
        protocol: url.protocol,
        hostname: url.hostname,
        port: url.port,
        pathname: url.pathname,
        search: url.search,
        hash: url.hash,
        origin: url.origin
    })
""")

# URLSearchParams - æŸ¥è¯¢å­—ç¬¦ä¸²æ“ä½œ
result = ctx.evaluate("""
    const params = new URLSearchParams('name=John&age=30');

    // è·å–å‚æ•°
    const name = params.get('name');  // "John"

    // è®¾ç½®å‚æ•°
    params.set('age', '31');

    // è¿½åŠ å‚æ•°
    params.append('tag', 'developer');
    params.append('tag', 'python');

    // è·å–æ‰€æœ‰åŒåå‚æ•°
    const tags = params.getAll('tag');  // ["developer", "python"]

    // è½¬å›æŸ¥è¯¢å­—ç¬¦ä¸²
    const queryString = params.toString();  // "name=John&age=31&tag=developer&tag=python"

    JSON.stringify({name, tags, queryString});
""")

# URL + URLSearchParams ç»„åˆ
result = ctx.evaluate("""
    const url = new URL('https://api.example.com/search');
    url.searchParams.append('q', 'javascript');
    url.searchParams.append('limit', '10');

    url.href  // "https://api.example.com/search?q=javascript&limit=10"
""")
```

### 6. FormData

è¡¨å•æ•°æ®å¤„ç† APIï¼š

```python
import never_jscore

ctx = never_jscore.Context()

result = ctx.evaluate("""
    const formData = new FormData();

    // æ·»åŠ å­—æ®µ
    formData.append('username', 'john_doe');
    formData.append('email', 'john@example.com');
    formData.append('tags', 'js');
    formData.append('tags', 'python');

    // è·å–å•ä¸ªå€¼
    const username = formData.get('username');  // "john_doe"

    // è·å–æ‰€æœ‰åŒåå€¼
    const tags = formData.getAll('tags');  // ["js", "python"]

    // è®¾ç½®ï¼ˆè¦†ç›–ï¼‰
    formData.set('email', 'new@example.com');

    // æ£€æŸ¥æ˜¯å¦å­˜åœ¨
    const hasUser = formData.has('username');  // true

    // åˆ é™¤
    formData.delete('tags');

    JSON.stringify({username, tags, hasUser});
""")
```

### 7. Event / EventTarget

å®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿï¼š

```python
import never_jscore

ctx = never_jscore.Context()

result = ctx.evaluate("""
    // åˆ›å»ºäº‹ä»¶ç›®æ ‡
    const target = new EventTarget();

    let eventData = [];

    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
    target.addEventListener('custom', (event) => {
        eventData.push({
            type: event.type,
            bubbles: event.bubbles,
            cancelable: event.cancelable
        });
    });

    // åˆ›å»ºå¹¶åˆ†å‘äº‹ä»¶
    const event = new Event('custom', {
        bubbles: true,
        cancelable: true
    });

    target.dispatchEvent(event);

    // æ”¯æŒ once é€‰é¡¹
    target.addEventListener('once-event', () => {
        eventData.push('fired once');
    }, { once: true });

    const onceEvent = new Event('once-event');
    target.dispatchEvent(onceEvent);
    target.dispatchEvent(onceEvent);  // ç¬¬äºŒæ¬¡ä¸ä¼šè§¦å‘

    JSON.stringify(eventData);
""")
```

### 8. XMLHttpRequest

ä¼ ç»Ÿ AJAX APIï¼ˆåŸºäº fetch å®ç°ï¼‰ï¼š

```python
import never_jscore

ctx = never_jscore.Context()

result = ctx.evaluate("""
    (async () => {
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();

            xhr.onload = function() {
                if (xhr.status === 200) {
                    resolve({
                        status: xhr.status,
                        statusText: xhr.statusText,
                        responseText: xhr.responseText.substring(0, 100),
                        readyState: xhr.readyState
                    });
                } else {
                    reject('Error: ' + xhr.status);
                }
            };

            xhr.onerror = function() {
                reject('Network error');
            };

            // å‘é€è¯·æ±‚
            xhr.open('GET', 'https://httpbin.org/get');
            xhr.setRequestHeader('X-Custom-Header', 'value');
            xhr.send();
        });
    })()
""")

print(result)
```

**æ”¯æŒçš„åŠŸèƒ½**ï¼š
- âœ… open() / send() / abort()
- âœ… setRequestHeader() / getResponseHeader()
- âœ… onload / onerror / onreadystatechange äº‹ä»¶
- âœ… readyState / status / statusText
- âœ… responseText / response
- âœ… addEventListener / removeEventListener

### 9. Performance APIï¼ˆv2.2.1 æ–°å¢ï¼‰

é«˜ç²¾åº¦æ€§èƒ½æµ‹é‡ APIï¼Œå…¼å®¹ Web Performance Timing æ ‡å‡†ï¼š

```python
import never_jscore

ctx = never_jscore.Context()

# 1. é«˜ç²¾åº¦æ—¶é—´æˆ³
result = ctx.evaluate("""
    const start = performance.now();

    // æ‰§è¡Œä¸€äº›æ“ä½œ
    let sum = 0;
    for (let i = 0; i < 1000000; i++) {
        sum += i;
    }

    const end = performance.now();

    ({
        start: start,
        end: end,
        elapsed: end - start,
        sum: sum
    })
""")
print(f"è€—æ—¶: {result['elapsed']:.4f}ms")

# 2. æ€§èƒ½æ ‡è®°å’Œæµ‹é‡
result = ctx.evaluate("""
    // åˆ›å»ºæ€§èƒ½æ ‡è®°
    performance.mark('task-start');

    // æ­¥éª¤ 1
    performance.mark('step1-start');
    let data = [];
    for (let i = 0; i < 100000; i++) {
        data.push(i * 2);
    }
    performance.mark('step1-end');

    // æ­¥éª¤ 2
    performance.mark('step2-start');
    let sum = data.reduce((acc, val) => acc + val, 0);
    performance.mark('step2-end');

    // åˆ›å»ºæ€§èƒ½æµ‹é‡
    const measure1 = performance.measure('step1-duration', 'step1-start', 'step1-end');
    const measure2 = performance.measure('step2-duration', 'step2-start', 'step2-end');
    const total = performance.measure('total-duration', 'task-start', 'step2-end');

    // è·å–æ‰€æœ‰æµ‹é‡ç»“æœ
    const measures = performance.getEntriesByType('measure');

    ({
        measures: measures.map(m => ({
            name: m.name,
            duration: m.duration.toFixed(4) + 'ms'
        })),
        sum: sum
    })
""")

for measure in result['measures']:
    print(f"{measure['name']}: {measure['duration']}")
# è¾“å‡ºç¤ºä¾‹ï¼š
# step1-duration: 2.3456ms
# step2-duration: 1.2345ms
# total-duration: 3.5801ms

# 3. è·å–æ€§èƒ½æ¡ç›®
result = ctx.evaluate("""
    performance.mark('test1');
    performance.mark('test2');
    performance.measure('test-measure', 'test1', 'test2');

    ({
        allEntries: performance.getEntries(),
        marksOnly: performance.getEntriesByType('mark'),
        measuresOnly: performance.getEntriesByType('measure'),
        byName: performance.getEntriesByName('test1')
    })
""")

print(f"æ‰€æœ‰æ¡ç›®: {len(result['allEntries'])}")
print(f"æ ‡è®°æ•°é‡: {len(result['marksOnly'])}")
print(f"æµ‹é‡æ•°é‡: {len(result['measuresOnly'])}")

# 4. æ¸…é™¤æ ‡è®°å’Œæµ‹é‡
ctx.eval("""
    performance.clearMarks('test1');    // æ¸…é™¤å•ä¸ªæ ‡è®°
    performance.clearMarks();           // æ¸…é™¤æ‰€æœ‰æ ‡è®°
    performance.clearMeasures();        // æ¸…é™¤æ‰€æœ‰æµ‹é‡
""")
```

**å¯ç”¨ API**ï¼š
- `performance.now()` - é«˜ç²¾åº¦æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
- `performance.timeOrigin` - æ—¶é—´åŸç‚¹ï¼ˆUnix æ—¶é—´æˆ³ï¼‰
- `performance.mark(name)` - åˆ›å»ºæ€§èƒ½æ ‡è®°
- `performance.measure(name, startMark?, endMark?)` - æµ‹é‡ä¸¤ä¸ªæ ‡è®°ä¹‹é—´çš„æ—¶é—´
- `performance.clearMarks(name?)` - æ¸…é™¤æ ‡è®°
- `performance.clearMeasures(name?)` - æ¸…é™¤æµ‹é‡
- `performance.getEntries()` - è·å–æ‰€æœ‰æ€§èƒ½æ¡ç›®
- `performance.getEntriesByType(type)` - æŒ‰ç±»å‹è·å–ï¼ˆ'mark' æˆ– 'measure'ï¼‰
- `performance.getEntriesByName(name, type?)` - æŒ‰åç§°è·å–

**ä½¿ç”¨åœºæ™¯**ï¼š
- ğŸ¯ ä»£ç æ€§èƒ½åˆ†æå’Œä¼˜åŒ–
- ğŸ¯ å¤šæ­¥éª¤æ“ä½œçš„æ—¶é—´åˆ†è§£
- ğŸ¯ JS é€†å‘ä¸­çš„æ€§èƒ½ç“¶é¢ˆå®šä½
- ğŸ¯ API è°ƒç”¨è€—æ—¶ç»Ÿè®¡


## å†…ç½® Web API æ‰©å±•ï¼ˆv2.0+ï¼‰

never_jscore å†…ç½®äº†å¸¸ç”¨çš„ Web APIï¼Œ**æ— éœ€é¢å¤– polyfill**ï¼Œå¼€ç®±å³ç”¨ï¼

### Crypto APIsï¼ˆåŠ å¯†ç›¸å…³ï¼‰

```python
import never_jscore

ctx = never_jscore.Context(enable_extensions=True)

# Base64 ç¼–è§£ç 
result = ctx.evaluate("btoa('Hello World')")  # "SGVsbG8gV29ybGQ="
result = ctx.evaluate("atob('SGVsbG8gV29ybGQ=')")  # "Hello World"

# å“ˆå¸Œå‡½æ•°
result = ctx.evaluate("md5('test')")  # "098f6bcd4621d373cade4e832627b4f6"
result = ctx.evaluate("sha256('test')")  # "9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08"

# HMAC
result = ctx.evaluate("CryptoUtils.hmacSha256('key', 'message')")

# Hex ç¼–è§£ç 
result = ctx.evaluate("CryptoUtils.hexEncode('test')")  # "74657374"
result = ctx.evaluate("CryptoUtils.hexDecode('74657374')")  # "test"

# é“¾å¼ APIï¼ˆç±» Node.js cryptoï¼‰
result = ctx.evaluate("""
    CryptoUtils.createHash('sha256')
        .update('hello')
        .update(' world')
        .digest('hex')
""")
```

### URL ç¼–ç 

```python
# URL ç¼–ç ï¼ˆå…¼å®¹æµè§ˆå™¨ APIï¼‰
result = ctx.evaluate("encodeURIComponent('hello world')")  # "hello%20world"
result = ctx.evaluate("decodeURIComponent('hello%20world')")  # "hello world"
```

### éšæœºæ•°ç”Ÿæˆï¼ˆæ”¯æŒç§å­æ§åˆ¶ï¼‰

```python
# é»˜è®¤ï¼šéç¡®å®šæ€§éšæœºæ•°
ctx = never_jscore.Context()

# Math.random() - æ ‡å‡†éšæœºæ•°ï¼ˆ0 åˆ° 1ï¼‰
result = ctx.evaluate("Math.random()")  # æ¯æ¬¡ä¸åŒ

# UUID ç”Ÿæˆ
uuid = ctx.evaluate("crypto.randomUUID()")  # "a3111236-1431-4d0d-807e-6c7b388d4433"

# éšæœºæ•°ç»„
result = ctx.evaluate("""
    const arr = new Uint8Array(16);
    crypto.getRandomValues(arr);
    Array.from(arr)
""")  # [123, 45, 67, ...]

# ä½¿ç”¨å›ºå®šç§å­ï¼ˆv2.3.0 æ–°å¢ï¼‰- ç¡®å®šæ€§éšæœºæ•°
ctx_seeded = never_jscore.Context(random_seed=12345)

# æ‰€æœ‰éšæœºæ•° API éƒ½éµå®ˆç§å­
r1 = ctx_seeded.evaluate("Math.random()")  # 0.8831156266... (å›ºå®š)
uuid = ctx_seeded.evaluate("crypto.randomUUID()")  # å›ºå®šçš„ UUID
random_bytes = ctx_seeded.evaluate("""
    const arr = new Uint8Array(8);
    crypto.getRandomValues(arr);
    Array.from(arr)
""")  # å›ºå®šçš„å­—èŠ‚æ•°ç»„

# ç›¸åŒç§å­äº§ç”Ÿç›¸åŒçš„éšæœºæ•°åºåˆ—
ctx_same_seed = never_jscore.Context(random_seed=12345)
r2 = ctx_same_seed.evaluate("Math.random()")  # 0.8831156266... (ä¸ r1 ç›¸åŒ!)
```

**ç§å­æ§åˆ¶çš„ä¼˜åŠ¿ï¼š**
- ğŸ¯ è°ƒè¯•åŠ¨æ€å‚æ•°ç®—æ³•æ—¶å¯é‡ç°æ‰§è¡Œ
- ğŸ¯ å¯¹æ¯”ä¸åŒç®—æ³•å®ç°çš„è¡Œä¸ºå·®å¼‚
- ğŸ¯ ç¼–å†™å¯é‡ç°çš„å•å…ƒæµ‹è¯•
- ğŸ¯ åˆ†æä¾èµ–éšæœºæ•°çš„åŠ å¯†ç®—æ³•

### å®šæ—¶å™¨ï¼ˆç«‹å³æ‰§è¡Œç‰ˆæœ¬ï¼‰

```python
# setTimeout/setIntervalï¼ˆç”¨äº API æ£€æµ‹ï¼Œç«‹å³æ‰§è¡Œï¼‰
result = ctx.evaluate("""
    let value = 0;
    setTimeout(() => { value = 42; }, 100);  // ç«‹å³æ‰§è¡Œ
    value  // éœ€è¦ç­‰å¾… Promise
""")
```

âš ï¸ **æ³¨æ„**ï¼šsetTimeout/setInterval æ˜¯**å‡çš„å¼‚æ­¥**ï¼ˆç«‹å³æ‰§è¡Œï¼‰ï¼Œä»…ç”¨äºé€šè¿‡ JS ä»£ç ä¸­çš„ API å­˜åœ¨æ€§æ£€æµ‹ã€‚

### Worker APIï¼ˆå•çº¿ç¨‹æ¨¡æ‹Ÿï¼‰

```python
# Worker APIï¼ˆç”¨äºå…¼å®¹æ£€æµ‹ï¼Œå•çº¿ç¨‹æ¨¡æ‹Ÿï¼‰
result = ctx.evaluate("""
    typeof Worker === 'function' &&
    typeof Worker.prototype.postMessage === 'function'
""")  # True
```

âš ï¸ **æ³¨æ„**ï¼šWorker æ˜¯**å•çº¿ç¨‹æ¨¡æ‹Ÿ**ï¼Œä¸ä¼šçœŸæ­£åˆ›å»ºå¤šçº¿ç¨‹ï¼Œä»…ç”¨äºé€šè¿‡ä»£ç æ£€æµ‹ã€‚

### ç¦ç”¨æ‰©å±•ï¼ˆçº¯å‡€ V8ï¼‰

å¦‚æœä¸éœ€è¦è¿™äº› APIï¼Œå¯ä»¥ç¦ç”¨æ‰©å±•ï¼š

```python
ctx = never_jscore.Context(enable_extensions=False)

# æ­¤æ—¶åªæœ‰ ECMAScript æ ‡å‡† API
result = ctx.evaluate("typeof btoa")  # "undefined"
result = ctx.evaluate("JSON.stringify({a: 1})")  # '{"a":1}' - æ ‡å‡† API å¯ç”¨
```

## é€‚ç”¨åœºæ™¯

### JavaScript é€†å‘åˆ†æï¼ˆæ¨èï¼‰

```python
import never_jscore

# åŠ è½½ç›®æ ‡ç½‘ç«™çš„åŠ å¯† JS
with open("target_crypto.js") as f:
    js_code = f.read()

ctx = never_jscore.Context(enable_extensions=True)  # å¯ç”¨å†…ç½® Web API
ctx.compile(js_code)

# ç›´æ¥è°ƒç”¨åŠ å¯†å‡½æ•°ï¼ˆæ— éœ€é¢å¤– polyfillï¼‰
encrypted = ctx.call("encrypt", [plain_text, key])

# å¦‚æœ JS ä»£ç ä½¿ç”¨äº† btoaã€md5ã€sha256 ç­‰ï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨
result = ctx.evaluate("btoa(md5('test'))")
```

### çœŸå®åœºæ™¯ï¼šAPI ç­¾åç”Ÿæˆ

```python
import never_jscore

ctx = never_jscore.Context(enable_extensions=True)

# å…¸å‹çš„ç­¾åç®—æ³•ï¼ˆæ— éœ€ polyfillï¼Œç›´æ¥è¿è¡Œï¼‰
ctx.compile("""
    function generateSignature(params, secret) {
        // 1. å‚æ•°æ’åº
        const keys = Object.keys(params).sort();

        // 2. æ‹¼æ¥æŸ¥è¯¢å­—ç¬¦ä¸²
        const query = keys.map(k =>
            encodeURIComponent(k) + '=' + encodeURIComponent(params[k])
        ).join('&');

        // 3. æ·»åŠ å¯†é’¥å¹¶è®¡ç®— HMAC
        const message = query + '&key=' + secret;
        const signature = CryptoUtils.hmacSha256(secret, message);

        // 4. Base64 ç¼–ç 
        return btoa(signature);
    }
""")

# è°ƒç”¨ç­¾åå‡½æ•°
signature = ctx.call("generateSignature", [
    {"user": "test", "timestamp": "1234567890"},
    "my-secret-key"
])
print(f"Signature: {signature}")
```

### Hookæ‹¦æˆªï¼šæå–åŠ å¯†æ•°æ®ï¼ˆv2.2.2 æ–°å¢ï¼‰

```python
import never_jscore

ctx = never_jscore.Context(enable_extensions=True)

# åœºæ™¯1: Hook Akamaiä¼ æ„Ÿå™¨ç”Ÿæˆ
result = ctx.evaluate("""
    (async () => {
        // æ¨¡æ‹ŸAkamaiä¼ æ„Ÿå™¨ç”Ÿæˆå‡½æ•°
        function generateSensorData(userAgent, timestamp) {
            const fingerprint = md5(userAgent + timestamp);
            const hash1 = sha256(fingerprint);
            const signature = hmacSha256('secret_key', hash1);

            // Hook: æ‹¦æˆªä¼ æ„Ÿå™¨æ•°æ®ï¼Œä¸æ‰§è¡Œåç»­çš„ç½‘ç»œè¯·æ±‚
            __neverjscore_return__({
                sensor: signature,
                fingerprint: fingerprint,
                timestamp: timestamp
            });

            // åç»­çš„ç½‘ç»œè¯·æ±‚ä¸ä¼šæ‰§è¡Œ
            fetch('/verify', {
                method: 'POST',
                body: JSON.stringify({ sig: signature })
            });
        }

        return generateSensorData(navigator.userAgent, Date.now());
    })()
""")

print(f"ä¼ æ„Ÿå™¨ç­¾å: {result['sensor']}")
print(f"æŒ‡çº¹: {result['fingerprint']}")

# åœºæ™¯2: æ‹¦æˆªå¤šå±‚åŠ å¯†çš„ä¸­é—´å€¼
ctx.compile("""
    function complexEncrypt(data, key) {
        const step1 = btoa(data);
        const step2 = md5(step1);
        const step3 = hmacSha256(key, step2);

        // Hookç¬¬äºŒå±‚åŠ å¯†ç»“æœ
        if (globalThis.__debug_mode__) {
            $return({
                step: 2,
                md5_result: step2,
                base64_result: step1,
                original: data
            });
        }

        return btoa(step3);
    }
""")

# å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œæ‹¦æˆªä¸­é—´å€¼
ctx.eval("globalThis.__debug_mode__ = true;")
result = ctx.call("complexEncrypt", ["sensitive_data", "secret_key"])

print(f"æ‹¦æˆªåˆ°ç¬¬{result['step']}æ­¥: {result['md5_result']}")

# åœºæ™¯3: XMLHttpRequestæ‹¦æˆª
result = ctx.evaluate("""
    (async () => {
        // Hookæ‰€æœ‰XMLHttpRequest.send
        const originalSend = XMLHttpRequest.prototype.send;
        let interceptedRequests = [];

        XMLHttpRequest.prototype.send = function(data) {
            interceptedRequests.push({
                url: this._url,
                method: this._method,
                data: data,
                headers: this._headers
            });

            // æ‹¦æˆªç¬¬ä¸€ä¸ªPOSTè¯·æ±‚
            if (this._method === 'POST') {
                $return({
                    totalRequests: interceptedRequests.length,
                    lastRequest: interceptedRequests[interceptedRequests.length - 1]
                });
            }

            originalSend.call(this, data);
        };

        // æ‰§è¡Œä¸€ç³»åˆ—è¯·æ±‚
        for (let i = 0; i < 3; i++) {
            const xhr = new XMLHttpRequest();
            xhr.open(i === 2 ? 'POST' : 'GET', '/api/data/' + i);
            xhr.send('data_' + i);
        }
    })()
""")

print(f"æ‹¦æˆªåˆ°çš„è¯·æ±‚: {result['lastRequest']}")
```

**Hookæ‹¦æˆªçš„ä¼˜åŠ¿ï¼š**
- âœ… æ— éœ€ä¿®æ”¹åŸå§‹JSä»£ç 
- âœ… ç²¾ç¡®æ§åˆ¶æ‹¦æˆªç‚¹
- âœ… è·å–åŠ å¯†ä¸­é—´å€¼ç”¨äºåˆ†æ
- âœ… é¿å…æ‰§è¡Œä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚
- âœ… æ”¯æŒæ¡ä»¶æ‹¦æˆªå’Œå¤šç‚¹æ‹¦æˆª

### å¼‚æ­¥æ•°æ®å¤„ç†

```python
import never_jscore

ctx = never_jscore.Context()
ctx.compile("""
    async function processBatch(items) {
        const results = await Promise.all(
            items.map(async item => {
                // æ¨¡æ‹Ÿå¼‚æ­¥å¤„ç†
                return await Promise.resolve(item * 2);
            })
        );
        return results;
    }
""")

result = ctx.call("processBatch", [[1, 2, 3, 4, 5]])
print(result)  # [2, 4, 6, 8, 10]
```

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **é‡ç”¨ Context**: å¯¹äºéœ€è¦å¤šæ¬¡è°ƒç”¨çš„ä»£ç ï¼Œåˆ›å»ºä¸€ä¸ª Context å¹¶å¤ç”¨
2. **æ‰¹é‡å¤„ç†**: åœ¨ JavaScript ç«¯æ‰¹é‡å¤„ç†æ•°æ®ï¼Œå‡å°‘ Python-JS è°ƒç”¨æ¬¡æ•°
3. **å• Context æ¨¡å¼**: å°½å¯èƒ½å°†æ‰€æœ‰å‡½æ•°å®šä¹‰åœ¨ä¸€ä¸ª Context ä¸­
4. **åˆç†ä½¿ç”¨ auto_await**: å¯¹äºä¸éœ€è¦ç­‰å¾…çš„åŒæ­¥ä»£ç ï¼Œè®¾ç½® `auto_await=False` å¯ç•¥å¾®æå‡æ€§èƒ½
5. **é¿å…é¢‘ç¹åˆ›å»º Context**: åˆ›å»º Context æœ‰å¼€é”€ï¼Œåº”å°½é‡å¤ç”¨

## æ¨¡å—åŒ–æ¶æ„

é¡¹ç›®é‡‡ç”¨æ¸…æ™°çš„æ¨¡å—åŒ–è®¾è®¡ï¼š

```
src/
â”œâ”€â”€ lib.rs              # æ¨¡å—å…¥å£ï¼Œä»…å¯¼å‡º Context ç±»
â”œâ”€â”€ context.rs          # Context å®ç°ï¼ˆV8 isolate å°è£…ï¼‰
â”œâ”€â”€ runtime.rs          # V8/Tokio runtime ç®¡ç†
â”œâ”€â”€ convert.rs          # Python â†” JavaScript ç±»å‹è½¬æ¢
â”œâ”€â”€ storage.rs          # ç»“æœå­˜å‚¨
â”œâ”€â”€ random_state.rs     # çº¿ç¨‹æœ¬åœ° RNG çŠ¶æ€ç®¡ç†ï¼ˆv2.3.0 æ–°å¢ï¼‰
â”œâ”€â”€ random_ops.rs       # éšæœºæ•°ç§å­æ§åˆ¶ï¼ˆv2.3.0 æ–°å¢ï¼‰
â”œâ”€â”€ fs_ops.rs           # æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆ11 ä¸ªæ“ä½œï¼‰
â”œâ”€â”€ fetch_ops.rs        # HTTP è¯·æ±‚ï¼ˆåŸºäº reqwestï¼Œæ”¯æŒäºŒè¿›åˆ¶å“åº”ï¼‰
â”œâ”€â”€ crypto_ops.rs       # åŠ å¯†æ“ä½œæ‰©å±•ï¼ˆBase64ã€Hashã€HMACã€Randomï¼‰
â”œâ”€â”€ encoding_ops.rs     # URL ç¼–ç æ‰©å±•
â”œâ”€â”€ timer_ops.rs        # å®šæ—¶å™¨æ‰©å±•ï¼ˆsetTimeout/setIntervalï¼‰
â”œâ”€â”€ worker_ops.rs       # Worker API æ‰©å±•
â”œâ”€â”€ performance_ops.rs  # Performance APIï¼ˆv2.2.1 æ–°å¢ï¼‰
â”œâ”€â”€ ops/                # æ–°å¢ ops æ¨¡å—
â”‚   â”œâ”€â”€ mod.rs         # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ storage_ops.rs # ç»“æœå­˜å‚¨ opsï¼ˆå« early_returnï¼Œv2.2.2ï¼‰
â”‚   â”œâ”€â”€ web_storage.rs # localStorage/sessionStorageï¼ˆ12 ä¸ªæ“ä½œï¼‰
â”‚   â””â”€â”€ browser_env.rs # æµè§ˆå™¨ç¯å¢ƒå¯¹è±¡ï¼ˆ9 ä¸ªæ“ä½œï¼‰
â””â”€â”€ dddd_js/
    â””â”€â”€ js_polyfill.js  # JavaScript polyfill å±‚ï¼ˆè‡ªåŠ¨æ³¨å…¥ï¼Œ2100+ è¡Œï¼‰

tests/
â”œâ”€â”€ test_all_features.py        # å®Œæ•´åŠŸèƒ½æµ‹è¯•å¥—ä»¶
â”œâ”€â”€ test_browser_apis.py        # æµè§ˆå™¨ API æµ‹è¯•
â”œâ”€â”€ test_high_priority_apis.py  # é«˜ä¼˜å…ˆçº§ API æµ‹è¯•
â”œâ”€â”€ test_wasm.py               # WebAssembly æµ‹è¯•
â”œâ”€â”€ test_async_simple.py       # å¼‚æ­¥åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_extensions.py         # æ‰©å±• API æµ‹è¯•
â”œâ”€â”€ test_new_apis.py           # æ–° API æµ‹è¯•
â”œâ”€â”€ test_hook_interception.py  # Hook æ‹¦æˆªæµ‹è¯•ï¼ˆv2.2.2ï¼‰
â”œâ”€â”€ test_random_seed.py        # éšæœºæ•°ç§å­æµ‹è¯•ï¼ˆv2.3.0ï¼‰
â””â”€â”€ test_performance.py        # Performance API æµ‹è¯•ï¼ˆv2.2.1ï¼‰
```

### æ‰©å±•ç³»ç»Ÿæ¶æ„

- **Rust å±‚**: ä½¿ç”¨ Deno Core çš„ `#[op2]` å®å®šä¹‰åº•å±‚æ“ä½œ
- **JavaScript å±‚**: åœ¨ `js_polyfill.js` ä¸­å°è£…ä¸ºæ ‡å‡† Web API
- **è‡ªåŠ¨æ³¨å…¥**: `enable_extensions=True` æ—¶è‡ªåŠ¨åŠ è½½æ‰€æœ‰æ‰©å±•

## æµ‹è¯•

```bash
# åŸºç¡€åŠŸèƒ½æµ‹è¯•
python test_async_simple.py

# Web API æ‰©å±•æµ‹è¯•
python test_extensions.py
python test_new_apis.py
```

## æŠ€æœ¯ç»†èŠ‚

- **V8 å¼•æ“**: ä½¿ç”¨ Deno Core æä¾›çš„ V8 bindings
- **Tokio Runtime**: å…¨å±€å•çº¿ç¨‹ runtimeï¼Œæ”¯æŒå¼‚æ­¥æ“ä½œ
- **ç±»å‹è½¬æ¢**: Python â†” JSON â†” JavaScript ä¸‰å±‚è½¬æ¢
- **å†…å­˜ç®¡ç†**: ä½¿ç”¨ `std::mem::forget()` é¿å… HandleScope é”™è¯¯ï¼Œæ¯ 100 æ¬¡æ‰§è¡Œæç¤º GC
- **æ‰©å±•ç³»ç»Ÿ**: åŸºäº Deno Core extension æœºåˆ¶ï¼Œæ¨¡å—åŒ–è®¾è®¡
- **ä¾èµ–åº“**:
  - `deno_core 0.367.0`: V8 è¿è¡Œæ—¶
  - `pyo3 0.27.1`: Python ç»‘å®šï¼ˆabi3-py38ï¼‰
  - `tokio 1.48`: å¼‚æ­¥è¿è¡Œæ—¶
  - `reqwest 0.12`: HTTP å®¢æˆ·ç«¯ï¼ˆæ”¯æŒ JSON å’Œ blockingï¼‰
  - `lazy_static 1.4`: å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆlocalStorage/sessionStorageï¼‰
  - `rand 0.8`: éšæœºæ•°ç”Ÿæˆ
  - `base64`, `md-5`, `sha1`, `sha2`, `hmac`: åŠ å¯†åº“
  - `urlencoding`, `percent-encoding`: URL ç¼–è§£ç 

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ç›¸å…³é¡¹ç›®

- [py_mini_racer](https://github.com/sqreen/PyMiniRacer) - Python MiniRacer å®ç°
- [PyExecJS](https://github.com/doloopwhile/PyExecJS) - åŸ Python ExecJS å®ç°
- [Deno](https://github.com/denoland/deno) - ç°ä»£ JavaScript/TypeScript è¿è¡Œæ—¶
- [PyO3](https://github.com/PyO3/pyo3) - Rust Python bindings

## æ›´æ–°æ—¥å¿—

### v2.3.0 (2025-11-12) - ç¡®å®šæ€§éšæœºæ•°ä¸äºŒè¿›åˆ¶æ•°æ®ä¿®å¤

#### ç¡®å®šæ€§éšæœºæ•°ï¼ˆSeedable RNGï¼‰
- âœ¨ **éšæœºæ•°ç§å­æ§åˆ¶**: Context æ–°å¢ `random_seed` å‚æ•°
  - æ”¯æŒå›ºå®šç§å­åˆ›å»ºç¡®å®šæ€§æ‰§è¡Œç¯å¢ƒ
  - æ‰€æœ‰éšæœºæ•° API ç»Ÿä¸€å—ç§å­æ§åˆ¶
  - ç›¸åŒç§å­äº§ç”Ÿå®Œå…¨ç›¸åŒçš„éšæœºæ•°åºåˆ—
- ğŸ² **æ”¯æŒçš„éšæœºæ•° API**:
  - `Math.random()`: æ ‡å‡†éšæœºæ•°ï¼ˆ0 åˆ° 1ï¼‰
  - `crypto.randomUUID()`: UUID v4 ç”Ÿæˆ
  - `crypto.getRandomValues()`: éšæœºå­—èŠ‚æ•°ç»„
- ğŸ“Š **åº”ç”¨åœºæ™¯**:
  - è°ƒè¯•åŠ¨æ€å‚æ•°åŠ å¯†ç®—æ³•
  - å¯é‡ç°çš„å•å…ƒæµ‹è¯•
  - å¯¹æ¯”ä¸åŒç®—æ³•å®ç°çš„è¡Œä¸º
  - Akamai ç­‰åçˆ¬è™«ç®—æ³•çš„ç¡®å®šæ€§æ‰§è¡Œ

#### äºŒè¿›åˆ¶æ•°æ®æ”¯æŒä¿®å¤
- ğŸ”§ **WASM åŠ è½½ä¿®å¤**: ä¿®å¤ fetch() å¯¹äºŒè¿›åˆ¶æ•°æ®çš„å¤„ç†
  - `fetch_ops.rs`: æ”¹ç”¨ `response.bytes()` ä»£æ›¿ `response.text()`
  - æ·»åŠ  Content-Type æ£€æµ‹ï¼Œè‡ªåŠ¨è¯†åˆ«äºŒè¿›åˆ¶å“åº”
  - äºŒè¿›åˆ¶æ•°æ®é€šè¿‡ Base64 ç¼–ç ä¼ è¾“ï¼ˆ`bodyBinary` å­—æ®µï¼‰
- ğŸ”§ **Base64 è§£ç ä¿®å¤**: ä¿®å¤ `atob()` å¯¹äºŒè¿›åˆ¶æ•°æ®çš„å¤„ç†
  - `crypto_ops.rs`: `op_base64_decode` è¿”å› Latin-1 å­—ç¬¦ä¸²
  - é¿å… UTF-8 è§£ç é”™è¯¯ï¼Œæ­£ç¡®å¤„ç†äºŒè¿›åˆ¶æ•°æ®
- ğŸŒ **XMLHttpRequest å¢å¼º**:
  - æ”¯æŒ `responseType="arraybuffer"`
  - æ­£ç¡®æå–å“åº”å¤´ï¼ˆ`getResponseHeader()`ï¼‰
  - `Response.arrayBuffer()` æ­£ç¡®è§£ç  Base64 äºŒè¿›åˆ¶æ•°æ®

#### æŠ€æœ¯å®ç°
- **æ–°å¢æ–‡ä»¶**:
  - `src/random_state.rs`: çº¿ç¨‹æœ¬åœ° RNG çŠ¶æ€ç®¡ç†ï¼ˆ~90 è¡Œï¼‰
  - `src/random_ops.rs`: éšæœºæ•°ç§å­æ§åˆ¶ opsï¼ˆ~30 è¡Œï¼‰
  - `tests/test_random_seed.py`: éšæœºæ•°ç§å­åŠŸèƒ½æµ‹è¯•å¥—ä»¶ï¼ˆ5 ä¸ªæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡ï¼‰
- **ä¿®æ”¹æ–‡ä»¶**:
  - `src/lib.rs`: æ·»åŠ  random_state å’Œ random_ops æ¨¡å—
  - `src/crypto_ops.rs`: æ‰€æœ‰éšæœºå‡½æ•°ç»Ÿä¸€ä½¿ç”¨ `random_state`
  - `src/fetch_ops.rs`: äºŒè¿›åˆ¶å“åº”å¤„ç†ï¼Œæ·»åŠ  `bodyBinary` å­—æ®µ
  - `src/context.rs`: Context æ·»åŠ  `random_seed` å‚æ•°
  - `src/dddd_js/js_polyfill.js`: è¦†ç›– `Math.random()`ï¼Œå¢å¼º `Response.arrayBuffer()`
  - `py_mod/never_jscore/never_jscore.pyi`: æ›´æ–°ç±»å‹æç¤º

#### æµ‹è¯•è¦†ç›–
- âœ… 5 ä¸ªéšæœºæ•°ç§å­æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆ100% é€šè¿‡ç‡ï¼‰
  - Math.random() å›ºå®šç§å­æµ‹è¯•
  - ä¸åŒç§å­äº§ç”Ÿä¸åŒéšæœºæ•°æµ‹è¯•
  - æ— ç§å­éç¡®å®šæ€§æµ‹è¯•
  - crypto API ç§å­æ§åˆ¶æµ‹è¯•
  - å¯é‡ç°ç®—æ³•å¯¹æ¯”æµ‹è¯•
- âœ… WASM äºŒè¿›åˆ¶åŠ è½½æµ‹è¯•é€šè¿‡
  - 124KB WASM æ¨¡å—æˆåŠŸåŠ è½½
  - æ­£ç¡®çš„ WASM magic bytes: `0x00 0x61 0x73 0x6d`

### v2.2.2 (2025-11-12) - Hookæ‹¦æˆªä¸æå‰è¿”å›

#### Hookæ‹¦æˆªåŠŸèƒ½
- âœ¨ **Hookæ‹¦æˆªAPI**: æ”¯æŒåœ¨ä»»æ„ä½ç½®ç»ˆæ­¢JavaScriptæ‰§è¡Œå¹¶è¿”å›ç»“æœ
  - `__neverjscore_return__(value)`: å®Œæ•´å‡½æ•°å
  - `$return(value)`: ç®€çŸ­åˆ«åï¼ˆæ¨èä½¿ç”¨ï¼‰
  - `$exit(value)`: æ›¿ä»£åˆ«å
- ğŸ£ **æå‰è¿”å›æœºåˆ¶**:
  - ç«‹å³ç»ˆæ­¢JavaScriptæ‰§è¡Œ
  - è·³è¿‡åç»­æ‰€æœ‰ä»£ç ï¼ˆåŒ…æ‹¬å¼‚æ­¥æ“ä½œï¼‰
  - å°†æ‹¦æˆªåˆ°çš„å€¼è¿”å›åˆ°Python
  - æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ‰§è¡Œæ¨¡å¼
  - è‡ªåŠ¨å¤„ç†JSONåºåˆ—åŒ–ï¼ˆå¤±è´¥æ—¶é™çº§ä¸ºå­—ç¬¦ä¸²ï¼‰

#### åº”ç”¨åœºæ™¯
- ğŸ¯ Hook `XMLHttpRequest.send` æ‹¦æˆªåŠ å¯†è¯·æ±‚æ•°æ®
- ğŸ¯ HookåŠ å¯†å‡½æ•°è·å–ä¸­é—´å€¼
- ğŸ¯ æå–Akamaiç­‰åçˆ¬è™«çš„ä¼ æ„Ÿå™¨æ•°æ®
- ğŸ¯ æ¡ä»¶æ‹¦æˆªï¼šåªåœ¨æ»¡è¶³æ¡ä»¶æ—¶æå‰è¿”å›
- ğŸ¯ å¤šç‚¹æ‹¦æˆªï¼šåœ¨å¤šä¸ªä½ç½®è®¾ç½®æ‹¦æˆªç‚¹

#### æŠ€æœ¯å®ç°
- **Rustå±‚**: æ–°å¢ `op_early_return` æ“ä½œï¼Œæ·»åŠ  `early_return` æ ‡å¿—
- **JavaScriptå±‚**: é€šè¿‡æŠ›å‡ºç‰¹æ®Šå¼‚å¸¸å®ç°ç«‹å³ç»ˆæ­¢
- **å¼‚æ­¥æ”¯æŒ**: è·³è¿‡event loopï¼Œç«‹å³è¿”å›ç»“æœ
- **åŒæ­¥æ”¯æŒ**: æ­£ç¡®è¯†åˆ«å¹¶å¤„ç†æå‰è¿”å›ä¿¡å·

#### æ–°å¢æ–‡ä»¶
- `examples/hook_examples.py`: 5ä¸ªå®ç”¨Hookç¤ºä¾‹
- `tests/test_hook_interception.py`: 13ä¸ªå…¨é¢æµ‹è¯•ç”¨ä¾‹ï¼ˆå…¨éƒ¨é€šè¿‡ï¼‰
- `HOOK_IMPLEMENTATION_REPORT.md`: è¯¦ç»†å®ç°æŠ¥å‘Š

#### ä¿®æ”¹æ–‡ä»¶
- `src/storage.rs`: æ·»åŠ  `early_return` æ ‡å¿—å’Œç›¸å…³æ–¹æ³•
- `src/ops/storage_ops.rs`: æ·»åŠ  `op_early_return` æ“ä½œ
- `src/context.rs`: å¼‚æ­¥å’ŒåŒæ­¥æ¨¡å¼çš„æå‰è¿”å›å¤„ç†
- `src/dddd_js/js_polyfill.js`: æ·»åŠ æå‰è¿”å›APIï¼Œé‡ç»„æ—¥å¿—å·¥å…·

#### æµ‹è¯•è¦†ç›–
- âœ… 13ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼ˆ100%é€šè¿‡ç‡ï¼‰
- âœ… Hook XMLHttpRequest.sendæµ‹è¯•
- âœ… HookåŠ å¯†å‡½æ•°æµ‹è¯•
- âœ… æ¡ä»¶æ‹¦æˆªæµ‹è¯•
- âœ… å¤æ‚æ•°æ®ç»“æ„è¿”å›æµ‹è¯•
- âœ… è·³è¿‡å¼‚æ­¥æ“ä½œæµ‹è¯•
- âœ… Akamaié£æ ¼Hookæµ‹è¯•

### v2.2.1 (2025-11-11) - Performance API

#### æ€§èƒ½ç›‘æ§ API
- âœ¨ **Performance API**: å®Œæ•´çš„ Web Performance Timing API
  - `performance.now()`: é«˜ç²¾åº¦æ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§ï¼‰
  - `performance.timeOrigin`: æ—¶é—´åŸç‚¹ï¼ˆUnix æ—¶é—´æˆ³ï¼‰
  - `performance.mark(name)`: åˆ›å»ºæ€§èƒ½æ ‡è®°
  - `performance.measure(name, start, end)`: æµ‹é‡ä¸¤ä¸ªæ ‡è®°ä¹‹é—´çš„æ—¶é—´
  - `performance.getEntries()`: è·å–æ‰€æœ‰æ€§èƒ½æ¡ç›®
  - `performance.getEntriesByType(type)`: æŒ‰ç±»å‹è·å–ï¼ˆ'mark' æˆ– 'measure'ï¼‰
  - `performance.getEntriesByName(name)`: æŒ‰åç§°è·å–
  - `performance.clearMarks()` / `performance.clearMeasures()`: æ¸…é™¤æ ‡è®°å’Œæµ‹é‡

#### æ–°å¢æ–‡ä»¶
- `src/performance_ops.rs`: Performance API Rust å®ç°ï¼ˆ~220 è¡Œï¼‰
- `test_performance.py`: Performance API æµ‹è¯•å¥—ä»¶

#### ä½¿ç”¨åœºæ™¯
- ğŸ¯ JavaScript ä»£ç æ€§èƒ½åˆ†æ
- ğŸ¯ å¤šæ­¥éª¤æ“ä½œçš„æ—¶é—´åˆ†è§£
- ğŸ¯ æ€§èƒ½ç“¶é¢ˆå®šä½
- ğŸ¯ API è°ƒç”¨è€—æ—¶ç»Ÿè®¡

### v2.2.0 (2025-11-11) - é‡å¤§åŠŸèƒ½æ‰©å±•

#### Node.js ç¯å¢ƒ API
- âœ¨ **require()**: å®Œæ•´çš„ CommonJS æ¨¡å—ç³»ç»Ÿ
  - ç›¸å¯¹/ç»å¯¹è·¯å¾„æ¨¡å—åŠ è½½
  - node_modules é€’å½’æŸ¥æ‰¾
  - package.json ä¸»å…¥å£è§£æ
  - æ¨¡å—ç¼“å­˜æœºåˆ¶
- âœ¨ **fs æ¨¡å—**: æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼ˆreadFileSync, writeFileSync, existsSync ç­‰ï¼‰
- âœ¨ **path æ¨¡å—**: è·¯å¾„å¤„ç†ï¼ˆresolve, join, dirname, basename ç­‰ï¼‰
- âœ¨ **fetch()**: ç°ä»£ HTTP API
  - æ”¯æŒæ‰€æœ‰ HTTP æ–¹æ³•ï¼ˆGET/POST/PUT/DELETE ç­‰ï¼‰
  - è‡ªå®šä¹‰è¯·æ±‚å¤´
  - JSON è‡ªåŠ¨åºåˆ—åŒ–/ååºåˆ—åŒ–
  - Response/Headers å¯¹è±¡
  - è¶…æ—¶æ§åˆ¶

#### æµè§ˆå™¨ç¯å¢ƒ APIï¼ˆè¡¥ç¯å¢ƒï¼‰
- âœ¨ **localStorage/sessionStorage**: æµè§ˆå™¨å­˜å‚¨ API
  - setItem/getItem/removeItem/clear
  - key() å’Œ length å±æ€§
  - çº¿ç¨‹å®‰å…¨å…¨å±€å­˜å‚¨
- âœ¨ **æµè§ˆå™¨ç¯å¢ƒå¯¹è±¡**:
  - `navigator`: ç”¨æˆ·ä»£ç†ã€å¹³å°ã€è¯­è¨€ç­‰ä¿¡æ¯
  - `location`: URL è§£æï¼ˆhref, protocol, hostname ç­‰ï¼‰
  - `document`: DOM æ–‡æ¡£å¯¹è±¡ï¼ˆreadyState, title, URL ç­‰ï¼‰
  - `window`: çª—å£å±æ€§ï¼ˆinnerWidth, innerHeight ç­‰ï¼‰
  - `screen`: å±å¹•ä¿¡æ¯ï¼ˆwidth, height, colorDepth ç­‰ï¼‰
- âœ¨ **URL/URLSearchParams**: å®Œæ•´çš„ URL å¤„ç†
  - URL è§£æå’Œæ„é€ 
  - æŸ¥è¯¢å‚æ•°æ“ä½œï¼ˆget/set/append/deleteï¼‰
  - è¿­ä»£å™¨æ”¯æŒ
- âœ¨ **FormData**: è¡¨å•æ•°æ®å¤„ç†
  - append/get/set/delete æ–¹æ³•
  - getAll() è·å–æ‰€æœ‰åŒåå­—æ®µ
  - è¿­ä»£å™¨æ”¯æŒ
- âœ¨ **Event/EventTarget**: å®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿ
  - Event ç±»ï¼ˆpreventDefault, stopPropagationï¼‰
  - EventTarget ç±»ï¼ˆaddEventListener, removeEventListener, dispatchEventï¼‰
  - äº‹ä»¶é˜¶æ®µå¸¸é‡å’Œé€‰é¡¹ï¼ˆonce, captureï¼‰
- âœ¨ **XMLHttpRequest**: ä¼ ç»Ÿ AJAX API
  - åŸºäº fetch() å®ç°
  - å®Œæ•´çš„çŠ¶æ€ç®¡ç†ï¼ˆUNSENT/OPENED/HEADERS_RECEIVED/LOADING/DONEï¼‰
  - äº‹ä»¶å¤„ç†å™¨ï¼ˆonload, onerror, onreadystatechangeï¼‰
  - è¯·æ±‚å¤´æ“ä½œ

#### æ–°å¢ä¾èµ–
- `reqwest 0.12`: HTTP å®¢æˆ·ç«¯åº“ï¼ˆblocking æ¨¡å¼ï¼‰
- `lazy_static 1.4`: å…¨å±€çŠ¶æ€ç®¡ç†

#### ä»£ç å¢é‡
- **Rust ä»£ç **: ~800 è¡Œæ–°å¢ä»£ç 
  - fs_ops.rs (11 ä¸ªæ“ä½œ)
  - fetch_ops.rs (3 ä¸ªæ“ä½œ)
  - web_storage.rs (12 ä¸ªæ“ä½œ)
  - browser_env.rs (9 ä¸ªæ“ä½œ)
- **JavaScript ä»£ç **: ~890 è¡Œæ–°å¢ä»£ç 
  - require() å®ç°ï¼ˆ~200 è¡Œï¼‰
  - fetch/Response/Headersï¼ˆ~60 è¡Œï¼‰
  - localStorage/sessionStorageï¼ˆ~50 è¡Œï¼‰
  - URL/URLSearchParamsï¼ˆ~160 è¡Œï¼‰
  - FormDataï¼ˆ~80 è¡Œï¼‰
  - Event/EventTargetï¼ˆ~130 è¡Œï¼‰
  - XMLHttpRequestï¼ˆ~180 è¡Œï¼‰
  - æµè§ˆå™¨ç¯å¢ƒå¯¹è±¡ï¼ˆ~40 è¡Œï¼‰

#### æµ‹è¯•è¦†ç›–
- âœ… test_all_features.py: 7 ä¸ªç»¼åˆæµ‹è¯•ï¼ˆ100% é€šè¿‡ï¼‰
- âœ… test_browser_apis.py: æµè§ˆå™¨ API å®Œæ•´æµ‹è¯•
- âœ… test_high_priority_apis.py: é«˜ä¼˜å…ˆçº§ API æµ‹è¯•
- âœ… test_wasm.py: WebAssembly éªŒè¯æµ‹è¯•

### v2.0.0 (2025-11-05)

#### æ¶æ„é‡æ„
- ğŸ”„ **æ¶æ„é‡æ„**: æ”¹ä¸º py_mini_racer é£æ ¼çš„å®ä¾‹åŒ– API
- âœ… ä¿®å¤ HandleScope é”™è¯¯ï¼šä½¿ç”¨ `std::mem::forget()` ç®¡ç† v8::Global
- âœ… æ˜ç¡® LIFO æ¸…ç†é¡ºåºè¦æ±‚
- âœ… å®Œå–„å¤š Context ä½¿ç”¨é™åˆ¶è¯´æ˜
- âœ… æ–°å¢ `compile()` ä¾¿æ·æ–¹æ³•
- âœ… æ–°å¢ `evaluate()` ç‹¬ç«‹æ±‚å€¼æ–¹æ³•

#### Web API æ‰©å±•ï¼ˆå…¨æ–°ï¼‰
- âœ¨ **Crypto APIs**:
  - Base64: `btoa()`, `atob()`
  - å“ˆå¸Œ: `md5()`, `sha1()`, `sha256()`, `sha512()`
  - HMAC: `hmacMd5()`, `hmacSha1()`, `hmacSha256()`
  - Hex: `hexEncode()`, `hexDecode()`
  - é“¾å¼ API: `CryptoUtils.createHash()`, `CryptoUtils.createHmac()`
- âœ¨ **URL ç¼–ç **: `encodeURIComponent()`, `decodeURIComponent()`, `encodeURI()`, `decodeURI()`
- âœ¨ **å®šæ—¶å™¨**: `setTimeout()`, `setInterval()`, `clearTimeout()`, `clearInterval()` (ç«‹å³æ‰§è¡Œç‰ˆæœ¬)
- âœ¨ **Worker API**: `Worker` ç±»ï¼ˆå•çº¿ç¨‹æ¨¡æ‹Ÿç‰ˆæœ¬ï¼‰
- âœ¨ **éšæœºæ•°**: `crypto.randomUUID()`, `crypto.getRandomValues()`, éšæœºæ•° ops
- ğŸ¯ **æ‰©å±•æ§åˆ¶**: `Context(enable_extensions=True/False)` å¯é€‰å¯ç”¨/ç¦ç”¨
- ğŸ“¦ **è‡ªåŠ¨æ³¨å…¥**: æ— éœ€æ‰‹åŠ¨åŠ è½½ polyfillï¼Œå¼€ç®±å³ç”¨

#### æ€§èƒ½ä¼˜åŒ–
- âš¡ æ‰©å±•æ¨¡å—é‡‡ç”¨ Rust å®ç°ï¼Œæ€§èƒ½æ¥è¿‘åŸç”Ÿ
- âš¡ JavaScript polyfill å±‚ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨

### v0.1.0 (2025-11-01)

- âœ… åŸºäº Deno Core çš„ JavaScript æ‰§è¡Œ
- âœ… Promise/async/await å®Œæ•´æ”¯æŒ
- âœ… Python â†” JavaScript ç±»å‹è‡ªåŠ¨è½¬æ¢
- âœ… æ¨¡å—åŒ–ä»£ç æ¶æ„
- âœ… å®Œæ•´çš„ç±»å‹æç¤ºæ”¯æŒ
- âœ… æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡

