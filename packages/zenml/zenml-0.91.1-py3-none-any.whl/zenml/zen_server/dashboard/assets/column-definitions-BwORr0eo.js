import{j as t}from"./@radix-DAoBbclx.js";import{S as C}from"./plus-E8wmxLMS.js";import{S as w}from"./refresh-DhdtzFSJ.js";import{S as y}from"./SearchField-CVlpmsG6.js";import{ai as m,B as p,r as i,e as h,a4 as D,J as v,N,O as b,Q as P,R as k,U as A,V as x,b8 as R,a1 as f,b9 as T,T as _,a2 as B,aU as F,ba as I,aJ as E,aK as L}from"./index-DnCFURX3.js";import{b as g}from"./@tanstack-2852wz5w.js";import{L as l,f as O}from"./@react-router-BTai9D5g.js";import{B as U}from"./button-group-basic-B-kwcZSw.js";import{P as Q}from"./Pagination-hLnXxv_M.js";import{z as c}from"./@zod-3snSrKBm.js";import{D as z}from"./deployment-status-tag-DXByBKnK.js";import{S as M}from"./trash-DsZfFPdX.js";import{D as q,a as G}from"./DeleteAlertDialog-B-lA-7-t.js";import{c as H}from"./helper-CKgq8caL.js";import{u as J}from"./update-snapshot-D2w0HSC0.js";import{u as K}from"./bulk-delete-CtPYv6hb.js";import{a as V}from"./@monaco-editor-Di1Jq_O0.js";import{P as $}from"./pipeline-link-n7S1rP3v.js";const{ContextProvider:Se,useContext:u}=H();function j(){const{setRowSelection:s}=u(),{mutateAsync:e}=J();async function n(a){await e({snapshotId:a,payload:{name:!1}})}return K({deleteFn:n,queryKeyToInvalidate:m.all,setRowSelection:s})}function W(){const{selectedRowCount:s,selectedRowIDs:e}=u(),{bulkDelete:n}=j();async function a(){await n(e)}return t.jsx(U,{itemName:"Pipeline Snapshot",selectedItemCount:s,onDeleteSelected:a})}function Ce({params:s,displayCreateButton:e=!1}){const{refetch:n}=g({...m.list(s),throwOnError:!0}),{selectedRowCount:a}=u();return t.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-1",children:[a?t.jsx(W,{}):t.jsx(y,{searchParams:s}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsxs(p,{className:"bg-theme-surface-primary",intent:"primary",emphasis:"subtle",size:"md",onClick:()=>n(),children:[t.jsx(w,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),e&&t.jsx(p,{className:"whitespace-nowrap",asChild:!0,size:"md",children:t.jsxs(l,{to:i.projects.snapshots.create,children:[t.jsx(C,{className:"h-5 w-5 shrink-0 fill-white"}),t.jsx("span",{children:"Create Snapshot"})]})})]})]})}function we({params:s,columns:e}){const{rowSelection:n,setRowSelection:a}=u(),r=g({...m.list(s),throwOnError:!0});if(r.isPending)return t.jsxs("div",{className:"flex flex-col items-center gap-5",children:[t.jsx("div",{className:"w-full",children:t.jsx(h,{className:"h-[500px] w-full"})}),t.jsx(h,{className:"h-[36px] w-[300px]"})]});if(r.isError)return t.jsx("p",{children:"Error fetching snapshots"});const o=r.data;return t.jsxs("div",{className:"flex flex-col items-center gap-5",children:[t.jsx("div",{className:"w-full",children:t.jsx(D,{columns:e,data:o.items,rowSelection:n,onRowSelectionChange:a,getRowId:S=>S.id})}),o.total_pages>1&&t.jsx(Q,{searchParams:s,paginate:o})]})}const d=1,X=c.object({page:c.coerce.number().min(d).optional().default(d).catch(d),name:c.string().optional(),operator:c.enum(["and","or"]).optional()});function ye(){const[s]=O(),{page:e,name:n,operator:a}=X.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:e,name:n,logical_operator:a}}function Y({deleteHandler:s}){return t.jsx(q,{title:"Delete Pipeline Snapshots",handleDelete:s,children:t.jsxs(G,{children:[t.jsx("p",{children:"Are you sure?"}),t.jsx("p",{children:"This action cannot be undone."})]})})}function Z({deleteHandler:s,open:e,setOpen:n}){return t.jsx(v,{open:e,onOpenChange:n,children:t.jsx(Y,{deleteHandler:s})})}function ee({snapshotId:s}){const[e,n]=V.useState(!1),{bulkDelete:a}=j();async function r(){await a([s]),n(!1)}return t.jsxs(t.Fragment,{children:[t.jsx(Z,{deleteHandler:r,open:e,setOpen:n}),t.jsxs(N,{children:[t.jsx(b,{asChild:!0,children:t.jsx(p,{intent:"secondary",emphasis:"minimal",className:"flex aspect-square items-center justify-center p-0",children:t.jsx(P,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})})}),t.jsx(k,{align:"end",sideOffset:7,children:t.jsxs(A,{onClick:()=>n(!0),className:"cursor-pointer space-x-2",children:[t.jsx(M,{className:"h-3 w-3 fill-neutral-400"}),t.jsx("p",{children:"Delete"})]})})]})]})}function De(){return{id:"check",header:({table:s})=>t.jsx(x,{id:"check-all",checked:s.getIsAllRowsSelected(),onCheckedChange:e=>s.toggleAllRowsSelected(e==="indeterminate"?!0:e)}),meta:{width:"1%"},cell:({row:s})=>t.jsx(x,{id:s.id,checked:s.getIsSelected(),onCheckedChange:s.getToggleSelectedHandler(),className:"h-3 w-3"})}}function ve(){return{id:"name",header:"Snapshot",accessorFn:s=>s.name,cell:({row:s})=>{const e=s.original.name,n=s.original.id;return t.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[t.jsx(R,{className:"h-5 w-5 shrink-0 fill-primary-400"}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(l,{to:i.projects.snapshots.detail.overview(n),className:"grid grid-cols-1 items-center gap-1",children:t.jsx("span",{className:"truncate text-text-md font-semibold text-theme-text-primary",children:e??"Unnamed"})}),t.jsx(f,{copyText:e??""})]}),t.jsxs(l,{to:i.projects.snapshots.detail.overview(n),className:"flex items-center gap-1",children:[t.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:T(n)}),t.jsx(f,{copyText:n})]})]})]})}}}function Ne(){return{id:"deployment",header:"Deployment",accessorFn:s=>{var e,n;return(n=(e=s.resources)==null?void 0:e.deployment)==null?void 0:n.id},cell:({row:s})=>{var r,o;const e=(r=s.original.resources)==null?void 0:r.deployment,n=(o=e==null?void 0:e.body)==null?void 0:o.status,a=e==null?void 0:e.id;return!n||!a?null:t.jsx(l,{to:i.projects.deployments.detail.overview(a),children:t.jsx(z,{status:n})})}}}function be(){return{id:"pipeline",header:"Pipeline",accessorFn:s=>{var e,n;return(n=(e=s.resources)==null?void 0:e.pipeline)==null?void 0:n.name},cell:({row:s})=>{var n;const e=(n=s.original.resources)==null?void 0:n.pipeline;return e?t.jsx($,{pipelineId:e.id,pipelineName:e.name}):null}}}function Pe(){return{id:"latest-run",header:"Latest Run",accessorFn:s=>{var e;return(e=s.resources)==null?void 0:e.latest_triggered_run_id},cell:({row:s})=>{var a,r;const e=(a=s.original.resources)==null?void 0:a.latest_run_id,n=(r=s.original.resources)==null?void 0:r.latest_run_status;return!e||!n?t.jsx("div",{children:"No run"}):t.jsx(l,{to:i.projects.runs.detail(e),children:t.jsxs(_,{emphasis:"subtle",rounded:!1,className:"inline-flex items-center gap-0.5",color:B(n),children:[t.jsx(F,{className:`h-3 w-3 ${I(n)}`}),e==null?void 0:e.split("-")[0]]})})}}}function ke(){return{id:"latest-run-author",header:"Latest Run Author",accessorFn:s=>{var e;return(e=s.resources)==null?void 0:e.latest_run_author},cell:({row:s})=>{var n,a,r;const e=(n=s.original.resources)==null?void 0:n.user;return e?t.jsx(E,{username:e.name,isServiceAccount:!!((a=e.body)!=null&&a.is_service_account),avatarUrl:((r=e.body)==null?void 0:r.avatar_url)??void 0}):null}}}function Ae(){return{id:"created",header:"Created at",accessorFn:s=>{var e;return{date:(e=s.body)==null?void 0:e.created}},cell:({getValue:s})=>{const{date:e}=s();return t.jsx(L,{dateString:e})}}}function Re(){return{id:"admin_actions",header:void 0,accessorFn:s=>s.id,cell:({row:s})=>{const e=s.original.id;return t.jsx(ee,{snapshotId:e})}}}export{we as P,Ce as S,ve as a,Ne as b,De as c,Pe as d,ke as e,Ae as f,Re as g,Se as h,be as i,ye as u};
