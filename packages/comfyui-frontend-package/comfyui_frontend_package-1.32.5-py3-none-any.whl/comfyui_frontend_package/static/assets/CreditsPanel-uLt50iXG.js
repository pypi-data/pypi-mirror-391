var z=Object.defineProperty;var a=(p,g)=>z(p,"name",{value:g,configurable:!0});import{ref as A,watch as N,defineComponent as M,computed as P,resolveDirective as G,openBlock as m,createElementBlock as x,createVNode as n,unref as t,withCtx as _,createTextVNode as L,toDisplayString as c,createBlock as S,createElementVNode as u,createCommentVNode as U,withDirectives as J,normalizeClass as K}from"vue";import E from"primevue/button";import D from"primevue/column";import O from"primevue/datatable";import R from"primevue/divider";import j from"primevue/skeleton";import Q from"primevue/tabpanel";import{aJ as q,bP as H,aK as W,D as X,O as Y,o as Z,v as ee,P as te,cx as oe}from"./index-BYfAAqfw.js";import se from"primevue/badge";import re from"primevue/message";import ae from"primevue/progressspinner";import{u as ie}from"./index-q8HDYOAD.js";import{aH as V}from"./vendor-other-ISwNJJIx.js";import{useI18n as ne}from"vue-i18n";import"./vendor-xterm-DV1MVhAx.js";import"primevue/scrollpanel";import"primevue/usetoast";import"primevue/card";import"primevue/galleria";import"primevue/popover";import"primevue/checkbox";import"primevue/iconfield";import"primevue/inputicon";import"primevue/inputtext";import"primevue/chip";import"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/progressbar";import"primevue";import"primevue/select";import"primevue/selectbutton";import"primevue/tag";import"primevue/dialog";import"primevue/colorpicker";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import"@primevue/themes";import"@primevue/themes/aura";import"./vendor-vue-CEZOemkk.js";import"primevue/config";import"primevue/confirmationservice";import"primevue/toastservice";import"primevue/tooltip";import"primevue/listbox";import"primevue/multiselect";import"primevue/floatlabel";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/inputnumber";import"primevue/tabpanels";import"primevue/tabs";import"primevue/toggleswitch";import"primevue/radiobutton";import"primevue/knob";import"primevue/slider";import"primevue/panel";import"primevue/tabmenu";import"primevue/tab";import"primevue/tablist";import"primevue/autocomplete";import"primevue/dropdown";import"./vendor-tiptap-BnS5itOe.js";import"primevue/blockui";var B=(p=>(p.CREDIT_ADDED="credit_added",p.ACCOUNT_CREATED="account_created",p.API_USAGE_STARTED="api_usage_started",p.API_USAGE_COMPLETED="api_usage_completed",p))(B||{});const F=V.create({baseURL:q(),headers:{"Content-Type":"application/json"}}),le=a(()=>{const p=A(!1),g=A(null),{d:v}=ne();N(()=>q(),e=>{F.defaults.baseURL=e});const b=a((e,s,r)=>{if(W(e))return;let d;if(!V.isAxiosError(e))d=`${s} failed: ${e instanceof Error?e.message:String(e)}`;else{const i=e,w=i.response?.status;w&&r?.[w]?d=r[w]:d=i.response?.data?.message??`${s} failed with status ${w}`}g.value=d},"handleRequestError"),y=a(async(e,s)=>{const{errorContext:r,routeSpecificErrors:d}=s;p.value=!0,g.value=null;try{return(await e()).data}catch(i){return b(i,r,d),null}finally{p.value=!1}},"executeRequest");function f(e){switch(e){case"credit_added":return"Credits Added";case"account_created":return"Account Created";case"api_usage_completed":return"API Usage";default:return e}}a(f,"formatEventType");function l(e){const s=new Date(e);return v(s,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}a(l,"formatDate");function k(e){return e.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" ")}a(k,"formatJsonKey");function C(e){return typeof e=="number"?e.toLocaleString():typeof e=="string"&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e).toLocaleString():e}a(C,"formatJsonValue");function $(e){switch(e){case"credit_added":return"success";case"account_created":return"info";case"api_usage_completed":return"warning";default:return"info"}}a($,"getEventSeverity");function T(e){const{amount:s,api_name:r,model:d,...i}=e.params||{};return Object.keys(i).length>0}a(T,"hasAdditionalInfo");function I(e){const{...s}=e.params||{};return Object.entries(s).map(([r,d])=>{const i=k(r),w=C(d);return`<strong>${i}:</strong> ${w}`}).join("<br>")}a(I,"getTooltipContent");function o(e){return e?(e/100).toFixed(2):"0.00"}a(o,"formatAmount");async function h({page:e=1,limit:s=10}={}){const r="Fetching customer events",d={400:"Invalid input, object invalid",404:"Not found"},i=await H().getAuthHeader();return i?await y(()=>F.get("/customers/events",{params:{page:e,limit:s},headers:i}),{errorContext:r,routeSpecificErrors:d}):(g.value="Authentication header is missing",null)}return a(h,"getMyEvents"),{isLoading:p,error:g,getMyEvents:h,formatEventType:f,getEventSeverity:$,formatAmount:o,hasAdditionalInfo:T,formatDate:l,formatJsonKey:k,formatJsonValue:C,getTooltipContent:I}},"useCustomerEventsService"),ce={key:0,class:"flex items-center justify-center p-8"},de={key:1,class:"p-4"},ue={class:"event-details"},me={key:0,class:"font-semibold text-green-500"},pe={key:1},fe={key:2,class:"flex flex-col gap-1"},ve={class:"font-semibold"},he={class:"text-sm text-smoke-400"},ge=M({__name:"UsageLogsTable",setup(p,{expose:g}){const v=A([]),b=A(!0),y=A(null),f=le(),l=A({page:1,limit:7,total:0,totalPages:0}),k=P(()=>(l.value.page-1)*l.value.limit),C=P(()=>{const o=new Map;return v.value.forEach(h=>{f.hasAdditionalInfo(h)&&h.event_id&&o.set(h.event_id,f.getTooltipContent(h))}),o}),$=a(async()=>{b.value=!0,y.value=null;try{const o=await f.getMyEvents({page:l.value.page,limit:l.value.limit});o?(o.events&&(v.value=o.events),o.page&&(l.value.page=o.page),o.limit&&(l.value.limit=o.limit),o.total&&(l.value.total=o.total),o.totalPages&&(l.value.totalPages=o.totalPages),ie()?.checkForCompletedTopup(o.events)):y.value=f.error.value||"Failed to load events"}catch(o){y.value=o instanceof Error?o.message:"Unknown error",console.error("Error loading events:",o)}finally{b.value=!1}},"loadEvents"),T=a(o=>{l.value.page=o.page+1,$().catch(h=>{console.error("Error loading events:",h)})},"onPageChange");return g({refresh:a(async()=>{l.value.page=1,await $()},"refresh")}),(o,h)=>{const e=G("tooltip");return m(),x("div",null,[b.value?(m(),x("div",ce,[n(t(ae))])):y.value?(m(),x("div",de,[n(t(re),{severity:"error",closable:!1},{default:_(()=>[L(c(y.value),1)]),_:1})])):(m(),S(t(O),{key:2,value:v.value,paginator:!0,rows:l.value.limit,"total-records":l.value.total,first:k.value,lazy:!0,class:"p-datatable-sm custom-datatable",onPage:T},{default:_(()=>[n(t(D),{field:"event_type",header:o.$t("credits.eventType")},{body:_(({data:s})=>[n(t(se),{value:t(f).formatEventType(s.event_type),severity:t(f).getEventSeverity(s.event_type)},null,8,["value","severity"])]),_:1},8,["header"]),n(t(D),{field:"details",header:o.$t("credits.details")},{body:_(({data:s})=>[u("div",ue,[s.event_type===t(B).CREDIT_ADDED?(m(),x("div",me,c(o.$t("credits.added"))+" $"+c(t(f).formatAmount(s.params?.amount)),1)):s.event_type===t(B).ACCOUNT_CREATED?(m(),x("div",pe,c(o.$t("credits.accountInitialized")),1)):s.event_type===t(B).API_USAGE_COMPLETED?(m(),x("div",fe,[u("div",ve,c(s.params?.api_name||"API"),1),u("div",he,c(o.$t("credits.model"))+": "+c(s.params?.model||"-"),1)])):U("",!0)])]),_:1},8,["header"]),n(t(D),{field:"createdAt",header:o.$t("credits.time")},{body:_(({data:s})=>[L(c(t(f).formatDate(s.createdAt)),1)]),_:1},8,["header"]),n(t(D),{field:"params",header:o.$t("credits.additionalInfo")},{body:_(({data:s})=>[t(f).hasAdditionalInfo(s)?J((m(),S(t(E),{key:0,icon:"pi pi-info-circle",class:"p-button-text p-button-sm"},null,512)),[[e,{escape:!1,value:C.value.get(s.event_id)||"",pt:{text:{style:{width:"max-content !important"}}}},void 0,{top:!0}]]):U("",!0)]),_:1},8,["header"])]),_:1},8,["value","rows","total-records","first"]))])}}}),_e={class:"flex h-full flex-col"},ye={class:"mb-2 text-2xl font-bold"},be={class:"flex flex-col gap-2"},Ce={class:"text-sm font-medium text-muted"},xe={class:"flex items-center justify-between"},Ae={class:"flex flex-row items-center"},$e={key:1,class:"text-xs text-muted"},we={class:"flex items-center justify-between"},Ee={key:0,class:"grow"},ke={class:"text-sm font-medium"},Se={class:"text-xs text-muted"},De={class:"flex flex-row gap-2"},Ht=M({__name:"CreditsPanel",setup(p){const g=X(),v=H(),b=Y(),y=Z(),{isActiveSubscription:f}=ee(),l=P(()=>v.loading),k=P(()=>v.isFetchingBalance),C=A(null),$=P(()=>v.lastBalanceUpdateTime?v.lastBalanceUpdateTime.toLocaleString():"");N(()=>v.lastBalanceUpdateTime,(r,d)=>{r&&r!==d&&C.value&&C.value.refresh()});const T=a(()=>{g.showTopUpCreditsDialog()},"handlePurchaseCreditsClick"),I=a(async()=>{await b.accessBillingPortal()},"handleCreditsHistoryClick"),o=a(async()=>{await y.execute("Comfy.ContactSupport")},"handleMessageSupport"),h=a(()=>{window.open("https://docs.comfy.org/tutorials/api-nodes/faq","_blank")},"handleFaqClick"),e=a(()=>{window.open("https://docs.comfy.org/tutorials/api-nodes/overview#api-nodes","_blank")},"handleOpenPartnerNodesInfo"),s=A([]);return(r,d)=>(m(),S(t(Q),{value:"Credits",class:"credits-container h-full"},{default:_(()=>[u("div",_e,[u("h2",ye,c(r.$t("credits.credits")),1),n(t(R)),u("div",be,[u("h3",Ce,c(r.$t("credits.yourCreditBalance")),1),u("div",xe,[n(te,{"text-class":"text-3xl font-bold"}),l.value?(m(),S(t(j),{key:0,width:"2rem",height:"2rem"})):t(f)?(m(),S(t(E),{key:1,label:r.$t("credits.purchaseCredits"),loading:l.value,onClick:T},null,8,["label","loading"])):U("",!0)]),u("div",Ae,[k.value?(m(),S(t(j),{key:0,width:"12rem",height:"1rem",class:"text-xs"})):$.value?(m(),x("div",$e,c(r.$t("credits.lastUpdated"))+": "+c($.value),1)):U("",!0),n(t(E),{icon:"pi pi-refresh",text:"",size:"small",severity:"secondary",onClick:d[0]||(d[0]=()=>t(b).fetchBalance())})])]),u("div",we,[u("h3",null,c(r.$t("credits.activity")),1),n(t(E),{label:r.$t("credits.invoiceHistory"),text:"",severity:"secondary",icon:"pi pi-arrow-up-right",loading:l.value,onClick:I},null,8,["label","loading"])]),s.value.length>0?(m(),x("div",Ee,[n(t(O),{value:s.value,"show-headers":!1},{default:_(()=>[n(t(D),{field:"title",header:r.$t("g.name")},{body:_(({data:i})=>[u("div",ke,c(i.title),1),u("div",Se,c(i.timestamp),1)]),_:1},8,["header"]),n(t(D),{field:"amount",header:r.$t("g.amount")},{body:_(({data:i})=>[u("div",{class:K(["text-center text-base font-medium",i.isPositive?"text-sky-500":"text-red-400"])},c(i.isPositive?"+":"-")+"$"+c(t(oe)(i.amount,"usd")),3)]),_:1},8,["header"])]),_:1},8,["value"])])):U("",!0),n(t(R)),n(ge,{ref_key:"usageLogsTableRef",ref:C},null,512),u("div",De,[n(t(E),{label:r.$t("credits.faqs"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:h},null,8,["label"]),n(t(E),{label:r.$t("subscription.partnerNodesCredits"),text:"",severity:"secondary",icon:"pi pi-question-circle",onClick:e},null,8,["label"]),n(t(E),{label:r.$t("credits.messageSupport"),text:"",severity:"secondary",icon:"pi pi-comments",onClick:o},null,8,["label"])])])]),_:1}))}});export{Ht as default};
//# sourceMappingURL=CreditsPanel-uLt50iXG.js.map
