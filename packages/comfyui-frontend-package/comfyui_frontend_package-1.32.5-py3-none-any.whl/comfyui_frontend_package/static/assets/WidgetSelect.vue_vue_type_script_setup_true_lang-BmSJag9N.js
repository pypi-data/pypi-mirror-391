var ye=Object.defineProperty;var f=(i,a)=>ye(i,"name",{value:a,configurable:!0});import{defineComponent as Q,computed as p,openBlock as m,createBlock as R,withCtx as Y,createVNode as B,unref as h,mergeProps as oe,isRef as be,createElementBlock as S,normalizeClass as U,createElementVNode as x,toDisplayString as E,createCommentVNode as j,mergeModels as X,useModel as V,useTemplateRef as te,ref as I,withDirectives as re,vModelText as we,Fragment as ae,renderList as se,inject as he,resolveDirective as Se,createTextVNode as ke,watch as le,provide as xe,toRef as Me}from"vue";import{c as $,t as F,w as ne,bE as $e,a as Ue,bO as Ce,bU as ze}from"./index-BYfAAqfw.js";import{bv as Ve,cf as Oe}from"./vendor-other-ISwNJJIx.js";import"primevue/button";import"vue-i18n";import"primevue/checkbox";import"primevue/message";import"primevue/divider";import"primevue/scrollpanel";import"primevue/usetoast";import"primevue/card";import"primevue/listbox";import"primevue/progressbar";import"primevue/floatlabel";import"primevue/inputtext";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/progressspinner";import"primevue/skeleton";import"primevue/tag";import"primevue/inputnumber";import"primevue/tabpanels";import"primevue/tabs";import"primevue/iconfield";import"primevue/inputicon";import"primevue/badge";import"primevue/chip";import"primevue/tabpanel";import Ae from"primevue/select";import"primevue/toggleswitch";import"primevue/colorpicker";import"primevue/radiobutton";import"primevue/knob";import"primevue/slider";import"primevue/panel";import"primevue/tabmenu";import de from"primevue/popover";import"primevue/tab";import"primevue/tablist";import"primevue";import"./vendor-xterm-DV1MVhAx.js";import"primevue/galleria";import"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/selectbutton";import"primevue/dialog";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import{c as ue}from"./useWidgetValue-BBcazAQ2.js";import{u as ce}from"./useTransformCompatOverlayProps-DkwHb7jz.js";import{f as pe,P as fe}from"./widgetPropFilter-CygYoMQt.js";import{W as me}from"./index-DhdNkVvg.js";import{_ as ve}from"./WidgetLayoutField.vue_vue_type_script_setup_true_lang-3h_UpSlS.js";import{a as De}from"./LazyImage.vue_vue_type_script_setup_true_lang-DdoduAD6.js";const Ie=Q({__name:"WidgetSelectDefault",props:{widget:{},modelValue:{}},emits:["update:modelValue"],setup(i,{emit:a}){const e=i,y=a,{localValue:l,onChange:b}=ue({widget:e.widget,modelValue:e.modelValue,defaultValue:e.widget.options?.values?.[0]||"",emit:y}),w=ce(),d=p(()=>{const t=e.widget.options;return t?.values&&Array.isArray(t.values)?t.values:[]}),u=p(()=>!!l.value&&!d.value.includes(l.value)),r=p(()=>({...pe(e.widget.options,fe),...w.value,...u.value?{placeholder:`${l.value}`}:{}}));return(t,o)=>(m(),R(ve,{widget:t.widget},{default:Y(()=>[B(h(Ae),oe({modelValue:h(l),"onUpdate:modelValue":o[0]||(o[0]=k=>be(l)?l.value=k:null),invalid:u.value,options:d.value},r.value,{class:h($)(h(me),"w-full text-xs"),"aria-label":t.widget.name,size:"small",pt:{option:"text-xs",dropdownIcon:"text-component-node-foreground-secondary"},"data-capture-wheel":"true","onUpdate:modelValue":h(b)}),null,16,["modelValue","invalid","options","class","aria-label","onUpdate:modelValue"])]),_:1},8,["widget"]))}}),Qe={class:"min-w-0 px-4 py-2 text-left"},Pe={key:0,class:"min-w-0"},Te={key:1,class:"line-clamp-1 min-w-0 break-all"},Le=["multiple","disabled","accept"],Fe=Q({__name:"FormDropdownInput",props:{isOpen:{type:Boolean,default:!1},placeholder:{default:"Select..."},files:{},items:{},selected:{},maxSelectable:{},uploadable:{type:Boolean},disabled:{type:Boolean},accept:{}},emits:["select-click","file-change"],setup(i,{emit:a}){const e=i,y=a,l=p(()=>e.items.filter(d=>e.selected.has(d.id))),b=p(()=>$("mr-2 size-4 transition-transform duration-200 flex-shrink-0 text-component-node-foreground-secondary",{"rotate-180":e.isOpen})),w=p(()=>$("border-0 bg-component-node-widget-background outline-none text-text-secondary",{"hover:bg-component-node-widget-background-hovered cursor-pointer":!e.disabled,"cursor-not-allowed":e.disabled,"text-text-primary":l.value.length>0}));return(d,u)=>(m(),S("div",{class:U(h($)(h(me),"flex text-base leading-none",{"opacity-50 cursor-not-allowed !outline-zinc-300/10":d.disabled}))},[x("button",{class:U(h($)(w.value,"flex justify-between items-center flex-1 h-8",{"rounded-l-lg":d.uploadable,"rounded-lg":!d.uploadable})),onClick:u[0]||(u[0]=r=>y("select-click",r))},[x("span",Qe,[l.value.length?(m(),S("span",Te,E(l.value.map(r=>r.label??r.name).join(", ")),1)):(m(),S("span",Pe,E(e.placeholder),1))]),x("i",{class:U(["icon-[lucide--chevron-down]",b.value])},null,2)],2),d.uploadable?(m(),S("label",{key:0,class:U(h($)(w.value,"relative","size-8 flex justify-center items-center border-l rounded-r-lg border-zinc-300/10"))},[u[2]||(u[2]=x("i",{class:"icon-[lucide--folder-search] size-4"},null,-1)),x("input",{type:"file",class:"absolute inset-0 -z-1 opacity-0",multiple:d.maxSelectable>1,disabled:d.disabled,accept:d.accept,onChange:u[1]||(u[1]=r=>y("file-change",r))},null,40,Le)],2)):j("",!0)],2))}}),Be={class:"text-secondary flex gap-2 px-4"},Re={key:0,class:"mr-2 icon-[lucide--loader-circle] size-4 animate-spin"},je={key:1,class:"mr-2 icon-[lucide--search] size-4"},We={key:0,class:"absolute top-[-2px] left-[-2px] size-2 rounded-full bg-blue-500"},Ke=["onClick"],Ee={key:0,class:"icon-[lucide--check] size-4"},ee="h-8 bg-zinc-500/20 rounded-lg outline outline-1 outline-offset-[-1px] outline-sand-100 dark-theme:outline-neutral-700 transition-all duration-150",N="bg-transparent border-0 outline-0 ring-0 text-left",ie="size-6 flex justify-center items-center rounded-sm cursor-pointer transition-all duration-150 hover:scale-108 hover:text-base-foreground active:scale-95",qe=Q({__name:"FormDropdownMenuActions",props:X({isQuerying:{type:Boolean},sortOptions:{}},{layoutMode:{},layoutModeModifiers:{},searchQuery:{},searchQueryModifiers:{},sortSelected:{},sortSelectedModifiers:{}}),emits:["update:layoutMode","update:searchQuery","update:sortSelected"],setup(i){const a=V(i,"layoutMode"),e=V(i,"searchQuery"),y=V(i,"sortSelected"),l=te("sortPopoverRef"),b=te("sortTriggerRef"),w=I(!1);function d(t){!l.value||!b.value||(w.value=!w.value,l.value.toggle(t,b.value))}f(d,"toggleSortPopover");function u(){w.value=!1,l.value?.hide()}f(u,"closeSortPopover");function r(t){y.value=t.id,u()}return f(r,"handleSortSelected"),(t,o)=>(m(),S("div",Be,[x("label",{class:U(h($)(ee,"flex-1 flex px-2 items-center text-base leading-none cursor-text",e.value?.trim()!==""?"text-base-foreground":"","hover:!outline-blue-500/80","focus-within:!outline-blue-500/80"))},[t.isQuerying?(m(),S("i",Re)):(m(),S("i",je)),re(x("input",{"onUpdate:modelValue":o[0]||(o[0]=k=>e.value=k),type:"text",class:U(N),placeholder:"Search"},null,512),[[we,e.value]])],2),x("button",{ref_key:"sortTriggerRef",ref:b,class:U(h($)(N,ee,"relative w-8 flex justify-center items-center cursor-pointer","hover:!outline-blue-500/80","active:!scale-95")),onClick:d},[y.value!=="default"?(m(),S("div",We)):j("",!0),o[4]||(o[4]=x("i",{class:"icon-[lucide--arrow-up-down] size-4"},null,-1))],2),B(h(de),{ref_key:"sortPopoverRef",ref:l,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:o[1]||(o[1]=k=>w.value=!1)},{default:Y(()=>[x("div",{class:U(h($)("flex flex-col gap-2 p-2 min-w-32","bg-zinc-200 dark-theme:bg-charcoal-700","rounded-lg outline outline-offset-[-1px] outline-sand-200 dark-theme:outline-zinc-700"))},[(m(!0),S(ae,null,se(t.sortOptions,k=>(m(),S("button",{key:k.name,class:U(h($)(N,"flex justify-between items-center h-6 cursor-pointer","hover:!text-blue-500")),onClick:f(C=>r(k),"onClick")},[x("span",null,E(k.name),1),y.value===k.id?(m(),S("i",Ee)):j("",!0)],10,Ke))),128))],2)]),_:1},512),x("div",{class:U(h($)(ee,"flex justify-center items-center p-1 gap-1 hover:!outline-blue-500/80"))},[x("button",{class:U(h($)(N,ie,a.value==="list"?"bg-neutral-500/50 text-base-foreground":"")),onClick:o[2]||(o[2]=k=>a.value="list")},o[5]||(o[5]=[x("i",{class:"icon-[lucide--list] size-4"},null,-1)]),2),x("button",{class:U(h($)(N,ie,a.value==="grid"?"bg-neutral-500/50 text-base-foreground":"")),onClick:o[3]||(o[3]=k=>a.value="grid")},o[6]||(o[6]=[x("i",{class:"icon-[lucide--layout-grid] size-4"},null,-1)]),2)],2)]))}}),He={class:"text-secondary mb-4 flex gap-1 px-4"},Ne=["onClick"],Xe=Q({__name:"FormDropdownMenuFilter",props:X({filterOptions:{}},{filterSelected:{},filterSelectedModifiers:{}}),emits:["update:filterSelected"],setup(i){const a=V(i,"filterSelected");return(e,y)=>(m(),S("div",He,[(m(!0),S(ae,null,se(e.filterOptions,l=>(m(),S("div",{key:l.id,class:U(h($)("px-4 py-2 rounded-md inline-flex justify-center items-center cursor-pointer select-none","transition-all duration-150","hover:text-base-foreground hover:bg-interface-menu-component-surface-hovered","active:scale-95",a.value===l.id?"!bg-interface-menu-component-surface-selected text-base-foreground":"bg-transparent")),onClick:f(b=>a.value=l.id,"onClick")},E(l.name),11,Ne))),128))]))}}),ge=Symbol("assetKind"),Ze={key:0,class:"absolute top-1 left-1 size-4 rounded-full border-1 border-white bg-blue-500"},Ge=["src"],Je={key:3,class:"size-full bg-gradient-to-tr from-blue-400 via-teal-500 to-green-400"},Ye={class:"text-secondary block text-xs"},_e=Q({__name:"FormDropdownMenuItem",props:{index:{},selected:{type:Boolean},mediaSrc:{},name:{},label:{},metadata:{},layout:{}},emits:["click","mediaLoad"],setup(i,{emit:a}){const e=i,y=a,l=I(null),b=he(ge),w=p(()=>b?.value==="video");function d(){y("click",e.index)}f(d,"handleClick");function u(t){if(y("mediaLoad",t),!t.target||!(t.target instanceof HTMLImageElement))return;const o=t.target;o.naturalWidth&&o.naturalHeight&&(l.value=`${o.naturalWidth} x ${o.naturalHeight}`)}f(u,"handleImageLoad");function r(t){if(y("mediaLoad",t),!t.target||!(t.target instanceof HTMLVideoElement))return;const o=t.target;o.videoWidth&&o.videoHeight&&(l.value=`${o.videoWidth} x ${o.videoHeight}`)}return f(r,"handleVideoLoad"),(t,o)=>{const k=Se("tooltip");return m(),S("div",{class:U(h($)("flex gap-1 select-none group/item cursor-pointer","transition-all duration-150",{"flex-col text-center":t.layout==="grid","flex-row text-left max-h-16 bg-interface-menu-component-surface-hovered rounded-lg hover:scale-102 active:scale-98":t.layout==="list","flex-row text-left hover:bg-interface-menu-component-surface-hovered rounded-lg":t.layout==="list-small","ring-2 ring-blue-500":t.layout==="list"&&t.selected})),onClick:d},[t.layout!=="list-small"?(m(),S("div",{key:0,class:U(h($)("relative","w-full aspect-square overflow-hidden outline-1 outline-offset-[-1px] outline-interface-stroke","transition-all duration-150",{"min-w-16 max-w-16 rounded-l-lg":t.layout==="list","rounded-sm group-hover/item:scale-108 group-active/item:scale-95":t.layout==="grid","ring-2 ring-blue-500":t.layout==="grid"&&t.selected}))},[t.selected?(m(),S("div",Ze,o[0]||(o[0]=[x("i",{class:"icon-[lucide--check] size-3 translate-y-[-0.5px] text-white"},null,-1)]))):j("",!0),t.mediaSrc&&w.value?(m(),S("video",{key:1,src:t.mediaSrc,class:"size-full object-cover",preload:"metadata",muted:"",onLoadeddata:r},null,40,Ge)):t.mediaSrc?(m(),R(De,{key:2,src:t.mediaSrc,alt:t.name,"image-class":"size-full object-cover",onLoad:u},null,8,["src","alt"])):(m(),S("div",Je))],2)):j("",!0),x("div",{class:U(h($)("flex gap-1",{"flex-col":t.layout==="grid","flex-col px-4 py-1 w-full justify-center min-w-0":t.layout==="list","flex-row p-2 items-center justify-between w-full":t.layout==="list-small"}))},[re((m(),S("span",{class:U(h($)("block text-[15px] line-clamp-2 break-words overflow-hidden","transition-colors duration-150",!!t.selected&&"text-blue-500"))},[ke(E(t.label??t.name),1)],2)),[[k,t.layout==="grid"?t.label??t.name:void 0]]),x("span",Ye,E(t.metadata||l.value),1)],2)],2)}}}),et={class:"flex max-h-[640px] w-103 flex-col rounded-lg bg-node-component-surface pt-4 outline outline-offset-[-1px] outline-node-component-border"},tt={class:"relative flex h-full mt-2 overflow-y-scroll"},lt={key:0,class:"absolute inset-0 flex items-center justify-center"},ot=Q({__name:"FormDropdownMenu",props:X({items:{},isSelected:{type:Function},isQuerying:{type:Boolean},filterOptions:{},sortOptions:{}},{filterSelected:{},filterSelectedModifiers:{},layoutMode:{},layoutModeModifiers:{},sortSelected:{},sortSelectedModifiers:{},searchQuery:{},searchQueryModifiers:{}}),emits:X(["item-click"],["update:filterSelected","update:layoutMode","update:sortSelected","update:searchQuery"]),setup(i,{emit:a}){const e=a,y=V(i,"filterSelected"),l=V(i,"layoutMode"),b=V(i,"sortSelected"),w=V(i,"searchQuery");return(d,u)=>(m(),S("div",et,[d.filterOptions.length>0?(m(),R(Xe,{key:0,"filter-selected":y.value,"onUpdate:filterSelected":u[0]||(u[0]=r=>y.value=r),"filter-options":d.filterOptions},null,8,["filter-selected","filter-options"])):j("",!0),B(qe,{"layout-mode":l.value,"onUpdate:layoutMode":u[1]||(u[1]=r=>l.value=r),"sort-selected":b.value,"onUpdate:sortSelected":u[2]||(u[2]=r=>b.value=r),"search-query":w.value,"onUpdate:searchQuery":u[3]||(u[3]=r=>w.value=r),"sort-options":d.sortOptions,"is-querying":d.isQuerying},null,8,["layout-mode","sort-selected","search-query","sort-options","is-querying"]),x("div",tt,[x("div",{class:U(h($)("h-full max-h-full grid gap-x-2 gap-y-4 overflow-y-auto px-4 pt-4 pb-4 w-full",{"grid-cols-4":l.value==="grid","grid-cols-1 gap-y-2":l.value==="list","grid-cols-1 gap-y-1":l.value==="list-small"}))},[u[5]||(u[5]=x("div",{class:"pointer-events-none absolute inset-x-3 top-0 z-10 h-5 bg-gradient-to-b from-backdrop to-transparent"},null,-1)),d.items.length===0?(m(),S("div",lt,u[4]||(u[4]=[x("i",{title:"No items",class:"icon-[lucide--circle-off] size-30 text-zinc-500/20"},null,-1)]))):j("",!0),(m(!0),S(ae,null,se(d.items,(r,t)=>(m(),R(_e,{key:r.id,index:t,selected:d.isSelected(r,t),"media-src":r.mediaSrc,name:r.name,label:r.label,metadata:r.metadata,layout:l.value,onClick:f(o=>e("item-click",r,t),"onClick")},null,8,["index","selected","media-src","name","label","metadata","layout","onClick"]))),128))],2)])]))}});async function at(i,a){if(i.trim()==="")return a;const e=i.trim().toLowerCase().split(" ");return a.filter(y=>{const l=y.name.toLowerCase();return e.every(b=>l.includes(b))})}f(at,"defaultSearcher");function st(){return[{name:"Default",id:"default",sorter:f(({items:i})=>i.slice(),"sorter")},{name:"A-Z",id:"a-z",sorter:f(({items:i})=>i.slice().sort((a,e)=>a.name.localeCompare(e.name)),"sorter")}]}f(st,"getDefaultSortOptions");const it=Q({__name:"FormDropdown",props:X({items:{},placeholder:{default:F("widgets.uploadSelect.placeholder")},multiple:{type:[Boolean,Number],default:!1},uploadable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},accept:{},filterOptions:{default:f(()=>[],"default")},sortOptions:{default:f(()=>st(),"default")},isSelected:{type:Function,default:f((i,a,e)=>i.has(a.id),"default")},searcher:{type:Function,default:at}},{selected:{default:new Set},selectedModifiers:{},filterSelected:{default:""},filterSelectedModifiers:{},sortSelected:{default:"default"},sortSelectedModifiers:{},layoutMode:{default:"grid"},layoutModeModifiers:{},files:{default:[]},filesModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:selected","update:filterSelected","update:sortSelected","update:layoutMode","update:files","update:searchQuery"],setup(i){const a=i,e=V(i,"selected"),y=V(i,"filterSelected"),l=V(i,"sortSelected"),b=V(i,"layoutMode"),w=V(i,"files"),d=V(i,"searchQuery"),u=Ve(d,700,{maxWait:700}),r=I(!1),t=ne(),o=I(),k=te("triggerRef"),C=I(!1),z=p(()=>a.multiple===!0?1/0:typeof a.multiple=="number"?a.multiple:1),P=I([]);le(d,g=>{r.value=g!==u.value}),le([u,()=>a.items],(g,v,M)=>{let q=!1,H;M(()=>{q=!0,H?.()}),a.searcher(u.value,a.items,n=>H=n).then(n=>{q||(P.value=n)}).finally(()=>{q||(r.value=!1)})},{immediate:!0});const T=p(()=>a.sortOptions.find(v=>v.id==="default")?.sorter||(({items:v})=>v.slice())),W=p(()=>l.value==="default"?T.value:a.sortOptions.find(v=>v.id===l.value)?.sorter||T.value),L=p(()=>W.value({items:P.value})||[]);function A(g,v){return a.isSelected?.(e.value,g,v)??!1}f(A,"internalIsSelected");const Z=f(g=>{a.disabled||o.value&&k.value&&(o.value.toggle(g,k.value),C.value=!C.value)},"toggleDropdown"),G=f(()=>{o.value&&(o.value.hide(),C.value=!1)},"closeDropdown");function _(g){if(a.disabled)return;const v=g.target;v.files&&(w.value=Array.from(v.files)),v.value=""}f(_,"handleFileChange");function J(g,v){if(a.disabled)return;const M=e.value;if(A(g,v))M.delete(g.id);else if(M.size<z.value)M.add(g.id);else if(z.value===1)M.clear(),M.add(g.id);else{t.addAlert("Maximum selection limit reached");return}e.value=new Set(M),z.value===1&&G()}return f(J,"handleSelection"),(g,v)=>(m(),S("div",{ref_key:"triggerRef",ref:k},[B(Fe,{files:w.value,"is-open":C.value,placeholder:g.placeholder,items:g.items,"max-selectable":z.value,selected:e.value,uploadable:g.uploadable,disabled:g.disabled,accept:g.accept,onSelectClick:Z,onFileChange:_},null,8,["files","is-open","placeholder","items","max-selectable","selected","uploadable","disabled","accept"]),B(h(de),{ref_key:"popoverRef",ref:o,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:v[4]||(v[4]=M=>C.value=!1)},{default:Y(()=>[B(ot,{"filter-selected":y.value,"onUpdate:filterSelected":v[0]||(v[0]=M=>y.value=M),"layout-mode":b.value,"onUpdate:layoutMode":v[1]||(v[1]=M=>b.value=M),"sort-selected":l.value,"onUpdate:sortSelected":v[2]||(v[2]=M=>l.value=M),"search-query":d.value,"onUpdate:searchQuery":v[3]||(v[3]=M=>d.value=M),"filter-options":g.filterOptions,"sort-options":g.sortOptions,disabled:g.disabled,"is-querying":r.value,items:L.value,"is-selected":A,"max-selectable":z.value,onClose:G,onItemClick:J},null,8,["filter-selected","layout-mode","sort-selected","search-query","filter-options","sort-options","disabled","is-querying","items","max-selectable"])]),_:1},512)],512))}});function rt(i){return{category:p(()=>{}),assets:p(()=>[]),dropdownItems:p(()=>[]),isLoading:p(()=>!1),error:p(()=>null)}}f(rt,"useAssetWidgetData");const nt=Q({__name:"WidgetSelectDropdown",props:{widget:{},modelValue:{},nodeType:{},assetKind:{},allowUpload:{type:Boolean},uploadFolder:{},isAssetMode:{type:Boolean},defaultLayoutMode:{}},emits:["update:modelValue"],setup(i,{emit:a}){const e=i;xe(ge,p(()=>e.assetKind));const y=a,{localValue:l,onChange:b}=ue({widget:e.widget,modelValue:f(()=>e.modelValue,"modelValue"),defaultValue:e.widget.options?.values?.[0]||"",emit:y}),w=ne(),d=$e(),u=ce(),r=p(()=>({...pe(e.widget.options,fe),...u.value})),o=f(()=>e.isAssetMode&&e.nodeType?rt(Me(()=>e.nodeType)):null,"getAssetData")(),k=I("all"),C=p(()=>{if(e.isAssetMode){const n=o?.category.value??"All";return[{id:"all",name:Oe(n)}]}return[{id:"all",name:"All"},{id:"inputs",name:"Inputs"},{id:"outputs",name:"Outputs"}]}),z=I(new Set);function P(n){const s=e.widget.options?.getOptionLabel;if(!s)return n;try{return s(n)}catch(c){return console.error("Failed to map value:",c),n}}f(P,"getDisplayLabel");const T=p(()=>{const n=e.widget.options?.values||[];return Array.isArray(n)?n.map((s,c)=>({id:`input-${c}`,mediaSrc:H(s,"input"),name:s,label:P(s),metadata:""})):[]}),W=p(()=>{if(!["image","video"].includes(e.assetKind??""))return[];const n=new Set;return d.historyTasks.forEach(s=>{s.flatOutputs.forEach(c=>{const O=e.assetKind==="image"&&c.mediaType==="images"||e.assetKind==="video"&&c.mediaType==="video";if(c.type==="output"&&O){const K=`${c.subfolder?`${c.subfolder}/${c.filename}`:c.filename} [output]`;n.add(K)}})}),Array.from(n).map((s,c)=>({id:`output-${c}`,mediaSrc:H(s.replace(" [output]",""),"output"),name:s,label:P(s),metadata:""}))}),L=p(()=>e.isAssetMode&&o?o.dropdownItems.value:[...T.value,...W.value]),A=p(()=>{if(e.isAssetMode)return L.value;switch(k.value){case"inputs":return T.value;case"outputs":return W.value;case"all":default:return L.value}}),Z=p(()=>{const n=e.widget.options;if(n?.placeholder)return n.placeholder;switch(e.assetKind){case"image":return F("widgets.uploadSelect.placeholderImage");case"video":return F("widgets.uploadSelect.placeholderVideo");case"audio":return F("widgets.uploadSelect.placeholderAudio");case"model":return F("widgets.uploadSelect.placeholderModel");case"unknown":return F("widgets.uploadSelect.placeholderUnknown")}return F("widgets.uploadSelect.placeholder")}),G=p(()=>e.isAssetMode?!1:e.allowUpload===!0),_=p(()=>{switch(e.assetKind){case"image":return"image/*";case"video":return"video/*";case"audio":return"audio/*";default:return}}),J=I(e.defaultLayoutMode??"grid");le(l,n=>{if(n!==void 0){const s=A.value.find(c=>c.name===n);s&&(z.value.clear(),z.value.add(s.id))}else z.value.clear()},{immediate:!0});function g(n){let s;if(n.size>0&&(s=n.values().next().value),s==null){b(void 0);return}const c=A.value.find(O=>O.id===s)?.name;if(!c){b(void 0);return}b(c)}f(g,"updateSelectedItems");const v=f(async(n,s=!1,c={})=>{const O=new FormData;O.append("image",n),s&&O.append("subfolder","pasted"),c.type&&O.append("type",c.type);const D=await Ue.fetchApi("/upload/image",{method:"POST",body:O});if(D.status!==200)return w.addAlert(D.status+" - "+D.statusText),null;const K=await D.json();return(c.type==="input"||!c.type&&!s)&&await Ce().updateInputs(),K.subfolder?`${K.subfolder}/${K.name}`:K.name},"uploadFile"),M=f(async n=>{const s=e.uploadFolder??"input",c=n.map(D=>v(D,!1,{type:s}));return(await Promise.all(c)).filter(D=>D!==null)},"uploadFiles");async function q(n){if(!(!n||n.length===0))try{const s=await M(n);if(s.length===0){w.addAlert("File upload failed");return}e.widget.options?.values&&s.forEach(c=>{const O=e.widget.options.values;O.includes(c)||O.push(c)}),b(s[0]),e.widget.callback&&e.widget.callback(s[0])}catch(s){console.error("Upload error:",s),w.addAlert(`Upload failed: ${s}`)}}f(q,"handleFilesUpdate");function H(n,s="input"){return["image","video"].includes(e.assetKind??"")?`/api/view?filename=${encodeURIComponent(n)}&type=${s}`:""}return f(H,"getMediaUrl"),(n,s)=>(m(),R(ve,{widget:n.widget},{default:Y(()=>[B(it,oe({selected:z.value,"onUpdate:selected":s[0]||(s[0]=c=>z.value=c),"filter-selected":k.value,"onUpdate:filterSelected":s[1]||(s[1]=c=>k.value=c),"layout-mode":J.value,"onUpdate:layoutMode":s[2]||(s[2]=c=>J.value=c),items:A.value,placeholder:Z.value,multiple:!1,uploadable:G.value,accept:_.value,"filter-options":C.value},r.value,{class:"w-full","onUpdate:selected":g,"onUpdate:files":q}),null,16,["selected","filter-selected","layout-mode","items","placeholder","uploadable","accept","filter-options"])]),_:1},8,["widget"]))}}),ml=Q({__name:"WidgetSelect",props:{widget:{},modelValue:{},nodeType:{}},emits:["update:modelValue"],setup(i,{emit:a}){const e=i,y=a;function l(C){y("update:modelValue",C)}f(l,"handleUpdateModelValue");const b=p(()=>{if(e.widget.spec&&ze(e.widget.spec))return e.widget.spec}),w=p(()=>{const C=b.value;if(!C)return{kind:"unknown",allowUpload:!1,folder:void 0};const{image_upload:z,animated_image_upload:P,video_upload:T,image_folder:W,audio_upload:L}=C;let A="unknown";return T?A="video":z||P?A="image":L&&(A="audio"),{kind:A,allowUpload:z===!0||P===!0||T===!0||L===!0,folder:W}}),d=p(()=>!1),u=p(()=>w.value.kind),r=p(()=>d.value||u.value!=="unknown"),t=p(()=>w.value.allowUpload),o=p(()=>w.value.folder??"input"),k=p(()=>d.value?"list":"grid");return(C,z)=>r.value?(m(),R(nt,oe({key:0},e,{"asset-kind":u.value,"allow-upload":t.value,"upload-folder":o.value,"is-asset-mode":d.value,"default-layout-mode":k.value,"onUpdate:modelValue":l}),null,16,["asset-kind","allow-upload","upload-folder","is-asset-mode","default-layout-mode"])):(m(),R(Ie,{key:1,widget:C.widget,"model-value":C.modelValue,"onUpdate:modelValue":l},null,8,["widget","model-value"]))}});export{ml as _};
//# sourceMappingURL=WidgetSelect.vue_vue_type_script_setup_true_lang-BmSJag9N.js.map
