var Q=Object.defineProperty;var o=(_,u)=>Q(_,"name",{value:u,configurable:!0});import{defineComponent as X,ref as s,computed as n,watch as Y,nextTick as Z,onUnmounted as ee,openBlock as r,createElementBlock as i,normalizeClass as te,unref as h,createElementVNode as a,toDisplayString as k,normalizeStyle as oe,createCommentVNode as C,createVNode as O,withCtx as ae}from"vue";import le from"primevue/slider";import re from"primevue/tieredmenu";import{useI18n as ie}from"vue-i18n";import{q as A,bm as se,l as ne,a as ue,c as ce,L as de,d as pe}from"./index-BYfAAqfw.js";import{i as me}from"./nodeFilterUtil-D49mCu4H.js";import{g as ve,f as B}from"./audioUtils-CfX8-cGF.js";import"@primevue/themes";import"@primevue/themes/aura";import"./vendor-other-ISwNJJIx.js";import"./vendor-vue-CEZOemkk.js";import"primevue/config";import"primevue/confirmationservice";import"primevue/toastservice";import"primevue/tooltip";import"primevue/button";import"primevue/checkbox";import"primevue/message";import"primevue/divider";import"primevue/scrollpanel";import"primevue/usetoast";import"primevue/card";import"primevue/listbox";import"primevue/skeleton";import"primevue/multiselect";import"primevue/inputtext";import"primevue/select";import"primevue/progressbar";import"primevue/floatlabel";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/progressspinner";import"primevue/tag";import"primevue/inputnumber";import"primevue/tabpanels";import"primevue/tabs";import"primevue/iconfield";import"primevue/inputicon";import"primevue/badge";import"primevue/chip";import"primevue/tabpanel";import"primevue/toggleswitch";import"primevue/colorpicker";import"primevue/radiobutton";import"primevue/knob";import"primevue/panel";import"primevue/tabmenu";import"primevue/popover";import"primevue/tab";import"primevue/tablist";import"primevue";import"./vendor-xterm-DV1MVhAx.js";import"primevue/galleria";import"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/selectbutton";import"primevue/dialog";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import"primevue/autocomplete";import"primevue/dropdown";import"./vendor-tiptap-BnS5itOe.js";import"primevue/blockui";const fe={class:"relative"},he={class:"relative flex shrink-0 items-center justify-start gap-2"},ye={key:0,class:"text-secondary icon-[lucide--play] size-4"},be={key:1,class:"text-secondary icon-[lucide--pause] size-4"},ge={class:"text-sm font-normal text-nowrap text-base-foreground"},ke={class:"relative h-0.5 flex-1 rounded-full bg-interface-stroke"},_e=["value","aria-label"],xe={class:"relative flex shrink-0 items-center justify-start gap-2"},we={key:0,class:"text-secondary icon-[lucide--volume-2] size-4"},Ce={key:1,class:"text-secondary icon-[lucide--volume-1] size-4"},Oe={key:2,class:"text-secondary icon-[lucide--volume-x] size-4"},ze={key:0,class:"w-48 px-4 py-2"},Pe={class:"mb-2 block text-xs text-base-foreground"},Ie=["onClick"],Le={class:"text-base-foreground"},Ae={key:0,class:"ml-auto icon-[lucide--check] size-4 text-base-foreground"},Be=X({__name:"AudioPreviewPlayer",props:{readonly:{type:Boolean},hideWhenEmpty:{type:Boolean,default:!0},showOptionsButton:{type:Boolean},modelValue:{},nodeId:{},audioUrl:{}},setup(_){const{t:u}=ie(),y=_,t=s(),z=s(),R=s(),m=s(!1),c=s(!1),v=s(1),f=s(0),d=s(0),P=s(!1),b=s(1),I=n(()=>!d.value||d.value===0?0:f.value/d.value*100),T=n(()=>!c.value&&v.value>.5),V=n(()=>c.value&&v.value>0),g=n(()=>!y.nodeId||!A.rootGraph?null:A.rootGraph.getNodeById(y.nodeId)),N=n(()=>g.value?g.value.constructor?.comfyClass==="LoadAudio"&&!!y.nodeId:!1),S=n(()=>{const e=g.value;return!!e&&me(e)}),L=n(()=>{const e=g.value;return e?se(e):null}),U=ne(),M=n(()=>{if(!S.value||!L.value)return"";const e=U.nodeOutputs[L.value];if(!e?.audio||e.audio.length===0)return"";const l=e.audio[0];return l.filename?ue.apiURL(ve(l.subfolder||"",l.filename,l.type||"output")):""}),j=n(()=>M.value||y.audioUrl||""),E=o(()=>{!t.value||!t.value.src||(m.value?t.value.pause():t.value.play(),m.value=!m.value)},"togglePlayPause"),F=o(()=>{t.value&&(c.value=!c.value,t.value.muted=c.value)},"toggleMute"),D=o(e=>{const l=e.target,p=parseFloat(l.value);if(t.value&&d.value>0){const w=p/100*d.value;t.value.currentTime=w,f.value=w}},"handleSeek"),$=o(()=>{t.value&&(d.value=t.value.duration)},"handleLoadedMetadata"),G=o(()=>{t.value&&(f.value=t.value.currentTime)},"handleTimeUpdate"),W=o(()=>{m.value=!1,f.value=0},"handleEnded"),q=o(e=>{z.value?.toggle(e)},"toggleOptionsMenu"),x=o(e=>{b.value=e,t.value&&(t.value.playbackRate=e)},"setPlaybackSpeed"),H=o(e=>{const l=Array.isArray(e)?e[0]:e;v.value=l/10,t.value&&(t.value.volume=v.value,v.value>0&&c.value&&(c.value=!1,t.value.muted=!1))},"handleVolumeChange"),J=n(()=>[{label:u("g.playbackSpeed"),items:[{label:u("g.halfSpeed"),onClick:o(()=>x(.5),"onClick"),selected:b.value===.5},{label:u("g.1x"),onClick:o(()=>x(1),"onClick"),selected:b.value===1},{label:u("g.2x"),onClick:o(()=>x(2),"onClick"),selected:b.value===2}]},{label:u("g.volume"),key:"volume"}]),K=o(e=>{t.value&&(m.value=!1,t.value.pause(),t.value.src=e,t.value.load(),P.value=!!e)},"loadAudioFromUrl");return Y(j,e=>{e&&Z(()=>{K(e)})},{immediate:!0}),ee(()=>{t.value&&(t.value.pause(),t.value.src="")}),(e,l)=>(r(),i("div",fe,[N.value?C("",!0):(r(),i("div",{key:0,class:te(h(ce)("bg-component-node-widget-background box-border flex gap-4 items-center justify-start relative rounded-lg w-full h-16 px-4 py-0",{hidden:e.hideWhenEmpty&&!P.value}))},[a("audio",{ref_key:"audioRef",ref:t,onLoadedmetadata:$,onTimeupdate:G,onEnded:W},null,544),a("div",he,[a("div",{role:"button",tabindex:0,"aria-label":"Play/Pause",class:"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered",onClick:E},[m.value?(r(),i("i",be)):(r(),i("i",ye))]),a("div",ge,k(h(B)(f.value))+" / "+k(h(B)(d.value)),1)]),a("div",ke,[a("div",{class:"absolute top-0 left-0 h-full rounded-full bg-button-icon transition-all",style:oe({width:`${I.value}%`})},null,4),a("input",{type:"range",value:I.value,min:"0",max:"100",step:"0.1","aria-label":e.$t("g.audioProgress"),class:"absolute inset-0 w-full cursor-pointer opacity-0",onInput:D},null,40,_e)]),a("div",xe,[a("div",{role:"button",tabindex:0,"aria-label":"Volume",class:"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered",onClick:F},[T.value?(r(),i("i",we)):V.value?(r(),i("i",Ce)):(r(),i("i",Oe))]),e.showOptionsButton?(r(),i("div",{key:0,ref_key:"optionsButtonRef",ref:R,role:"button",tabindex:0,"aria-label":"More Options",class:"flex size-6 cursor-pointer items-center justify-center rounded hover:bg-interface-menu-component-surface-hovered",onClick:q},l[0]||(l[0]=[a("i",{class:"text-secondary icon-[lucide--more-vertical] size-4"},null,-1)]),512)):C("",!0)]),O(h(re),{ref_key:"optionsMenu",ref:z,model:J.value,popup:"",class:"audio-player-menu","pt:root:class":"!bg-white dark-theme:!bg-charcoal-800 !border-sand-100 dark-theme:!border-charcoal-600","pt:submenu:class":"!bg-white dark-theme:!bg-charcoal-800"},{item:ae(({item:p})=>[p.key==="volume"?(r(),i("div",ze,[a("label",Pe,k(p.label),1),O(h(le),{"model-value":v.value*10,min:0,max:10,step:1,class:"w-full","onUpdate:modelValue":H},null,8,["model-value"])])):(r(),i("div",{key:1,class:"flex cursor-pointer items-center px-4 py-2 text-xs hover:bg-white/10",onClick:o(w=>p.onClick?.(),"onClick")},[a("span",Le,k(p.label),1),p.selected?(r(),i("i",Ae)):C("",!0)],8,Ie))]),_:1},8,["model"])],2)),O(de)]))}}),Wt=pe(Be,[["__scopeId","data-v-65e72e89"]]);export{Wt as default};
//# sourceMappingURL=AudioPreviewPlayer-BJQJJzX0.js.map
