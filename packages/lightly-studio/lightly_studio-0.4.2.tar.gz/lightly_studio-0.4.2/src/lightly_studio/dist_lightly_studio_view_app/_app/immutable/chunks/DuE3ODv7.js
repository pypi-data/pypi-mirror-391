var lt=e=>{throw TypeError(e)};var H=(e,t,s)=>t.has(e)||lt("Cannot "+s);var n=(e,t,s)=>(H(e,t,"read from private field"),s?s.call(e):t.get(e)),y=(e,t,s)=>t.has(e)?lt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),l=(e,t,s,a)=>(H(e,t,"write to private field"),a?a.call(e,s):t.set(e,s),s),f=(e,t,s)=>(H(e,t,"access private method"),s);import{d as Ct,e as St,g as Ft,f as Et,h as Qt,i as At,j as Mt,k as xt,l as Ut,u as qt,m as Dt,n as Tt,o as Lt,p as Kt,q as jt}from"./B-Pwaivo.js";import{aN as Bt,o as G,m as nt,w as kt}from"./C3xJX0nD.js";import{u as rt}from"./CWV1Rpwv.js";import{S as _t,p as ft,r as R,s as J,a as V,n as Pt,i as yt,b as mt,t as Vt,f as zt,c as Nt,d as pt,e as wt,g as Wt,h as Ht}from"./CANX9QXL.js";var O,r,k,b,M,T,S,w,_,L,K,x,U,F,j,i,B,X,Y,Z,$,tt,et,st,Rt,vt,Gt=(vt=class extends _t{constructor(t,s){super();y(this,i);y(this,O);y(this,r);y(this,k);y(this,b);y(this,M);y(this,T);y(this,S);y(this,w);y(this,_);y(this,L);y(this,K);y(this,x);y(this,U);y(this,F);y(this,j,new Set);this.options=s,l(this,O,t),l(this,w,null),l(this,S,ft()),this.options.experimental_prefetchInRender||n(this,S).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(n(this,r).addObserver(this),bt(n(this,r),this.options)?f(this,i,B).call(this):this.updateResult(),f(this,i,$).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return at(n(this,r),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return at(n(this,r),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,i,tt).call(this),f(this,i,et).call(this),n(this,r).removeObserver(this)}setOptions(t,s){const a=this.options,o=n(this,r);if(this.options=n(this,O).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof R(this.options.enabled,n(this,r))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,i,st).call(this),n(this,r).setOptions(this.options),a._defaulted&&!J(this.options,a)&&n(this,O).getQueryCache().notify({type:"observerOptionsUpdated",query:n(this,r),observer:this});const u=this.hasListeners();u&&Ot(n(this,r),o,this.options,a)&&f(this,i,B).call(this),this.updateResult(s),u&&(n(this,r)!==o||R(this.options.enabled,n(this,r))!==R(a.enabled,n(this,r))||V(this.options.staleTime,n(this,r))!==V(a.staleTime,n(this,r)))&&f(this,i,X).call(this);const d=f(this,i,Y).call(this);u&&(n(this,r)!==o||R(this.options.enabled,n(this,r))!==R(a.enabled,n(this,r))||d!==n(this,F))&&f(this,i,Z).call(this,d)}getOptimisticResult(t){const s=n(this,O).getQueryCache().build(n(this,O),t),a=this.createResult(s,t);return Xt(this,a)&&(l(this,b,a),l(this,T,this.options),l(this,M,n(this,r).state)),a}getCurrentResult(){return n(this,b)}trackResult(t,s){const a={};return Object.keys(t).forEach(o=>{Object.defineProperty(a,o,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(o),s==null||s(o),t[o])})}),a}trackProp(t){n(this,j).add(t)}getCurrentQuery(){return n(this,r)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=n(this,O).defaultQueryOptions(t),a=n(this,O).getQueryCache().build(n(this,O),s);return a.fetch().then(()=>this.createResult(a,s))}fetch(t){return f(this,i,B).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),n(this,b)))}createResult(t,s){var dt;const a=n(this,r),o=this.options,u=n(this,b),d=n(this,M),m=n(this,T),I=t!==a?t.state:n(this,k),{state:c}=t;let h={...c},Q=!1,g;if(s._optimisticResults){const p=this.hasListeners(),q=!p&&bt(t,s),D=p&&Ot(t,a,s,o);(q||D)&&(h={...h,...Nt(c.data,t.options)}),s._optimisticResults==="isRestoring"&&(h.fetchStatus="idle")}let{error:ot,errorUpdatedAt:ut,status:A}=h;if(s.select&&h.data!==void 0)if(u&&h.data===(d==null?void 0:d.data)&&s.select===n(this,_))g=n(this,L);else try{l(this,_,s.select),g=s.select(h.data),g=pt(u==null?void 0:u.data,g,s),l(this,L,g),l(this,w,null)}catch(p){l(this,w,p)}else g=h.data;if(s.placeholderData!==void 0&&g===void 0&&A==="pending"){let p;if(u!=null&&u.isPlaceholderData&&s.placeholderData===(m==null?void 0:m.placeholderData))p=u.data;else if(p=typeof s.placeholderData=="function"?s.placeholderData((dt=n(this,K))==null?void 0:dt.state.data,n(this,K)):s.placeholderData,s.select&&p!==void 0)try{p=s.select(p),l(this,w,null)}catch(q){l(this,w,q)}p!==void 0&&(A="success",g=pt(u==null?void 0:u.data,p,s),Q=!0)}n(this,w)&&(ot=n(this,w),g=n(this,L),ut=Date.now(),A="error");const z=h.fetchStatus==="fetching",N=A==="pending",W=A==="error",ct=N&&z,ht=g!==void 0,v={status:A,fetchStatus:h.fetchStatus,isPending:N,isSuccess:A==="success",isError:W,isInitialLoading:ct,isLoading:ct,data:g,dataUpdatedAt:h.dataUpdatedAt,error:ot,errorUpdatedAt:ut,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>I.dataUpdateCount||h.errorUpdateCount>I.errorUpdateCount,isFetching:z,isRefetching:z&&!N,isLoadingError:W&&!ht,isPaused:h.fetchStatus==="paused",isPlaceholderData:Q,isRefetchError:W&&ht,isStale:it(t,s),refetch:this.refetch,promise:n(this,S)};if(this.options.experimental_prefetchInRender){const p=P=>{v.status==="error"?P.reject(v.error):v.data!==void 0&&P.resolve(v.data)},q=()=>{const P=l(this,S,v.promise=ft());p(P)},D=n(this,S);switch(D.status){case"pending":t.queryHash===a.queryHash&&p(D);break;case"fulfilled":(v.status==="error"||v.data!==D.value)&&q();break;case"rejected":(v.status!=="error"||v.error!==D.reason)&&q();break}}return v}updateResult(t){const s=n(this,b),a=this.createResult(n(this,r),this.options);if(l(this,M,n(this,r).state),l(this,T,this.options),n(this,M).data!==void 0&&l(this,K,n(this,r)),J(a,s))return;l(this,b,a);const o={},u=()=>{if(!s)return!0;const{notifyOnChangeProps:d}=this.options,m=typeof d=="function"?d():d;if(m==="all"||!m&&!n(this,j).size)return!0;const C=new Set(m??n(this,j));return this.options.throwOnError&&C.add("error"),Object.keys(n(this,b)).some(I=>{const c=I;return n(this,b)[c]!==s[c]&&C.has(c)})};(t==null?void 0:t.listeners)!==!1&&u()&&(o.listeners=!0),f(this,i,Rt).call(this,{...o,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,i,$).call(this)}},O=new WeakMap,r=new WeakMap,k=new WeakMap,b=new WeakMap,M=new WeakMap,T=new WeakMap,S=new WeakMap,w=new WeakMap,_=new WeakMap,L=new WeakMap,K=new WeakMap,x=new WeakMap,U=new WeakMap,F=new WeakMap,j=new WeakMap,i=new WeakSet,B=function(t){f(this,i,st).call(this);let s=n(this,r).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(Pt)),s},X=function(){f(this,i,tt).call(this);const t=V(this.options.staleTime,n(this,r));if(yt||n(this,b).isStale||!mt(t))return;const a=Vt(n(this,b).dataUpdatedAt,t)+1;l(this,x,setTimeout(()=>{n(this,b).isStale||this.updateResult()},a))},Y=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(n(this,r)):this.options.refetchInterval)??!1},Z=function(t){f(this,i,et).call(this),l(this,F,t),!(yt||R(this.options.enabled,n(this,r))===!1||!mt(n(this,F))||n(this,F)===0)&&l(this,U,setInterval(()=>{(this.options.refetchIntervalInBackground||zt.isFocused())&&f(this,i,B).call(this)},n(this,F)))},$=function(){f(this,i,X).call(this),f(this,i,Z).call(this,f(this,i,Y).call(this))},tt=function(){n(this,x)&&(clearTimeout(n(this,x)),l(this,x,void 0))},et=function(){n(this,U)&&(clearInterval(n(this,U)),l(this,U,void 0))},st=function(){const t=n(this,O).getQueryCache().build(n(this,O),this.options);if(t===n(this,r))return;const s=n(this,r);l(this,r,t),l(this,k,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},Rt=function(t){wt.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(n(this,b))}),n(this,O).getQueryCache().notify({query:n(this,r),type:"observerResultsUpdated"})})},vt);function Jt(e,t){return R(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function bt(e,t){return Jt(e,t)||e.state.data!==void 0&&at(e,t,t.refetchOnMount)}function at(e,t,s){if(R(t.enabled,e)!==!1){const a=typeof s=="function"?s(e):s;return a==="always"||a!==!1&&it(e,t)}return!1}function Ot(e,t,s,a){return(e!==t||R(a.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&it(e,s)}function it(e,t){return R(t.enabled,e)!==!1&&e.isStaleByTime(V(t.staleTime,e))}function Xt(e,t){return!J(e.getCurrentResult(),t)}function Yt(){return Wt()}function Zt(e){return Ht()}function $t(e){return"subscribe"in e&&typeof e.subscribe=="function"}function te(){}function ee(e,t,s){const a=Zt(),o=Yt(),u=$t(e)?e:Bt(e),d=G([u,o],([c,h])=>{const Q=a.defaultQueryOptions(c);return Q._optimisticResults=h?"isRestoring":"optimistic",Q}),m=new t(a,nt(d));d.subscribe(c=>{m.setOptions(c,{listeners:!1})});const C=G(o,(c,h)=>{const Q=c?te:m.subscribe(wt.batchCalls(h));return m.updateResult(),Q}),{subscribe:I}=G([C,d],([c,h])=>(c=m.getOptimisticResult(h),h.notifyOnChangeProps?c:m.trackResult(c)));return{subscribe:I}}function se(e,t){return ee(e,Gt)}function ve(e){return e}const E=(e,t,s)=>{const a={_id:e,baseUrl:(t==null?void 0:t.baseUrl)||((t==null?void 0:t.client)??Ct).getConfig().baseUrl};return s&&(a._infinite=s),t!=null&&t.body&&(a.body=t.body),t!=null&&t.headers&&(a.headers=t.headers),t!=null&&t.path&&(a.path=t.path),t!=null&&t.query&&(a.query=t.query),[a]},It=(e,t)=>{const s={...e[0]};return t.body&&(s.body={...e[0].body,...t.body}),t.headers&&(s.headers={...e[0].headers,...t.headers}),t.path&&(s.path={...e[0].path,...t.path}),t.query&&(s.query={...e[0].query,...t.query}),s},ae=e=>E("readSample",e),we=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await Mt({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:ae(e)}),Re=e=>({mutationFn:async s=>{const{data:a}=await Et({...e,...s,throwOnError:!0});return a}}),ne=e=>E("readAnnotationLabels",e),Ie=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await xt({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:ne(e)}),Ce=e=>({mutationFn:async s=>{const{data:a}=await At({...e,...s,throwOnError:!0});return a}}),re=e=>E("readAnnotations",e,!0),Se=e=>({queryFn:async({pageParam:t,queryKey:s,signal:a})=>{const u=It(s,typeof t=="object"?t:{query:{cursor:t}}),{data:d}=await Tt({...e,...u,signal:a,throwOnError:!0});return d},queryKey:re(e)}),Fe=e=>({mutationFn:async s=>{const{data:a}=await Qt({...e,...s,throwOnError:!0});return a}}),Ee=e=>({mutationFn:async s=>{const{data:a}=await qt({...e,...s,throwOnError:!0});return a}}),ie=e=>E("countAnnotationsByDataset",e),Qe=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await Ut({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:ie(e)}),Ae=e=>({mutationFn:async s=>{const{data:a}=await Kt({...e,...s,throwOnError:!0});return a}}),Me=e=>({mutationFn:async s=>{const{data:a}=await St({...e,...s,throwOnError:!0});return a}}),oe=e=>E("getAnnotation",e),xe=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await Lt({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:oe(e)}),ue=e=>E("readCaptions",e,!0),Ue=e=>({queryFn:async({pageParam:t,queryKey:s,signal:a})=>{const u=It(s,typeof t=="object"?t:{query:{cursor:t}}),{data:d}=await Dt({...e,...u,signal:a,throwOnError:!0});return d},queryKey:ue(e)}),ce=e=>E("get2dEmbeddings",e),qe=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await jt({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:ce(e)}),he=e=>E("getMetadataInfo",e),de=e=>({queryFn:async({queryKey:t,signal:s})=>{const{data:a}=await Ft({...e,...t[0],signal:s,throwOnError:!0});return a},queryKey:he(e)}),gt=kt(!1),le=async e=>{if(nt(gt))return;const t=de({path:{dataset_id:e}});se(t).subscribe(a=>{if(a.data){const o=a.data,{updateMetadataBounds:u,updateMetadataValues:d,updateMetadataInfo:m}=rt(),C={},I={};o.forEach(c=>{(c.type==="integer"||c.type==="float")&&c.min!=null&&c.max!=null&&(C[c.name]={min:c.min,max:c.max},I[c.name]={min:c.min,max:c.max})}),u(C),d(I),m(o),gt.set(!0)}})},fe=e=>{const t=[],{metadataBounds:s}=rt();for(const[a,o]of Object.entries(e)){const d=nt(s)[a];d&&(o.min>d.min&&t.push({key:a,value:o.min,op:">="}),o.max<d.max&&t.push({key:a,value:o.max,op:"<="}))}return t},De=e=>{e&&le(e);const{metadataBounds:t,metadataValues:s,metadataInfo:a,updateMetadataValues:o,updateMetadataBounds:u,updateMetadataInfo:d}=rt();return{metadataBounds:t,metadataValues:s,metadataInfo:a,updateMetadataValues:o,updateMetadataBounds:u,updateMetadataInfo:d,createMetadataFilters:fe}};export{Gt as Q,Fe as a,Ce as b,fe as c,Me as d,Re as e,Ae as f,we as g,se as h,De as i,Qe as j,qe as k,ee as l,$t as m,te as n,Ee as o,Se as p,Ie as q,Ue as r,ve as s,xe as t,Zt as u};
