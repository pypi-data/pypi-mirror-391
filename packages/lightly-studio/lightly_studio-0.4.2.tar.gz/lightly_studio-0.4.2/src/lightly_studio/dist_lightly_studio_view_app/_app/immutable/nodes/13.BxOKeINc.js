import{w as I,m as r,p as $,f as j,a as y,$ as N,g as h,b as v}from"../chunks/C3xJX0nD.js";import{c as P}from"../chunks/B-Pwaivo.js";import{c as L}from"../chunks/DuE3ODv7.js";import{u as A}from"../chunks/CWV1Rpwv.js";import"../chunks/CWj6FrbW.js";import"../chunks/69_IOA4Y.js";import{e as k}from"../chunks/SiegjVo0.js";import{c as E,a as D}from"../chunks/CAPx0Bfm.js";import{i as O,a as T,s as F}from"../chunks/DmGM9V9Q.js";import{p as x}from"../chunks/BVTSFVWH.js";import{g as b}from"../chunks/lrI25eI9.js";import{r as w}from"../chunks/7XnHnNk_.js";import{S as M}from"../chunks/DNJnBfHs.js";const z=({dataset_id:n,sampleIndex:s,tagIds:a,annotationLabelIds:u,min_width:f,max_width:l,min_height:o,max_height:p,textEmbedding:m,metadataValues:c})=>{const i=I({isLoading:!1});return(async()=>{i.update(e=>({...e,isLoading:!0,error:void 0}));try{const{data:e}=await P({path:{dataset_id:n},body:{pagination:{offset:s<1?0:s-1,limit:3},filters:{annotation_label_ids:u,tag_ids:a,width:{min:f,max:l},height:{min:o,max:p},metadata_filters:c?L(c):void 0},text_embedding:m},throwOnError:!0}),{setfilteredSampleCount:t}=A();t(e==null?void 0:e.total_count);let d;const g=s>0?e.data[0]:void 0;e.data.length>2&&(d=s==0?e.data[1]:e.data[2]),i.update(S=>({...S,isLoading:!1,sampleNext:d,samplePrevious:g,error:void 0}))}catch(e){i.update(t=>({...t,isLoading:!1,error:e.message||"Failed to load adjacent samples"}))}})(),i},C=async({parent:n,params:{dataset_id:s,sampleId:a,sampleIndex:u}})=>{var _,e,t,d,g;const{samplesSelectedTagsIds:f,samplesSelectedAnnotationLabelsIds:l,samplesDimensions:o,samplesTextEmbedding:p}=await n(),m=parseInt(u,10),{metadataValues:c}=A();return{sampleAdjacents:z({dataset_id:s,sampleIndex:m,tagIds:Array.from(r(f)),annotationLabelIds:Array.from(r(l)),min_width:(_=r(o))==null?void 0:_.min_width,max_width:(e=r(o))==null?void 0:e.max_width,min_height:(t=r(o))==null?void 0:t.min_height,max_height:(d=r(o))==null?void 0:d.max_height,textEmbedding:(g=r(p))==null?void 0:g.embedding,metadataValues:r(c)}),sampleIndex:m}},ee=Object.freeze(Object.defineProperty({__proto__:null,load:C},Symbol.toStringTag,{value:"Module"}));function G(n,s){$(s,!0);const a=()=>F(h(o),"$sampleAdjacents",u),[u,f]=T(),l=v(()=>x.data.sampleIndex),o=v(()=>x.data.sampleAdjacents),p=()=>{a().sampleNext&&b(w.toSample({sampleId:a().sampleNext.sample_id,datasetId:a().sampleNext.sample.dataset_id,sampleIndex:h(l)+1}),{invalidateAll:!0})},m=()=>{a().samplePrevious&&b(w.toSample({sampleId:a().samplePrevious.sample_id,datasetId:a().samplePrevious.sample.dataset_id,sampleIndex:h(l)-1}),{invalidateAll:!0})},c=t=>{switch(t.key){case"ArrowRight":p();break;case"ArrowLeft":m();break}};var i=E();k("keydown",N,c);var _=j(i);{var e=t=>{{let d=v(()=>!!a().samplePrevious),g=v(()=>!!a().sampleNext);M(t,{get hasPrevious(){return h(d)},get hasNext(){return h(g)},onPrevious:m,onNext:p})}};O(_,t=>{a()&&t(e)})}D(n,i),y(),f()}function ae(n){G(n,{})}export{ae as component,ee as universal};
