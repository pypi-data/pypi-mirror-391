import{p as F,f as T,n as Yt,a as z,w as Tt,m as et,$ as gt,g as t,b as n,c as A,r as b,s as S,t as V,am as pt,u as Qt,al as Et,Z as tt}from"../chunks/C3xJX0nD.js";import{n as ta}from"../chunks/B-Pwaivo.js";import{u as bt}from"../chunks/CWV1Rpwv.js";import"../chunks/CWj6FrbW.js";import{c as X,a as v,f as C,t as _t,d as aa}from"../chunks/CAPx0Bfm.js";import{i as U,s as L,a as q}from"../chunks/DmGM9V9Q.js";import{e as ht}from"../chunks/SiegjVo0.js";import{c as xt,e as ea,u as na,k as oa,b as sa,t as ia}from"../chunks/OutaaHH7.js";import{g as nt,a as ra,c as da}from"../chunks/lrI25eI9.js";import{I as la,w as ca,r as ot,K as ua,M as va,N as ma,O as fa,o as Dt,F as ga,t as pa,C as Lt,B as jt,G as _a,J as ha,n as Ut,v as ba,D as xa,q as Ia}from"../chunks/bQ1GK5by.js";import"../chunks/QWEcxSok.js";import{p as H}from"../chunks/BVTSFVWH.js";import"../chunks/69_IOA4Y.js";import{S as Aa}from"../chunks/ConpFqMd.js";import"../chunks/gBp1tBnA.js";import{r as K}from"../chunks/7XnHnNk_.js";import{S as $a,B as wa,a as Sa,b as at,c as mt,H as ya,d as ft,D as Ma,e as Na,g as Pa,Z as ka,h as Ca,f as Ba,u as Ea}from"../chunks/nl6F34Ly.js";import{S as Ra}from"../chunks/DNJnBfHs.js";import{f as Rt}from"../chunks/DELrRF6e.js";import{s as Z}from"../chunks/CpbA3HU7.js";import{f as Ta}from"../chunks/DuE3ODv7.js";import{C as Da}from"../chunks/LEVhVU4b.js";import{s as La}from"../chunks/DoEId1MK.js";import{s as ja,r as Ua}from"../chunks/xQhUoIl9.js";function Ha(l,a){F(a,!0);/**
 * @license @lucide/svelte v0.482.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */let e=Ua(a,["$$slots","$$events","$$legacy"]);const c=[["path",{d:"M5 3a2 2 0 0 0-2 2"}],["path",{d:"M19 3a2 2 0 0 1 2 2"}],["path",{d:"M21 19a2 2 0 0 1-2 2"}],["path",{d:"M5 21a2 2 0 0 1-2-2"}],["path",{d:"M9 3h1"}],["path",{d:"M9 21h1"}],["path",{d:"M14 3h1"}],["path",{d:"M14 21h1"}],["path",{d:"M3 9v1"}],["path",{d:"M21 9v1"}],["path",{d:"M3 14v1"}],["path",{d:"M21 14v1"}]];la(l,ja({name:"square-dashed"},()=>e,{get iconNode(){return c},children:(o,r)=>{var s=X(),x=T(s);La(x,()=>a.children??Yt),v(o,s)},$$slots:{default:!0}})),z()}const Fa=({annotationIndex:l,...a})=>{const e=Tt({isLoading:!1});return(async()=>{e.update(o=>({...o,isLoading:!0}));try{const{data:o}=await ta({path:{dataset_id:a.dataset_id},query:{cursor:l>0?l-1:0,limit:3,annotation_label_ids:a.annotation_label_ids,tag_ids:a.tag_ids}});if(!o){e.update(i=>({...i,isLoading:!1,error:"No annotations data received",data:void 0}));return}const{setfilteredAnnotationCount:r}=bt();r(o.total_count);let s;const x=l>0?o.data[0]:void 0;o.data.length>1&&(s=l===0?o.data[1]:o.data[2]),e.update(i=>({...i,isLoading:!1,error:void 0,data:{annotationNext:s,annotationPrevious:x}}))}catch(o){e.update(r=>({...r,isLoading:!1,error:String(o)}))}})(),e},za=async({parent:l,params:{dataset_id:a,annotationId:e,annotationIndex:c}})=>{const{annotationsSelectedTagsIds:o,annotationsSelectedAnnotationLabelsIds:r,dataset:s}=await l(),x=parseInt(c,10),i=Tt();if(!s)throw new Error("Dataset data not found");return Fa({annotationIndex:x,dataset_id:a,currentAnnotationId:e,annotation_label_ids:Array.from(et(r)),tag_ids:Array.from(et(o))}).subscribe(({data:B})=>{i.set(B)}),{annotationAdjacents:i,annotationIndex:x,annotationId:e,dataset:s}},Ue=Object.freeze(Object.defineProperty({__proto__:null,load:za},Symbol.toStringTag,{value:"Module"}));function Oa(l,a){F(a,!0);const e=()=>L(t(s),"$annotationAdjacents",c),[c,o]=q(),r=n(()=>H.data.annotationIndex),s=n(()=>H.data.annotationAdjacents),x=()=>{e().annotationNext&&nt(K.toSampleWithAnnotation({datasetId:e().annotationNext.dataset_id,sampleId:e().annotationNext.parent_sample_id,annotationId:e().annotationNext.annotation_id,annotationIndex:t(r)+1}),{invalidateAll:!0})},i=()=>{e().annotationPrevious&&nt(K.toSampleWithAnnotation({datasetId:e().annotationPrevious.dataset_id,sampleId:e().annotationPrevious.parent_sample_id,annotationId:e().annotationPrevious.annotation_id,annotationIndex:t(r)-1}),{invalidateAll:!0})},B=w=>{switch(w.key){case"ArrowRight":x();break;case"ArrowLeft":i();break}};var $=X();ht("keydown",gt,B);var g=T($);{var E=w=>{{let d=n(()=>!!e().annotationPrevious),I=n(()=>!!e().annotationNext);Ra(w,{get hasPrevious(){return t(d)},get hasNext(){return t(I)},onPrevious:i,onNext:x})}};U(g,w=>{e()&&w(E)})}v(l,$),z(),o()}const Ga={object_detection:"Object Detection",instance_segmentation:"Instance Segmentation",semantic_segmentation:"Semantic Segmentation",classification:"Classification"};var Ka=C('<span class="text-sm"> </span> <span class="break-all text-sm"> </span>',1);function qa(l,a){var e=Ka(),c=T(e),o=A(c,!0);b(c);var r=S(c,2),s=A(r,!0);b(r),V(()=>{Z(o,a.label),xt(r,"data-testid",`annotation-metadata-${a.id}`),Z(s,a.value)}),v(l,e)}var Wa=C('<span class="break-all text-sm"> </span>'),Va=C('<span class="text-sm"> </span> <!>',1);function Za(l,a){F(a,!0);const e=()=>L(s,"$result",o),c=()=>L(a.isEditingMode,"$isEditingMode",o),[o,r]=q(),s=ca(),{updateAnnotation:x}=ot({datasetId:a.datasetId,annotationId:a.annotationId,onUpdate:a.onUpdate}),i=n(()=>ma(e().data||[])),B=n(()=>{const f=t(i).find(p=>p.value===a.value);return f||{value:a.value,label:a.value}});var $=Va(),g=T($),E=A(g,!0);b(g);var w=S(g,2);{var d=f=>{{const p=(y,m)=>{let k=()=>m==null?void 0:m().inputValue;va(y,{get label(){return k()}})};let _=n(()=>t(i).find(y=>{var m;return y.value===((m=t(B))==null?void 0:m.value)}));ua(f,{get items(){return t(i)},get selectedItem(){return t(_)},name:"annotation-label",placeholder:"Select or create a label",onSelect:y=>{x({annotation_id:a.annotationId,dataset_id:a.datasetId,label_name:y.value})},notFound:p,$$slots:{notFound:!0}})}},I=f=>{var p=Wa();xt(p,"data-testid","annotation-metadata-label");var _=A(p,!0);b(p),V(()=>Z(_,a.value)),v(f,p)};U(w,f=>{c()?f(d):f(I,!1)})}V(()=>Z(E,a.label)),v(l,$),z(),r()}var Ja=C('<div class="flex flex-col gap-4"><div class="grid grid-cols-[6rem_1fr] gap-y-3 text-diffuse-foreground"></div></div>');function Xa(l,a){F(a,!0);const e=()=>L(t(x),"$annotationResp",c),[c,o]=q(),{datasetId:r}=H.data,s=n(()=>ot({datasetId:r,annotationId:a.annotationId})),x=n(()=>t(s).annotation);let i=n(()=>e().data);const B=n(()=>{var I,f;if(!t(i))return[];let d=[{id:"label",label:"Label:",value:(f=(I=t(i))==null?void 0:I.annotation_label)==null?void 0:f.annotation_label_name},{id:"type",label:"Type:",value:Ga[t(i).annotation_type]||"Unknown"}];if(t(i)&&!fa(t(i))){const{height:p,width:_}=Dt(t(i));d=[{id:"height",label:"Height:",value:Rt(Math.round(p))+"px"},{id:"width",label:"Width:",value:Rt(Math.round(_))+"px"},...d]}return d}),{isEditingMode:$}=H.data.globalStorage;var g=X(),E=T(g);{var w=d=>{ga(d,{title:"Annotation details",children:(I,f)=>{var p=Ja(),_=A(p);ea(_,21,()=>t(B),({label:y,value:m,id:k})=>y,(y,m)=>{let k=()=>t(m).label,D=()=>t(m).value,M=()=>t(m).id;var h=X(),R=T(h);{var u=N=>{Za(N,{get onUpdate(){return a.onUpdate},get annotationId(){return a.annotationId},get datasetId(){return r},get label(){return k()},get value(){return D()},get isEditingMode(){return $}})},O=N=>{qa(N,{get label(){return k()},get id(){return M()},get value(){return D()}})};U(R,N=>{M()==="label"&&$?N(u):N(O,!1)})}v(y,h)}),b(_),b(p),v(I,p)}})};U(E,d=>{t(B).length>0&&d(w)})}v(l,g),z(),o()}const Ya=()=>{const l=pa(Ta());return l.subscribe(()=>{}),{removeTagFromAnnotation:(e,c)=>new Promise((o,r)=>{et(l).mutate({path:{annotation_id:e,tag_id:c}},{onSuccess:()=>o(),onError:s=>r(s)})})}};var Qa=C("<!> <!>",1),te=C('<div class="flex h-full w-full items-center justify-center"><!></div>'),ae=C('<div class="flex h-full min-h-0 flex-col space-y-4 overflow-hidden dark:[color-scheme:dark]"><!> <!> <!></div>');function ee(l,a){F(a,!0);const e=()=>L(t(i),"$annotationResp",c),[c,o]=q(),{removeTagFromAnnotation:r}=Ya(),{datasetId:s}=H.data,x=n(()=>ot({datasetId:s,annotationId:a.annotationId})),i=n(()=>t(x).annotation),B=n(()=>t(x).refetch);let $=n(()=>e().data),g=n(()=>{var d;return(d=t($))==null?void 0:d.sample});const E=n(()=>{var d,I;return((I=(d=t($))==null?void 0:d.tags)==null?void 0:I.map(f=>({tagId:f.tag_id,name:f.name})))??[]}),w=async d=>{await r(t($).annotation_id,d),t(B)()};Lt(l,{className:"h-full",children:(d,I)=>{jt(d,{className:"h-full flex flex-col",children:(f,p)=>{var _=ae(),y=A(_);_a(y,{get tags(){return t(E)},onClick:w});var m=S(y,2);Xa(m,{get annotationId(){return a.annotationId},get onUpdate(){return a.onUpdate}});var k=S(m,2);{var D=h=>{var R=Qa(),u=T(R);$a(u,{get sample(){return t(g)},showCustomMetadata:!1});var O=S(u,2);{let N=n(()=>K.toSample({sampleId:t(g).sample_id,datasetId:t(g).dataset_id}));ha(O,{variant:"secondary",get href(){return t(N)},children:(j,It)=>{pt();var st=_t("View sample");v(j,st)},$$slots:{default:!0}})}v(h,R)},M=h=>{var R=te(),u=A(R);Ut(u,{size:"large",align:"center"}),b(R),v(h,R)};U(k,h=>{t(g)?h(D):h(M,!1)})}b(_),v(f,_)},$$slots:{default:!0}})},$$slots:{default:!0}}),z(),o()}var ne=C('<!> <span class="hidden sm:inline">Home</span>',1),oe=C('<!> <span class="max-w-[150px] truncate"> </span>',1),se=C('<!> <span class="hidden sm:inline">Annotations</span>',1),ie=C('<!> <span class="max-w-[200px] truncate"><!></span>',1),re=C("<!> <!> <!> <!> <!> <!> <!>",1);function de(l,a){F(a,!0);const e=()=>L(r,"$filteredAnnotationCount",c),[c,o]=q(),{filteredAnnotationCount:r}=bt();wa(l,{class:"mb-2",children:(s,x)=>{Sa(s,{children:(i,B)=>{var $=re(),g=T($);at(g,{children:(_,y)=>{{let m=n(()=>K.toHome());mt(_,{get href(){return t(m)},class:"flex items-center gap-2",children:(k,D)=>{var M=ne(),h=T(M);ya(h,{class:"h-4 w-4"}),pt(2),v(k,M)},$$slots:{default:!0}})}},$$slots:{default:!0}});var E=S(g,2);ft(E,{});var w=S(E,2);at(w,{children:(_,y)=>{{let m=n(()=>K.toAnnotations(a.dataset.dataset_id));mt(_,{get href(){return t(m)},class:"flex items-center gap-2",children:(k,D)=>{var M=oe(),h=T(M);Ma(h,{class:"h-4 w-4"});var R=S(h,2),u=A(R,!0);b(R),V(()=>Z(u,a.dataset.name)),v(k,M)},$$slots:{default:!0}})}},$$slots:{default:!0}});var d=S(w,2);ft(d,{});var I=S(d,2);at(I,{children:(_,y)=>{{let m=n(()=>K.toAnnotations(a.dataset.dataset_id));mt(_,{get href(){return t(m)},class:"flex items-center gap-2",children:(k,D)=>{var M=se(),h=T(M);Da(h,{class:"h-4 w-4"}),pt(2),v(k,M)},$$slots:{default:!0}})}},$$slots:{default:!0}});var f=S(I,2);ft(f,{});var p=S(f,2);at(p,{children:(_,y)=>{Na(_,{class:"flex items-center gap-2",children:(m,k)=>{var D=ie(),M=T(D);Ha(M,{class:"h-4 w-4"});var h=S(M,2),R=A(h);{var u=N=>{var j=_t();V(()=>Z(j,`Annotation ${a.annotationIndex+1} of ${e()??""}`)),v(N,j)},O=N=>{var j=_t("Annotation");v(N,j)};U(R,N=>{a.annotationIndex!==void 0?N(u):N(O,!1)})}b(h),v(m,D)},$$slots:{default:!0}})},$$slots:{default:!0}}),v(i,$)},$$slots:{default:!0}})},$$slots:{default:!0}}),z(),o()}var le=aa("<image></image><g><!></g>",1),ce=C('<div class="h-full w-full overflow-hidden"><div class="sample relative h-full w-full"><div class="absolute right-4 top-2 z-30"><!></div> <!> <!></div></div>'),ue=C('<div class="flex h-full w-full items-center justify-center"><!></div>'),ve=C('<div class="flex h-full w-full flex-col space-y-4"><div class="flex w-full items-center"><!></div> <!> <div class="flex min-h-0 flex-1 gap-4"><div class="flex-1"><!></div> <div class="relative w-[375px]"><!></div></div></div>');function me(l,a){F(a,!0);const e=()=>L(j,"$isEditingMode",s),c=()=>L(t(M),"$annotationResp",s),o=()=>L(B,"$selectedSampleAnnotationCropIds",s),r=()=>L(E,"$isHidden",s),[s,x]=q(),{toggleSampleAnnotationCropSelection:i,selectedSampleAnnotationCropIds:B,clearReversibleActionsByGroupId:$,addReversibleAction:g}=bt(),{isHidden:E,handleKeyEvent:w}=ba(),{settingsStore:d}=na(),I=" ",f=et(d).key_go_back;let p=Et(!1);const _=()=>{var P;(P=a.sample)!=null&&P.dataset_id?nt(K.toAnnotations(a.sample.dataset_id)):nt("/")},y=P=>{switch(P.key){case f:_();break;case" ":P.preventDefault(),e()?tt(p,!0):i(a.annotationId);break;case I:P.preventDefault(),i(a.annotationId);break}w(P)},m=P=>{P.key===" "&&tt(p,!1),w(P)},k=H.data.datasetId,D=n(()=>ot({datasetId:k,annotationId:a.annotationId})),M=n(()=>t(D).annotation),h=n(()=>t(D).updateAnnotation);ra(()=>{$(Pa)});const R=P=>{if(t(u)){const J={annotation_id:t(u).annotation_id,dataset_id:t(u).dataset_id,bounding_box:P};(async()=>{try{await t(h)(J),Ba({annotation:t(u),addReversibleAction:g,updateAnnotation:t(h)})}catch(yt){ia.error("Failed to update annotations:"+yt.message)}})()}};let u=n(()=>c().data),O=n(()=>{var P,J;return Ca(((J=(P=t(u))==null?void 0:P.sample)==null?void 0:J.sample_id)||"")}),N=n(()=>t(u)?Dt(t(u)):void 0);const{isEditingMode:j}=H.data.globalStorage,It=n(()=>t(p)?"grab":"auto"),st=n(()=>e()&&!t(p));let Y=Et(void 0);Qt(()=>{!t(Y)&&t(N)&&tt(Y,t(N),!0)}),da(()=>{tt(Y,void 0)});var it=ve();ht("keydown",gt,y),ht("keyup",gt,m);var rt=A(it),Ht=A(rt);de(Ht,{get dataset(){return a.dataset},get annotationIndex(){return a.annotationIndex}}),b(rt);var At=S(rt,2);Aa(At,{class:"mb-4 bg-border-hard"});var $t=S(At,2),dt=A($t),Ft=A(dt);Lt(Ft,{className:"h-full",children:(P,J)=>{jt(P,{className:"h-full",children:(St,yt)=>{var Mt=X(),Ot=T(Mt);{var Gt=W=>{var G=ce(),Q=A(G),lt=A(Q),qt=A(lt);{let Pt=n(()=>o().has(a.annotationId));xa(qt,{onSelect:()=>i(a.annotationId),get isSelected(){return t(Pt)}})}b(lt);var Nt=S(lt,2);Oa(Nt,{});var Wt=S(Nt,2);ka(Wt,{get width(){return t(u).sample.width},get height(){return t(u).sample.height},get cursor(){return t(It)},get boundingBox(){return t(Y)},zoomableContent:(Vt,ct)=>{let Zt=()=>ct==null?void 0:ct().scale;var kt=le(),Ct=T(kt),ut=S(Ct);let Bt;var Jt=A(ut);oa(Jt,()=>c().dataUpdatedAt,vt=>{{let Xt=n(()=>({x:0,y:0,width:t(u).sample.width,height:t(u).sample.height}));Ia(vt,{get annotation(){return t(u)},showLabel:!0,get scale(){return Zt()},get imageWidth(){return t(u).sample.width},get isResizable(){return t(st)},onBoundingBoxChanged:R,get constraintBox(){return t(Xt)}})}}),b(ut),V(vt=>{xt(Ct,"href",t(O)),Bt=sa(ut,0,"",null,Bt,vt)},[()=>({invisible:r()})]),v(Vt,kt)},$$slots:{zoomableContent:!0}}),b(Q),b(G),v(W,G)},Kt=W=>{var G=ue(),Q=A(G);Ut(Q,{size:"large",align:"center"}),b(G),v(W,G)};U(Ot,W=>{t(u)?W(Gt):W(Kt,!1)})}v(St,Mt)},$$slots:{default:!0}})},$$slots:{default:!0}}),b(dt);var wt=S(dt,2),zt=A(wt);ee(zt,{get annotationId(){return a.annotationId}}),b(wt),b($t),b(it),v(l,it),z(),x()}var fe=C('<div class="flex h-full w-full space-x-4 px-4 pb-4" data-testid="annotation-details"><div class="h-full w-full space-y-6 rounded-[1vw] bg-card p-4"><!></div></div>');function He(l,a){F(a,!0);const e=()=>L(t($),"$sample",c),[c,o]=q(),r=n(()=>a.data.annotationId),s=n(()=>a.data.dataset),x=n(()=>a.data.annotationIndex),i=n(()=>H.params.sampleId),B=n(()=>Ea({sampleId:t(i)})),$=n(()=>t(B).sample);var g=fe(),E=A(g),w=A(E);{var d=I=>{me(I,{get annotationId(){return t(r)},get annotationIndex(){return t(x)},get dataset(){return t(s)},get sample(){return e().data}})};U(w,I=>{e().data&&t(r)&&t(s)&&I(d)})}b(E),b(g),v(l,g),z(),o()}export{He as component,Ue as universal};
