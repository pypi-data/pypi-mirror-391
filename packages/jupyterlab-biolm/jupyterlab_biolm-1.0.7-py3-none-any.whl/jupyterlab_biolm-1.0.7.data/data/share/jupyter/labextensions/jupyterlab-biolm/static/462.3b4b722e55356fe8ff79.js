(self.webpackChunkjupyterlab_biolm=self.webpackChunkjupyterlab_biolm||[]).push([[462],{462:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>C});var o=a(762),n=a(986),i=a(345),l=a.n(i);let s=null;function r(e){const t=[];return e.predictor&&t.push("predict"),e.encoder&&t.push("encode"),e.generator&&t.push("generate"),e.classifier&&t.push("classify"),e.similarity&&t.push("similarity"),e.explainer&&t.push("explain"),e.transformer&&t.push("transform"),0===t.length&&t.push("predict"),{id:e.model_slug,name:e.model_name,description:e.description,tags:e.tags||[],apiVersion:e.api_version,communityModel:e.community_model,companyModel:e.company_model,actions:t,apiDocsLink:e.api_docs_link}}var c=a(606);const m="jupyterlab-biolm:settings",d={profiles:[],activeProfile:void 0,defaultModel:void 0,defaultAction:"predict"};function p(){try{const e=localStorage.getItem(m);if(e)return{...d,...JSON.parse(e)}}catch(e){console.warn("Failed to load settings from localStorage:",e)}return{...d}}function u(e){try{localStorage.setItem(m,JSON.stringify(e))}catch(e){console.warn("Failed to save settings to localStorage:",e)}}async function y(e){const t=p();t.profiles=e,u(t)}async function g(e){const t=p();t.activeProfile=e,u(t)}async function b(e,t,a=!0){const o=e.currentWidget;if(!o)return await(0,n.showErrorMessage)("No Active Notebook","Please open a notebook before inserting code."),!1;const i=o.content.activeCell;if(!i)return await(0,n.showErrorMessage)("No Active Cell","Please select a cell in the notebook."),!1;const l=i.model.sharedModel,s=l.getSource();return a&&s.trim()?l.setSource(s+"\n"+t):l.setSource(t),!0}const f=({notebookTracker:e})=>{const[t,a]=(0,i.useState)([]),[o,m]=(0,i.useState)(!0),[d,u]=(0,i.useState)(null),[y,g]=(0,i.useState)(""),[f,h]=(0,i.useState)(null),[E,v]=(0,i.useState)(new Set);(0,i.useEffect)(()=>{N()},[]);const N=async()=>{m(!0),u(null);try{const e=function(){if(void 0!==c&&c.env&&c.env.BIOLM_API_KEY)return c.env.BIOLM_API_KEY;const e=p(),t=e.activeProfile;if(t){const a=e.profiles.find(e=>e.name===t);if(a)return a.apiKey}}(),t=await async function(e){if(s&&Date.now()-s.timestamp<3e5)return s.data;const t={"Content-Type":"application/json"};let a="/biolm/api/models";e&&(a+=`?api_key=${encodeURIComponent(e)}`,t.Authorization=`Bearer ${e}`);try{const e=await fetch(a,{method:"GET",headers:t,credentials:"same-origin"});if(console.log("[BioLM] Response status:",e.status,e.statusText),!e.ok){let t=`Failed to fetch models: ${e.statusText}`;try{const a=await e.json();a.message?t=a.message:a.error&&(t=a.error)}catch(e){}throw{message:t,status:e.status}}const o=await e.json(),n=Array.isArray(o)?o.map(r):[];return s={data:n,timestamp:Date.now()},n}catch(e){if(s)return console.warn("Using cached models due to fetch error:",e),s.data;if(e instanceof Error)throw{message:e.message.includes("fetch")||e.message.includes("CORS")||e.message.includes("Failed to fetch")?"Unable to connect to BioLM API. Please check your internet connection and API endpoint configuration.":e.message};throw e}}(e);a(t)}catch(e){u(e.message||"Failed to load models"),console.error("Error loading models:",e)}finally{m(!1)}},w=(0,i.useMemo)(()=>{let e=t;if(f&&(e=e.filter(e=>e.actions&&e.actions.includes(f)||e.tags&&e.tags.includes(f))),y.trim()){const t=y.toLowerCase();e=e.filter(e=>{const a=(e.name||e.id||"").toLowerCase(),o=(e.description||"").toLowerCase(),n=(e.tags||[]).join(" ").toLowerCase();return a.includes(t)||o.includes(t)||n.includes(t)})}return e.sort((e,t)=>{const a=(e.name||e.id||"").toLowerCase(),o=(t.name||t.id||"").toLowerCase();return a.localeCompare(o)})},[t,y,f]),j=(0,i.useMemo)(()=>{const e=new Set;return t.forEach(t=>{t.actions&&t.actions.forEach(t=>e.add(t))}),Array.from(e).sort()},[t]);return l().createElement("div",{className:"biolm-models-tab"},l().createElement("div",{className:"biolm-tab-header"},l().createElement("input",{type:"text",className:"jp-mod-styled jp-InputGroup-input",placeholder:"Search models...",value:y,onChange:e=>g(e.target.value),style:{width:"100%",marginBottom:"8px"}}),l().createElement("div",{className:"biolm-tag-filter"},l().createElement("button",{className:"jp-mod-styled jp-mod-minimal "+(f?"":"jp-mod-active"),onClick:()=>h(null),style:{marginRight:"4px",marginBottom:"4px"}},"All"),j.map(e=>l().createElement("button",{key:e,className:"jp-mod-styled jp-mod-minimal "+(f===e?"jp-mod-active":""),onClick:()=>h(e===f?null:e),style:{marginRight:"4px",marginBottom:"4px"}},e))),l().createElement("button",{className:"jp-mod-styled jp-mod-minimal",onClick:()=>{s=null,N()},style:{marginTop:"8px"}},"Refresh")),l().createElement("div",{className:"biolm-models-list"},o&&l().createElement("div",{className:"biolm-loading"},"Loading models..."),d&&l().createElement("div",{className:"biolm-error"},l().createElement("p",null,"Error: ",d),l().createElement("button",{className:"jp-mod-styled jp-mod-minimal",onClick:N},"Retry")),!o&&!d&&0===w.length&&l().createElement("div",{className:"biolm-empty"},y||f?"No models match your filters":"No models available"),!o&&!d&&w.map(t=>{const a=E.has(t.id),o=t.description||"",i=o.length>150,s=i&&!a?o.substring(0,150)+"...":o;return l().createElement("div",{key:t.id,className:"biolm-model-card"},l().createElement("div",{className:"biolm-model-header"},l().createElement("h3",{className:"biolm-model-name"},t.name||t.id),l().createElement("button",{className:"jp-mod-styled jp-mod-minimal",onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),console.log("Model ID copied to clipboard")}catch(e){(0,n.showErrorMessage)("Copy Failed","Failed to copy model ID to clipboard")}})(t.id),title:"Copy Model ID"},"Copy ID")),o&&l().createElement("div",{className:"biolm-model-description"},l().createElement("p",null,s),i&&l().createElement("button",{className:"jp-mod-styled jp-mod-minimal",onClick:()=>(e=>{const t=new Set(E);t.has(e)?t.delete(e):t.add(e),v(t)})(t.id)},a?"Show less":"Show more")),t.actions&&t.actions.length>0&&l().createElement("div",{className:"biolm-model-tags"},t.actions.map(a=>l().createElement("button",{key:a,className:"biolm-tag-button",onClick:()=>(async(t,a)=>{const o=function(e,t){let a="sequence",o='"YOUR_SEQUENCE_HERE"';return"generate"===t&&(a="context",o='"YOUR_CONTEXT_HERE"'),`result = biolm(entity="${e}", action="${t}", type="${a}", items=${o})\n\nprint(result)`}(t.id,a);await b(e,o,!0)&&console.log(`Inserted ${a} snippet for ${t.name||t.id}`)})(t,a),title:`Insert ${a} code for ${t.name||t.id}`},a))),t.tags&&t.tags.length>0&&l().createElement("div",{className:"biolm-model-meta-tags",style:{marginTop:"8px",fontSize:"11px",color:"var(--biolm-text-secondary)"}},l().createElement("strong",null,"Tags:")," ",t.tags.join(", ")))})))},h=[{title:"Import BioLM",description:"Import the BioLM library (run this once at the top of your notebook)",category:"Setup",code:"from biolmai import biolm",parameters:[]},{title:"Encode Sequence",description:"Encode a single sequence into embeddings using ESM2-8M",category:"Encoding",code:'result = biolm(entity="esm2-8m", action="encode", type="sequence", items="MSILVTRPSPAGEEL")\n\nprint(result)',parameters:["entity","action","type","items"]},{title:"Encode Batch",description:"Encode multiple sequences in a batch",category:"Encoding",code:'result = biolm(entity="esm2-8m", action="encode", type="sequence", items=["SEQ1", "SEQ2"])\n\nprint(result)',parameters:["entity","action","type","items"]},{title:"Predict Structure",description:"Predict protein structure from sequence using ESMFold",category:"Prediction",code:'result = biolm(entity="esmfold", action="predict", type="sequence", items="MDNELE")\n\nprint(result)',parameters:["entity","action","type","items"]},{title:"Predict Batch",description:"Predict structures for multiple sequences",category:"Prediction",code:'result = biolm(entity="esmfold", action="predict", type="sequence", items=["MDNELE", "MENDEL"])\n\nprint(result)',parameters:["entity","action","type","items"]},{title:"Generate Sequence",description:"Generate new sequences from a context using ProGen2-OAS",category:"Generation",code:'result = biolm(\n    entity="progen2-oas",\n    action="generate",\n    type="context",\n    items="M",\n    params={"temperature": 0.7, "top_p": 0.6, "num_samples": 2, "max_length": 17}\n)\n\nprint(result)',parameters:["entity","action","type","items","params"]},{title:"Write to Disk",description:"Save results directly to a file",category:"Output",code:'result = biolm(\n    entity="esmfold",\n    action="predict",\n    type="sequence",\n    items=["SEQ1", "SEQ2"],\n    output=\'disk\',\n    file_path="results.jsonl"\n)',parameters:["entity","action","type","items","output","file_path"]},{title:"Classify Sequence",description:"Classify a sequence",category:"Classification",code:'result = biolm(entity="your-model-id", action="classify", type="sequence", items="YOUR_SEQUENCE")\n\nprint(result)',parameters:["entity","action","type","items"]},{title:"Similarity Search",description:"Find similar sequences",category:"Similarity",code:'result = biolm(entity="your-model-id", action="similarity", type="sequence", items="YOUR_SEQUENCE")\n\nprint(result)',parameters:["entity","action","type","items"]}],E=({notebookTracker:e})=>{const[t,a]=(0,i.useState)(""),[o,s]=(0,i.useState)(null),r=(0,i.useMemo)(()=>{const e=new Set;return h.forEach(t=>e.add(t.category)),Array.from(e).sort()},[]),c=(0,i.useMemo)(()=>{let e=h;if(o&&(e=e.filter(e=>e.category===o)),t.trim()){const a=t.toLowerCase();e=e.filter(e=>{const t=e.title.toLowerCase(),o=e.description.toLowerCase(),n=e.category.toLowerCase();return t.includes(a)||o.includes(a)||n.includes(a)})}return e},[t,o]);return l().createElement("div",{className:"biolm-operations-tab"},l().createElement("div",{className:"biolm-tab-header"},l().createElement("input",{type:"text",className:"jp-mod-styled jp-InputGroup-input",placeholder:"Search operations...",value:t,onChange:e=>a(e.target.value),style:{width:"100%",marginBottom:"8px"}}),l().createElement("div",{className:"biolm-category-filter"},l().createElement("button",{className:"jp-mod-styled jp-mod-minimal "+(o?"":"jp-mod-active"),onClick:()=>s(null),style:{marginRight:"4px",marginBottom:"4px"}},"All"),r.map(e=>l().createElement("button",{key:e,className:"jp-mod-styled jp-mod-minimal "+(o===e?"jp-mod-active":""),onClick:()=>s(e===o?null:e),style:{marginRight:"4px",marginBottom:"4px"}},e)))),l().createElement("div",{className:"biolm-operations-list"},0===c.length&&l().createElement("div",{className:"biolm-empty"},t||o?"No operations match your filters":"No operations available"),c.map((t,a)=>l().createElement("div",{key:a,className:"biolm-operation-card"},l().createElement("div",{className:"biolm-operation-header"},l().createElement("h3",{className:"biolm-operation-title"},t.title),l().createElement("span",{className:"biolm-operation-category"},t.category)),l().createElement("p",{className:"biolm-operation-description"},t.description),t.parameters&&t.parameters.length>0&&l().createElement("div",{className:"biolm-operation-parameters"},l().createElement("strong",null,"Parameters:")," ",t.parameters.join(", ")),l().createElement("div",{className:"biolm-operation-code"},l().createElement("pre",null,l().createElement("code",null,t.code))),l().createElement("div",{className:"biolm-operation-actions"},l().createElement("button",{className:"jp-mod-styled jp-mod-accept",onClick:()=>(async t=>{await b(e,t.code,!0)&&console.log(`Inserted ${t.title} example`)})(t)},"Insert"),l().createElement("button",{className:"jp-mod-styled jp-mod-minimal",onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),console.log("Code snippet copied to clipboard")}catch(e){(0,n.showErrorMessage)("Copy Failed","Failed to copy code snippet to clipboard")}})(t.code)},"Copy"))))))};var v=a(606);const N=()=>{const[e,t]=(0,i.useState)([]),[a,o]=(0,i.useState)(),[s,r]=(0,i.useState)(""),[c,m]=(0,i.useState)("predict"),[d,b]=(0,i.useState)(""),[f,h]=(0,i.useState)(""),[E,N]=(0,i.useState)(null),[w,j]=(0,i.useState)(""),[C,k]=(0,i.useState)(""),[S,T]=(0,i.useState)(!1),[I,M]=(0,i.useState)(null);(0,i.useEffect)(()=>{x()},[]);const x=()=>{const e=p().profiles||[],a=p().activeProfile,n=p().defaultModel||"",i=p().defaultAction||"predict";t(e),o(a),r(n),m(i)},P=async()=>{if(!E||!w.trim()||!C.trim())return;const n=e.map(e=>e.name===E?{name:w.trim(),apiKey:C.trim()}:e);await y(n),t(n),a===E&&(await g(w.trim()),o(w.trim())),N(null),j(""),k(""),console.log("Profile has been updated")},L=async e=>{await g(e),o(e),console.log(e?`Active profile: ${e}`:"Using environment variable")},A=void 0!==v&&v.env&&!!v.env.BIOLM_API_KEY;return l().createElement("div",{className:"biolm-settings-tab"},l().createElement("div",{className:"biolm-settings-section"},l().createElement("h3",null,"API Key Profiles"),A&&l().createElement("div",{className:"biolm-env-notice"},l().createElement("p",null,"BIOLM_API_KEY environment variable is set and will be used if no profile is selected.")),l().createElement("div",{className:"biolm-profile-list"},0===e.length&&l().createElement("div",{className:"biolm-empty"},"No profiles configured. Add one below."),e.map(i=>l().createElement("div",{key:i.name,className:"biolm-profile-card"},E===i.name?l().createElement("div",{className:"biolm-profile-edit"},l().createElement("input",{type:"text",className:"jp-mod-styled jp-InputGroup-input",value:w,onChange:e=>j(e.target.value),placeholder:"Profile name",style:{marginBottom:"4px"}}),l().createElement("input",{type:"password",className:"jp-mod-styled jp-InputGroup-input",value:C,onChange:e=>k(e.target.value),placeholder:"API Key",style:{marginBottom:"4px"}}),l().createElement("div",null,l().createElement("button",{className:"jp-mod-styled jp-mod-accept",onClick:P},"Save"),l().createElement("button",{className:"jp-mod-styled jp-mod-minimal",onClick:()=>{N(null),j(""),k("")}},"Cancel"))):l().createElement(l().Fragment,null,l().createElement("div",{className:"biolm-profile-header"},l().createElement("strong",null,i.name),l().createElement("div",null,l().createElement("button",{className:"jp-mod-styled jp-mod-minimal "+(a===i.name?"jp-mod-active":""),onClick:()=>L(i.name),title:"Set as active"},a===i.name?"Active":"Set Active"),l().createElement("button",{className:"jp-mod-styled jp-mod-minimal",onClick:()=>(async e=>{T(!0),M(null);try{const t=await async function(e){try{const t=await fetch("/biolm/api/test-connection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:e}),credentials:"same-origin"});if(t.ok){const e=await t.json();return{valid:e.valid||!1,message:e.message||"Connection test completed"}}return{valid:!1,message:(await t.json().catch(()=>({}))).message||`HTTP ${t.status}: ${t.statusText}`}}catch(e){return{valid:!1,message:e instanceof Error?e.message:"Connection failed"}}}(e);M(t),t.valid?console.log(t.message||"API key is valid"):(0,n.showErrorMessage)("Connection Failed",t.message||"Invalid API key")}catch(e){const t=e.message||"Connection test failed";M({valid:!1,message:t}),(0,n.showErrorMessage)("Connection Failed",t)}finally{T(!1)}})(i.apiKey),disabled:S},"Test"),l().createElement("button",{className:"jp-mod-styled jp-mod-minimal",onClick:()=>(e=>{N(e.name),j(e.name),k(e.apiKey)})(i)},"Edit"),l().createElement("button",{className:"jp-mod-styled jp-mod-minimal",onClick:()=>(async n=>{const i=e.filter(e=>e.name!==n);await y(i),t(i),a===n&&(await g(void 0),o(void 0)),console.log(`Profile "${n}" has been deleted`)})(i.name)},"Delete"))),I&&a===i.name&&l().createElement("div",{className:"biolm-connection-status "+(I.valid?"valid":"invalid")},I.message))))),l().createElement("div",{className:"biolm-add-profile"},l().createElement("h4",null,"Add New Profile"),l().createElement("input",{type:"text",className:"jp-mod-styled jp-InputGroup-input",value:d,onChange:e=>b(e.target.value),placeholder:"Profile name",style:{marginBottom:"4px"}}),l().createElement("input",{type:"password",className:"jp-mod-styled jp-InputGroup-input",value:f,onChange:e=>h(e.target.value),placeholder:"API Key",style:{marginBottom:"4px"}}),l().createElement("button",{className:"jp-mod-styled jp-mod-accept",onClick:async()=>{if(!d.trim()||!f.trim())return void(0,n.showErrorMessage)("Invalid Input","Please provide both profile name and API key");if(e.some(e=>e.name===d))return void(0,n.showErrorMessage)("Duplicate Profile","A profile with this name already exists");const a={name:d.trim(),apiKey:f.trim()},o=[...e,a];await y(o),t(o),b(""),h(""),console.log(`Profile "${a.name}" has been added`)}},"Add Profile")),l().createElement("div",{className:"biolm-env-option"},l().createElement("button",{className:"jp-mod-styled jp-mod-minimal "+(a?"":"jp-mod-active"),onClick:()=>L(void 0),disabled:!A},"Use Environment Variable ",A?"(Available)":"(Not Set)"))),l().createElement("div",{className:"biolm-settings-section"},l().createElement("h3",null,"Default Preferences"),l().createElement("div",{className:"biolm-defaults"},l().createElement("label",null,"Default Model ID:",l().createElement("input",{type:"text",className:"jp-mod-styled jp-InputGroup-input",value:s,onChange:e=>r(e.target.value),placeholder:"Optional",style:{marginLeft:"8px",width:"200px"}})),l().createElement("label",{style:{marginTop:"8px",display:"block"}},"Default Action:",l().createElement("select",{className:"jp-mod-styled",value:c,onChange:e=>m(e.target.value),style:{marginLeft:"8px"}},l().createElement("option",{value:"predict"},"predict"),l().createElement("option",{value:"generate"},"generate"),l().createElement("option",{value:"embed"},"embed"),l().createElement("option",{value:"encode"},"encode"),l().createElement("option",{value:"classify"},"classify"))),l().createElement("button",{className:"jp-mod-styled jp-mod-accept",onClick:async()=>{await async function(e){const t=p();t.defaultModel=e,u(t)}(s.trim()||void 0),await async function(e){const t=p();t.defaultAction=e,u(t)}(c),console.log("Default preferences have been saved")},style:{marginTop:"8px"}},"Save Defaults"))))};class w extends l().Component{constructor(e){super(e),this.state={activeTab:"models"}}render(){const{activeTab:e}=this.state,{notebookTracker:t}=this.props;return l().createElement("div",{className:"biolm-widget"},l().createElement("div",{className:"biolm-tabs"},l().createElement("button",{className:"biolm-tab-button "+("models"===e?"active":""),onClick:()=>this.setState({activeTab:"models"})},"ðŸ§  Models"),l().createElement("button",{className:"biolm-tab-button "+("operations"===e?"active":""),onClick:()=>this.setState({activeTab:"operations"})},"âš™ï¸ Operations"),l().createElement("button",{className:"biolm-tab-button "+("settings"===e?"active":""),onClick:()=>this.setState({activeTab:"settings"})},"ðŸ”‘ Settings")),l().createElement("div",{className:"biolm-tab-content"},"models"===e&&l().createElement(f,{notebookTracker:t}),"operations"===e&&l().createElement(E,{notebookTracker:t}),"settings"===e&&l().createElement(N,null)))}}class j extends n.ReactWidget{constructor(e){super(),this._notebookTracker=e,this.addClass("biolm-widget-container"),this.id="biolm-widget",this.title.label="BioLM",this.title.caption="BioLM Model Browser",this.title.iconClass="jp-MaterialIcon jp-Icon jp-Icon-16",this.title.closable=!0}render(){return l().createElement(w,{notebookTracker:this._notebookTracker})}}const C={id:"jupyterlab-biolm:plugin",autoStart:!0,requires:[o.INotebookTracker],optional:[n.ICommandPalette],activate:async(e,t,a)=>{console.log("JupyterLab extension jupyterlab-biolm is activated!"),console.log("BioLM: Creating widget...");const o=new j(t);console.log("BioLM: Widget created with ID:",o.id),console.log("BioLM: Adding widget to left sidebar..."),e.shell.add(o,"left",{rank:1e3}),console.log("BioLM: Widget added to sidebar. Title:",o.title.label),e.commands.addCommand("biolm:open",{label:"Open BioLM",execute:()=>{e.shell.activateById(o.id)}}),a&&a.addItem({command:"biolm:open",category:"BioLM"})}}},606:e=>{var t,a,o=e.exports={};function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{a="function"==typeof clearTimeout?clearTimeout:i}catch(e){a=i}}();var s,r=[],c=!1,m=-1;function d(){c&&s&&(c=!1,s.length?r=s.concat(r):m=-1,r.length&&p())}function p(){if(!c){var e=l(d);c=!0;for(var t=r.length;t;){for(s=r,r=[];++m<t;)s&&s[m].run();m=-1,t=r.length}s=null,c=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===i||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function u(e,t){this.fun=e,this.array=t}function y(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];r.push(new u(e,t)),1!==r.length||c||l(p)},u.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}}}]);