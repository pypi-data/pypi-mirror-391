# RA助手系统需求规格说明书

## 1. 项目概述

### 1.1 项目背景

RA部门（注册部门）在药品注册过程中需要处理大量技术文档，包括质量标准文档、检测标准操作规程等。目前的文档编写过程主要依靠人工操作，存在效率低、易出错、格式不统一等问题。

### 1.2 项目目标

开发一个MCP服务器，通过接入大语言模型聊天机器人，辅助RA部门人员高效、准确地完成注册文档的编写和校验工作。

### 1.3 功能范围

- MCP接口支持上传和下载文档
- 实现质量标准文件的表格内容提取
- 实现质量标准文件的表格填充
- 实现检验方法文件的智能提取和总结
- 实现两个文档内容的自动校验功能

## 2. 功能需求

### 2.1 质量标准表格提取功能

#### 2.1.1 功能概述

上传试验人员编写的质量标准文档，系统提取文档中的检测标准表格，例如doc/example/例子-原液质量标准.docx ，并以Markdown格式呈现。

标准质量标准文档的检测标准表格列定义：

| 类型 | 检验项目 | 检验方法 | 质量标准 |
| ---- | -------- | -------- | -------- |

#### 2.1.2 核心挑战

- **表格结构差异**：源文档和目标文档的表格列名称可能不完全相同
- **列顺序不一致**：不同文档中表格列的排列顺序可能不同
- **列数量差异**：源文档表格可能包含目标文档不需要的列，或缺少某些必需列
- **保持原始数字单位**：源文档表格中可能包含生物、化学领域的英文名称、数据、计量单位，上下标需要保持一致

#### 2.1.3 验收标准

- [ ] 能够准确识别和提取质量标准表格
- [ ] 输出的Markdown格式符合标准
- [ ] 保持原始数据的精度和格式
- [ ] 正确处理上下标、特殊符号

### 2.2 质量标准表格填充功能

#### 2.2.1 功能概述

上传质量标准文档模板（例如 doc/example/模板-质量标准.docx）和Markdown格式的质量标准表格，系统将表格内容填充到标准文档模板中，并返回给用户。

#### 2.2.2 核心挑战

- **表格完整性检查**：质量标准表格内容需要包括"类型、检验项目、检验方法、质量标准"
- **保持原始数字单位**：Markdown表格中可能包含生物、化学领域的英文名称、数据、计量单位，上下标需要保持一致

#### 2.2.3 验收标准

- [ ] 能够验证表格内容的完整性
- [ ] 正确填充到模板文档的对应位置
- [ ] 保持数据的格式和精度
- [ ] 支持表格格式的正确转换

### 2.3 分析方法内容提取功能

#### 2.3.1 功能概述

系统能够从标准操作规程文件（例如 doc/example/例子-检验标准操作规程.docx）中提取操作方法，并按照规定原则进行总结归纳。

#### 2.3.2 归纳原则

基于"人机料法环"管理理念，提取和总结应包含以下要素：

- **人（People）**：操作人员资质、培训要求
- **机（Machine）**：设备仪器规格、校准状态
- **料（Material）**：试剂、样品、标准品要求
- **法（Method）**：关键操作步骤、参数设置
- **环（Environment）**：环境条件、安全要求

#### 2.3.3 处理要求

- **关键步骤提取**：识别并提取操作流程中的关键步骤
- **简约归纳**：将冗长的操作描述精简为核心要点
- **结构化输出**：按照标准模板格式输出归纳结果

#### 2.3.4 验收标准

- [ ] 能够识别文档中的操作方法章节
- [ ] 提取的关键步骤覆盖完整操作流程
- [ ] 归纳内容包含"人机料法环"五大要素
- [ ] 输出格式符合注册文档标准
- [ ] 归纳内容准确率达到90%以上

### 2.4 文档内容校验功能

#### 2.4.1 功能概述

系统能够自动校验目标文档中的关键信息，确保与源文档保持一致。

#### 2.4.2 校验范围

系统需要对以下关键信息进行比对和校验：

1. **数据及单位**

   - 数值的准确性
   - 单位的一致性
   - 精度和有效数字
   - 数据范围的合理性
2. **设备仪器**

   - 设备型号和规格
   - 厂家信息
   - 校准状态和有效期
   - 操作参数设置
3. **操作顺序**

   - 操作步骤的完整性
   - 步骤顺序的正确性
   - 关键控制点的标识
   - 时间节点和持续时间

#### 2.4.3 校验算法

- 实现基于NLP的文本相似度比对
- 建立专业术语词典和标准化规则
- 支持数值型数据的精确匹配和范围验证
- 提供可配置的校验规则和阈值

#### 2.4.4 验收标准

- [ ] 能够准确识别和比对关键信息
- [ ] 数值比对准确率达到100%
- [ ] 设备信息匹配准确率达到95%以上
- [ ] 操作顺序校验准确率达到90%以上
- [ ] 生成详细的校验报告

## 3. 技术架构需求

### 3.1 推荐技术栈

- **后端框架**：Python
- **文档处理**：python-docx库 + 自然语言处理框架 + 大语言模型调用
- **MCP框架**：FastMCP

### 3.2 架构要求

- 采用模块化设计，功能独立可扩展
- 实现完善的错误处理和日志记录机制
- 提供清晰的API接口文档

## 4. 开发实践要求

### 4.1 测试驱动开发

- 采用测试驱动开发（TDD）框架
- 对所有功能方法编写单元测试用例
- 先编写测试用例再实现功能方法
- 单元测试覆盖率目标：≥90%
- 提供集成测试和端到端测试

### 4.2 代码质量

- 每个方法提供详细的代码注释
- 遵循PEP 8 Python代码规范
- 使用类型提示（Type Hints）提高代码可读性
- 定期进行代码审查和重构

### 4.3 文档要求

- 提供完整的API接口文档
- 编写用户使用指南
- 提供开发者文档和架构说明
- 维护更新日志（CHANGELOG）

## 5. 项目交付

### 5.1 交付物

- 完整的源代码及依赖配置
- 单元测试和集成测试代码
- API接口文档
- 用户使用指南
- 部署和运维文档

### 5.2 质量标准

- 所有功能通过验收测试
- 代码测试覆盖率达标
- 性能满足实际使用需求
- 文档完整清晰
