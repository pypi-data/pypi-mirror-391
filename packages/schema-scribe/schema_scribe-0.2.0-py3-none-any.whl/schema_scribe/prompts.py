"""
This module centralizes all prompt templates for generating content with an LLM.

Each constant is a carefully formatted f-string that provides context,
instructions, and few-shot examples to the language model. This helps ensure
the model's output is structured and relevant for tasks like generating column
descriptions, model summaries, and dbt metadata.
"""

COLUMN_DESCRIPTION_PROMPT = """
You are a Data Analyst. Your task is to write a brief, business-focused description
for a database column (under 15 words).

Base Context:
- Table: {table_name}
- Column: {col_name}
- Type: {col_type}

Data Profile Context:
{profile_context}

Instructions:
1.  Use the Data Profile to make your description more accurate.
2.  If 'is_unique' is True, mention it (e.g., "Unique ID...").
3.  If 'distinct_count' is low (e.g., < 10), it's likely a category (e.g., "Status of...").
4.  If 'null_ratio' is high (e.g., > 0.5), it's likely optional (e.g., "User's middle name (optional)").
5.  Just provide the description, nothing else.

Example 1 (for an 'id' column with is_unique=True):
A unique identifier for each {table_name}.

Example 2 (for a 'status' column with distinct_count=4):
The current status of the {table_name} (e.g., pending, shipped).

Description:
"""
"""
A prompt to generate a business-focused description for a database column.

Placeholders:
- `{table_name}`: The name of the table the column belongs to.
- `{col_name}`: The name of the column.
- `{col_type}`: The data type of the column.
- `{profile_context}`: A formatted string of data profiling statistics.
"""

DBT_MODEL_PROMPT = """
You are a dbt expert.
Below is the SQL query that defines the '{model_name}' dbt model.
Summarize in 1-2 sentences what kind of data this model produces or aggregates from a business perspective.

```sql
{raw_sql}
```
"""
"""
A prompt to generate a high-level, business-focused summary for a dbt model.

Placeholders:
- `{model_name}`: The name of the dbt model.
- `{raw_sql}`: The raw SQL code that defines the model.
"""

DBT_MODEL_LINEAGE_PROMPT = """
You are a data architect specializing in dbt.
Below is the SQL query that defines the '{model_name}' dbt model.
Analyze the `ref()` and `source()` functions to understand its dependencies.

Generate a Mermaid.js `graph TD` (Top-Down) flowchart code that shows the lineage for this *single* model.
- Show only the direct parents (sources or refs) flowing *into* this model.
- Do not show downstream children.
- Keep it simple.

SQL:
```sql
{raw_sql}
```

---
EXAMPLE INPUT (SQL):
with orders as (
    select * from {{ ref('stg_orders') }}
),
payments as (
    select * from {{ ref('stg_payments') }}
)
select ... from orders join payments ...
---
EXAMPLE OUTPUT (Mermaid code ONLY):
```mermaid
graph TD
    A[stg_orders] --> C({model_name});
    B[stg_payments] --> C({model_name});
```
"""
"""
A prompt to generate a Mermaid.js lineage chart for a dbt model.

This asks the LLM to act as a data architect, analyze the model's dependencies
(`ref` and `source` functions), and generate a simple, top-down Mermaid graph
showing only its direct parents.

Placeholders:
- `{model_name}`: The name of the dbt model.
- `{raw_sql}`: The raw SQL code that defines the model.
"""

VIEW_SUMMARY_PROMPT = """
You are a professional data analyst.
Below is the SQL query that defines the database view '{view_name}'.
Summarize in 1-2 sentences what business-level information this view provides.

```sql
{view_definition}
```
"""
"""
A prompt to generate a business-level summary for a database view.

Placeholders:
- `{view_name}`: The name of the database view.
- `{view_definition}`: The SQL `CREATE VIEW` statement.
"""

TABLE_SUMMARY_PROMPT = """
You are a professional data analyst.
Below is a table named '{table_name}' and its columns: {column_list_str}.
Summarize in 1-2 sentences what business-level information this table likely holds.

Example (for table 'orders' with columns 'id, user_id, product_id, order_date'):
"Stores order information, linking users to the products they purchased and when."

Summary:
"""
"""
A prompt to generate a business-level summary for a database table.

Placeholders:
- `{table_name}`: The name of the database table.
- `{column_list_str}`: A comma-separated string of column names.
"""

DBT_COLUMN_PROMPT = """
You are a senior data governance expert using dbt.
Analyze the column '{col_name}' ({col_type}) in the dbt model '{model_name}'.
This column is generated by the following SQL:

SQL context:
```sql
{raw_sql}
```

Your task is to generate a YAML snippet for a dbt `schema.yml` file.
Provide the following keys:
1.  `description`: A concise (under 20 words) business description of this column.
2.  `meta`: A meta field containing `pii: true` if the column name or context suggests it's Personally Identifiable Information (e.g., email, name, phone, ssn), otherwise `pii: false`.
3.  `tags`: A YAML list of 1-2 relevant business tags (e.g., 'user_info', 'finance', 'pii').
4.  `tests`: A YAML list of 1-2 appropriate dbt generic tests (e.g., 'not_null', 'unique'). If no specific test seems necessary, provide an empty list `[]`.

Output ONLY the YAML snippet, starting with `description:`.
Do not include any other text, explanations, or markdown fences.

---
EXAMPLE INPUT (col_name='email'):
---
EXAMPLE OUTPUT:
description: The user's unique email address for login and contact.
meta:
  pii: true
tags:
  - user_info
  - pii
tests:
  - not_null
  - unique
"""
"""
A prompt to generate a complete YAML metadata block for a dbt column.

This asks the LLM to act as a senior data governance expert and generate a YAML
snippet containing a description, PII metadata, tags, and appropriate tests.
It is designed to produce output that can be directly used in a dbt `schema.yml`.

Placeholders:
- `{col_name}`: The name of the column.
- `{col_type}`_ The data type of the column.
- `{model_name}`: The name of the dbt model.
- `{raw_sql}`: The raw SQL code of the model for context.
"""

DBT_DRIFT_CHECK_PROMPT = """
You are a Data Governance Auditor.
Your task is to compare the 'Existing Description' against the 'Current Data Profile'
for the column '{node_name}.{column_name}' and determine if they conflict.

-   'Existing Description': {existing_description}
-   'Current Data Profile':
{profile_context}

Does the 'Existing Description' conflict with the 'Current Data Profile'?
Answer with a single word: 'MATCH' or 'DRIFT'.

-   Respond 'DRIFT' if the description is clearly wrong (e.g., description says 'Unique ID' but 'is_unique' is False).
-   Respond 'DRIFT' if the description mentions specific categories (e.g., 'Status is A or B') but the 'distinct_count' is very high (e.g., 1000).
-   Respond 'MATCH' if the description is still plausible, even if vague.
-   Respond 'MATCH' if the profile is 'N/A' (profiling failed).

Response (MATCH or DRIFT):
"""
"""
A prompt to check for documentation drift against live data.

This prompt asks the LLM to act as a data governance auditor. It compares
the existing documentation for a column against fresh data profile statistics
from the live database to see if the description is still accurate.

Placeholders:
- `{node_name}`: The name of the model or table.
- `{column_name}`: The name of the column.
- `{existing_description}`: The documentation currently in schema.yml.
- `{profile_context}`: The fresh data profile stats from the database.
"""