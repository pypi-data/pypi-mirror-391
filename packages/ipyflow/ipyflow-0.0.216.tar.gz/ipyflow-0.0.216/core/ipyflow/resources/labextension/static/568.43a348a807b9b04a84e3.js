"use strict";(self.webpackChunkjupyterlab_ipyflow=self.webpackChunkjupyterlab_ipyflow||[]).push([[568],{568:(e,t,l)=>{l.r(t),l.d(t,{default:()=>H});var s,i,n,o=l(777),c=l(329),d=l(423),a=l(761),r=l.n(a),u=function(e,t,l,s){if("a"===l&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===l?s:"a"===l?s.call(e):s?s.value:t.get(e)};const m="waiting-cell",v="ready-cell",C="ready-making-cell",h="ready-making-input-cell",y="linked-waiting",f="linked-ready-maker",g="ipyflow-slice",x="ipyflow-slice-execute",p="ipyflow-classic-colors",w=new Event("cleanup");class _{constructor(){s.add(this),this.comm=null,this.notebook=null,this.session=null,this.isIpyflowCommConnected=!1,this.selectedCells=[],this.executedCells=new Set,this.dirtyCells=new Set,this.waitingCells=new Set,this.readyCells=new Set,this.waiterLinks={},this.readyMakerLinks={},this.staleParents={},this.staleParentsByExecutedCellByChild={},this.staleParentsByChildByExecutedCell={},this.prevActiveCell=null,this.activeCell=null,this.cellsById={},this.orderIdxById={},this.cellPendingExecution=null,this.isReactivelyExecuting=!1,this.numAltModeExecutes=0,this.altModeExecuteCells=null,this.lastExecutionHighlights=null,this.executedReactiveReadyCells=new Set,this.newReadyCells=new Set,this.forcedReactiveCells=new Set,this.forcedCascadingReactiveCells=new Set,this.numPendingForcedReactiveCounterBumps=0,this.cellParents={},this.cellChildren={},this.settings={},this.lastCellMetadataMap=null}gatherCellMetadataAndContent(){const e={};return this.notebook.widgets.forEach(((t,l)=>{const s=t.model;e[s.id]={index:l,content:s.sharedModel.getSource(),type:s.type}})),e}requestComputeExecSchedule(){this.comm.send({type:"compute_exec_schedule",cell_metadata_by_id:this.gatherCellMetadataAndContent(),is_reactively_executing:this.isReactivelyExecuting})}isBatchReactive(){var e,t,l;return null!==(e=this.isIpyflowCommConnected)&&void 0!==e&&e&&"reactive"===(null===(t=this.settings)||void 0===t?void 0:t.exec_mode)&&"batch"===(null===(l=this.settings)||void 0===l?void 0:l.reactivity_mode)}executeCells(e){if(0===e.length)return;let t=0;for(const l of e)c.CodeCell.execute(l,this.session).then((()=>{var s;(null===(s=l.promptNode.textContent)||void 0===s?void 0:s.includes("[*]"))?l.setPrompt(""):this.executedCells.add(l.model.id),++t===e.length&&(this.isReactivelyExecuting=!1,setTimeout((()=>this.requestComputeExecSchedule()),0))}))}executeClosure(e){if(0===e.length)return;const t=e.map((e=>e.model.id)),l=this.computeTransitiveClosure(t);this.executeCells(l)}toggleReactivity(){return"reactive"===this.settings.exec_mode?this.settings.exec_mode="lazy":"lazy"===this.settings.exec_mode&&(this.settings.exec_mode="reactive"),this.session.session.kernel.requestExecute({code:"%flow toggle-reactivity",silent:!0,store_history:!1})}bumpForcedReactiveCounter(){return this.numPendingForcedReactiveCounterBumps--,this.session.session.kernel.requestExecute({code:"%flow bump-min-forced-reactive-counter",silent:!0,store_history:!1})}computeRawTransitiveClosureHelper(e,t,l,s=!1,i=!1){var n,o,c;if(!i&&e.has(t))return;s||e.add(t);const d=null==l?void 0:l[t];if(void 0===d)return;const a=e.size;if(d.forEach((t=>{this.computeRawTransitiveClosureHelper(e,t,l,s)})),s&&(e.size>a||!this.executedCells.has(t)||this.readyCells.has(t)||this.waitingCells.has(t)||this.dirtyCells.has(t))&&e.add(t),s&&e.has(t)){d.forEach((i=>{var n,o,c,d;if(e.has(i))return;let a=null===(o=null===(n=this.staleParents)||void 0===n?void 0:n[t])||void 0===o?void 0:o.includes(i);if(!a)for(const[l,s]of Object.entries(null!==(d=null===(c=this.staleParentsByExecutedCellByChild)||void 0===c?void 0:c[t])&&void 0!==d?d:{}))if(e.has(l)&&(a=s.includes(i),a))break;a&&(e.add(i),this.computeRawTransitiveClosureHelper(e,i,l,s,!0))}));for(const[i,d]of Object.entries(null!==(o=null===(n=this.staleParentsByChildByExecutedCell)||void 0===n?void 0:n[t])&&void 0!==o?o:{}))if(e.has(i))for(const t of d)!e.has(t)&&(null===(c=null==l?void 0:l[i])||void 0===c?void 0:c.includes(t))&&(e.add(t),this.computeRawTransitiveClosureHelper(e,t,l,s,!0))}}cellIdsToCells(e){const t="any_order"===this.settings.flow_order?u(this,s,"m",n).call(this):this.orderIdxById;return e.filter((e=>void 0!==this.cellsById[e])).filter((e=>void 0!==this.orderIdxById[e])).sort(((e,l)=>t[e]-t[l])).map((e=>this.cellsById[e]))}computeRawTransitiveClosure(e,t=!0,l=!1){var s,i;let n=e;const o=new Set(n);for(;;){for(const e of n)l?this.computeRawTransitiveClosureHelper(o,e,this.cellParents,!1,!0):this.computeRawTransitiveClosureHelper(o,e,this.cellChildren,!1,!0);if(l||null===(s=this.settings.pull_reactive_updates)||void 0===s||!s)break;for(const e of o)this.computeRawTransitiveClosureHelper(o,e,this.cellParents,!0,!0);if(n.length===o.size||null===(i=this.settings.push_reactive_updates_to_cousins)||void 0===i||!i)break;n=Array.from(o)}if(!t)for(const t of e)o.delete(t);return o}computeTransitiveClosure(e,t=!0,l=!1){return this.cellIdsToCells(Array.from(this.computeRawTransitiveClosure(e,t,l)))}}s=new WeakSet,i=function e(t,l,i){var n,o,c;if(!i.has(t)&&"code"===(null===(o=null===(n=this.cellsById[t])||void 0===n?void 0:n.model)||void 0===o?void 0:o.type)){i.add(t);for(const n of null!==(c=this.cellChildren[t])&&void 0!==c?c:[])u(this,s,"m",e).call(this,n,l,i);l.unshift(t)}},n=function(){const e=[],t=new Set;for(const l of Object.keys(this.cellsById))u(this,s,"m",i).call(this,l,e,t);const l={};return e.forEach(((e,t)=>{l[e]=t})),l};const E={},R=[];function b(e){delete E[e]}function k(e,t){const l={};for(const e in t)l[e]=t[e];for(const t in e)l[t]=e[t];return l}const B={id:"jupyterlab-ipyflow",requires:[d.INotebookTracker,o.ICommandPalette],autoStart:!0,activate:(e,t,l)=>{e.commands.addCommand("execute-stale",{label:"Execute Ready Cells",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>{var e,l;const s=t.currentWidget.sessionContext;if(!s.isReady)return;const i=null!==(e=E[s.session.id])&&void 0!==e?e:{};if(null===(l=i.isIpyflowCommConnected)||void 0===l||!l)return;const n=Array.from(new Set([...i.dirtyCells,...i.readyCells]));let o;o="batch"===i.settings.reactivity_mode?i.computeTransitiveClosure(n):i.cellIdsToCells(n),i.executeCells(o)}}),e.commands.addCommand("alt-mode-execute",{label:"Alt Mode Execute",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>{var l,s;const i=t.currentWidget.sessionContext;if(!i.isReady)return;e.commands.execute("notebook:enter-command-mode");const n=null!==(l=E[i.session.id])&&void 0!==l?l:{},o=n.altModeExecuteCells;if(n.altModeExecuteCells=null,null===(s=n.isIpyflowCommConnected)||void 0===s||!s)return n.executedCells.add(t.activeCell.model.id),void c.CodeCell.execute(t.activeCell,i);if(("batch"===n.settings.reactivity_mode||null===o)&&"code"===t.activeCell.model.type)if(n.numAltModeExecutes++,"incremental"===n.settings.reactivity_mode)1===n.numAltModeExecutes?n.toggleReactivity().done.then((()=>{n.executedCells.add(t.activeCell.model.id),c.CodeCell.execute(t.activeCell,i)})):(n.executedCells.add(t.activeCell.model.id),c.CodeCell.execute(t.activeCell,i));else if("batch"===n.settings.reactivity_mode){let e=null!=o?o:[t.activeCell];"lazy"===n.settings.exec_mode&&null===o&&(e=n.computeTransitiveClosure([t.activeCell.model.id])),1===n.numAltModeExecutes?n.toggleReactivity().done.then((()=>n.executeCells(e))):n.executeCells(e)}else console.error(`Unknown reactivity mode: ${n.settings.reactivity_mode}`)}}),e.commands.addKeyBinding({command:"alt-mode-execute",keys:["Accel Shift Enter"],selector:".jp-Notebook"}),e.commands.addKeyBinding({command:"alt-mode-execute",keys:["Ctrl Shift Enter"],selector:".jp-Notebook"}),e.commands.addKeyBinding({command:"execute-stale",keys:["Space"],selector:".jp-Notebook.jp-mod-commandMode"}),l.addItem({command:"alt-mode-execute",category:"execution",args:{}});const s=l=>{var s,i;const n=t.currentWidget.sessionContext;if(!n.isReady)return;const o=null!==(s=E[n.session.id])&&void 0!==s?s:{};if(null===(i=o.isIpyflowCommConnected)||void 0===i||!i)return;e.commands.execute("notebook:enter-command-mode");const c=o.computeTransitiveClosure([o.activeCell.model.id],!0,l);o.numPendingForcedReactiveCounterBumps++,"lazy"===o.settings.exec_mode?o.executeCells(c):(o.altModeExecuteCells=c,e.commands.execute("alt-mode-execute"))};let i,n,o;e.commands.addCommand("execute-forward-slice",{label:"Execute Forward Slice",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>s(!1)}),e.commands.addKeyBinding({command:"execute-forward-slice",keys:["Accel J"],selector:".jp-Notebook"}),e.commands.addKeyBinding({command:"execute-forward-slice",keys:["Accel ArrowDown"],selector:".jp-Notebook"}),e.commands.addCommand("execute-backward-slice",{label:"Execute Backward Slice",isEnabled:()=>!0,isVisible:()=>!0,isToggled:()=>!1,execute:()=>s(!0)}),e.commands.addKeyBinding({command:"execute-backward-slice",keys:["Accel K"],selector:".jp-Notebook"}),e.commands.addKeyBinding({command:"execute-backward-slice",keys:["Accel ArrowUp"],selector:".jp-Notebook"});try{i=e.commands._commands.get("notebook:run-cell"),n=e.commands._commands.get("notebook:run-cell-and-select-next"),o=e.commands._commands.get("runmenu:run")}catch(t){i=e.commands._commands["notebook:run-cell"],n=e.commands._commands["notebook:run-cell-and-select-next"],o=e.commands._commands["runmenu:run"]}const d=i.execute,a=n.execute,r=o.execute,u=()=>{var e;const l=t.currentWidget.sessionContext;return l.isReady&&null!==(e=E[l.session.id])&&void 0!==e?e:{}};[[i,d,"notebook:run-cell"],[n,a,"notebook:run-cell-and-select-next"],[o,r,"runmenu:run"]].forEach((([l,s,i])=>{l.execute=(...n)=>{var o,c,d;const a=u(),r=t.currentWidget,v=r.content;if("ipyflow"!==r.sessionContext.session.kernel.name||null!==(o=null==a?void 0:a.isIpyflowCommConnected)&&void 0!==o&&o)if(u().isBatchReactive()&&"code"===(null===(d=null===(c=null==a?void 0:a.activeCell)||void 0===c?void 0:c.model)||void 0===d?void 0:d.type)){e.commands.execute("notebook:enter-command-mode");const t=a.notebook.widgets[a.notebook.widgets.length-1],l=a.activeCell.model.id===t.model.id;m(),["notebook:run-cell-and-select-next","runmenu:run"].includes(i)&&(l?e.commands.execute("notebook:insert-cell-below"):e.commands.execute("notebook:move-cursor-down"))}else s.call(l,n),a.requestComputeExecSchedule();else for(const e of v.widgets)v.isSelectedOrActive(e)&&(e.setPrompt("*"),R.push(e))}}));const m=(e=!1)=>{var t;const l=u();if(null!==(t=l.isIpyflowCommConnected)&&void 0!==t&&t){const t=[];for(const e of l.notebook.widgets)l.notebook.isSelectedOrActive(e)&&t.push(e.model.id);let s=l.computeTransitiveClosure(t,!0);e&&(s=s.splice(1)),s.length>0?l.executeCells(s):l.requestComputeExecSchedule()}};t.currentChanged.connect(((e,t)=>{const l=t.sessionContext;window.ipyflow=E[l.session.id]})),t.widgetAdded.connect(((e,l)=>{const s=l.sessionContext;let i=()=>b(s.session.id);const n=()=>{s.session.kernel.registerCommTarget("ipyflow-client",((e,n)=>{e.onMsg=e=>{var n;const o=e.content.data;(null===(n=o.success)||void 0===n||n)&&("unestablish"===o.type?i():"establish"===o.type&&(i(),i=j(s,t,l.content)))},i(),i=j(s,t,l.content)}))};s.ready.then((()=>{T(l.content),n(),i(),i=j(s,t,l.content),s.kernelChanged.connect(((e,o)=>{null!=o.newValue&&(T(l.content),i(),b(s.session.id),i=()=>b(s.session.id),s.ready.then((()=>{n(),i=j(s,t,l.content)})))}))}))}))}},I=e=>{if(null==e)return null;const t=e.children.item(1);return null===t?null:t.firstElementChild},L=e=>{if(null==e)return null;const t=e.children.item(2);return null===t?null:t.firstElementChild},S=(e,t,l)=>{const s=()=>{e.removeEventListener(t,l),e.removeEventListener("cleanup",s)};e.addEventListener(t,l),e.addEventListener("cleanup",s)},M=(e,t,l,s,i)=>{null!==e&&null!==t&&S(e,l,(()=>{t.firstElementChild.classList[s](i)}))},P=(e,t)=>{M(I(e),L(e),"mouseover","add",y),M(I(e),L(e),"mouseout","remove",y),M(L(e),I(e),"mouseover","add",t),M(L(e),I(e),"mouseout","remove",t)},T=e=>{e.widgets.forEach((e=>{e.node.classList.remove(p),e.node.classList.remove(m),e.node.classList.remove(C),e.node.classList.remove(v),e.node.classList.remove(h),e.node.classList.remove(g),e.node.classList.remove(x);const t=I(e.node);null!==t&&(t.firstElementChild.classList.remove(y),t.firstElementChild.classList.remove(f),t.dispatchEvent(w));const l=L(e.node);null!==l&&(l.firstElementChild.classList.remove(y),l.firstElementChild.classList.remove(f),l.dispatchEvent(w))}))},A=(e,t,l,s,i,n,o)=>{if(null===e)return;const c=()=>{for(const e of t){let t=f;o.has(e)&&(t=y);const i=s(l[e].node);if(null===i||null===i.firstElementChild)return;i.firstElementChild.classList[n](t)}};e.addEventListener(i,c),S(e,i,c)},j=(e,t,l)=>{var s,i,n,o,c;!function(e){const t=new _;E[e]=t,window.ipyflow=t}(e.session.id);const d=E[e.session.id];d.activeCell=l.activeCell;const a=e.session.kernel.createComm("ipyflow","ipyflow");d.comm=a,d.notebook=l,d.session=e;let u=!1;const w=e=>{null!==e&&null!==e.model&&(e.model.isDirty?d.dirtyCells.add(e.model.id):d.dirtyCells.delete(e.model.id))},B=r().debounce((()=>{if(u)return l.model.contentChanged.disconnect(B),void l.model.cells.changed.disconnect(B);const e=d.gatherCellMetadataAndContent();r().isEqual(e,d.lastCellMetadataMap)||(d.lastCellMetadataMap=e,l.widgets.forEach(w),a.send({type:"notify_content_changed",cell_metadata_by_id:e}))}),500),S=(e,t)=>{u?e.stateChanged.disconnect(S):"executionCount"===t.name&&null!==t.newValue&&(d.executedCells.add(e.id),d.dirtyCells.delete(e.id),l.widgets.forEach((t=>{t.model.id===e.id&&(t.node.classList.remove(v),t.node.classList.remove(h))})))};for(const e of l.widgets)e.model.stateChanged.connect(S);const M=(e,t)=>{if(u)l.model.cells.changed.disconnect(M);else if("add"===t.type)for(const e of t.newValues)null==e||e.stateChanged.connect(S);else if("remove"===t.type)for(const e of t.oldValues)null==e||e.stateChanged.disconnect(S)};l.model.cells.changed.connect(M);const j=e=>{d.cellsById={},d.orderIdxById={},e.widgets.forEach(((e,t)=>{d.cellsById[e.model.id]=e,d.orderIdxById[e.model.id]=t}))},H=(e,t)=>{var s,i;l===e&&(u?l.activeCellChanged.disconnect(H):((e=>{if(null==e.id)return;let t=-1;l.widgets.forEach(((l,s)=>{l.model.id===e.id&&(t=s)}));const s={type:"change_active_cell",active_cell_id:e.id,active_cell_order_idx:t};a.send(s)})(t.model),d.prevActiveCell=d.activeCell,d.activeCell=t,null!==d.activeCell&&null!==d.activeCell.model&&"code"===d.activeCell.model.type&&(d.dirtyCells.has(d.activeCell.model.id)&&(null===(i=(s=d.activeCell.model)._setDirty)||void 0===i||i.call(s,!0)),z(l))))},q=[{action:"mouseover",update:"add"},{action:"mouseout",update:"remove"}],N=(e,t,l,s)=>{var i;const{model:n,node:o}=e,c=n.id;"code"===n.type&&("classic"===(null!==(i=d.settings.color_scheme)&&void 0!==i?i:"lazy")&&o.classList.add(p),l?o.classList.add(x):o.classList.remove(x),t&&!l?o.classList.add(g):o.classList.remove(g),s&&(d.waitingCells.has(c)?(o.classList.add(m),o.classList.add(v),o.classList.remove(h),P(o,y)):d.readyCells.has(c)&&(o.classList.add(h),o.classList.add(v),P(o,f)),"reactive"!==d.settings.exec_mode&&(void 0!==d.waiterLinks[c]&&q.forEach((({action:e,update:t})=>{A(I(o),d.waiterLinks[c],d.cellsById,I,e,t,d.waitingCells),A(L(o),d.waiterLinks[c],d.cellsById,I,e,t,d.waitingCells)})),void 0!==d.readyMakerLinks[c]&&(d.waitingCells.has(c)||(o.classList.add(C),o.classList.add(v)),q.forEach((({action:e,update:t})=>{A(I(o),d.readyMakerLinks[c],d.cellsById,I,e,t,d.waitingCells),A(I(o),d.readyMakerLinks[c],d.cellsById,L,e,t,d.waitingCells)}))))))},z=e=>{T(e),j(e);let t=d.selectedCells;0===t.length&&(t=[d.activeCell.model.id]);const l=d.computeRawTransitiveClosure(t,!0,!1);t=Array.from(l);const s=new Set(l);for(const e of t)s.delete(e),d.computeRawTransitiveClosureHelper(s,e,d.cellParents);for(const t of e.widgets){const e=t.model.id;N(t,s.has(e),l.has(e),"none"!==d.lastExecutionHighlights)}},F=()=>{var e,l,s;u&&t.selectionChanged.disconnect(F);const i=null==t?void 0:t.currentWidget,n=null==i?void 0:i.sessionContext;if(null===(e=null==n?void 0:n.isReady)||void 0===e||!e)return;const o=null!==(l=E[n.session.id])&&void 0!==l?l:{};if(null===(s=o.isIpyflowCommConnected)||void 0===s||!s)return;const c=i.content;o.selectedCells=c.widgets.filter((e=>"code"===e.model.type&&c.isSelected(e))).map((e=>e.model.id)),z(c)};t.selectionChanged.connect(F);const K=r().debounce((()=>{var e;const l=t.currentWidget;null!==(e=l.model.collaborative)&&void 0!==e&&e||l.context.save()}),200);a.onMsg=e=>{var t,s,i,n,o,c,r,m,v;const C=e.content.data;if(!u&&(null===(t=C.success)||void 0===t||t))if("establish"===C.type)d.isIpyflowCommConnected=!0,j(l),l.activeCellChanged.connect(H),l.activeCell.model.stateChanged.connect(S),H(l,l.activeCell),l.model.contentChanged.connect(B),l.model.cells.changed.connect(B),d.requestComputeExecSchedule();else if("set_exec_mode"===C.type)d.numAltModeExecutes=0,d.settings.exec_mode=C.exec_mode;else if("compute_exec_schedule"===C.type){d.settings=C.settings;const e=null!==(n=null===(i=(s=l.model).getMetadata)||void 0===i?void 0:i.call(s,"ipyflow"))&&void 0!==n?n:{},t=null!==(o=null==e?void 0:e.cell_parents)&&void 0!==o?o:{},u=null!==(c=null==e?void 0:e.cell_children)&&void 0!==c?c:{};d.cellParents=k(C.cell_parents,t),d.cellChildren=k(C.cell_children,u),d.executedCells=new Set(C.executed_cells),null===(m=(r=l.model).setMetadata)||void 0===m||m.call(r,"ipyflow",{cell_parents:d.cellParents,cell_children:d.cellChildren}),K(),d.waitingCells=new Set(C.waiting_cells),d.readyCells=new Set(C.ready_cells),0===d.numPendingForcedReactiveCounterBumps?(d.forcedReactiveCells=new Set([...d.forcedReactiveCells,...C.forced_reactive_cells]),d.forcedCascadingReactiveCells=new Set([...d.forcedCascadingReactiveCells,...C.forced_cascading_reactive_cells])):(d.forcedReactiveCells=new Set,d.forcedCascadingReactiveCells=new Set),d.waiterLinks=C.waiter_links,d.readyMakerLinks=C.ready_maker_links,d.staleParents=C.stale_parents,d.staleParentsByExecutedCellByChild=C.stale_parents_by_executed_cell_by_child,d.staleParentsByChildByExecutedCell=C.stale_parents_by_child_by_executed_cell,d.cellPendingExecution=null;const h=C.exec_mode;d.isReactivelyExecuting=d.isReactivelyExecuting||null!==(v=null==C?void 0:C.is_reactively_executing)&&void 0!==v&&v||"reactive"===h,d.newReadyCells="reactive"===h?new Set([...d.newReadyCells,...C.new_ready_cells]):new Set;const y=C.flow_order,f=C.exec_schedule;d.lastExecutionHighlights=C.highlights;const g=C.last_executed_cell_id;if(d.executedReactiveReadyCells.add(g),R.length>0){const e=R.splice(0,R.length);return void(d.isBatchReactive()?d.executeClosure(e):d.executeCells(e))}let x=!1;if(C.last_execution_was_error)x=!0;else if("batch"===d.settings.reactivity_mode){const e=d.computeTransitiveClosure(Array.from(d.forcedCascadingReactiveCells).filter((e=>!d.executedReactiveReadyCells.has(e)))).map((e=>e.model.id));let t;t="reactive"===h?d.computeTransitiveClosure([...d.newReadyCells,...d.forcedReactiveCells,...e].filter((e=>!d.executedReactiveReadyCells.has(e)))).filter((e=>!d.executedReactiveReadyCells.has(e.model.id))):[...d.forcedReactiveCells,...e].filter((e=>!d.executedReactiveReadyCells.has(e)&&void 0!==d.cellsById[e]&&void 0!==d.orderIdxById[e])).sort(((e,t)=>d.orderIdxById[e]-d.orderIdxById[t])).map((e=>d.cellsById[e])),0===t.length?x=!0:(d.isReactivelyExecuting=!0,d.executedReactiveReadyCells=new Set([...d.executedReactiveReadyCells,...t.map((e=>e.model.id))]),d.executeCells(t))}else if("incremental"===d.settings.reactivity_mode){let e=!1;for(const t of l.widgets){if(!e&&(e=t.model.id===g,"in_order"===y||"strict"===f))continue;if("code"!==t.model.type||d.executedReactiveReadyCells.has(t.model.id))continue;if(!(d.forcedReactiveCells.has(t.model.id)||d.newReadyCells.has(t.model.id)&&"reactive"===h))continue;const l=t;if(null===d.cellPendingExecution){if(d.cellPendingExecution=l,"in_order"===y||"strict"===f)break}else null==l.model.executionCount||l.model.executionCount<d.cellPendingExecution.model.executionCount&&(d.cellPendingExecution=l)}null===d.cellPendingExecution?x=!0:(d.isReactivelyExecuting=!0,d.executedCells.add(d.cellPendingExecution.model.id),d.executeCells([d.cellPendingExecution]))}x&&(d.isReactivelyExecuting&&("reactive"===d.lastExecutionHighlights&&(d.readyCells=d.executedReactiveReadyCells),a.send({type:"reactivity_cleanup"})),d.numAltModeExecutes>0&&0==--d.numAltModeExecutes&&d.toggleReactivity(),d.numPendingForcedReactiveCounterBumps>0&&d.bumpForcedReactiveCounter(),d.forcedReactiveCells=new Set,d.forcedCascadingReactiveCells=new Set,d.newReadyCells=new Set,d.executedReactiveReadyCells=new Set,d.isReactivelyExecuting=!1,z(l))}};const V=null!==(n=null===(i=(s=l.model).getMetadata)||void 0===i?void 0:i.call(s,"ipyflow"))&&void 0!==n?n:{};return a.open({interface:"jupyterlab",cell_metadata_by_id:d.gatherCellMetadataAndContent(),cell_parents:null!==(o=null==V?void 0:V.cell_parents)&&void 0!==o?o:{},cell_children:null!==(c=null==V?void 0:V.cell_children)&&void 0!==c?c:{}}),()=>{a.dispose(),u=!0,d.isIpyflowCommConnected=!1,b(e.session.id)}},H=B}}]);