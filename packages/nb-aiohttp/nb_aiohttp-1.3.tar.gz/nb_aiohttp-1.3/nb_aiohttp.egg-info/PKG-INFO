Metadata-Version: 2.4
Name: nb_aiohttp
Version: 1.3
Summary: æ›´å¥½ç”¨çš„ aiohttp å®¢æˆ·ç«¯ï¼Œæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ä½¿ç”¨ã€‚ æ€§èƒ½ç¢¾å‹ httpx å’Œ requests 400%
Author-email: ydf0509 <ydf0509@xxx.com>
License: MIT
Project-URL: Homepage, https://github.com/ydf0509/nb_aiohttp
Project-URL: Repository, https://github.com/ydf0509/nb_aiohttp
Project-URL: Issues, https://github.com/ydf0509/nb_aiohttp/issues
Keywords: asyncio,aiohttp,httpx
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Programming Language :: Python :: 3.14
Requires-Python: >=3.7
Description-Content-Type: text/markdown
Requires-Dist: typing_extensions>=3.7; python_version < "3.8"
Requires-Dist: aiohttp
Requires-Dist: nb_log
Provides-Extra: test
Requires-Dist: pytest>=6.0; extra == "test"
Requires-Dist: pytest-asyncio>=0.14; extra == "test"
Provides-Extra: dev
Requires-Dist: black>=21.0; extra == "dev"
Requires-Dist: flake8>=3.8; extra == "dev"
Requires-Dist: mypy>=0.812; extra == "dev"

<div align="center">

# âš¡ nb_aiohttp

**ä¸‹ä¸€ä»£é«˜æ€§èƒ½ Python HTTP å®¢æˆ·ç«¯**

[![Python Version](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](https://opensource.org/licenses/MIT)
[![Performance](https://img.shields.io/badge/performance-400%25%20faster-red.svg)](https://github.com/ydf0509/nb_aiohttp)

*è®©å¼‚æ­¥è¯·æ±‚åƒå‘¼å¸ä¸€æ ·ç®€å•*

[ç‰¹æ€§](#2--æ ¸å¿ƒç‰¹æ€§) â€¢ [å®‰è£…](#3--å®‰è£…) â€¢ [å¿«é€Ÿå¼€å§‹](#4--å¿«é€Ÿå¼€å§‹) â€¢ [æ€§èƒ½å¯¹æ¯”](#5--æ€§èƒ½å¯¹æ¯”) â€¢ [APIæ–‡æ¡£](#6--api-æ–‡æ¡£)

---

</div>

## 1. ğŸ’¡ ä¸ºä»€ä¹ˆé€‰æ‹© nb_aiohttpï¼Ÿ

åœ¨ Python HTTP å®¢æˆ·ç«¯çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬å¸¸å¸¸é¢ä¸´ä¸€ä¸ªè‰°éš¾çš„é€‰æ‹©ï¼š

- é€‰æ‹© **requests**ï¼Ÿç®€å•æ˜“ç”¨ï¼Œä½†æ€§èƒ½å—é™äºåŒæ­¥é˜»å¡
- é€‰æ‹© **httpx**ï¼ŸåŒæ­¥å¼‚æ­¥é€šåƒï¼Œä½†æ€§èƒ½å¹³å¹³
- é€‰æ‹© **aiohttp**ï¼Ÿæ€§èƒ½å“è¶Šï¼Œä½† API å¤æ‚ï¼Œä¸èƒ½å…¨å±€å®ä¾‹åŒ–

**nb_aiohttp æ¨ªç©ºå‡ºä¸–ï¼Œæ‰“ç ´è¿™ä¸ªå›°å±€ï¼**

æˆ‘ä»¬åœ¨ `aiohttp` çš„å¼ºå¤§æ€§èƒ½åŸºç¡€ä¸Šï¼Œé‡æ–°è®¾è®¡äº†æ›´å‹å¥½çš„ APIï¼Œè®©ä½ æ—¢èƒ½äº«å—æè‡´æ€§èƒ½ï¼Œåˆèƒ½æ‹¥æœ‰æç®€ä½“éªŒã€‚

- å„ä¸ªhttpå®¢æˆ·ç«¯æ€§èƒ½å¯¹æ¯”ï¼ŒåŒ…æ‹¬åŒæ­¥å’Œå¼‚æ­¥ï¼š
   - å¯ä»¥çœ‹å‡º nb_http_client æ€§èƒ½æ˜¯ç¥ä¸­ç¥ï¼Œnb_http_client ä¹Ÿæ˜¯æˆ‘åŸºäº ä¸‡èƒ½å¯¹è±¡æ±  å¼€å‘çš„ http è¿æ¥æ± ã€‚
   - nb_aiohttp æ€§èƒ½å’Œ aiohttp å¹¶åˆ—ç¬¬äºŒï¼Œ ä½†æ˜¯ nb_aiohttp çš„ API æ›´ç®€å•ï¼Œæ›´æ˜“ç”¨ï¼Œå¯ä»¥åŒæ­¥å’Œå¼‚æ­¥åŒä¸–ç•Œä½¿ç”¨ã€‚
  
- å…·ä½“å¯¹æ¯”ä»£ç å¯ä»¥çœ‹ [benchmark.md](https://github.com/ydf0509/nb_aiohttp/blob/main/benchmark/benchmark.md)
- å¯¹æ¯”æ–‡æ¡£æ€»ç»“ï¼Œè§æ–‡æ¡£ç¬¬ 20ç« èŠ‚ã€‚

[![pZCRiPe.png](https://s21.ax1x.com/2025/11/13/pZCRiPe.png)](https://imgchr.com/i/pZCRiPe)



## 2. ğŸš€ æ ¸å¿ƒç‰¹æ€§

### 2.1 ğŸ† æ€§èƒ½ç‹è€…

- **å¼‚æ­¥æ€§èƒ½**: æ¯” `httpx` å¿« **5å€**ï¼Œå®Œå…¨é‡Šæ”¾ `aiohttp` çš„æ€§èƒ½æ½œåŠ›
- **åŒæ­¥æ€§èƒ½**: æ¯” `requests` å¿« **4å€**ï¼ŒåŒæ­¥ä»£ç ä¹Ÿèƒ½äº«å—å¼‚æ­¥æ€§èƒ½
- **æµ·é‡å¹¶å‘**: å†…ç½®è¿æ¥æ± ç®¡ç†ï¼Œè½»æ¾åº”å¯¹æ•°ä¸‡çº§å¹¶å‘è¯·æ±‚

### 2.2 ğŸ¯ æç®€è®¾è®¡

```python
# ä¸€è¡Œå®ä¾‹åŒ–ï¼Œå…¨å±€å¯ç”¨
http = NbAioHttpClient()

# ä¸€è¡Œè¯·æ±‚ï¼Œä¼˜é›…ç®€æ´
resp = await http.get('https://api.github.com')
```

### 2.3 ğŸ§© æ‡’åŠ è½½æœºåˆ¶

å½»åº•è§£å†³ `aiohttp.ClientSession` æ— æ³•åœ¨æ¨¡å—çº§åˆ«å®ä¾‹åŒ–çš„ç—›ç‚¹ï¼š

```python
# âœ… nb_aiohttp - éšå¤„å®ä¾‹åŒ–
from nb_aiohttp import NbAioHttpClient
http = NbAioHttpClient()  # åœ¨å…¨å±€ä½œç”¨åŸŸç›´æ¥åˆ›å»º

# âŒ aiohttp - å¿…é¡»åœ¨ async å‡½æ•°å†…
import aiohttp
async def func():
    async with aiohttp.ClientSession() as session:  # æ¯æ¬¡éƒ½è¦é‡æ–°åˆ›å»º
        ...
```

### 2.4 ğŸ”„ åŒæ­¥/å¼‚æ­¥åŒæ”¯æŒ

ä¸€å¥—ä»£ç ï¼Œä¸¤ç§æ¨¡å¼ï¼Œé€‚é…å„ç§åº”ç”¨åœºæ™¯ï¼š

- **ç”¨é€”**
  - **NbAioHttpClient**: å¼‚æ­¥é«˜æ€§èƒ½ï¼Œé€‚åˆé«˜å¹¶å‘æœåŠ¡
  - **NbSyncHttpClient**: åŒæ­¥è°ƒç”¨ï¼Œé€‚åˆéasyncioç¼–ç¨‹ç”Ÿæ€çš„ä¼ ç»Ÿåº”ç”¨ã€è„šæœ¬


- **åŸç†**
  - **NbAioHttpClientçš„åŸç†**ï¼š æ˜¯è°ƒç”¨`aiohttp`çš„`ClientSession`çš„å¼‚æ­¥æ–¹æ³• ï¼Œä½†ä½¿ç”¨æ–¹å¼è¢«å¤§å¹…ç®€åŒ–ï¼Œæ”¯æŒå…¨å±€å˜é‡åˆ›å»º `NbAioHttpClient`ï¼ŒåŸç”Ÿ`aiohttp`çš„2æ¬¡`async with` åŠ  3æ¬¡`await`ï¼Œè¢«ç®€åŒ–ä¸º 1æ¬¡`await`
  - **NbSyncHttpClientçš„åŸç†**ï¼š æ˜¯é€šè¿‡ `asyncio.run_coroutine_threadsafe` è°ƒç”¨ `NbAioHttpClient` çš„å¼‚æ­¥`request`æ–¹æ³•ï¼Œç„¶åé€šè¿‡ `future.result()` è·å–ç»“æœ,æ‰€ä»¥æœ¬è´¨ä¹Ÿæ˜¯åœ¨`loop` ä¸­è¿è¡Œ `aiohttp` ï¼Œæ€§èƒ½è¿œè¶… `requests`


### 2.5 ğŸ’ª ä¼ä¸šçº§ç‰¹æ€§

- âœ… **è‡ªåŠ¨é‡è¯•**: æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼Œæå‡è¯·æ±‚æˆåŠŸç‡
- âœ… **ç»Ÿä¸€å“åº”**: å°è£… `NbHttpResp` å¯¹è±¡ï¼ŒAPI ä¸€è‡´æ€§å¼º
- âœ… **JSON è½¬æ¢**: `.dict` å±æ€§ç›´æ¥è·å– JSON æ•°æ®
- âœ… **æ™ºèƒ½æ—¥å¿—**: é›†æˆ `nb_log`ï¼Œè‡ªåŠ¨è®°å½•é”™è¯¯å’Œæ…¢è¯·æ±‚
- âœ… **çµæ´»é…ç½®**: è¶…æ—¶ã€é‡è¯•ã€è¿æ¥æ± ç­‰å‚æ•°éšå¿ƒå®šåˆ¶

## 3. ğŸ“¦ å®‰è£…

```bash
pip install nb_aiohttp
```

## 4. âš¡ å¿«é€Ÿå¼€å§‹

### 4.1 ğŸ”¹ å¼‚æ­¥æ¨¡å¼ - æ€§èƒ½å·…å³°

å®Œç¾é€‚é… FastAPIã€å¼‚æ­¥çˆ¬è™«ã€é«˜å¹¶å‘æœåŠ¡ç­‰åœºæ™¯ï¼š

```python
import asyncio
from nb_aiohttp import NbAioHttpClient

# ğŸ¯ åœ¨æ¨¡å—é¡¶å±‚ç›´æ¥å®ä¾‹åŒ– - è¿™æ˜¯æœ€å¤§çš„åˆ›æ–°ï¼
http = NbAioHttpClient(
    timeout=10,              # è¶…æ—¶æ—¶é—´
    connector_limit=100,     # è¿æ¥æ± å¤§å°
    max_retries=3,           # æœ€å¤§é‡è¯•æ¬¡æ•°
)

async def main():
    # ğŸš€ å‘èµ· GET è¯·æ±‚ - ä»…éœ€ä¸€æ¬¡ await
    resp = await http.get('https://api.github.com/events')
    print(f"çŠ¶æ€ç : {resp.status}")
    print(f"å“åº”å†…å®¹: {resp.text[:100]}")
    
    # ğŸ“¤ å‘èµ· POST jsonæ•°æ®è¯·æ±‚ - API ç®€æ´ç›´è§‚
    resp = await http.post(
        'https://httpbin.org/post',
        json={'username': 'admin', 'password': '123456'}
    )
    
    # ğŸ ç›´æ¥è·å– JSON æ•°æ®
    print(f"å“åº”æ•°æ®: {resp.dict}")
    
    # ğŸ” ä½¿ç”¨ context manager è‡ªåŠ¨ç®¡ç†èµ„æº
    async with NbAioHttpClient() as client:
        resp = await client.get('https://www.python.org')
        print(f"Python å®˜ç½‘: {resp.ok}")
    
    # ğŸ›‘ æ‰‹åŠ¨å…³é—­è¿æ¥
    await http.close()

if __name__ == '__main__':
    asyncio.run(main())
```

### 4.2 ğŸ”¹ åŒæ­¥æ¨¡å¼ - ç®€å•æ˜“ç”¨

å®Œç¾é€‚é…ä¼ ç»Ÿ Djangoã€Flaskã€çˆ¬è™«è„šæœ¬ç­‰åŒæ­¥åœºæ™¯ï¼š

```python
from nb_aiohttp import NbSyncHttpClient

# ğŸ¯ å®ä¾‹åŒ–åŒæ­¥å®¢æˆ·ç«¯
http = NbSyncHttpClient(
    timeout=10,
    connector_limit=100,
    max_retries=3,
)

# âš™ï¸ å¯åŠ¨åå°äº‹ä»¶å¾ªç¯ï¼ˆä»…éœ€è°ƒç”¨ä¸€æ¬¡ï¼‰
http.run_forever()

# ğŸš€ åƒä½¿ç”¨ requests ä¸€æ ·ç®€å•
resp = http.get('https://api.github.com/events')
print(f"çŠ¶æ€ç : {resp.status}")
print(f"å“åº”å†…å®¹: {resp.text[:100]}")

# ğŸ“¤ POST è¯·æ±‚
resp = http.post(
    'https://httpbin.org/post',
    json={'key': 'value'}
)
print(f"å“åº”æ•°æ®: {resp.dict}")

# ğŸ¯ æ— éœ€æ‰‹åŠ¨å…³é—­ï¼Œè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
```

### 4.3 ğŸ”¹ é«˜çº§ç”¨æ³•

#### 4.3.1 é”™è¯¯å¤„ç†ä¸é‡è¯•

```python
from nb_aiohttp import NbAioHttpClient

http = NbAioHttpClient(
    max_retries=5,              # å¤±è´¥åé‡è¯• 5 æ¬¡
    is_raise_for_status=True,   # çŠ¶æ€ç å¼‚å¸¸æ—¶æŠ›å‡ºé”™è¯¯
    is_log_error=True,          # è®°å½•é”™è¯¯æ—¥å¿—
)

async def robust_request():
    try:
        resp = await http.get('https://unstable-api.com/data')
        return resp.dict
    except Exception as e:
        print(f"è¯·æ±‚å¤±è´¥: {e}")
        return None
```

#### 4.3.2 æ€§èƒ½ç›‘æ§

```python
http = NbAioHttpClient(
    log_timeout_seconds=2.0,  # è¶…è¿‡ 2 ç§’çš„è¯·æ±‚å°†è¢«è®°å½•
)

async def monitor_slow_requests():
    # æ…¢è¯·æ±‚ä¼šè‡ªåŠ¨è¢«è®°å½•åˆ°æ—¥å¿—
    resp = await http.get('https://slow-api.com/data')
```

#### 4.3.3 è‡ªå®šä¹‰è¯·æ±‚å¤´å’Œ Cookies

```python
http = NbAioHttpClient(
    headers={
        'User-Agent': 'MyApp/1.0',
        'Authorization': 'Bearer YOUR_TOKEN',
    },
    cookies={
        'session_id': 'abc123',
    }
)

async def custom_request():
    # ä½¿ç”¨å…¨å±€é…ç½®çš„ headers å’Œ cookies
    resp = await http.get('https://api.example.com/user')
    
    # æˆ–è€…ä¸´æ—¶è¦†ç›–
    resp = await http.get(
        'https://api.example.com/admin',
        headers={'Authorization': 'Bearer ADMIN_TOKEN'}
    )
```

#### 4.3.4 å®Œæ•´çš„ HTTP æ–¹æ³•æ”¯æŒ

```python
http = NbAioHttpClient()

# æ”¯æŒæ‰€æœ‰å¸¸ç”¨ HTTP æ–¹æ³•
await http.get(url)
await http.post(url, json=data)
await http.put(url, json=data)
await http.delete(url)
await http.patch(url, json=data)
await http.head(url)
await http.options(url)
```

## 5. ğŸ“Š æ€§èƒ½å¯¹æ¯”

### 5.1 å®æµ‹æ•°æ®

åŸºäºçœŸå®å‹æµ‹åœºæ™¯ï¼ˆ200 å¹¶å‘ï¼Œ20ä¸‡æ¬¡è¯·æ±‚ï¼‰ï¼š

| HTTP å®¢æˆ·ç«¯ | å¼‚æ­¥æ€§èƒ½ | åŒæ­¥æ€§èƒ½ | æ˜“ç”¨æ€§ | å…¨å±€å®ä¾‹åŒ– |
|------------|---------|---------|-------|-----------|
| **nb_aiohttp (å¼‚æ­¥)** | âš¡âš¡âš¡âš¡âš¡ | - | â­â­â­â­â­ | âœ… |
| **nb_aiohttp (åŒæ­¥)** | - | âš¡âš¡âš¡âš¡ | â­â­â­â­â­ | âœ… |
| aiohttp (åŸç”Ÿ) | âš¡âš¡âš¡âš¡âš¡ | - | â­â­ | âŒ |
| httpx (å¼‚æ­¥) | âš¡ | - | â­â­â­â­ | âœ… |
| httpx (åŒæ­¥) | - | âš¡âš¡ | â­â­â­â­ | âœ… |
| requests | - | âš¡ | â­â­â­â­â­ | âœ… |

### 5.2 æ€§èƒ½ç»“è®º

- ğŸ† **å¼‚æ­¥åœºæ™¯**: `nb_aiohttp` â‰ˆ åŸç”Ÿ `aiohttp` > `httpx` (5å€)
- ğŸ† **åŒæ­¥åœºæ™¯**: `nb_aiohttp` > `httpx` (2å€) > `requests` (4å€)
- ğŸ¯ **æ˜“ç”¨æ€§**: `nb_aiohttp` = `requests` > `httpx` > åŸç”Ÿ `aiohttp`

### 5.3 ä»£ç å¯¹æ¯”

#### 5.3.1 åŸç”Ÿ aiohttp - ç¹çå†—é•¿

```python
import aiohttp
import asyncio

async def fetch():
    # âŒ ä¸èƒ½å…¨å±€å®ä¾‹åŒ–
    # âŒ éœ€è¦ 2 æ¬¡ async with
    # âŒ éœ€è¦ 3 æ¬¡ await
    async with aiohttp.ClientSession() as session:
        async with session.get('https://api.github.com') as response:
            if response.status == 200:
                text = await response.text()
                data = await response.json()
                print(data)
```

#### 5.3.2 nb_aiohttp - æè‡´ç®€æ´

```python
from nb_aiohttp import NbAioHttpClient
import asyncio

# âœ… å…¨å±€å®ä¾‹åŒ–
http = NbAioHttpClient()

async def fetch():
    # âœ… ä»…éœ€ 1 æ¬¡ await
    # âœ… è‡ªåŠ¨å¤„ç†çŠ¶æ€ç 
    # âœ… ç›´æ¥è·å–æ•°æ®
    resp = await http.get('https://api.github.com')
    print(resp.dict)
```

**ä»£ç é‡å‡å°‘ 70%ï¼Œå¯è¯»æ€§æå‡ 300%ï¼**

## 6. ğŸ“š API æ–‡æ¡£

### 6.1 NbAioHttpClient (å¼‚æ­¥å®¢æˆ·ç«¯)

#### 6.1.1 æ„é€ å‡½æ•°

```python
NbAioHttpClient(
    *,
    timeout: int | float = 30,
    connector_limit: int = 100,
    max_retries: int = 3,
    is_raise_for_status: bool = True,
    log_timeout_seconds: int | float | None = None,
    is_log_error: bool = True,
    connector: BaseConnector = None,
    headers: dict = None,
    cookies: dict = None,
    **kwargs
)
```

**å‚æ•°è¯´æ˜:**

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|-----|------|-------|------|
| `timeout` | int/float | 30 | è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ |
| `connector_limit` | int | 100 | TCP è¿æ¥æ± å¤§å° |
| `max_retries` | int | 3 | å¤±è´¥é‡è¯•æ¬¡æ•° |
| `is_raise_for_status` | bool | True | 4xx/5xx çŠ¶æ€ç æ˜¯å¦æŠ›å¼‚å¸¸ |
| `log_timeout_seconds` | int/float | None | æ…¢è¯·æ±‚è®°å½•é˜ˆå€¼ï¼ˆç§’ï¼‰ |
| `is_log_error` | bool | True | æ˜¯å¦è®°å½•é”™è¯¯æ—¥å¿— |
| `connector` | BaseConnector | None | è‡ªå®šä¹‰è¿æ¥å™¨ |
| `headers` | dict | None | é»˜è®¤è¯·æ±‚å¤´ |
| `cookies` | dict | None | é»˜è®¤ Cookies |

#### 6.1.2 ä¸»è¦æ–¹æ³•

```python
# HTTP è¯·æ±‚æ–¹æ³•
await http.get(url, **kwargs) -> NbHttpResp
await http.post(url, **kwargs) -> NbHttpResp
await http.put(url, **kwargs) -> NbHttpResp
await http.delete(url, **kwargs) -> NbHttpResp
await http.patch(url, **kwargs) -> NbHttpResp
await http.head(url, **kwargs) -> NbHttpResp
await http.options(url, **kwargs) -> NbHttpResp

# é€šç”¨è¯·æ±‚æ–¹æ³•
await http.request(method, url, **kwargs) -> NbHttpResp

# ç”Ÿå‘½å‘¨æœŸç®¡ç†
await http.ensure_session()  # ç¡®ä¿ session å·²åˆ›å»º
await http.close()           # å…³é—­ session

# Context Manager æ”¯æŒ
async with NbAioHttpClient() as client:
    resp = await client.get(url)
```

### 6.2 NbSyncHttpClient (åŒæ­¥å®¢æˆ·ç«¯)

#### 6.2.1 æ„é€ å‡½æ•°

```python
NbSyncHttpClient(**kwargs)  # å‚æ•°ä¸ NbAioHttpClient ç›¸åŒ
```

#### 6.2.2 ä¸»è¦æ–¹æ³•

```python
# å¯åŠ¨åå°äº‹ä»¶å¾ªç¯ï¼ˆå¿…é¡»é¦–å…ˆè°ƒç”¨ï¼‰
http.run_forever()

# HTTP è¯·æ±‚æ–¹æ³•ï¼ˆåŒæ­¥è°ƒç”¨ï¼‰
http.get(url, **kwargs) -> NbHttpResp
http.post(url, **kwargs) -> NbHttpResp
http.put(url, **kwargs) -> NbHttpResp
http.delete(url, **kwargs) -> NbHttpResp
http.patch(url, **kwargs) -> NbHttpResp
http.head(url, **kwargs) -> NbHttpResp
http.options(url, **kwargs) -> NbHttpResp

# é€šç”¨è¯·æ±‚æ–¹æ³•
http.request(method, url, **kwargs) -> NbHttpResp
```

### 6.3 NbHttpResp (å“åº”å¯¹è±¡)

ç»Ÿä¸€å°è£…çš„å“åº”å¯¹è±¡ï¼Œæä¾›ä¾¿æ·çš„æ•°æ®è®¿é—®æ¥å£ï¼š

```python
class NbHttpResp:
    text: str          # å“åº”æ–‡æœ¬å†…å®¹
    status: int        # HTTP çŠ¶æ€ç 
    headers: dict      # å“åº”å¤´
    url: str           # è¯·æ±‚çš„ URL
    
    @property
    def dict(self) -> dict:
        """å°† JSON å“åº”è§£æä¸ºå­—å…¸"""
        
    @property
    def ok(self) -> bool:
        """çŠ¶æ€ç æ˜¯å¦ä¸º 2xx"""
```

#### 6.3.1 ä½¿ç”¨ç¤ºä¾‹

```python
resp = await http.get('https://api.github.com/users/github')

print(resp.status)        # 200
print(resp.ok)            # True
print(resp.text[:100])    # å“åº”æ–‡æœ¬å‰ 100 å­—ç¬¦
print(resp.dict['name'])  # ç›´æ¥è®¿é—® JSON æ•°æ®
print(resp.headers)       # å“åº”å¤´å­—å…¸
print(resp.url)           # å®é™…è¯·æ±‚çš„ URL
```

## 7. ğŸ¯ ä½¿ç”¨åœºæ™¯

### 7.1 ğŸ”¹ é«˜å¹¶å‘ Web æœåŠ¡

```python
from fastapi import FastAPI
from nb_aiohttp import NbAioHttpClient

app = FastAPI()
http = NbAioHttpClient(connector_limit=500)  # å…¨å±€å®ä¾‹

@app.get("/proxy")
async def proxy_request():
    # è¶…é«˜å¹¶å‘ä¸‹ä¾ç„¶ç¨³å®š
    resp = await http.get('https://api.example.com/data')
    return resp.dict
```

### 7.2 ğŸ”¹ å¼‚æ­¥çˆ¬è™«

```python
from nb_aiohttp import NbAioHttpClient
import asyncio

http = NbAioHttpClient(
    timeout=30,
    max_retries=5,
    connector_limit=200,
)

async def crawl(url):
    try:
        resp = await http.get(url)
        # å¤„ç†æ•°æ®
        return resp.text
    except Exception as e:
        print(f"çˆ¬å–å¤±è´¥: {url}, é”™è¯¯: {e}")

async def main():
    urls = ['https://example.com/page' + str(i) for i in range(1000)]
    tasks = [crawl(url) for url in urls]
    results = await asyncio.gather(*tasks)
    print(f"å®Œæˆ {len(results)} ä¸ªé¡µé¢çš„çˆ¬å–")

asyncio.run(main())
```

### 7.3 ğŸ”¹ å¾®æœåŠ¡è°ƒç”¨

```python
from nb_aiohttp import NbAioHttpClient

# ä¸åŒæœåŠ¡çš„å®¢æˆ·ç«¯
user_service = NbAioHttpClient(timeout=5)
order_service = NbAioHttpClient(timeout=10)
payment_service = NbAioHttpClient(timeout=15)

async def create_order(user_id, product_id):
    # å¹¶å‘è°ƒç”¨å¤šä¸ªæœåŠ¡
    user_resp, product_resp = await asyncio.gather(
        user_service.get(f'http://user-service/users/{user_id}'),
        order_service.get(f'http://product-service/products/{product_id}')
    )
    
    # åˆ›å»ºè®¢å•
    order_resp = await order_service.post(
        'http://order-service/orders',
        json={
            'user': user_resp.dict,
            'product': product_resp.dict,
        }
    )
    
    return order_resp.dict
```

### 7.4 ğŸ”¹ åŒæ­¥è„šæœ¬

```python
from nb_aiohttp import NbSyncHttpClient

http = NbSyncHttpClient().run_forever()

# åœ¨ä»»ä½•åŒæ­¥ä»£ç ä¸­ä½¿ç”¨
def batch_process():
    urls = ['https://api.example.com/item/' + str(i) for i in range(100)]
    
    for url in urls:
        resp = http.get(url)
        if resp.ok:
            print(f"å¤„ç†æˆåŠŸ: {resp.dict}")
        else:
            print(f"å¤„ç†å¤±è´¥: {resp.status}")

batch_process()
```

## 8. ğŸ”§ é«˜çº§é…ç½®

### 8.1 è‡ªå®šä¹‰ Connector

```python
import aiohttp
from nb_aiohttp import NbAioHttpClient

# è‡ªå®šä¹‰ SSL å’Œ DNS é…ç½®
connector = aiohttp.TCPConnector(
    limit=200,
    ttl_dns_cache=300,
    ssl=False,
)

http = NbAioHttpClient(connector=connector)
```

### 8.2 ä»£ç†è®¾ç½®

```python
http = NbAioHttpClient()

# ä½¿ç”¨ä»£ç†
resp = await http.get(
    'https://api.example.com',
    proxy='http://proxy.example.com:8080'
)
```

### 8.3 ä¸Šä¼ æ–‡ä»¶

```python
http = NbAioHttpClient()

# ä¸Šä¼ æ–‡ä»¶
with open('file.txt', 'rb') as f:
    resp = await http.post(
        'https://api.example.com/upload',
        data={'file': f}
    )
```

### 8.4 æµå¼ä¸‹è½½

```python
http = NbAioHttpClient()

# è®¿é—®åº•å±‚ aiohttp session è¿›è¡Œæµå¼æ“ä½œ
await http.ensure_session()
async with http.session.get('https://example.com/large-file.zip') as response:
    with open('downloaded.zip', 'wb') as f:
        async for chunk in response.content.iter_chunked(1024):
            f.write(chunk)
```

## 9. ğŸ¤” å¸¸è§é—®é¢˜

### 9.1 Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ aiohttpï¼Ÿ

**A:** åŸç”Ÿ aiohttp è™½ç„¶æ€§èƒ½å“è¶Šï¼Œä½† API è®¾è®¡å¤æ‚ï¼š
- âŒ ä¸èƒ½åœ¨å…¨å±€ä½œç”¨åŸŸå®ä¾‹åŒ– `ClientSession`
- âŒ éœ€è¦ 2 æ¬¡ `async with` å’Œå¤šæ¬¡ `await`
- âŒ ç¼ºå°‘è‡ªåŠ¨é‡è¯•ç­‰ä¼ä¸šçº§ç‰¹æ€§

nb_aiohttp ä¿ç•™äº† aiohttp çš„æ€§èƒ½ä¼˜åŠ¿ï¼ŒåŒæ—¶æä¾›äº†æ›´å‹å¥½çš„ APIã€‚

### 9.2 Q: ä¸ httpx ç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ

**A:** 
- âš¡ **æ€§èƒ½**: å¼‚æ­¥æ€§èƒ½æ˜¯ httpx çš„ 5 å€
- ğŸ¯ **ç®€æ´**: API è®¾è®¡æ›´åŠ ç®€æ´ç›´è§‚
- ğŸ”„ **çµæ´»**: åŒæ—¶æä¾›å¼‚æ­¥å’ŒåŒæ­¥ä¸¤ç§æ¨¡å¼

### 9.3 Q: NbSyncHttpClient çš„æ€§èƒ½ä¸ºä»€ä¹ˆæ¯” requests å¥½ï¼Ÿ

**A:** NbSyncHttpClient åº•å±‚ä½¿ç”¨ aiohttp å¼‚æ­¥å¼•æ“ï¼Œé€šè¿‡äº‹ä»¶å¾ªç¯è½¬æ¢ä¸ºåŒæ­¥æ¥å£ï¼Œæ€§èƒ½è¿œè¶…ä¼ ç»Ÿçš„åŒæ­¥é˜»å¡æ¨¡å‹ã€‚

### 9.4 Q: æ˜¯å¦æ”¯æŒ HTTP/2ï¼Ÿ

**A:** ç›®å‰åŸºäº aiohttpï¼Œæš‚ä¸æ”¯æŒ HTTP/2ã€‚å¦‚æœä½ çš„åœºæ™¯å¼ºä¾èµ– HTTP/2ï¼Œå»ºè®®ä½¿ç”¨ httpxã€‚

### 9.5 Q: å¦‚ä½•å¤„ç†è¯·æ±‚å¤±è´¥ï¼Ÿ

**A:** 
```python
http = NbAioHttpClient(
    max_retries=5,           # è‡ªåŠ¨é‡è¯• 5 æ¬¡
    is_raise_for_status=True # å¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸
)

try:
    resp = await http.get(url)
except Exception as e:
    # å¤„ç†å¼‚å¸¸
    print(f"è¯·æ±‚å¤±è´¥: {e}")
```



## 10. ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT åè®®](https://opensource.org/licenses/MIT) å¼€æºã€‚


## 20 å„ç§ä¸‰æ–¹åŒ…çš„httpå®¢æˆ·ç«¯æ¯è¯·æ±‚ 10000æ¬¡ httpçš„ è€—æ—¶

[![pZCRiPe.png](https://s21.ax1x.com/2025/11/13/pZCRiPe.png)](https://imgchr.com/i/pZCRiPe)

### 20.1 å®æµ‹å¯¹æ¯”ä¾èµ–çš„ä¸‰æ–¹åŒ…è¯´æ˜

- pip install nb_libs   
thread_show_process_cpu_usage éœ€è¦ç”¨è¿™ä¸ªå‡½æ•°ç›‘æ§å½“å‰è¿›ç¨‹çš„cpuï¼Œé€šè¿‡å½“å‰è¿›ç¨‹cpuä½¿ç”¨ç‡çš„æ‰“å°ï¼Œè®©ä½ æ¸…æ¸…æ¥šæ¥šåˆ°åº•æ˜¯æœåŠ¡ç«¯æ€§èƒ½ä¸è¡Œè¿˜æ˜¯å®¢æˆ·ç«¯æ€§èƒ½ä¸è¡Œï¼Ÿè®©ä½ æ¸…æ¸…æ¥šæ¥šçŸ¥é“æ˜¯å®¢æˆ·ç«¯cpuè¾¾åˆ°100%äº†ï¼Œæ‰€ä»¥è¯·æ±‚æ¬¡æ•°æ— æ³•å¾€ä¸Šçªç ´

- pip install  nb_aiopool
 å¼‚æ­¥å¹¶å‘æ± ï¼Œæ¯”æ— è„‘ asyncio.create_task 10ä¸‡ä»»åŠ¡ + asyncio.Semaphore(100) é™åˆ¶å¹¶å‘ï¼Œ å†…å­˜å’Œcpuå¥½å¤ªå¤š

- pip install  threadpool_executor_shrink_able
 åŒæ­¥å¹¶å‘æ± ï¼Œä¸»è¦æ˜¯æœ‰ç•Œé˜Ÿåˆ—ï¼Œä¹Ÿå¯ä»¥ç”¨ concurrent.futures.ThreadPoolExecutor ï¼Œä½†æ˜¯å®ƒæ˜¯æ— ç•Œé˜Ÿåˆ—ï¼Œã€‚

### 20.2 é€šè¿‡ä»£ç å®æµ‹ benchmark

é€šè¿‡æ§åˆ¶å°çš„ æ—¥å¿—è§‚å¯Ÿå¾—åˆ°

ä¾‹å¦‚ï¼š
```
ç¬¬ 20000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:29:20 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"} 
ç¬¬ 30000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:29:35 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}
```

#### 20.2.1 aiohttp.ClientSession()
- è€—æ—¶15ç§’   
ç¬¬ 1000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:37:07 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}  
ç¬¬ 11000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:37:22 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}  

#### 20.2.2 httpx.AsyncClient()
- è€—æ—¶50ç§’   
ç¬¬ 1000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:44:17 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}
ç¬¬ 11000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:45:07 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}

#### 20.2.3 nb_aiohttp.NbAioHttpClient
- è€—æ—¶13ç§’
ç¬¬ 1000 æ¬¡ å“åº”æ—¶é—´ï¼š 10:58:32 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}
ç¬¬ 11000 æ¬¡ å“åº”æ—¶é—´ï¼š 10:58:45 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"} 

### 20.2.4 requests.Session()  
- è€—æ—¶40ç§’
ç¬¬ 2000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:34:25 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}
ç¬¬ 12000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:35:05 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"} 

#### 20.2.5 nb_aiohttp.NbSyncHttpClient
- è€—æ—¶ 15ç§’   
ç¬¬ 20000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:29:20 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}   
ç¬¬ 30000 æ¬¡ å“åº”æ—¶é—´ï¼š  10:29:35 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}  

#### 20.2.6 nb_http_client.ObjectPool
- è€—æ—¶4ç§’  
ç¬¬ 11000 æ¬¡ å“åº”æ—¶é—´ï¼š 11:07:49 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"} 
ç¬¬ 21000 æ¬¡ å“åº”æ—¶é—´ï¼š 11:07:53 {"message":"æ¬¢è¿æ¥åˆ°aio1 ç¤ºä¾‹ API!"}


### 20.10 å°ç»“

#### 20.10.1 nb_http_clientï¼š

nb_http_client å’Œ nb_aiohttp æ˜¯åŒä¸€ä¸ªä½œè€…ã€‚

nb_http_client æ€§èƒ½åŠæ‰“pythonåŒæ­¥å’Œå¼‚æ­¥ç¼–ç¨‹ä¸–ç•Œçš„ ä»»ä½•httpå®¢æˆ·ç«¯è¯·æ±‚ä¸‰æ–¹åŒ…ï¼Œæ˜¯çœŸæ­£çš„ **ç‹ä¸­ç‹ï¼Œç¥ä¸­ç¥**ã€‚  
nb_http_client æ€§èƒ½å¼ºæ‚æ˜¯å› ä¸ºåŸºäºæˆ‘çš„ ä¸‡èƒ½å¯¹è±¡æ±  universal_object_pool  + python å†…ç½®çš„éå¸¸åº•å±‚çš„ http æ¨¡å— æ‰“é€ çš„ httpè¿æ¥æ± ã€‚  

- `nb_http_client` æ˜¯ ydf0509çš„ pythonä¸‡èƒ½å¯¹è±¡æ± çš„ `universal_object_pool` æ¼”ç¤ºçš„ä¸€ä¸ªé™„å±å“è€Œå·²ã€‚   
`nb_http_client` æ˜¯ç”¨æ¥æ˜¾ç¤º `universal_object_pool` è¿™ä¸ªä¸‡èƒ½å¯¹è±¡æ± å¦‚ä½•ç¥é€šå¹¿å¤§çš„ä¸‡èƒ½ï¼Œå¯ä»¥å®ç°ä»»ä½•è¿æ¥æ± ï¼ŒåŒ…æ‹¬**æ•°æ®åº“è¿æ¥æ± **å’Œ**httpè¿æ¥æ± **ä»¥åŠ**pythonå¯¹è±¡æ± **

- `nb_http_client`æ²¡æœ‰è¿‡äºç²¾å¿ƒæ‰“ç£¨æˆäººæ€§åŒ–å¥½ç”¨,éš¾ç”¨æ˜¯éš¾ç”¨äº†ä¸€ç‚¹ã€‚   
ä½†æ˜¯ç”¨åœ¨å…¬å¸å†…éƒ¨çš„httpæœåŠ¡é—´è°ƒç”¨è¶³å¤Ÿäº†ï¼Œä½ å¯ä»¥å†å¯¹ä»–äºŒæ¬¡å°è£…æˆä¸€ä¸ªä½ è‡ªå·±çš„è¯·æ±‚å‡½æ•° utils/my_request ï¼Œæ€§èƒ½åŠæ‰“requests 10å€ï¼Œç»™ä½ çš„æœåŠ¡å™¨èŠ‚çº¦å¤§é‡cpu

- **ä¼˜ç‚¹**ï¼š
   - æ€§èƒ½å¥½ï¼Œåœ¨åŒæ­¥åŒ…é‡Œé¢ nb_http_client.ObjectPool æ˜¯ç¥ä¸­ç¥çº§åˆ«ï¼Œpython æœ‰å²ä»¥æ¥çš„httpè¯·æ±‚åŒ…ï¼Œæ€§èƒ½çš„ç‹ä¸­ç‹ã€‚
   - è¿æ¥æ± ç»‘å®šäº†hostå’Œportï¼Œä»¥åŠå‘é€è¯·æ±‚ç›¸å¯¹äºå°è£…å®Œå–„çš„requests å’Œ aiohttp httpxä»¬ï¼Œä¸å¤Ÿäººæ€§åŒ–
- **ç¼ºç‚¹**ï¼š
   - ä¸å¤ªå¥½ç”¨ï¼Œè¿æ¥æ± ç»‘å®šäº†hostå’Œportï¼Œä¸èƒ½å¼ å† ææˆ´å¯¹åˆ«çš„åŸŸåå‘è¯·æ±‚ï¼›
   - ä¸å¤Ÿäººæ€§åŒ–ï¼Œå‘é€è¯·æ±‚ç›¸å¯¹äºå°è£…å®Œå–„çš„é«˜çº§åŒ…ï¼Œrequests å’Œ aiohttp httpxä»¬ï¼Œä½¿ç”¨æ²¡é‚£ä¹ˆæ–¹ä¾¿ï¼Œä½†ä½ å¯ä»¥äºŒæ¬¡å°è£…æˆä½ çš„ utils/my_request å‡½æ•°ã€‚

#### 20.10.2  nb_aiohttp

- nb_aiohttp æœ‰ NbAioHttpClient å’Œ NbSyncHttpClient ä¸¤ä¸ªç±»ï¼Œ å¦‚åŒhttpx.AsyncClient() å’Œ httpx.Client() ä¸€æ ·ï¼Œä¸¤ä¸ªç±»åˆ†åˆ«ç”¨äºåŒæ­¥ç¼–ç¨‹å’Œå¼‚æ­¥ç¼–ç¨‹ã€‚

- `nb_aiohttp` çš„å¥½å¤„æ˜¯ ä½¿ç”¨æ–¹ä¾¿ç¨‹åº¦å’Œ `httpx/requests` ä¸€æ ·ï¼Œ æ€§èƒ½ç¨‹åº¦å’Œ`aiohttp`ä¸€æ ·ã€‚
- httpxä½¿ç”¨æ¯”aiohttpæ–¹ä¾¿
- aiohttp æ€§èƒ½åŠæ‰“ httpx
  



## 30. ğŸ™ è‡´è°¢

- æ„Ÿè°¢ [aiohttp](https://github.com/aio-libs/aiohttp) æä¾›äº†å¼ºå¤§çš„å¼‚æ­¥ HTTP å¼•æ“
- æ„Ÿè°¢ [nb_log](https://github.com/ydf0509/nb_log) æä¾›äº†ä¼˜ç§€çš„æ—¥å¿—è§£å†³æ–¹æ¡ˆ

## 40. ğŸ“® è”ç³»æ–¹å¼

- **GitHub**: [https://github.com/ydf0509/nb_aiohttp](https://github.com/ydf0509/nb_aiohttp)
- **é—®é¢˜åé¦ˆ**: [https://github.com/ydf0509/nb_aiohttp/issues](https://github.com/ydf0509/nb_aiohttp/issues)


---

<div align="center">

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª Starï¼â­**

**è®© HTTP è¯·æ±‚æ›´å¿«ã€æ›´ç®€å•ã€æ›´ä¼˜é›…ï¼**

Made with â¤ï¸ by ydf0509

</div>

