when:
  - event: tag
    branch: main

depends_on:
  - test

steps:
  build_and_publish:
    image: node:23-alpine
    commands:
      - echo //codeberg.org/api/packages/bovine/npm/:_authToken=$NPM_ACCESS_TOKEN  > ~/.npmrc
      - echo @bovine:registry=https://codeberg.org/api/packages/bovine/npm/ >> ~/.npmrc
      - npm install
      - npm publish
    environment:
      NPM_ACCESS_TOKEN: { from_secret: codeberg_npm_token }
