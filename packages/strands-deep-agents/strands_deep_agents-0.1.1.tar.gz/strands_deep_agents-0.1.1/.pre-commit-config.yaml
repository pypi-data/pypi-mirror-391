repos:
  # General file checks and auto-fixes
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
      - id: end-of-file-fixer
        name: Fix end of files
      - id: check-yaml
        name: Check YAML syntax
      - id: check-toml
        name: Check TOML syntax
      - id: check-added-large-files
        name: Check for large files
        args: ["--maxkb=500"]
      - id: check-merge-conflict
        name: Check for merge conflicts
      - id: check-case-conflict
        name: Check for case conflicts
      - id: mixed-line-ending
        name: Fix mixed line endings
        args: ["--fix=lf"]
      - id: debug-statements
        name: Check for debug statements

  # Python import sorting (auto-fix)
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        name: Sort imports with isort
        args: ["--profile=black", "--line-length=100"]

  # Python code formatting (auto-fix)
  - repo: https://github.com/psf/black
    rev: 24.1.1
    hooks:
      - id: black
        name: Format code with black
        language_version: python3
        args: ["--line-length=100"]

  # Python linting with ruff (auto-fix when possible)
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.2.1
    hooks:
      - id: ruff
        name: Lint with ruff
        args: ["--fix", "--line-length=100", "--ignore=F841"]
        types_or: [python, pyi]

  # Type checking with mypy (optional - currently disabled due to pre-existing type issues)
  # Uncomment when ready to enforce strict type checking
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.8.0
  #   hooks:
  #     - id: mypy
  #       name: Type check with mypy
  #       additional_dependencies: [
  #         'boto3-stubs',
  #         'types-requests',
  #       ]
  #       args: ['--ignore-missing-imports', '--python-version=3.9']
  #       files: ^src/

  # Run targeted tests on changed files before commit
  - repo: local
    hooks:
      - id: pytest-changed
        name: Run pytest on changed files
        entry: bash -c 'if git diff --cached --name-only --diff-filter=ACMR | grep -E "^(src/|tests/).*\.py$"; then source .venv/bin/activate && pytest -v; fi'
        language: system
        pass_filenames: false
        types: [python]
        stages: [pre-commit]

  # Run all tests before push
  - repo: local
    hooks:
      - id: pytest-all
        name: Run all pytest tests
        entry: bash -c 'source .venv/bin/activate && pytest -v'
        language: system
        pass_filenames: false
        types: [python]
        stages: [pre-push]

# Global configuration
default_stages: [pre-commit]
fail_fast: false
