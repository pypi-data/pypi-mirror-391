"use strict";(self.webpackChunkjupyterlab_markdown_viewer_toc_fix=self.webpackChunkjupyterlab_markdown_viewer_toc_fix||[]).push([[509],{509:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var o=n(669),r=n(512),i=n(975),a=n(7);function c(e,t,n){var o;let r;try{const i=e.startsWith("#")?e.slice(1):e,a=CSS.escape(i),c=n.sanitizer,s=null!==(o=null==c?void 0:c.allowNamedProperties)&&void 0!==o&&o,d=s?`#${a}`:`[data-jupyter-id="${a}"]`;if(r=t.querySelector(d),!r){const e=s?`[data-jupyter-id="${a}"]`:`#${a}`;r=t.querySelector(e)}if(!r){const e=t.querySelectorAll("[data-jupyter-id], [id]"),n=i.toLowerCase();for(const t of Array.from(e))if((t.getAttribute("data-jupyter-id")||t.getAttribute("id")||"").toLowerCase()===n){r=t;break}}}catch(e){return!1}return!!r&&(r.scrollIntoView({behavior:"smooth",block:"start"}),!0)}function s(e,t){const n=e.content;if(!n||!n.setFragment)return;const o=n.setFragment.bind(n);n.setFragment=function(e){c(e,n.node,t)||o(e)};const r=()=>{const o=window.location.hash;o&&e.isVisible&&setTimeout(()=>{c(o,n.node,t)},100)};n.rendered.connect(()=>{setTimeout(()=>{n.node},50);const e=window.location.hash;e&&setTimeout(()=>{c(e,n.node,t)},100)}),window.addEventListener("hashchange",r),e.disposed.connect(()=>{window.removeEventListener("hashchange",r)})}function d(e,t,n){setTimeout(()=>{const o=t.get(e);o&&o.activeHeadingChanged.connect(async(t,o)=>{var r;if(!o)return;const i=n.sanitizer,c=null!==(r=null==i?void 0:i.allowNamedProperties)&&void 0!==r&&r?"id":"data-jupyter-id",s=t.parser;if(s)try{const t=o.raw||o.text,n=await a.TableOfContentsUtils.Markdown.getHeadingId(s,t,o.level,i);if(!n)return;const r=`h${o.level}[${c}="${CSS.escape(n)}"]`,d=e.content.node.querySelector(r);d&&d.scrollIntoView({behavior:"smooth",block:"start"})}catch(e){}})},100)}const l={id:"jupyterlab_markdown_viewer_toc_fix:plugin",description:"Fixes TOC navigation and anchor links in Markdown Viewer for JupyterLab 4.x",autoStart:!0,requires:[r.IMarkdownViewerTracker,i.IRenderMimeRegistry,a.ITableOfContentsTracker],optional:[o.IRouter],activate:(e,t,n,o,r)=>{!function(e){const t=Object.getPrototypeOf(e.createRenderer("text/html"));if(!t||!t.setFragment)return;const n=t.setFragment;t.setFragment=function(e){let t;try{const n=e.startsWith("#")?e.slice(1):e,o=CSS.escape(n);t=this.node.querySelector(`#${o}`)||this.node.querySelector(`[data-jupyter-id="${o}"]`)}catch(e){}t?t.scrollIntoView():n.call(this,e)}}(n),function(e,t,n){e.forEach(e=>{d(e,t,n),s(e,n)}),e.widgetAdded.connect((e,o)=>{d(o,t,n),s(o,n)})}(t,o,n),r&&r.routed.connect(()=>{const e=window.location.hash;if(e){const o=t.currentWidget;o&&o.content&&setTimeout(()=>{c(e,o.content.node,n)},300)}}),window.addEventListener("hashchange",()=>{const e=t.currentWidget;e&&e.content&&setTimeout(()=>{c(window.location.hash,e.content.node,n)},100)})}}}}]);