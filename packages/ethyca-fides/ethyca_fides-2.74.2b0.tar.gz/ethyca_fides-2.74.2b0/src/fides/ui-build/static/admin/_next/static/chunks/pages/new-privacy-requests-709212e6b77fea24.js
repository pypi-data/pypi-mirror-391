(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9609,9676],{74833:function(e,t,n){var i=n(56127),a=/^\s+/;e.exports=function(e){return e?e.slice(0,i(e)+1).replace(a,""):e}},56127:function(e){var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},66726:function(e,t,n){var i=n(11611),a=n(82846),s=n(91936),r=Math.max,l=Math.min;e.exports=function(e,t,n){var o,c,u,d,g,f,p=0,m=!1,h=!1,x=!0;if("function"!=typeof e)throw TypeError("Expected a function");function y(t){var n=o,i=c;return o=c=void 0,p=t,d=e.apply(i,n)}function v(e){var n=e-f,i=e-p;return void 0===f||n>=t||n<0||h&&i>=u}function j(){var e,n,i,s=a();if(v(s))return b(s);g=setTimeout(j,(e=s-f,n=s-p,i=t-e,h?l(i,u-n):i))}function b(e){return(g=void 0,x&&o)?y(e):(o=c=void 0,d)}function E(){var e,n=a(),i=v(n);if(o=arguments,c=this,f=n,i){if(void 0===g)return p=e=f,g=setTimeout(j,t),m?y(e):d;if(h)return clearTimeout(g),g=setTimeout(j,t),y(f)}return void 0===g&&(g=setTimeout(j,t)),d}return t=s(t)||0,i(n)&&(m=!!n.leading,u=(h="maxWait"in n)?r(s(n.maxWait)||0,t):u,x="trailing"in n?!!n.trailing:x),E.cancel=function(){void 0!==g&&clearTimeout(g),p=0,o=f=c=g=void 0},E.flush=function(){return void 0===g?d:b(a())},E}},82846:function(e,t,n){var i=n(77400);e.exports=function(){return i.Date.now()}},91936:function(e,t,n){var i=n(74833),a=n(11611),s=n(55193),r=0/0,l=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(s(e))return r;if(a(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=a(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=i(e);var n=o.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):l.test(e)?r:+e}},89987:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/new-privacy-requests",function(){return n(62292)}])},30952:function(e,t,n){"use strict";n.d(t,{f:function(){return o}});var i=n(24246),a=n(66726),s=n.n(a),r=n(27378),l=n(26917);let o=e=>{let{value:t,onChange:n,placeholder:a,...o}=e,[c,u]=(0,r.useState)(t);(0,r.useEffect)(()=>{u(t||"")},[t]);let d=s()(n,500),g=(0,r.useCallback)(e=>{u(e),d(e)},[]);return(0,i.jsx)(l.Z,{value:c,onChange:g,onClear:()=>{u(""),n("")},placeholder:a,...o})}},58754:function(e,t,n){"use strict";var i=n(24246),a=n(98227),s=n(70788);t.Z=e=>{let{heading:t,breadcrumbItems:n,isSticky:r=!0,children:l,rightContent:o,style:c,...u}=e;return(0,i.jsxs)("div",{...u,style:r?{position:"sticky",top:"-24px",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"40px",marginLeft:"-40px",paddingRight:"40px",marginRight:"-40px",marginTop:"-24px",left:0,zIndex:20,backgroundColor:"white",...c}:{paddingBottom:"24px",...c},children:[(0,i.jsxs)(a.jqI,{justify:"space-between",children:["string"==typeof t?(0,i.jsx)(a.lQT,{className:n||l?"pb-4":void 0,level:1,"data-testid":"page-heading",children:t}):t,o&&(0,i.jsx)("div",{"data-testid":"page-header-right-content",children:o})]}),!!n&&(0,i.jsx)(s.m,{className:l?"pb-4":void 0,items:n,"data-testid":"page-breadcrumb"}),l]})}},45259:function(e,t,n){"use strict";var i=n(24246),a=n(98227);let s={approved:{color:a.tAb.SUCCESS,label:"Approved"},complete:{color:a.tAb.SUCCESS,label:"Completed"},awaiting_email_send:{color:a.tAb.MARBLE,label:"Awaiting Email Send"},denied:{color:a.tAb.WARNING,label:"Denied"},canceled:{color:a.tAb.MARBLE,label:"Canceled"},error:{color:a.tAb.ERROR,label:"Error"},in_processing:{color:a.tAb.CAUTION,label:"In Progress"},paused:{color:a.tAb.MARBLE,label:"Paused"},pending:{color:a.tAb.INFO,label:"New"},identity_unverified:{color:a.tAb.MARBLE,label:"Unverified"},requires_input:{color:a.tAb.MINOS,label:"Requires Input"},requires_manual_finalization:{color:a.tAb.MINOS,label:"Requires Finalization"},duplicate:{color:a.tAb.DEFAULT,label:"Duplicate"}};t.Z=e=>{let{status:t}=e;return(0,i.jsx)(a.j8w,{color:s[t].color,className:"justify-center","data-testid":"request-status-badge",children:s[t].label})}},70788:function(e,t,n){"use strict";n.d(t,{m:function(){return c}});var i=n(24246),a=n(98227),s=n(79894),r=n.n(s),l=n(27378);let{Text:o}=a.AntTypography,c=e=>{let{items:t,...n}=e,s=(0,l.useMemo)(()=>null==t?void 0:t.map((e,n)=>{let s=n===t.length-1,l={...e},c=l.onClick&&!l.href;return("string"==typeof l.title&&(l.title=(0,i.jsx)(o,{style:{color:"inherit",maxWidth:s?void 0:400},ellipsis:!s,id:s?"breadcrumb-current-page":void 0,children:l.title})),c)?l.title=(0,i.jsx)(a.wpx,{type:"text",size:"small",icon:l.icon,onClick:l.onClick,className:"ant-breadcrumb-link -mt-px px-1 text-inherit",children:l.title}):(l.icon&&(l.title=(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{className:"anticon align-text-bottom",children:l.icon}),l.title]})),l.href&&l.title&&(l.title=(0,i.jsx)(r(),{href:l.href,className:"ant-breadcrumb-link",children:l.title}),delete l.href)),l}),[t]);return(0,i.jsx)(a.zrq,{items:s,...n})}},42478:function(e,t,n){"use strict";n.d(t,{FU:function(){return c},JE:function(){return a},Ki:function(){return d},SU:function(){return g},W:function(){return f},h9:function(){return s},jc:function(){return i},qt:function(){return o},sn:function(){return u}});let{useGetEmailInviteStatusQuery:i,useGetActiveMessagingProviderQuery:a,useCreateMessagingConfigurationMutation:s,useCreateMessagingConfigurationSecretsMutation:r,useGetMessagingConfigurationDetailsQuery:l,useGetMessagingConfigurationsQuery:o,useGetMessagingConfigurationByKeyQuery:c,useUpdateMessagingConfigurationByKeyMutation:u,useUpdateMessagingConfigurationSecretsByKeyMutation:d,useCreateTestConnectionMessageMutation:g,useDeleteMessagingConfigurationByKeyMutation:f}=n(78780).u.injectEndpoints({endpoints:e=>({getEmailInviteStatus:e.query({query:()=>({url:"/messaging/email-invite/status"}),providesTags:()=>["Email Invite Status"]}),createMessagingConfiguration:e.mutation({query:e=>({url:"messaging/config",method:"POST",body:e}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getActiveMessagingProvider:e.query({queryFn:async(e,t,n,i)=>{let a=await i({url:"messaging/default/active"});return a.error&&404===a.error.status?{data:null}:a},providesTags:["Messaging Config"]}),createMessagingConfigurationSecrets:e.mutation({query:e=>({url:"messaging/default/".concat(e.service_type,"/secret"),method:"PUT",body:e.details}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getMessagingConfigurationDetails:e.query({query:e=>({url:"messaging/default/".concat(e.type)}),providesTags:["Messaging Config"]}),getMessagingConfigurations:e.query({query:()=>({url:"messaging/config"}),providesTags:["Messaging Config"]}),getMessagingConfigurationByKey:e.query({query:e=>({url:"messaging/config/".concat(e.key)}),providesTags:["Messaging Config"]}),createTestConnectionMessage:e.mutation({query:e=>({url:"messaging/test/".concat(e.service_type),method:"POST",body:e.details}),invalidatesTags:["Messaging Config"]}),updateMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"PATCH",body:e.config}),invalidatesTags:["Messaging Config","Configuration Settings"]}),updateMessagingConfigurationSecretsByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key,"/secret"),method:"PUT",body:e.secrets}),invalidatesTags:["Messaging Config","Configuration Settings"]}),deleteMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"DELETE"}),invalidatesTags:["Messaging Config","Configuration Settings"]})})})},59676:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var i=n(24246),a=n(98227),s=n(16134),r=n(27378),l=n(812),o=n(17245),c=n(90867);let u=(0,a.Gpc)((e,t)=>{let{handleBlur:n,subjectRequest:u}=e,d=(0,s.T)(),[g,f]=(0,r.useState)(!1),{errorAlert:p,successAlert:m}=(0,o.VY)(),{errorRequests:h}=(0,s.C)(c.fe),[x]=(0,c.JD)(),[y]=(0,c.Fq)(),v=async()=>{f(!0);let e=await x(h);(0,l.D4)(e)?(d((0,c.uT)({checkAll:!1,errorRequests:[]})),p((0,l.e$)(e.error),"DSR batch automation has failed due to the following:",{duration:null})):(e.data.failed.length>0&&p((0,i.jsxs)(a.xuv,{children:["DSR automation has failed for"," ",(0,i.jsx)(a.xvT,{as:"span",fontWeight:"semibold",children:e.data.failed.length})," ","privacy request(s). Please review the event log for further details."]}),void 0,{containerStyle:{maxWidth:"max-content"},duration:null}),e.data.succeeded.length>0&&m("Privacy request(s) are now being reprocessed.")),f(!1)},j=async()=>{if(!u)return;f(!0);let e=await y(u);(0,l.D4)(e)?p((0,l.e$)(e.error),"DSR automation has failed for this privacy request due to the following:",{duration:null}):m("Privacy request is now being reprocessed."),f(!1),n&&n(t)};return(0,i.jsx)(a.wpx,{disabled:g,loading:g,onClick:u?j:v,ref:t,size:"small",icon:(0,i.jsx)(a.AyE,{}),children:"Reprocess"})});var d=n(34090),g=n(55484);let f=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,p=e=>f.test(e),m=(0,a.Gpc)((e,t)=>{let{isRequired:n=!1,...s}=e,{emails:l}=s.form.values,[o,c]=(0,r.useState)(""),u=e=>l.includes(e),d=e=>{e.map(e=>e.trim()).filter(e=>p(e)&&!u(e)).forEach(e=>s.push(e)),c("")};return(0,i.jsxs)(a.NIc,{alignItems:"baseline",display:"inline-flex",isInvalid:!!s.form.errors[s.name],isRequired:n,children:[(0,i.jsx)(a.lXp,{fontSize:"md",htmlFor:"email",children:"Email"}),(0,i.jsxs)(a.gCW,{align:"flex-start",w:"inherit",children:[(0,i.jsx)(a.IIB,{autoComplete:"off",placeholder:"Type or paste email addresses separated by commas and press `Enter` or `Tab`...",onChange:e=>{c(e.target.value)},onKeyDown:e=>{["Enter","Tab",","].includes(e.key)&&(e.preventDefault(),d([o]))},onPaste:e=>{e.preventDefault(),d(e.clipboardData.getData("text").split(","))},ref:t,size:"sm",type:"email",value:o}),(0,i.jsx)(a.J1D,{children:s.form.errors[s.name]}),l.length>0&&(0,i.jsx)(a.Eq9,{spacing:1,mb:3,pt:"8px",children:l.map((e,t)=>(0,i.jsxs)(a.Vp9,{borderRadius:"full",backgroundColor:"primary.400",color:"white",size:"sm",variant:"solid",children:[(0,i.jsx)(a.Sn0,{children:e}),(0,i.jsx)(a.SD9,{onClick:()=>{s.remove(t)}})]},e))})]})]})}),h=g.Ry().shape({emails:g.IX(g.Z_()).when(["notify"],{is:!0,then:()=>g.IX(g.Z_()).min(1,"Must enter at least one valid email").label("Email")}),notify:g.O7(),minErrorCount:g.Rx().required()});var x=()=>{let{isOpen:e,onOpen:t,onClose:n}=(0,a.qY0)(),[s,u]=(0,r.useState)({emails:[],notify:!1,minErrorCount:1}),g=(0,r.useRef)(null),{errorAlert:f,successAlert:p}=(0,o.VY)(),[x,y]=(0,r.useState)(!0),{data:v}=(0,c.tE)(void 0,{skip:x}),[j]=(0,c.SC)(),b=async(e,t)=>{t.setSubmitting(!0);let i=await j({email_addresses:e.emails,notify_after_failures:e.notify?e.minErrorCount:0});(0,l.D4)(i)?f((0,l.e$)(i.error),"Configure alerts and notifications has failed to save due to the following:"):p("Configure alerts and notifications saved successfully."),t.setSubmitting(!1),n()};return(0,r.useEffect)(()=>{e&&y(!1),v&&u({emails:v.email_addresses,notify:0!==v.notify_after_failures,minErrorCount:v.notify_after_failures})},[v,e]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.wpx,{onClick:t,title:"Configure alerts","aria-label":"Configure alerts",icon:(0,i.jsx)(a.Dkj,{})}),(0,i.jsx)(d.J9,{enableReinitialize:!0,initialValues:s,onSubmit:b,validationSchema:h,children:t=>(0,i.jsxs)(a.dys,{isOpen:e,placement:"right",initialFocusRef:g,onClose:()=>{t.resetForm(),n()},size:"lg",children:[(0,i.jsx)(a.P1B,{}),(0,i.jsxs)(a.scA,{color:"gray.900",children:[(0,i.jsx)(a.cCv,{}),(0,i.jsxs)(a.OXI,{color:"gray.900",children:[(0,i.jsx)(a.xvT,{fontSize:"2xl",fontWeight:"normal",mb:4,children:"Configure alerts and notifications"}),(0,i.jsx)(a.xuv,{mt:"26px",children:(0,i.jsx)(a.xvT,{fontSize:"md",fontWeight:"normal",children:"Setup your alerts to send you a notification when there are any processing failures. You can also setup a threshold for connector failures for Fides to notify you after X amount of failures have occurred."})})]}),(0,i.jsx)(a.Ng0,{mt:"20px",children:(0,i.jsxs)(d.l0,{id:"configure-alerts-form",noValidate:!0,children:[(0,i.jsx)(a.xvT,{fontSize:"md",children:"Contact details"}),(0,i.jsxs)(a.gCW,{align:"stretch",gap:"29px",mt:"14px",children:[(0,i.jsx)(a.Ugi,{children:(0,i.jsx)(d.F2,{name:"emails",render:e=>(0,i.jsx)(m,{...e,isRequired:t.values.notify,ref:g})})}),(0,i.jsx)(a.Ugi,{children:(0,i.jsx)(d.gN,{id:"notify",name:"notify",children:e=>{let{field:n}=e;return(0,i.jsxs)(a.NIc,{alignItems:"center",display:"flex",mt:"45px",children:[(0,i.jsx)(a.lXp,{fontSize:"md",mb:"0",children:"Notify me immediately if there are any DSR processing errors"}),(0,i.jsx)(a.rAg,{checked:t.values.notify,onChange:(e,i)=>{n.onChange(i),t.setFieldValue(n.name,e),t.setFieldValue("minErrorCount",1),e||setTimeout(()=>{t.setFieldTouched("emails",!1)},0)}})]})}})})]}),(0,i.jsx)(a.xvT,{color:"#757575",fontSize:"sm",mt:"11px",children:"If selected, then Fides will notify you by your chosen method of communication every time the system encounters a data subject request processing error. You can turn this off anytime and setup a more suitable notification method below if you wish."}),t.values.notify&&(0,i.jsx)(a.Ugi,{mt:"34px",children:(0,i.jsx)(d.gN,{id:"minErrorCount",name:"minErrorCount",children:e=>{let{field:n,meta:s}=e;return(0,i.jsxs)(a.NIc,{alignItems:"center",display:"flex",isInvalid:!!(s.error&&s.touched),isRequired:!0,children:[(0,i.jsx)(a.xvT,{children:"Notify me after"}),(0,i.jsxs)(a.Y2U,{allowMouseWheel:!0,color:"gray.700",defaultValue:t.values.minErrorCount||1,min:1,ml:"8px",mr:"8px",onChange:(e,n)=>{t.setFieldValue("minErrorCount",n)},size:"sm",w:"80px",children:[(0,i.jsx)(a.zuI,{...n}),(0,i.jsxs)(a.FiK,{children:[(0,i.jsx)(a.WQu,{}),(0,i.jsx)(a.Y_d,{})]})]}),(0,i.jsx)(a.xvT,{children:"DSR processing errors "})]})}})})]})}),(0,i.jsx)(a.zeN,{justifyContent:"flex-start",children:(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(a.wpx,{onClick:()=>{t.resetForm(),n()},children:"Cancel"}),(0,i.jsx)(a.wpx,{form:"configure-alerts-form",disabled:t.isSubmitting,loading:t.isSubmitting,htmlType:"submit",children:"Save"})]})})]})]})})]})},y=()=>{let{errorRequests:e}=(0,s.C)(c.fe);return(0,i.jsxs)(a.kCb,{gap:4,children:[(null==e?void 0:e.length)>0&&(0,i.jsx)(u,{}),(0,i.jsx)(x,{})]})}},62292:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ei}});var i,a,s=n(24246),r=n(98227),l=n(27378),o=n(25980),c=n(35287),u=n(58754),d=n(19904),g=n(28686),f=n(59676);let{Text:p}=r.AntTypography,m=e=>{let{selectedIds:t,menuItems:n,totalResults:i}=e,a=t.length>0;return(0,s.jsxs)(r.jqI,{gap:8,align:"center",children:[a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(p,{strong:!0,"data-testid":"selected-count",children:[t.length," selected"]}),void 0!==i&&(0,s.jsx)(p,{type:"secondary",children:" / "})]}),void 0!==i&&(0,s.jsxs)(p,{type:"secondary","data-testid":"total-results",children:[i," results"]}),(0,s.jsx)(r.S0p,{menu:{items:n},disabled:!a,children:(0,s.jsxs)(r.wpx,{"data-testid":"bulk-actions-btn",disabled:!a,children:["Actions",(0,s.jsx)(r.PJP._ME,{})]})})]})},h=()=>{let[e,t]=(0,l.useState)([]),n=(0,l.useCallback)(()=>{t([])},[]);return{selectedIds:e,setSelectedIds:t,clearSelectedIds:n}};var x=n(90867),y=n(9270),v=n(16394),j=n(60240);(i=a||(a={})).APPROVE="approve",i.DENY="deny",i.DELETE="delete";let b={[j.q2.PENDING]:["approve","deny","delete"],[j.q2.IDENTITY_UNVERIFIED]:["delete"],[j.q2.REQUIRES_INPUT]:["delete"],[j.q2.APPROVED]:["delete"],[j.q2.DENIED]:["delete"],[j.q2.IN_PROCESSING]:["delete"],[j.q2.COMPLETE]:["delete"],[j.q2.PAUSED]:["delete"],[j.q2.AWAITING_EMAIL_SEND]:["delete"],[j.q2.REQUIRES_MANUAL_FINALIZATION]:["delete"],[j.q2.CANCELED]:["delete"],[j.q2.ERROR]:["delete"],[j.q2.DUPLICATE]:["delete"]},E=e=>b[e.status],q=(e,t)=>t.some(t=>E(t).includes(e)),C=e=>{let{form:t}=e;return(0,s.jsx)(r.PPS,{form:t,layout:"vertical",children:(0,s.jsx)(r.PPS.Item,{name:"denialReason",rules:[{required:!0,message:"Please enter a reason for denial"}],children:(0,s.jsx)(r.AntInput.TextArea,{placeholder:"Enter reason for denial...",rows:4})})})},T=e=>{let{openFormModal:t}=(0,r.U8S)(e);return{openDenyPrivacyRequestModal:(0,l.useCallback)(async e=>{let n=await t({title:"Privacy request denial",content:t=>(0,s.jsxs)(r.jqI,{vertical:!0,gap:2,children:[e&&(0,s.jsx)(r.FUI,{children:e}),(0,s.jsx)(r.FUI,{children:"Please enter a reason for denying this privacy request. Please note: this can be seen by the user in their notification email."}),(0,s.jsx)(C,{form:t})]}),okText:"Confirm",cancelText:"Cancel",width:500,centered:!0});return n?null==n?void 0:n.denialReason:null},[t])}},I={[a.APPROVE]:"approved",[a.DENY]:"denied",[a.DELETE]:"deleted"},w={[a.APPROVE]:{title:"Approve privacy requests",verb:"approve"},[a.DENY]:{title:"Privacy request denial",verb:"deny"},[a.DELETE]:{title:"Delete privacy requests",verb:"delete",okType:"danger"}},_=(e,t,n)=>{let i=I[e];return n>0&&t>0?{type:"warning",message:"Successfully ".concat(i," ").concat(t," ").concat((0,v._6)(t,"request","requests"),". ").concat(n," ").concat((0,v._6)(n,"request","requests")," failed.")}:n>0?{type:"error",message:"Failed to ".concat(e," ").concat(n," ").concat((0,v._6)(n,"request","requests"),".")}:{type:"success",message:"Successfully ".concat(i," ").concat(t," privacy ").concat((0,v._6)(t,"request","requests"))}},P=e=>{let{requests:t,selectedIds:n,clearSelectedIds:i,messageApi:o,modalApi:c}=e,u=(0,l.useMemo)(()=>t.filter(e=>n.includes(e.id)),[t,n]);(0,l.useEffect)(()=>{i()},[t,i]);let[d]=(0,x.AG)(),[g]=(0,x.ZZ)(),[f]=(0,x.AL)(),{openDenyPrivacyRequestModal:p}=T(c),m=(0,l.useCallback)(async e=>{let t;let n=u.length,i=u.filter(t=>E(t).includes(e)),s=i.length;t=s===n?"You are about to ".concat(w[e].verb," ").concat(n," privacy ").concat((0,v._6)(n,"request","requests"),". Are you sure you want to continue?"):"You have selected ".concat(n," ").concat((0,v._6)(n,"request","requests"),", but only ").concat(s," ").concat((0,v._6)(s,"request","requests")," can perform this action. If you continue, the bulk action will only be applied to ").concat(s," ").concat((0,v._6)(s,"request","requests"),".");let r=i.map(e=>e.id);if(e===a.DENY){let n=await p(t);if(!n)return;let i=r.length,a=o.loading("Executing bulk action on ".concat(i," privacy ").concat((0,v._6)(i,"request","requests"),"..."),0),s=await g({request_ids:r,reason:n});if(a(),"error"in s)o.error("Failed to deny requests. Please try again.",5);else if("data"in s){var l,m;let{type:t,message:n}=_(e,(null===(l=s.data.succeeded)||void 0===l?void 0:l.length)||0,(null===(m=s.data.failed)||void 0===m?void 0:m.length)||0);o[t](n,5)}}else c.confirm({title:w[e].title,content:t,okText:"Continue",cancelText:"Cancel",okType:w[e].okType,onOk:async()=>{let t;if(0===r.length)return;let n=r.length,i=o.loading("Executing bulk action on ".concat(n," privacy ").concat((0,v._6)(n,"request","requests"),"..."),0);if(e===a.APPROVE?t=await d({request_ids:r}):e===a.DELETE&&(t=await f({request_ids:r})),i(),t){if("error"in t){let t=e===a.APPROVE?"approve":"delete";o.error("Failed to ".concat(t," requests. Please try again."),5)}else if("data"in t){var s,l;let{type:n,message:i}=_(e,(null===(s=t.data.succeeded)||void 0===s?void 0:s.length)||0,(null===(l=t.data.failed)||void 0===l?void 0:l.length)||0);o[n](i,5)}}}})},[u,p,g,d,f,o,c]);return{bulkActionMenuItems:(0,l.useMemo)(()=>{let e=q(a.APPROVE,u),t=q(a.DENY,u),n=q(a.DELETE,u);return[{key:a.APPROVE,label:"Approve",icon:(0,s.jsx)(r.PJP.MCw,{}),onClick:()=>m(a.APPROVE),disabled:!e},{key:a.DENY,label:"Deny",icon:(0,s.jsx)(r.PJP.x8P,{}),onClick:()=>m(a.DENY),disabled:!t},{type:"divider"},{key:a.DELETE,label:"Delete",icon:(0,s.jsx)(r.PJP.ZNm,{}),danger:!0,onClick:()=>m(a.DELETE),disabled:!n}]},[u,m])}};var A=n(40431),S=e=>{let{pagination:t}=e,[n,i]=(0,A.XI)({search:A.Oi.withOptions({throttleMs:300}),from:A.Oi,to:A.Oi,status:(0,A.S$)((0,A.jx)(Object.values(j.q2))),action_type:(0,A.S$)((0,A.jx)(Object.values(j.Us)))},{history:"push"}),a=(0,l.useMemo)(()=>Object.values({...n,search:void 0,to:void 0}).filter(e=>e&&e.length>0).length,[n]),[s,r]=(0,A.XI)({sort_field:A.Oi,sort_direction:(0,A.jx)(Object.values(j.AV))},{history:"push"}),o=(0,l.useMemo)(()=>({fuzzy_search_str:n.search,from:n.from,to:n.to,status:n.status,action_type:n.action_type,sort_field:s.sort_field,sort_direction:s.sort_direction}),[n.search,n.from,n.to,n.status,n.action_type,s.sort_field,s.sort_direction]),{resetPagination:c}=t;return(0,l.useEffect)(()=>{c()},[o,c]),{filters:n,setFilters:i,filtersCount:a,sortState:s,setSortState:r,filterQueryParams:o}},N=n(19785),R=n.n(N),D=n(65567),k=n.n(D),M=n(98855),O=n(90449),F=n(27693),Y=n.n(F);let U=[j.q2.COMPLETE,j.q2.CANCELED,j.q2.DENIED,j.q2.IDENTITY_UNVERIFIED],L=e=>{let{status:t,daysLeft:n,timeframe:i=45}=e;if(null!=n&&null!=i&&!U.includes(t)){let e=100*n/i<25?r.tAb.ERROR:r.tAb.DEFAULT;return(0,s.jsx)("div",{children:(0,s.jsx)(r.j8w,{color:e,bordered:!1,children:(0,s.jsx)(r.esZ,{title:(0,v.p6)(Y()().add(n,"day").toDate()),children:(0,s.jsxs)(s.Fragment,{children:[n," days left"]})})})})}return null};var z=n(86677),V=n(77830),Z=n(45259),W=n(71784);let K=e=>{var t;let{privacyRequest:n}=e,i=(0,z.useRouter)();return(0,s.jsxs)(r.jqI,{gap:12,wrap:!0,align:"center",children:[(0,s.jsx)("div",{className:"flex min-w-[100px] gap-2",children:(0,s.jsx)(r.AntTypography.Title,{level:3,children:(0,s.jsxs)(r.AntTypography.Link,{href:"/privacy-requests/".concat(n.id),variant:"primary",onClick:e=>{e.preventDefault(),i.push({pathname:V.ld,query:{id:n.id}})},children:[null===(t=n.policy.rules)||void 0===t?void 0:t.map(e=>W.rE.get(e.action_type)).join("/")," ","request"]})})}),(0,s.jsx)(Z.Z,{status:n.status}),(0,s.jsx)(r.AntTypography.Text,{type:"secondary",copyable:{text:n.id,icon:(0,s.jsx)(r.PJP.CKM,{className:"size-4 text-[var(--ant-color-text-secondary)]"}),tooltips:["Copy request ID","Copied"]},children:n.id})]})},B=e=>{let{label:t,children:n}=e;return(0,s.jsxs)(r.jqI,{gap:"small",wrap:!0,children:[(0,s.jsxs)(r.lKn,{type:"secondary",children:[t,":"]}),(0,s.jsx)(r.lKn,{ellipsis:{tooltip:!0},className:"!max-w-60",children:n})]})};var J=n(51980);let X=e=>{let{createdAt:t}=e;return t?(0,s.jsx)(B,{label:"Received",children:(0,s.jsx)(r.lKn,{type:"secondary",children:(0,s.jsx)(r.esZ,{title:(0,v.p6)(new Date(t)),children:(0,v.G8)((0,J.B)(new Date(t),new Date,{addSuffix:!0}))})})}):null},G=e=>{let{item:t,checkbox:n}=e,i=(0,O.o8)(t.identity),a=(0,O.Ub)(t.identity,i),l=(0,O.aP)(t.custom_privacy_request_fields),o=a.length>0||l.length>0||!!t.location,c=t.location?(()=>{try{return(0,r.QCN)(t.location)}catch(e){return}})():void 0;return(0,s.jsxs)(r.krs.Item,{children:[(0,s.jsx)("div",{className:"pr-4",children:n}),(0,s.jsxs)(r.jqI,{vertical:!0,gap:"small",className:"grow pr-8",children:[(0,s.jsx)(K,{privacyRequest:t}),(0,s.jsxs)(r.jqI,{vertical:!0,gap:"small",wrap:!0,children:[(0,s.jsxs)(r.jqI,{gap:"small",wrap:!0,children:[i&&(0,s.jsx)(B,{label:i.label,children:i.value}),(0,s.jsx)(r.j8w,{children:t.policy.name}),(0,s.jsx)(r.j8w,{children:t.source})]}),o&&(0,s.jsxs)(r.jqI,{wrap:!0,className:"gap-x-3 gap-y-2",children:[t.location&&(0,s.jsx)(B,{label:"Location",children:c?(0,r.c1K)({isoEntry:c,showFlag:!0}):t.location},"location"),a.map(e=>(0,s.jsx)(B,{label:e.label,children:e.value},e.key)),l.map(e=>(0,s.jsx)(B,{label:e.label,children:R()(e.value)?e.value.join(" - "):k()(e.value)},e.key))]})]})]}),(0,s.jsxs)("div",{className:"flex shrink-0 flex-col items-end gap-2 pr-2 2xl:flex-row 2xl:gap-4",children:[(0,s.jsx)(L,{daysLeft:t.days_left,status:t.status,timeframe:t.policy.execution_timeframe}),(0,s.jsx)(X,{createdAt:t.created_at})]}),(0,s.jsx)(r.jqI,{className:"min-w-[90px]",align:"center",justify:"end",gap:"small",children:(0,s.jsx)(M.q,{subjectRequest:t},"other-actions")})]})};var $=n(30952);let Q=e=>{let{filters:t,setFilters:n}=e,i=e=>(0,s.jsxs)("span",{children:["+ ",e.length]});return(0,s.jsxs)(r.jqI,{gap:"small",align:"center",justify:"flex-start",children:[(0,s.jsx)($.f,{placeholder:"Request ID or identity value",value:t.search||"",onChange:e=>n({search:e||null}),variant:"compact","data-testid":"privacy-request-search"}),(0,s.jsx)(r.cv2.RangePicker,{format:"YYYY-MM-DD",value:t.from&&t.to?[Y()(t.from),Y()(t.to)]:null,onChange:e=>{let[t,i]=e||[null,null];n({from:null==t?void 0:t.format("YYYY-MM-DD"),to:null==i?void 0:i.format("YYYY-MM-DD")})},placeholder:["From","To"],allowClear:!0,"data-testid":"date-range-filter","aria-label":"Date range",className:"w-60"}),(0,s.jsx)(r.WPr,{mode:"multiple",placeholder:"Status",options:W.I3,value:t.status||[],onChange:e=>{n({status:e.length>0?e:null})},allowClear:!0,maxTagCount:"responsive","data-testid":"request-status-filter","aria-label":"Status",className:"w-44",maxTagPlaceholder:i}),(0,s.jsx)(r.WPr,{mode:"multiple",placeholder:"Request type",options:W.kN,value:t.action_type||[],onChange:e=>{n({action_type:e.length>0?e:null})},allowClear:!0,maxTagCount:"responsive","data-testid":"request-action-type-filter","aria-label":"Request type",className:"w-44",maxTagPlaceholder:i})]})},H=()=>{let e=(0,y.S)(),{filterQueryParams:t,filters:n,setFilters:i}=S({pagination:e}),[a,o]=r.Pg3.useMessage(),[c,u]=r.$zI.useModal(),{selectedIds:d,setSelectedIds:g,clearSelectedIds:f}=h(),{data:p,isLoading:v,isFetching:j,refetch:b}=(0,x.R2)({...t,page:e.pageIndex,size:e.pageSize}),{items:E,total:q}=(0,l.useMemo)(()=>{let e=p||{items:[],total:0,pages:0},t=e.items.map(e=>({...e,key:e.id}));return{...e,items:t}},[p]),[C]=(0,x.YO)(),T=async()=>{let e;try{await C(t)}catch(t){e=t instanceof Error?t.message:"Unknown error occurred"}e&&a.error(e,5e3)},{bulkActionMenuItems:I}=P({requests:E,selectedIds:d,clearSelectedIds:f,messageApi:a,modalApi:c});return(0,s.jsxs)("div",{children:[(0,s.jsx)(r.jqI,{gap:"small",align:"center",className:"mb-4",children:(0,s.jsx)(Q,{filters:n,setFilters:i})}),(0,s.jsxs)(r.jqI,{gap:"small",align:"center",justify:"flex-end",className:"mb-2",children:[(0,s.jsx)(m,{selectedIds:d,menuItems:I,totalResults:null!=q?q:0}),(0,s.jsx)(r.wpx,{"aria-label":"Reload","data-testid":"reload-btn",icon:(0,s.jsx)(r.PJP.CQM,{}),onClick:()=>b()}),(0,s.jsx)(r.wpx,{"aria-label":"Export report","data-testid":"export-btn",icon:(0,s.jsx)(r.PJP.UWx,{}),onClick:T})]}),v?(0,s.jsx)("div",{className:" p-2",children:(0,s.jsx)(r.krs,{dataSource:Array(25).fill({}),renderItem:()=>(0,s.jsx)(r.krs.Item,{children:(0,s.jsx)(r.N_L,{})})})}):(0,s.jsxs)(r.jqI,{vertical:!0,gap:"middle",children:[(0,s.jsx)(r.ZJQ,{spinning:j,children:(0,s.jsx)(r.krs,{dataSource:E,rowSelection:{selectedRowKeys:d,onChange:g},renderItem:(e,t,n)=>(0,s.jsx)(G,{item:e,checkbox:n})})}),(0,s.jsx)(r.B7X,{...e.paginationProps,showTotal:(e,t)=>"".concat(t[0],"-").concat(t[1]," of ").concat(e," items"),total:null!=q?q:0,align:"start"})]}),o,u]})};var ee=n(88152),et=n(72281),en=n(86291),ei=()=>{let{processing:e}=(0,ee.Y)(),{plus:t}=(0,o.hz)(),{activeTab:n,handleTabChange:i,availableTabs:a}=(0,et.d)();(0,l.useEffect)(()=>{e()},[e]);let p=(0,l.useMemo)(()=>{let e=[];return a.request&&e.push({key:et.G.REQUEST,label:"Request",children:(0,s.jsx)(H,{})}),a.manualTask&&e.push({key:et.G.MANUAL_TASK,label:"Manual tasks",children:(0,s.jsx)(g.m,{})}),e},[a.manualTask,a.request]);return(0,s.jsxs)(c.Z,{title:"Privacy Requests",mainProps:{minWidth:"784px"},children:[(0,s.jsx)(u.Z,{heading:"Privacy Requests",breadcrumbItems:[{title:"All requests"}],rightContent:(0,s.jsxs)(r.vyj,{children:[t&&(0,s.jsx)(d.ZP,{scopes:[j.Sh.PRIVACY_REQUEST_CREATE],children:(0,s.jsx)(en.Z,{})}),(0,s.jsx)(f.default,{})]}),"data-testid":"privacy-requests"}),(0,s.jsx)(r.A5g,{activeKey:n,onChange:i,items:p})]})}}},function(e){e.O(0,[431,7245,3655,7654,2888,9774,179],function(){return e(e.s=89987)}),_N_E=e.O()}]);