Metadata-Version: 2.4
Name: sii-agent-sdk
Version: 0.1.7
Summary: Python SDK for SII-CLI - AI Agent Framework
Author-email: GAIR-NLP <snowy2002@sjtu.edu.cn>
License: Apache-2.0
Project-URL: Homepage, https://github.com/GAIR-NLP/sii-cli
Project-URL: Documentation, https://github.com/GAIR-NLP/sii-cli/tree/main/packages/python-sdk
Project-URL: Repository, https://github.com/GAIR-NLP/sii-cli
Project-URL: Issues, https://github.com/GAIR-NLP/sii-cli/issues
Keywords: ai,agent,sii,gemini,assistant
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: Apache Software License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Requires-Python: >=3.10
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: anyio>=4.0.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Dynamic: license-file

# SII Agent SDK for Python

Python SDK for SII-CLI - AI Agent Framework

[![Python Version](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
[![Node.js](https://img.shields.io/badge/node-%3E%3D20.0.0-brightgreen.svg)](https://nodejs.org/)
[![PyPI](https://img.shields.io/pypi/v/sii-agent-sdk.svg)](https://pypi.org/project/sii-agent-sdk/)

## æ¦‚è¿°

SII Agent SDK æ˜¯ SII-CLI çš„ Python æ¥å£ï¼Œä½¿ Python å¼€å‘è€…èƒ½å¤Ÿé€šè¿‡ç¼–ç¨‹æ–¹å¼è°ƒç”¨ SII-CLI çš„å¼ºå¤§ AI æ™ºèƒ½ä½“åŠŸèƒ½ã€‚

æœ¬é¡¹ç›®è®¾è®¡å‚è€ƒäº† [claude-agent-sdk-python](https://github.com/anthropics/claude-agent-sdk-python)ï¼Œæä¾›ç›¸ä¼¼çš„ API ä½“éªŒï¼ŒåŒæ—¶é›†æˆäº† SII çš„ç‰¹è‰²åŠŸèƒ½ã€‚

### ä¸»è¦ç‰¹æ€§

- âœ… **Claude SDK é£æ ¼ API**: API è®¾è®¡å‚è€ƒ claude-agent-sdk-pythonï¼Œé™ä½å­¦ä¹ æˆæœ¬
- âœ… **YOLO è‡ªä¸»æ‰§è¡Œ**: ä¸€å¥è¯è§¦å‘ï¼ŒAI è‡ªåŠ¨å®Œæˆä»»åŠ¡ï¼ˆåŸºäº SimpleYoloAgentï¼‰
- âœ… **å¤šè®¤è¯æ”¯æŒ**: æ”¯æŒ USE_SII, USE_GEMINI, USE_OPENAI ç­‰å¤šç§è®¤è¯æ–¹å¼
- âœ… **SII ä¸“å±å·¥å…·**: æ·±åº¦é›†æˆ sii_cognitions, sii_deep_research, sii_hybrid_search ç­‰å·¥å…·
- âœ… **æµå¼å“åº”**: åŸºäº JSONL åè®®ï¼Œå®æ—¶è¿”å›æ‰§è¡Œè¿›åº¦å’Œç»“æœ
- âœ… **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ç±»å‹æç¤ºå’Œ IDE æ”¯æŒ
- âœ… **è¿›ç¨‹éš”ç¦»**: é€šè¿‡ Node.js Bridge å®ç° Python ä¸ SII-CLI Core çš„è¿›ç¨‹é—´é€šä¿¡

## æœ€æ–°å‘å¸ƒ

- **PyPI**: [`sii-agent-sdk` 0.1.5](https://pypi.org/project/sii-agent-sdk/0.1.5/)
- **å‘å¸ƒæ—¥æœŸ**: 2025-10-07
- **çŠ¶æ€**: Alphaï¼ˆAPI ä»å¯èƒ½è°ƒæ•´ï¼‰

> è‡ª 0.1.2 èµ·ï¼ŒPython SDK å·²é€šè¿‡ PyPI æ­£å¼å‘å¸ƒï¼Œç»§ç»­ä¾èµ–å…¨å±€å®‰è£…çš„ `@gair/sii-cli` æ¥æä¾› Node.js Bridge èƒ½åŠ›ã€‚

## æ¶æ„è®¾è®¡

![alt text](../../assets/figures/fig1.png)

### ç»„ä»¶è¯´æ˜

1. **Python SDK** (`sii_agent_sdk/`)
   - æä¾› Pythonic çš„ API æ¥å£
   - ç®¡ç† Bridge è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ
   - è§£æ JSONL äº‹ä»¶æµ
   - ç±»å‹å®‰å…¨çš„æ¶ˆæ¯å°è£…

2. **Node.js Bridge** (`bridge/`)
   - æ¡¥æ¥ Python å’Œ Node.js ç”Ÿæ€
   - å¤„ç† JSONL åè®®é€šä¿¡
   - ç®¡ç† SII-CLI Core å®ä¾‹
   - æä¾›è¿›ç¨‹éš”ç¦»å’Œé”™è¯¯æ¢å¤

3. **SII-CLI Core** (`../core/`)
   - å¤ç”¨ç°æœ‰çš„æ ¸å¿ƒåŠŸèƒ½
   - AgentService: å¯¹è¯å¼äº¤äº’
   - SimpleYoloAgent: è‡ªä¸»æ‰§è¡Œ
   - ToolRegistry: å·¥å…·ç®¡ç†

## å®‰è£…

```bash
pip install sii-agent-sdk
```

### å‰ç½®è¦æ±‚

- **Python**: >= 3.10
- **Node.js**: >= 20.0.0
- **SII-CLI**: å·²æ„å»ºçš„ `@gair/sii-cli` åŒ…ï¼Œ`npm install -g @gair/sii-cli` ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ[sii-cli å®‰è£…æŒ‡å—](https://github.com/GAIR-NLP/sii-cli-dev/blob/main/README.md)

## è®¤è¯æ–¹å¼

SII Agent SDK æ”¯æŒä¸‰ç§è®¤è¯æ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼š

| è®¤è¯ç±»å‹                       | è¯´æ˜                                              | ç¯å¢ƒå˜é‡                                                 | å¯ç”¨å·¥å…·                | æ¨èåœºæ™¯        |
| ------------------------------ | ------------------------------------------------- | -------------------------------------------------------- | ----------------------- | --------------- |
| `USE_SII` (é»˜è®¤)               | SII å¹³å°è®¤è¯                                      | `SII_USERNAME`<br>`SII_PASSWORD`                         | æ‰€æœ‰å·¥å…· + SII ä¸“å±å·¥å…· | å®Œæ•´åŠŸèƒ½        |
| `USE_OPENAI`                   | OpenAI API Key                                    | `SII_OPENAI_BASE_URL`<br>`OPENAI_API_KEY` æˆ–<br>`SII_OPENAI_API_KEY` | åŸºç¡€å·¥å…·                | æˆæœ¬æ§åˆ¶        |
| `USE_OPENAI_WITH_SII_TOOLS` âœ¨ | **æ··åˆæ¨¡å¼**<br>OpenAI ç”Ÿæˆ + SII å·¥å…· + æ•°æ®ä¸Šä¼  | `SII_OPENAI_BASE_URL`<br>`SII_OPENAI_API_KEY`<br>`SII_USERNAME`<br>`SII_PASSWORD` | æ‰€æœ‰å·¥å…· + SII ä¸“å±å·¥å…· | **ä¸¤å…¨å…¶ç¾** ğŸš€ |

### 1. SII è®¤è¯ï¼ˆå®Œæ•´åŠŸèƒ½ï¼‰

ä½¿ç”¨ SII å¹³å°è´¦å·è¿›è¡Œè®¤è¯ï¼Œè·å¾—å®Œæ•´çš„åŠŸèƒ½æ”¯æŒï¼š

```bash
export SII_USERNAME="your-username"
export SII_PASSWORD="your-password"
export SII_BASE_URL="https://www.opensii.ai/backend"  # å¯é€‰
```

```python
from sii_agent_sdk import query, SiiAgentOptions

async for msg in query(
    prompt="...",
    options=SiiAgentOptions(auth_type='USE_SII')
):
    print(msg)
```

**ä¼˜åŠ¿**ï¼š

- âœ… è®¿é—®æ‰€æœ‰ SII ä¸“å±å·¥å…·ï¼ˆè®¤çŸ¥åº“ã€æ·±åº¦ç ”ç©¶ç­‰ï¼‰
- âœ… å®Œæ•´çš„åŠŸèƒ½æ”¯æŒ
- âœ… å¯¹è¯å†å²è‡ªåŠ¨ä¸Šä¼ 

### 2. OpenAI è®¤è¯

ç›´æ¥ä½¿ç”¨ OpenAI API Keyï¼Œé€‚åˆæˆæœ¬æ•æ„Ÿåœºæ™¯ï¼š

```bash
export SII_OPENAI_BASE_URL="https://api.openai.com/v1"  # å¿…å¡«ï¼šæ¨¡å‹ base_urlï¼ˆOpenAI å®˜æ–¹ä¸º https://api.openai.com/v1ï¼‰
export SII_OPENAI_API_KEY="sk-..."                      # å¿…å¡«ï¼šOpenAI API Key
```

> â„¹ï¸ **æ³¨æ„**ï¼š`SII_OPENAI_BASE_URL` æ˜¯ Bridge ä¸ OpenAI é€šä¿¡æ‰€å¿…éœ€çš„é…ç½®ï¼Œè¯·ä¸ `SII_OPENAI_API_KEY` ä¸€å¹¶è®¾ç½®ã€‚
> 
> - ä½¿ç”¨å®˜æ–¹ OpenAI æœåŠ¡æ—¶ï¼Œä¿æŒé»˜è®¤å€¼ `https://api.openai.com/v1`
> - è‹¥ä½¿ç”¨ Azure OpenAIã€Togetherã€Fireworks ç­‰å…¼å®¹æœåŠ¡ï¼Œè¯·æ›¿æ¢ä¸ºå¯¹åº”çš„ API Base URLï¼Œä¾‹å¦‚ï¼š`https://your-resource.openai.azure.com/openai`ï¼ˆéœ€ä¸æœåŠ¡å•†æ–‡æ¡£ä¿æŒä¸€è‡´ï¼‰

```python
async for msg in query(
    prompt="...",
    options=SiiAgentOptions(
        auth_type='USE_OPENAI',
        model='gpt-4o'  # æŒ‡å®š OpenAI æ¨¡å‹
    )
):
    print(msg)
```

**ä¼˜åŠ¿**ï¼š

- âœ… æ›´ä½çš„ API æˆæœ¬
- âœ… æ›´å¿«çš„å“åº”é€Ÿåº¦
- âœ… æ”¯æŒæœ€æ–°çš„ OpenAI æ¨¡å‹

**é™åˆ¶**ï¼š

- âŒ æ— æ³•ä½¿ç”¨ SII ä¸“å±å·¥å…·
- âŒ å¯¹è¯å†å²ä¸ä¼šä¸Šä¼ 

### 3. æ··åˆè®¤è¯ï¼ˆæ¨èï¼âœ¨ï¼‰

**æ··åˆæ¨¡å¼ç»“åˆäº†ä¸¤ç§è®¤è¯æ–¹å¼çš„ä¼˜åŠ¿**ï¼Œæ—¢äº«å— OpenAI çš„ä½æˆæœ¬å’Œé«˜é€Ÿåº¦ï¼Œåˆèƒ½ä½¿ç”¨ SII çš„å¼ºå¤§å·¥å…·ï¼š

```bash
# åŒæ—¶è®¾ç½®ä¸¤ç§å‡­è¯
export SII_OPENAI_BASE_URL="https://api.openai.com/v1"  # å¿…å¡«ï¼šOpenAI æ¨¡å‹ base_url
export SII_OPENAI_API_KEY="sk-..."                     # å¿…å¡«ï¼šOpenAI API Key
export SII_USERNAME="your-username"                    # SII ç”¨æˆ·å
export SII_PASSWORD="your-password"                    # SII å¯†ç 
```

> â„¹ï¸ **æ³¨æ„**ï¼šæ··åˆæ¨¡å¼ä¸‹åŒæ ·éœ€è¦è®¾ç½® `SII_OPENAI_BASE_URL`ï¼Œå¦åˆ™ SDK æ— æ³•ä»£ç† OpenAI è¯·æ±‚ã€‚è‹¥ä½¿ç”¨è‡ªå»ºæˆ–ç¬¬ä¸‰æ–¹ OpenAI å…¼å®¹æœåŠ¡ï¼Œè¯·æ›¿æ¢ä¸ºæœåŠ¡æä¾›çš„ Base URLã€‚

```python
async for msg in query(
    prompt="æœç´¢æœ€æ–°çš„ AI è¶‹åŠ¿å¹¶æ€»ç»“",
    options=SiiAgentOptions(
        auth_type='USE_OPENAI_WITH_SII_TOOLS',  # æ··åˆæ¨¡å¼
        model='gpt-4o'  # ä½¿ç”¨ OpenAI æ¨¡å‹
    )
):
    print(msg)
```

**å·¥ä½œåŸç†**ï¼š

- ğŸ¤– **å†…å®¹ç”Ÿæˆ**ï¼šä½¿ç”¨ OpenAI APIï¼ˆæ›´ä¾¿å®œã€æ›´å¿«ï¼‰
- ğŸ”§ **å·¥å…·è°ƒç”¨**ï¼šä½¿ç”¨ SII åç«¯ï¼ˆæœç´¢ã€è®¤çŸ¥åº“ç­‰ï¼‰
- ğŸ“Š **æ•°æ®ä¸Šä¼ **ï¼šå¯¹è¯å†å²è‡ªåŠ¨ä¸Šä¼ åˆ° DC ç«¯

**ä¼˜åŠ¿**ï¼š

- âœ… OpenAI çš„ä½æˆæœ¬å’Œé«˜é€Ÿåº¦
- âœ… SII çš„å®Œæ•´å·¥å…·é›†
- âœ… å¯¹è¯æ•°æ®è‡ªåŠ¨ä¸Šä¼ 
- âœ… **ä¸¤å…¨å…¶ç¾çš„æ–¹æ¡ˆ** ğŸ¯

**ç¤ºä¾‹**ï¼šæŸ¥çœ‹ `examples/hybrid_auth_example.py` è·å–å®Œæ•´ç¤ºä¾‹ã€‚

### è‡ªåŠ¨æ£€æµ‹è®¤è¯æ¨¡å¼

SDK æ”¯æŒ**è‡ªåŠ¨æ£€æµ‹**ç¯å¢ƒå˜é‡å¹¶é€‰æ‹©æœ€åˆé€‚çš„è®¤è¯æ–¹å¼ï¼š

```python
# ä¸æŒ‡å®š auth_typeï¼ŒSDK ä¼šè‡ªåŠ¨æ£€æµ‹
async for msg in query(prompt="ä½ å¥½"):
    print(msg)
```

**æ£€æµ‹ä¼˜å…ˆçº§**ï¼š

1. **æ··åˆæ¨¡å¼**ï¼ˆå¦‚æœåŒæ—¶å­˜åœ¨ OpenAI Keyã€`SII_OPENAI_BASE_URL` ä¸ SII å‡­è¯ï¼‰
2. **OpenAI æ¨¡å¼**ï¼ˆå¦‚æœåªæœ‰ OpenAI Key ä¸”è®¾ç½®äº† `SII_OPENAI_BASE_URL`ï¼‰
3. **SII æ¨¡å¼**ï¼ˆå¦‚æœåªæœ‰ SII å‡­è¯ï¼‰

### é…ç½®å¿«é€Ÿå‚è€ƒ

```bash
# æ··åˆæ¨¡å¼ï¼ˆæ¨èï¼‰
export SII_OPENAI_BASE_URL="https://api.openai.com/v1"  # å¿…å¡«ï¼šOpenAI æ¨¡å‹ base_url
export SII_OPENAI_API_KEY="sk-..."
export SII_USERNAME="your-username"
export SII_PASSWORD="your-password"

# OpenAI æ¨¡å¼
export SII_OPENAI_BASE_URL="https://api.openai.com/v1"  # å¿…å¡«ï¼šOpenAI æ¨¡å‹ base_url
export OPENAI_API_KEY="sk-..."                      # æˆ–ä½¿ç”¨ SII_OPENAI_API_KEY

# SII æ¨¡å¼
export SII_USERNAME="your-username"
export SII_PASSWORD="your-password"

# å¯é€‰é…ç½®
export SII_BASE_URL="https://www.opensii.ai/backend"
export SII_OPENAI_MODEL="gpt-4o"  # é»˜è®¤æ¨¡å‹
```

## å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€æŸ¥è¯¢

æœ€ç®€å•çš„ç”¨æ³•ï¼Œä½¿ç”¨é»˜è®¤é…ç½®ï¼š

```python
import anyio
from sii_agent_sdk import query

async def main():
    async for message in query(prompt="è¯·é—®ä½ æ˜¯è°"):
        print(message)

anyio.run(main)
```

### 2. YOLO è‡ªä¸»æ‰§è¡Œæ¨¡å¼

è®© AI è‡ªåŠ¨æ‰§è¡Œæ‰€æœ‰æ­¥éª¤ï¼Œæ— éœ€äººå·¥ç¡®è®¤ï¼š

```python
import anyio
import os
from pathlib import Path
from sii_agent_sdk import query, SiiAgentOptions


async def main():
    print("ğŸ® å¼€å§‹æµ‹è¯•ï¼šç”ŸæˆåŒäººå¯¹æˆ˜äº”å­æ£‹æ¸¸æˆå‰ç«¯ç•Œé¢")
    print("=" * 60)

    # è®¾ç½®å·¥ä½œç›®å½•
    output_dir = Path(__file__).parent / "gomoku_game_output"
    output_dir.mkdir(exist_ok=True)

    print(f"ğŸ“ è¾“å‡ºç›®å½•: {output_dir}")
    print(f"ğŸ” Trajectory å°†ä¿å­˜åˆ°: .sii/conversation_logs/")
    print("=" * 60)

    # æ„å»ºè¯¦ç»†çš„æç¤ºè¯
    prompt = """
è¯·å¸®æˆ‘åˆ›å»ºä¸€ä¸ªåŒäººå¯¹æˆ˜çš„äº”å­æ£‹æ¸¸æˆå‰ç«¯ç•Œé¢ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š

1. **æŠ€æœ¯æ ˆ**ï¼šä½¿ç”¨çº¯ HTML + CSS + JavaScriptï¼ˆä¸ä¾èµ–æ¡†æ¶ï¼‰
2. **æ¸¸æˆåŠŸèƒ½**ï¼š
   - 15x15 çš„æ£‹ç›˜
   - åŒäººæœ¬åœ°å¯¹æˆ˜ï¼ˆé»‘ç™½æ£‹å­è½®æµä¸‹æ£‹ï¼‰
   - æ˜¾ç¤ºå½“å‰è½®åˆ°å“ªæ–¹
   - è‡ªåŠ¨åˆ¤æ–­èƒœè´Ÿï¼ˆäº”å­è¿ç ï¼‰
   - é‡æ–°å¼€å§‹æ¸¸æˆçš„æŒ‰é’®
   - æ‚”æ£‹åŠŸèƒ½

3. **ç•Œé¢è®¾è®¡**ï¼š
   - ç¾è§‚çš„æ£‹ç›˜UIï¼Œæœ‰ç½‘æ ¼çº¿
   - æ¸…æ™°çš„é»‘ç™½æ£‹å­æ˜¾ç¤º
   - æ˜¾ç¤ºæ¸¸æˆçŠ¶æ€ï¼ˆè½®åˆ°è°ã€è°èµ¢äº†ç­‰ï¼‰
   - å“åº”å¼è®¾è®¡ï¼Œé€‚é…ä¸åŒå±å¹•

4. **æ–‡ä»¶ç»“æ„**ï¼š
   - gomoku.html - ä¸»HTMLæ–‡ä»¶ï¼ˆåŒ…å«å®Œæ•´çš„æ¸¸æˆï¼‰
   - å¯ä»¥å°† CSS å’Œ JS éƒ½å†…åµŒåœ¨ HTML ä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨

5. **é¢å¤–åŠŸèƒ½**ï¼ˆå¯é€‰ï¼‰ï¼š
   - èƒœåˆ©æ—¶çš„åŠ¨ç”»æ•ˆæœ
   - éŸ³æ•ˆï¼ˆå¯é€‰ï¼‰
   - æ£‹ç›˜åæ ‡æ˜¾ç¤º

è¯·åˆ›å»ºå®Œæ•´å¯è¿è¡Œçš„ä»£ç ï¼Œå¹¶ä¿å­˜ä¸º gomoku.html æ–‡ä»¶ã€‚
"""

    print("\nğŸ“¤ å‘é€è¯·æ±‚ç»™ AI...")
    print("-" * 60)

    try:
        message_count = 0

        # ä½¿ç”¨ YOLO æ¨¡å¼è®© AI è‡ªåŠ¨æ‰§è¡Œå·¥å…·è°ƒç”¨
        async for msg in query(
            prompt=prompt,
            options=SiiAgentOptions(
                yolo=True,  # å¯ç”¨ YOLO æ¨¡å¼ï¼Œè‡ªåŠ¨æ‰§è¡Œå·¥å…·
                max_turns=15,  # æœ€å¤š15è½®å¯¹è¯
                cwd=str(output_dir),  # åœ¨è¾“å‡ºç›®å½•ä¸­å·¥ä½œ
                auth_type="USE_SII",  # ä½¿ç”¨ SII è®¤è¯
                system_prompt="You are a helpful frontend developer assistant. Create beautiful and functional web applications."
            )
        ):
            message_count += 1
            print(f"\nğŸ’¬ æ¶ˆæ¯ #{message_count}:")
            print(msg)
            print("-" * 60)

        print(f"\nâœ… ä»»åŠ¡å®Œæˆï¼å…±æ”¶åˆ° {message_count} æ¡æ¶ˆæ¯")

    except Exception as e:
        print(f"\nâŒ é”™è¯¯: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    anyio.run(main)
```

### 3. å¤šè½® YOLO ä¼šè¯ï¼ˆSiiAgentSessionï¼‰

æœ‰äº›ä»»åŠ¡éœ€è¦åœ¨åŒä¸€å·¥ä½œç›®å½•ä¸‹è¿ç»­æ¨è¿›å¤šè½®æ‰§è¡Œï¼Œä¾‹å¦‚â€œè§„åˆ’ â†’ å®æ–½ â†’ æ•´ç†æ–‡æ¡£â€ã€‚
`SiiAgentSession` æä¾›äº†æœ€å°åŒ–çš„æŒä¹…ä¼šè¯å°è£…ï¼Œèƒ½å¤Ÿåœ¨å¤šè½® YOLO æ¨¡å¼ä¸‹å¤ç”¨åŒä¸€ä¸ª `session_id`ã€ç¯å¢ƒä¸Šä¸‹æ–‡å’Œå†å²æ¶ˆæ¯ã€‚

> ç¤ºä¾‹è„šæœ¬ï¼š`examples/multi_round_yolo_session.py`

```python
import anyio
from sii_agent_sdk import SiiAgentOptions, SiiAgentSession


async def main() -> None:
    prompts = [
        "ä½ å¥½",
        "è¯·ç»§ç»­ï¼Œæ ¹æ®ä¸Šä¸€è½®ç»“æœæ€»ç»“ä¸€ä¸‹ä¸‹ä¸€æ­¥è®¡åˆ’ã€‚",
        "å†è¡¥å……ä¸€ä¸ª README.mdï¼Œå‘Šè¯‰æˆ‘å¦‚ä½•è¿è¡Œåˆšæ‰ç”Ÿæˆçš„é¡¹ç›®ã€‚",
    ]

    options = SiiAgentOptions(
        yolo=True,
        max_turns=80,
        auth_type="USE_SII",
        model="GLM-4.6",
        cwd="./multi_round_project",
        timeout_ms=240000,
    )

    session = SiiAgentSession(options)

    for round_index, prompt in enumerate(prompts, start=1):
        print(f"\n===== Round {round_index}: {prompt} =====")
        async for message in session.run(prompt):
            print(message)

    print(f"\nä¼šè¯ ID: {session.session_id}")
    print(f"å†å²é•¿åº¦: {len(session.history)} æ¡")


anyio.run(main)
```

#### å…³é”®å‚æ•°è¯´æ˜

| é…ç½®é¡¹ | ä½œç”¨ | æ¨èè®¾ç½® |
| --- | --- | --- |
| `SiiAgentOptions.yolo` | æ˜¯å¦å¯ç”¨ YOLO æ¨¡å¼ | `True`ï¼ˆå¤šè½®è‡ªåŠ¨æ‰§è¡Œå¿…å¼€ï¼‰ |
| `max_turns` | æ¯è½®å…è®¸çš„æœ€å¤§å¯¹è¯è½®æ•° | æ ¹æ®ä»»åŠ¡å¤æ‚åº¦è°ƒæ•´ï¼Œç¤ºä¾‹ä¸­ä¸º 80 |
| `cwd` | å·¥ä½œç›®å½• | è®¾ç½®ä¸ºåŒä¸€ç›®å½•ï¼Œä¾¿äºå¤šè½®å…±äº«æ–‡ä»¶è¾“å‡º |
| `timeout_ms` | å•è½®æ‰§è¡Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ | é»˜è®¤ 120000ï¼Œå¯æŒ‰éœ€å»¶é•¿ |
| `auth_type` / `model` | è®¤è¯æ–¹å¼ä¸æ¨¡å‹ | ä¸å•è½® YOLO ä¸€è‡´ï¼Œæ ¹æ®éœ€æ±‚é€‰æ‹© |

`SiiAgentSession` ä¼šåœ¨é¦–æ¬¡è°ƒç”¨ `run()` æ—¶å‘ Bridge è¯·æ±‚ä¼šè¯ IDï¼Œå¹¶åœ¨åç»­è½®æ¬¡é‡ç”¨ï¼›åŒæ—¶ä¼šè‡ªåŠ¨ç´¯è®¡ `session.history`ï¼Œå¯ç”¨äºè¿½åŠ è‡ªå®šä¹‰ç”¨æˆ·åé¦ˆæˆ–è°ƒè¯•ã€‚

#### ä¸å•è½® `query()` çš„åŒºåˆ«

| åœºæ™¯ | å•è½® `query()` | `SiiAgentSession.run()` |
| --- | --- | --- |
| ä¼šè¯ ID | æ¯æ¬¡è°ƒç”¨é‡æ–°åˆ›å»º | å¤šè½®å…±äº«åŒä¸€ä¸ª `session_id` |
| å†å²è®°å½• | é»˜è®¤ä¸ä¿ç•™ï¼Œéœ€è‡ªè¡Œç®¡ç† | è‡ªåŠ¨åœ¨ `session.history` ä¸­ç´¯ç§¯ |
| ç¯å¢ƒä¸Šä¸‹æ–‡ | æ¯æ¬¡é‡æ–°ç”Ÿæˆ | é¦–è½®ç”Ÿæˆååœ¨åç»­è½®æ¬¡å¤ç”¨ |
| ä½¿ç”¨åœºæ™¯ | ä¸€æ¬¡æ€§ä»»åŠ¡ | éœ€è¦â€œè®¡åˆ’ â†’ æ‰§è¡Œ â†’ æ£€æŸ¥â€ç­‰è¿ç»­æµç¨‹ |

å¦‚æœåªæ˜¯æ‰§è¡Œä¸€æ¬¡ YOLO ä»»åŠ¡ï¼Œç»§ç»­ä½¿ç”¨ `async for msg in query(...)` å³å¯ï¼›å½“éœ€è¦å¤šè½®æ¨è¿›æ—¶ï¼Œæ”¹ç”¨ `SiiAgentSession` å¯ä»¥é¿å…é‡å¤åˆå§‹åŒ–ã€ä¸¢å¤±ä¸Šä¸‹æ–‡æˆ–ç”Ÿæˆå¤šä¸ªè½¨è¿¹æ–‡ä»¶ã€‚

### 3. ä½¿ç”¨ SII ä¸“å±å·¥å…·

å……åˆ†åˆ©ç”¨ SII å¹³å°çš„è®¤çŸ¥èƒ½åŠ›ï¼š

```python
import anyio
from sii_agent_sdk import query, SiiAgentOptions

async def main():
    # ä½¿ç”¨ SII è®¤çŸ¥æ•°æ®åº“å’Œæ··åˆæœç´¢
    async for message in query(
        prompt="æœç´¢æœ€æ–°çš„å¤§è¯­è¨€æ¨¡å‹è®­ç»ƒæŠ€æœ¯ç ”ç©¶è¿›å±•",
        options=SiiAgentOptions(
            auth_type="USE_SII",
            allowed_tools=[
                "sii_cognitions",
                "sii_deep_research",
                "sii_hybrid_search"
            ],
            max_turns=5
        )
    ):
        if message.type == "assistant_message":
            print(message.content[0].text)

anyio.run(main)
```

### 4. æŒ‡å®šå·¥ä½œç›®å½•å’Œæ¨¡å‹

è‡ªå®šä¹‰æ‰§è¡Œç¯å¢ƒï¼š

```python
import anyio
from sii_agent_sdk import query, SiiAgentOptions

async def main():
    async for message in query(
        prompt="åˆ†æ src/ ç›®å½•ä¸‹çš„ä»£ç ç»“æ„",
        options=SiiAgentOptions(
            cwd="/path/to/your/project",
            model="gemini-2.0-flash-exp",
            temperature=0.7,
            max_turns=8,
            allowed_tools=["read_file", "list_dir", "grep_search"]
        )
    ):
        print(message)

anyio.run(main)
```

## API å‚è€ƒ

### `query()` å‡½æ•°

ç®€å•çš„ä¸€æ¬¡æ€§æŸ¥è¯¢æ¥å£ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ã€‚

```python
async def query(
    prompt: str,
    *,
    options: SiiAgentOptions | None = None
) -> AsyncIterator[Message]
```

**å‚æ•°**:

- `prompt`: ç”¨æˆ·è¾“å…¥çš„ä»»åŠ¡æè¿°
- `options`: å¯é€‰çš„é…ç½®é€‰é¡¹ï¼ˆè§ä¸‹æ–‡ï¼‰

**è¿”å›**: å¼‚æ­¥è¿­ä»£å™¨ï¼Œäº§ç”Ÿ `Message` å¯¹è±¡

### `SiiAgentOptions` é…ç½®

```python
from dataclasses import dataclass
from typing import List, Literal, Optional

@dataclass
class SiiAgentOptions:
    # è®¤è¯é…ç½®
    auth_type: Optional[str] = None  # "USE_SII", "USE_OPENAI", "USE_OPENAI_WITH_SII_TOOLS"
                                     # ç•™ç©ºåˆ™è‡ªåŠ¨æ£€æµ‹

    # æ‰§è¡Œæ¨¡å¼
    yolo: bool = False               # YOLO è‡ªä¸»æ‰§è¡Œæ¨¡å¼
    max_turns: int = 10              # æœ€å¤§å¯¹è¯è½®æ•°
    timeout_ms: int = 120000         # è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

    # å·¥å…·æ§åˆ¶
    allowed_tools: Optional[List[str]] = None  # å…è®¸ä½¿ç”¨çš„å·¥å…·ç™½åå•

    # æ¨¡å‹é…ç½®
    model: Optional[str] = None      # æ¨¡å‹åç§°ï¼Œå¦‚ "gpt-4o", "claude-sonnet-4.5"
    temperature: Optional[float] = None  # æ¸©åº¦å‚æ•° (0.0-2.0)
    system_prompt: Optional[str] = None  # è‡ªå®šä¹‰ç³»ç»Ÿæç¤º
    run_model: Literal["agent", "ask"] = "agent"  # è¿è¡Œæ¨¡å‹ï¼šagent=å®Œæ•´ CLI Promptï¼Œask=è½»é‡é—®ç­”

    # ç¯å¢ƒé…ç½®
    cwd: Optional[str] = None        # å·¥ä½œç›®å½•
    session_id: Optional[str] = None # ä¼šè¯ ID
```

#### è¿è¡Œæ¨¡å‹åˆ‡æ¢ï¼ˆ`run_model`ï¼‰

- `agent`ï¼ˆé»˜è®¤ï¼‰ï¼šå¤ç”¨ SII-CLI çš„å®Œæ•´ç³»ç»Ÿ Promptã€ç¯å¢ƒä¸Šä¸‹æ–‡å’Œå·¥å…·æ³¨å…¥ï¼Œé€‚åˆéœ€è¦å·¥å…·é“¾çš„å¤æ‚ä»»åŠ¡ã€‚
- `ask`ï¼šä»…å‘æ¨¡å‹æ³¨å…¥ä½ æä¾›çš„ `system_prompt`ï¼ˆè‹¥æœªæä¾›ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨é»˜è®¤ Ask Promptï¼‰ï¼Œå¹¶ç¦ç”¨ CLI çº§åˆ«çš„å·¥å…·æç¤ºï¼Œé€‚åˆè½»é‡ Q&Aã€‚

```python
options = SiiAgentOptions(
    run_model="ask",
    system_prompt="ä½ æ˜¯ä¸€ä½è€å¿ƒçš„åŠ©æ•™ï¼Œç”¨ä¸­æ–‡å›ç­”æ‰€æœ‰é—®é¢˜ã€‚"
)
```

Ask æ¨¡å¼ä¸‹å¦‚æœæœªä¼ å…¥ `system_prompt`ï¼ŒSDK ä¼šè‡ªåŠ¨æ³¨å…¥é»˜è®¤æç¤ºï¼š

> `You are Ask Model running inside the SII CLI environment. Answer the user's question directly and concisely using only the provided context. Do not assume tool access unless explicitly mentioned.`

### Message ç±»å‹

æ‰€æœ‰æ¶ˆæ¯éƒ½ç»§æ‰¿è‡ª `Message` åŸºç±»ï¼š

```python
# çŠ¶æ€æ¶ˆæ¯
class StatusMessage(Message):
    type: Literal["status"]
    status: str                      # "initializing", "authenticating", "ready", "running"
    message: str
    auth_type: Optional[str]
    available_tools: Optional[List[str]]

# åŠ©æ‰‹æ¶ˆæ¯
class AssistantMessage(Message):
    type: Literal["assistant_message"]
    role: Literal["assistant"]
    content: List[ContentBlock]      # å†…å®¹å—åˆ—è¡¨

# å·¥å…·è°ƒç”¨
class ToolCallMessage(Message):
    type: Literal["tool_call"]
    tool_name: str
    tool_call_id: str
    args: Dict[str, Any]

# å·¥å…·ç»“æœ
class ToolResultMessage(Message):
    type: Literal["tool_result"]
    tool_call_id: str
    result: Dict[str, Any]

# å®Œæˆæ¶ˆæ¯
class CompletedMessage(Message):
    type: Literal["completed"]
    metadata: Dict[str, Any]         # turns_used, time_elapsed, tokens_used

# é”™è¯¯æ¶ˆæ¯
class ErrorMessage(Message):
    type: Literal["error"]
    error: Dict[str, Any]            # code, message, details
```

## ç¤ºä¾‹

### å®Œæ•´ç¤ºä¾‹ä»£ç 

æŸ¥çœ‹ `examples/` ç›®å½•è·å–æ›´å¤šç¤ºä¾‹ï¼š

```
examples/
â”œâ”€â”€ quick_start.py              # å¿«é€Ÿå…¥é—¨ï¼ˆè‡ªåŠ¨æ£€æµ‹è®¤è¯ï¼‰
â”œâ”€â”€ hybrid_auth_example.py      # æ··åˆè®¤è¯æ¨¡å¼ç¤ºä¾‹ âœ¨
â”œâ”€â”€ gomoku_openai_example.py    # OpenAI æ¨¡å¼ç¤ºä¾‹
â””â”€â”€ debug_quick_start.py        # è°ƒè¯•ç¤ºä¾‹
```

è¿è¡Œç¤ºä¾‹ï¼š

```bash
cd examples

# å¿«é€Ÿå¼€å§‹ï¼ˆè‡ªåŠ¨æ£€æµ‹è®¤è¯ï¼‰
python quick_start.py

# æ··åˆè®¤è¯æ¨¡å¼ç¤ºä¾‹
python hybrid_auth_example.py

# OpenAI æ¨¡å¼ç¤ºä¾‹
python gomoku_openai_example.py
```

## å¼€å‘

### é¡¹ç›®ç»“æ„

```
packages/python-sdk/
â”œâ”€â”€ sii_agent_sdk/              # Python SDK æºç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ query.py                # query() å‡½æ•°å®ç°
â”‚   â”œâ”€â”€ types.py                # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ errors.py               # å¼‚å¸¸ç±»
â”‚   â”œâ”€â”€ bridge.py               # Bridge è¿›ç¨‹ç®¡ç†
â”‚   â””â”€â”€ _internal/              # å†…éƒ¨å®ç°
â”‚       â”œâ”€â”€ protocol.py         # JSONL åè®®è§£æ
â”‚       â””â”€â”€ process.py          # è¿›ç¨‹ç®¡ç†
â”œâ”€â”€ bridge/                     # Node.js Bridge
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts            # Bridge å…¥å£
â”‚   â”‚   â”œâ”€â”€ protocol.ts         # åè®®å¤„ç†
â”‚   â”‚   â”œâ”€â”€ executor.ts         # æ‰§è¡Œå™¨
â”‚   â”‚   â”œâ”€â”€ stream.ts           # äº‹ä»¶æµ
â”‚   â”‚   â””â”€â”€ types.ts            # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”œâ”€â”€ tests/                      # æµ‹è¯•
â”‚   â”œâ”€â”€ test_query.py
â”‚   â”œâ”€â”€ test_bridge.py
â”‚   â””â”€â”€ test_types.py
â”œâ”€â”€ examples/                   # ç¤ºä¾‹
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”œâ”€â”€ pyproject.toml              # Python é¡¹ç›®é…ç½®
â””â”€â”€ README.md                   # æœ¬æ–‡ä»¶
```

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_query.py -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=sii_agent_sdk --cov-report=html
```

### ä»£ç è´¨é‡æ£€æŸ¥

```bash
# ä»£ç æ ¼å¼åŒ–
black sii_agent_sdk/ tests/ examples/

# Lint æ£€æŸ¥
ruff check sii_agent_sdk/ tests/

# ç±»å‹æ£€æŸ¥
mypy sii_agent_sdk/
```

### è°ƒè¯• Bridge

è®¾ç½®ç¯å¢ƒå˜é‡å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
export SII_BRIDGE_DEBUG=1
python your_script.py
```

## å¸¸è§é—®é¢˜

### 1. Bridge è¿›ç¨‹å¯åŠ¨å¤±è´¥

**é—®é¢˜**: `BridgeNotFoundError: Bridge executable not found`

**è§£å†³æ–¹æ¡ˆ**:

- ç¡®ä¿å·²æ„å»º SII-CLI Core: `npm run build`
- æ£€æŸ¥ Node.js ç‰ˆæœ¬: `node --version` (éœ€è¦ >= 20.0.0)
- æ‰‹åŠ¨æŒ‡å®š Bridge è·¯å¾„: `export SII_BRIDGE_PATH=/path/to/bridge`

### 2. è®¤è¯å¤±è´¥

**é—®é¢˜**: `AuthenticationError: Authentication failed`

**è§£å†³æ–¹æ¡ˆ**:

- æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®
- éªŒè¯ API Key æ˜¯å¦æœ‰æ•ˆ
- ä½¿ç”¨ `list_tools` æ–¹æ³•æ£€æŸ¥å¯ç”¨å·¥å…·

### 3. å·¥å…·è°ƒç”¨è¶…æ—¶

**é—®é¢˜**: `TimeoutError: Tool execution timeout`

**è§£å†³æ–¹æ¡ˆ**:

- å¢åŠ è¶…æ—¶æ—¶é—´: `SiiAgentOptions(timeout_ms=300000)` # 5åˆ†é’Ÿ
- å‡å°‘ `max_turns` é™åˆ¶å¤æ‚åº¦
- ä½¿ç”¨æ›´ç²¾ç¡®çš„ `allowed_tools` è¿‡æ»¤

### 4. JSONL è§£æé”™è¯¯

**é—®é¢˜**: `JSONDecodeError: Failed to parse event`

**è§£å†³æ–¹æ¡ˆ**:

- å¯ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹åŸå§‹è¾“å‡º
- æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
- æäº¤ issue é™„å¸¦é”™è¯¯æ—¥å¿—

## é¡¹ç›®çŠ¶æ€

**å½“å‰ç‰ˆæœ¬**: 0.1.2 (Alpha)

**å¼€å‘è¿›åº¦**:

- âœ… Phase 1: Node.js Bridge åŸºç¡€ç»“æ„
- âœ… Phase 2: Python SDK æ ¸å¿ƒ API (`query()`)
- âœ… Phase 3: YOLO æ¨¡å¼é›†æˆ
- âœ… Phase 4: å¤šè®¤è¯æ–¹å¼æ”¯æŒ
- âœ… Phase 5: å®Œæ•´æµ‹è¯•è¦†ç›–
- âœ… Phase 6: æ€§èƒ½ä¼˜åŒ–
- âœ… Phase 7: å‘å¸ƒåˆ° PyPI

### å·²çŸ¥é™åˆ¶

- `SiiSDKClient` ç±»å°šæœªå®Œå…¨å®ç°æŒä¹…ä¼šè¯åŠŸèƒ½
- å·¥å…·ç™½åå• (`allowed_tools`) å½“å‰ä»…ä½œä¸ºå»ºè®®ï¼Œæœªå¼ºåˆ¶æ‰§è¡Œ
- éƒ¨åˆ†é«˜çº§é…ç½®é€‰é¡¹å°šæœªå®ç°ï¼ˆå¦‚è‡ªå®šä¹‰é”™è¯¯å¤„ç†å™¨ï¼‰
- æ–‡æ¡£å’Œç¤ºä¾‹ä»åœ¨å®Œå–„ä¸­

### è·¯çº¿å›¾

- [ ] å®Œå–„ `SiiSDKClient` æŒä¹…ä¼šè¯æ”¯æŒ
- [ ] å®ç°å·¥å…·ç™½åå•å¼ºåˆ¶è¿‡æ»¤
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†
- [ ] æ”¯æŒè‡ªå®šä¹‰å·¥å…·æ³¨å†Œ
- [ ] æä¾›æ›´ä¸°å¯Œçš„äº‹ä»¶é’©å­
- [ ] å®Œå–„æ–‡æ¡£å’Œæ•™ç¨‹
- [ ] å‘å¸ƒåˆ° PyPI

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/your-feature`
3. æäº¤æ›´æ”¹: `git commit -am 'Add new feature'`
4. æ¨é€åˆ°åˆ†æ”¯: `git push origin feature/your-feature`
5. æäº¤ Pull Request

æ›´å¤šè¯¦æƒ…è¯·æŸ¥çœ‹ [CONTRIBUTING.md](../../CONTRIBUTING.md)

### å¼€å‘è§„èŒƒ

- ä»£ç æ ¼å¼: Black (line-length=100)
- ç±»å‹æ£€æŸ¥: ä½¿ç”¨ mypy strict æ¨¡å¼
- æµ‹è¯•è¦†ç›–ç‡: ç›®æ ‡ >= 80%
- æäº¤ä¿¡æ¯: éµå¾ª Conventional Commits

## è®¸å¯

Apache License 2.0 - è¯¦è§ [LICENSE](../../LICENSE)

## è‡´è°¢

- æœ¬é¡¹ç›®è®¾è®¡å‚è€ƒäº† [claude-agent-sdk-python](https://github.com/anthropics/claude-agent-sdk-python)
- æ„Ÿè°¢ Anthropic å›¢é˜Ÿçš„ä¼˜ç§€è®¾è®¡ç†å¿µ
- æ„Ÿè°¢ SII-CLI æ ¸å¿ƒå›¢é˜Ÿæä¾›å¼ºå¤§çš„åŸºç¡€è®¾æ–½

## ç›¸å…³é“¾æ¥

- [SII-CLI ä¸»é¡¹ç›®](https://github.com/GAIR-NLP/sii-cli)
- [SII å¹³å°å®˜ç½‘](https://sii.gair-nlp.com)
- [Claude Agent SDK](https://github.com/anthropics/claude-agent-sdk-python)
- [é—®é¢˜åé¦ˆ](https://github.com/GAIR-NLP/sii-cli/issues)
- [è®¨è®ºåŒº](https://github.com/GAIR-NLP/sii-cli/discussions)

---

**æç¤º**: æœ¬é¡¹ç›®å¤„äºæ—©æœŸå¼€å‘é˜¶æ®µï¼ŒAPI å¯èƒ½ä¼šæœ‰è¾ƒå¤§å˜åŠ¨ã€‚å»ºè®®å…³æ³¨ [CHANGELOG.md](./CHANGELOG.md) äº†è§£æœ€æ–°æ›´æ–°ã€‚
