# Nexus Configuration Example
# Copy this file to config.yaml and modify as needed

# Deployment mode: embedded, monolithic, or distributed
mode: monolithic

# Server settings
server:
  host: 0.0.0.0
  port: 8080
  workers: 4
  log_level: info

# Database configuration
database:
  # For SQLite (embedded/monolithic)
  url: sqlite:///./nexus.db

  # For PostgreSQL (distributed)
  # url: postgresql://user:password@localhost:5432/nexus

  pool_size: 10
  max_overflow: 20
  echo: false

# Cache configuration
cache:
  type: memory  # memory, redis

  # For Redis
  # type: redis
  # url: redis://localhost:6379
  # db: 0

  ttl: 3600
  max_size_mb: 100

# Vector database
vector_db:
  type: qdrant

  # Embedded mode
  path: ./nexus-data/qdrant

  # Server mode
  # url: http://localhost:6333
  # api_key: your-api-key

  collection_prefix: nexus

# Multi-backend storage configuration
# Define multiple storage backends that will be automatically mounted on server startup.
# Each backend can be mounted at a different virtual path with different priorities.
#
# IMPORTANT: This feature is only available when using `nexus serve --config config.yaml`
#
# Fields:
#   type: Backend type (local, gcs, s3, gdrive)
#   mount_point: Virtual path where backend is mounted (e.g., /workspace, /archives)
#   config: Backend-specific configuration (see examples below)
#   priority: Mount priority - higher priority mounts are checked first (default: 0)
#   readonly: Whether mount is read-only (default: false)
#
# Example usage:
#   nexus serve --config config.yaml --auth-type database --init
#
# This will:
#   1. Start the server
#   2. Auto-mount all backends defined below
#   3. Files in /workspace will use local storage
#   4. Files in /archives will use GCS storage
#
backends:
  # Local filesystem backend (default workspace)
  - type: local
    mount_point: /workspace
    config:
      root_path: ./nexus-data/files
    priority: 0
    readonly: false

  # Google Cloud Storage for archives (requires GCS credentials)
  # - type: gcs
  #   mount_point: /archives
  #   config:
  #     bucket: my-nexus-archives
  #     project_id: my-gcp-project
  #     credentials_path: /path/to/gcs-credentials.json
  #   priority: 10
  #   readonly: false

  # GCS for shared datasets (read-only)
  # - type: gcs
  #   mount_point: /datasets
  #   config:
  #     bucket: company-ml-datasets
  #     project_id: my-gcp-project
  #     credentials_path: /path/to/gcs-credentials.json
  #   priority: 10
  #   readonly: true

  # Amazon S3 (not yet implemented)
  # - type: s3
  #   mount_point: /s3
  #   config:
  #     bucket: my-company-files
  #     region: us-east-1
  #     access_key: ${AWS_ACCESS_KEY_ID}
  #     secret_key: ${AWS_SECRET_ACCESS_KEY}
  #   priority: 10
  #   readonly: false

  # Google Drive (not yet implemented)
  # - type: gdrive
  #   mount_point: /gdrive
  #   config:
  #     credentials_path: ./secrets/gdrive-creds.json
  #   priority: 10
  #   readonly: false

# Authentication
auth:
  jwt_secret: ${JWT_SECRET:-change-me-in-production}
  jwt_algorithm: HS256
  token_expiry_hours: 24
  api_key_expiry_days: 365

# Rate limiting
rate_limits:
  enabled: true
  default: "100/minute"
  semantic_search: "10/minute"
  llm_read: "50/hour"

# LLM providers
llm:
  default_provider: anthropic

  anthropic:
    api_key: ${ANTHROPIC_API_KEY}
    default_model: claude-sonnet-4
    max_tokens: 4096
    enable_cache: true

  openai:
    api_key: ${OPENAI_API_KEY}
    default_model: gpt-4-turbo
    max_tokens: 4096
    enable_cache: true

  google:
    api_key: ${GOOGLE_API_KEY}
    default_model: gemini-pro
    max_tokens: 4096

# Embeddings
embeddings:
  provider: openai
  model: text-embedding-3-large
  dimensions: 1536
  batch_size: 100

# Jobs
jobs:
  enabled: true
  max_workers: 4
  checkpoint_interval: 60  # seconds
  max_retries: 3

# Monitoring
monitoring:
  prometheus:
    enabled: true
    port: 9090

  tracing:
    enabled: false
    jaeger_endpoint: http://localhost:14268/api/traces

  logging:
    level: info
    format: json  # json, text
    file: ./logs/nexus.log

# Features
features:
  semantic_search: true
  llm_read: true
  agent_memory: true
  job_system: true
  mcp_server: true
