<?xml version="1.0" encoding="utf-8"?>
<!--
Contract Template Data
======================

This file defines contract templates and their associated lines for different
billing modes in self-consumption projects. Each template includes specific
product configurations and quantity formulas.

Main templates:
- Energy Delivered: For billing based on actual energy delivered
- Power Acquired: For billing based on contracted power capacity
- Energy Custom: For custom billing configurations

Each template includes detailed invoice line descriptions with dynamic placeholders
for CUPS codes, owner information, billing periods, and technical data.
-->
<odoo>
    <data>
        
        <!-- ========================================== -->
        <!-- ENERGY DELIVERED TEMPLATE                 -->
        <!-- ========================================== -->
        
        <!-- Contract Template: Energy Delivered Self-consumption Pack -->
        <record id="contract_template_energy_delivered_selfconsumption_pack" model="contract.template">
            <field name="name">Energy delivered selfconsumption pack</field>
            <field name="contract_type">sale</field>
            <field name="company_id" eval="False"/>
        </record>

        <!-- Contract Template Line: Energy Delivered -->
        <record id="contract_template_line_energy_delivered_selfconsumption_pack" model="contract.template.line">
            <field name="contract_id" ref="contract_template_energy_delivered_selfconsumption_pack"/>
            <field name="name">CUPS: #code#
Owner: #owner_id#
Invoicing period: #START# - #END#
CAU: #cau#</field>
            <field name="product_id" search="[('product_tmpl_id', '=', ref('product_product_energy_delivered_product_template'))]" />
            <field name="automatic_price" eval="True" />
            <field name="qty_type">variable</field>
            <field name="qty_formula_id" ref="energy_selfconsumption.energy_delivered_formula"/>
            <field name="quantity">1</field>
            <field name="uom_id" ref="energy_project.kw_uom"/>
        </record>

        <!-- ========================================== -->
        <!-- POWER ACQUIRED TEMPLATE                   -->
        <!-- ========================================== -->
        
        <!-- Contract Template: Power Acquired Self-consumption Pack -->
        <record id="contract_template_power_acquired_selfconsumption_pack" model="contract.template">
            <field name="name">Power acquired selfconsumption pack</field>
            <field name="contract_type">sale</field>
            <field name="company_id" eval="False"/>
        </record>

        <!-- Contract Template Line: Power Acquired -->
        <record id="contract_template_line_power_acquired_selfconsumption_pack" model="contract.template.line">
            <field name="contract_id" ref="contract_template_power_acquired_selfconsumption_pack"/>
            <field name="name">CUPS: #code#
Owner: #owner_id#
Invoicing period: #START# - #END#
CAU: #cau#
Total installed nominal power (kW): #power#
Partition coefficient: #coefficient#
Daily nominal power acquired: #power# kWn * #coefficient# = #power_acquired# kWn/day
Days to be invoiced: #days_invoiced# days
Total amount invoiced:  #days_invoiced# days * #power_acquired# kWn/day = #total_amount# kWn</field>
            <field name="product_id" search="[('product_tmpl_id', '=', ref('product_product_power_acquired_product_template'))]" />
            <field name="automatic_price" eval="True" />
            <field name="qty_type">variable</field>
            <field name="qty_formula_id" ref="energy_selfconsumption.power_acquired_formula"/>
            <field name="quantity">1</field>
            <field name="uom_id" ref="energy_project.kw_uom"/>
        </record>

        <!-- ========================================== -->
        <!-- ENERGY CUSTOM TEMPLATE                    -->
        <!-- ========================================== -->
        
        <!-- Contract Template: Energy Custom Self-consumption Pack -->
        <record id="contract_template_energy_custom_selfconsumption_pack" model="contract.template">
            <field name="name">Energy custom selfconsumption pack</field>
            <field name="contract_type">sale</field>
            <field name="company_id" eval="False"/>
        </record>

        <!-- Contract Template Line: Energy Custom -->
        <record id="contract_template_line_energy_custom_selfconsumption_pack" model="contract.template.line">
            <field name="contract_id" ref="contract_template_energy_custom_selfconsumption_pack"/>
            <field name="name">CUPS: #code#
Owner: #owner_id#
Invoicing period: #START# - #END#</field>
            <field name="product_id" search="[('product_tmpl_id', '=', ref('product_product_energy_custom_product_template'))]" />
            <field name="automatic_price" eval="True" />
            <field name="qty_type">fixed</field>
            <field name="quantity">1</field>
            <field name="uom_id" ref="energy_project.kw_uom"/>
        </record>

        <!-- ========================================== -->
        <!-- PRODUCT TEMPLATE ASSOCIATIONS             -->
        <!-- ========================================== -->
        
        <!-- Associate Energy Delivered Pack with Contract Template -->
        <record id="product_product_energy_delivered_product_pack_template" model="product.template">
            <field name="is_contract" eval="True"/>
            <field name="property_contract_template_id" ref="contract_template_energy_delivered_selfconsumption_pack"/>
        </record>

        <!-- Associate Power Acquired Pack with Contract Template -->
        <record id="product_product_power_acquired_product_pack_template" model="product.template">
            <field name="is_contract" eval="True"/>
            <field name="property_contract_template_id" ref="contract_template_power_acquired_selfconsumption_pack"/>
        </record>

        <!-- Associate Energy Custom Pack with Contract Template -->
        <record id="product_product_energy_custom_product_pack_template" model="product.template">
            <field name="is_contract" eval="True"/>
            <field name="property_contract_template_id" ref="contract_template_energy_custom_selfconsumption_pack"/>
        </record>
        
    </data>
</odoo>
