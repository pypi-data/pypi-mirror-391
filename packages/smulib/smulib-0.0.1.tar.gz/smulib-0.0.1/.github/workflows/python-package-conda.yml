name: Build & Release SMU Python Package

on:
    push:
        tags:
            - "v*" # Trigger on version tags, e.g., v1.0.0

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            # 1️⃣ Checkout repo
            - name: Checkout code
              uses: actions/checkout@v3

            # 2️⃣ Setup Miniconda and create environment from environment.yml
            - name: Setup Conda environment
              uses: conda-incubator/setup-miniconda@v3
              with:
                  python-version: 3.12
                  auto-update-conda: true
                  activate-environment: build-env
                  environment-file: environment.yml
                  use-mamba: true # faster dependency resolution

            # 3️⃣ Install Python build tools
            - name: Install build tools
              run: |
                  pip install --upgrade build twine

            # 4️⃣ Build the Python package (wheel + sdist)
            - name: Build package
              run: |
                  python -m build --sdist --wheel

            # 5️⃣ Upload release assets to GitHub
            - name: Upload release assets
              uses: softprops/action-gh-release@v1
              with:
                  files: "dist/*"
              env:
                  GITHUB_TOKEN: ${{ secrets.GH_PAT }}
