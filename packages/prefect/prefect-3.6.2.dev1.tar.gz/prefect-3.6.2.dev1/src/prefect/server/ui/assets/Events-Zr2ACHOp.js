import{d as de,h as ee,ae as fe,ak as me,al as te,am as pe,an as ge,ao as ve,ap as be,aq as ye,ar as _e,as as xe,at as ke,w as ne,i as L,c as U,a as X,n,o as O,k as T,m as z,q as De,l as _,au as Te,a6 as R,av as Re,aw as Ee,ax as je,ay as Se,E as ae,F as Ie,az as Oe,A as he,aA as Ne,aB as Be,aC as Ce}from"./index-Dhxp3bbZ.js";import{c as q,g as Ve}from"./_commonjsHelpers-Cpj98o6Y.js";import{u as Fe}from"./usePageTitle-Dn837hxV.js";import{m as se}from"./mapper-fQuCzVrD.js";var Q,re;function Le(){if(re)return Q;re=1;var Y="Expected a function",h=NaN,N="[object Symbol]",w=/^\s+|\s+$/g,x=/^[-+]0x[0-9a-f]+$/i,k=/^0b[01]+$/i,p=/^0o[0-7]+$/i,l=parseInt,i=typeof q=="object"&&q&&q.Object===Object&&q,A=typeof self=="object"&&self&&self.Object===Object&&self,M=i||A||Function("return this")(),P=Object.prototype,B=P.toString,E=Math.max,j=Math.min,S=function(){return M.Date.now()};function C(e,a,u){var g,c,t,d,o,f,b=0,r=!1,m=!1,v=!0;if(typeof e!="function")throw new TypeError(Y);a=V(a)||0,D(u)&&(r=!!u.leading,m="maxWait"in u,t=m?E(V(u.maxWait)||0,a):t,v="trailing"in u?!!u.trailing:v);function $(s){var y=g,I=c;return g=c=void 0,b=s,d=e.apply(I,y),d}function le(s){return b=s,o=setTimeout(F,a),r?$(s):d}function ie(s){var y=s-f,I=s-b,Z=a-y;return m?j(Z,t-I):Z}function J(s){var y=s-f,I=s-b;return f===void 0||y>=a||y<0||m&&I>=t}function F(){var s=S();if(J(s))return K(s);o=setTimeout(F,ie(s))}function K(s){return o=void 0,v&&g?$(s):(g=c=void 0,d)}function ue(){o!==void 0&&clearTimeout(o),b=0,g=f=c=o=void 0}function ce(){return o===void 0?d:K(S())}function H(){var s=S(),y=J(s);if(g=arguments,c=this,f=s,y){if(o===void 0)return le(f);if(m)return o=setTimeout(F,a),$(f)}return o===void 0&&(o=setTimeout(F,a)),d}return H.cancel=ue,H.flush=ce,H}function D(e){var a=typeof e;return!!e&&(a=="object"||a=="function")}function W(e){return!!e&&typeof e=="object"}function G(e){return typeof e=="symbol"||W(e)&&B.call(e)==N}function V(e){if(typeof e=="number")return e;if(G(e))return h;if(D(e)){var a=typeof e.valueOf=="function"?e.valueOf():e;e=D(a)?a+"":a}if(typeof e!="string")return e===0?e:+e;e=e.replace(w,"");var u=k.test(e);return u||p.test(e)?l(e.slice(2),u?2:8):x.test(e)?h:+e}return Q=C,Q}var Ue=Le();const ze=Ve(Ue),qe={class:"events__content"},we={class:"events__filters"},Ae={class:"events__controls"},oe=6e4,$e=de({__name:"Events",setup(Y){const h=ee(()=>[{text:"Event Feed"}]),N=fe(),{now:w}=me({interval:oe});Fe("Event Feed");const x=te("resource",[]),k=te("events",[]),p=pe({type:"span",seconds:-Ce}),{startDate:l,endDate:i}=ge(),{selectionStart:A,selectionEnd:M}=ve(),P={minRangeInSeconds:Be-1,maxRangeInSeconds:Ne-1},B=be(()=>{const{startDate:c,endDate:t}=se.map("DateRangeSelectValue",p.range,"DateRange"),[d,o]=ye(k.value,v=>v.endsWith("*")),f=d.map(v=>v.replace(".*",".")),r=["prefect.log.write"].filter(v=>!o.includes(v));return{occurred:{since:A.value??c,until:M.value??t},anyResource:{idPrefix:x.value},event:{prefix:f,name:o,excludeName:r}}}),{page:E,pages:j,loading:S,events:C,empty:D}=_e(B,{interval:oe}),{margin:W}=xe(),G=()=>({rootMargin:W.value}),{stuck:V}=ke(N,G),e=ee(()=>({chart:{"events__chart--stuck":V.value}}));let a=!1;const u=ze(()=>{if(!(!l.value||!i.value)){if(a){a=!1;return}p.range={type:"range",startDate:l.value,endDate:i.value}}},1e3);ne([l,i],()=>u());function g(){if(!p.range)return;const{startDate:c,endDate:t}=se.map("DateRangeSelectValue",p.range,"DateRange");l.value?.getTime()!==c.getTime()&&(a=!0,l.value=c),i.value?.getTime()!==t.getTime()&&(a=!0,i.value=t)}return ne(()=>p.range,()=>g()),g(),(c,t)=>{const d=L("p-label"),o=L("p-empty-results"),f=L("p-pager"),b=L("p-layout-default");return n(l)&&n(i)?(O(),U(b,{key:0,class:"events"},{header:T(()=>[_(n(he),{crumbs:h.value},null,8,["crumbs"])]),default:T(()=>[z("div",qe,[z("div",we,[_(d,{label:"Resource"},{default:T(({id:r})=>[_(n(Te),{id:r,selected:n(x),"onUpdate:selected":t[0]||(t[0]=m=>R(x)?x.value=m:null),multiple:""},null,8,["id","selected"])]),_:1}),_(d,{label:"Events"},{default:T(({id:r})=>[_(n(Re),{id:r,selected:n(k),"onUpdate:selected":t[1]||(t[1]=m=>R(k)?k.value=m:null),multiple:""},null,8,["id","selected"])]),_:1})]),z("div",{ref_key:"chart",ref:N,class:Ee(["events__chart p-background",e.value.chart])},[_(n(je),{"start-date":n(l),"onUpdate:startDate":t[2]||(t[2]=r=>R(l)?l.value=r:null),"end-date":n(i),"onUpdate:endDate":t[3]||(t[3]=r=>R(i)?i.value=r:null),filter:B.value,"zoom-options":P},null,8,["start-date","end-date","filter"]),z("div",Ae,[_(n(Se),{modelValue:n(p).range,"onUpdate:modelValue":t[4]||(t[4]=r=>n(p).range=r),max:n(w)},null,8,["modelValue","max"])])],2),n(S)&&n(D)?(O(),U(o,{key:0},{message:T(()=>[...t[7]||(t[7]=[ae(" Loading events ",-1)])]),_:1})):(O(),De(Ie,{key:1},[n(D)?(O(),U(o,{key:0},{message:T(()=>[...t[8]||(t[8]=[ae(" No events ",-1)])]),_:1})):X("",!0),_(n(Oe),{class:"events__timeline",events:n(C),"start-date":n(l),"end-date":n(i)},null,8,["events","start-date","end-date"]),n(C).length?(O(),U(f,{key:1,page:n(E),"onUpdate:page":t[5]||(t[5]=r=>R(E)?E.value=r:null),pages:n(j),"onUpdate:pages":t[6]||(t[6]=r=>R(j)?j.value=r:null),class:"events__pager"},null,8,["page","pages"])):X("",!0)],64))])]),_:1})):X("",!0)}}});export{$e as default};
//# sourceMappingURL=Events-Zr2ACHOp.js.map
