// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider      = "prisma-client-js"
  output        = "./generated/client"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Enums
enum TaskStatus {
  TODO
  IN_PROGRESS
  DONE
}

enum ProjectStatus {
  IN_PROGRESS
  COMPLETED
  ON_HOLD
}

enum OrganizationRole {
  ADMIN
  MANAGER
  MEMBER
}

enum ProjectRole {
  OWNER
  MEMBER
}

enum DocumentSource {
  UPLOAD
  EMAIL
}

enum DocumentImportance {
  HIGH
  MEDIUM
  LOW
}

enum ClassificationStatus {
  PENDING // AI ì œì•ˆë§Œ ìˆìŒ, ì‚¬ìš©ì ê²°ì • ëŒ€ê¸°
  CLASSIFIED // ì‚¬ìš©ìê°€ ë¶„ë¥˜í•¨
  UNCLASSIFIED // ì‚¬ìš©ìê°€ ë¯¸ë¶„ë¥˜ ì²˜ë¦¬ (ë¶„ë¥˜ ì•ˆí•¨)
}

enum ClassificationType {
  EXISTING
  NEW_TASK
  NEW_PROJECT
  SKIP // ê´‘ê³ /ìŠ¤íŒ¸ ë“±ìœ¼ë¡œ í•„í„°ë§ëœ ì´ë©”ì¼
}

enum ContactSource {
  GMAIL
  MANUAL
}

enum ProjectTagType {
  COMPANY
  CUSTOM
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  REVOKED
  EXPIRED
}

enum UserRuleCategory {
  EMAIL_WRITING
  RESPONSE_STYLE
  CLASSIFICATION_PREFERENCE
  GENERAL
}

enum EmailType {
  RECEIVED // ë°›ì€ ë©”ì¼
  SENT // ë³´ë‚¸ ë©”ì¼
  DRAFT // ì´ˆì•ˆ
}

enum EmailIndexingJobType {
  ONBOARDING_SENT
  ONBOARDING_INBOX
  MANUAL_RESYNC
  PUSH_NOTIFICATION
}

enum EmailIndexingJobStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
  STALE
}

model User {
  id              String  @id @default(cuid())
  clerkId         String  @unique // Clerkì—ì„œ ì œê³µí•˜ëŠ” ì‚¬ìš©ì ID
  email           String  @unique
  firstName       String?
  lastName        String?
  profileImageUrl String?
  phoneNumber     String? // Page 3: ì „í™”ë²ˆí˜¸
  isActive        Boolean @default(true)
  version         Int     @default(1) // ë‚™ê´€ì  ì ê¸ˆ ë˜ëŠ” ìŠ¤ëƒ…ìƒ· ë²„ì „ ê´€ë¦¬ìš©

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Gmail ê´€ë ¨ ê´€ê³„
  gmailTokens      UserGmailToken[]
  emailPreferences UserEmailPreferences?
  emailThreads     EmailThread[]
  emails           Email[]

  // Organization ê´€ê³„ (Page 1: auth-onboarding)
  organizationMemberships OrganizationMember[]

  // Project ê´€ê³„ (Page 6: project-detail)
  projectMemberships ProjectMember[]

  // Audit Log ê´€ê³„
  auditLogs  AuditLog[]
  // Agent ì—…ë¡œë“œ íŒŒì¼ ê´€ê³„
  agentFiles AgentFile[]
  // User Rules ê´€ê³„
  userRules  UserRule[]

  @@map("users") // í…Œì´ë¸”ëª… ëª…ì‹œ
}

// Gmail OAuth í† í° ì •ë³´
model UserGmailToken {
  id           String    @id @default(cuid())
  userId       String    @map("user_id")
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  email        String // Google ê³„ì • ì´ë©”ì¼
  accessToken  String    @map("access_token") // ì•”í˜¸í™”ëœ ì•¡ì„¸ìŠ¤ í† í°
  refreshToken String?   @map("refresh_token") // ì•”í˜¸í™”ëœ ë¦¬í”„ë ˆì‹œ í† í°
  tokenType    String    @default("Bearer") @map("token_type")
  scope        String // ìŠ¹ì¸ëœ ìŠ¤ì½”í”„
  expiresAt    DateTime  @map("expires_at") // í† í° ë§Œë£Œ ì‹œê°„
  isActive     Boolean   @default(true) @map("is_active")
  lastSyncAt   DateTime? @map("last_sync_at") // Page 3: ë§ˆì§€ë§‰ ì´ë©”ì¼ ë™ê¸°í™” ì‹œê°„
  historyId    BigInt?   @map("history_id") // Gmail history ID for sync
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")

  @@unique([userId, email]) // Page 3: ì‚¬ìš©ìë‹¹ ë™ì¼ Gmail ê³„ì • ì¤‘ë³µ ë°©ì§€
  @@index([userId])
  @@index([email])
  @@map("user_gmail_tokens")
}

// íšŒì‚¬ ì •ë³´ (ê¸€ë¡œë²Œ, ë…ë¦½ì )
model Company {
  id String @id @default(cuid())

  name        String  @unique // íšŒì‚¬ëª… (ì˜ˆ: "ì‚¼ì„±ì „ì", "LGì „ì")
  domain      String? @unique // ë„ë©”ì¸ (ì˜ˆ: "samsung.com")
  industry    String? // ì—…ì¢… (ì˜ˆ: "ì „ì", "IT")
  address     String? // ì£¼ì†Œ
  website     String? // ì›¹ì‚¬ì´íŠ¸
  description String? // íšŒì‚¬ ì„¤ëª…

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organizations OrganizationCompany[] // ì´ íšŒì‚¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¡°ì§ë“¤
  contacts      Contact[] // ì´ íšŒì‚¬ ì†Œì† ì—°ë½ì²˜ë“¤
  projectLinks  ProjectCompany[]      @relation("ProjectCompanyLinks") // ì´ íšŒì‚¬ì™€ ê´€ë ¨ëœ í”„ë¡œì íŠ¸ë“¤
  tags          ProjectTag[]          @relation("CompanyTags") // ì´ íšŒì‚¬ ê¸°ë°˜ í”„ë¡œì íŠ¸ íƒœê·¸ë“¤

  @@index([name])
  @@index([domain])
  @@map("companies")
}

// ì¡°ì§-íšŒì‚¬ ê´€ê³„ (Organizationì´ ê´€ë¦¬í•˜ëŠ” íšŒì‚¬ ëª©ë¡)
model OrganizationCompany {
  id             String       @id @default(cuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  companyId      String
  company        Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)

  // ì¡°ì§ë³„ ì»¤ìŠ¤í…€ ë©”ëª¨ (ì„ íƒ)
  note String? // ì´ ì¡°ì§ì—ì„œ ì´ íšŒì‚¬ì— ëŒ€í•œ íŠ¹ë³„ ë©”ëª¨

  createdAt DateTime @default(now())

  @@unique([organizationId, companyId])
  @@index([organizationId])
  @@index([companyId])
  @@map("organization_companies")
}

// ì™¸ë¶€ ì—°ë½ì²˜ ì •ë³´ (Organizationì´ ê´€ë¦¬)
model Contact {
  id             String       @id @default(cuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  companyId      String? // ì†Œì† íšŒì‚¬ (ì„ íƒ, ê¸€ë¡œë²Œ Company ì°¸ì¡°)
  company        Company?     @relation(fields: [companyId], references: [id], onDelete: SetNull)

  name        String
  email       String
  phone       String? // Page 6: ì „í™”ë²ˆí˜¸
  role        String? // Page 6: ì§ì±…/ì—­í•  (ì˜ˆ: "CTO", "ë§ˆì¼€íŒ… íŒ€ì¥")
  description String? // Page 6: ì§ë¬´ ë° ì—­í•  ìƒì„¸ ì„¤ëª…
  source      ContactSource @default(MANUAL)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  projects ProjectContact[] // Page 6: í”„ë¡œì íŠ¸ ê´€ê³„

  @@unique([organizationId, email])
  @@index([organizationId])
  @@index([companyId])
  @@index([organizationId, name])
  @@map("contacts")
}

// ì‚¬ìš©ì ì´ë©”ì¼ ì—ì´ì „íŠ¸ ì„¤ì •
model UserEmailPreferences {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  autoSyncEnabled      Boolean @default(true)
  syncFrequencyMinutes Int     @default(30)
  maxEmailsPerSync     Int     @default(100)
  enableSmartSearch    Boolean @default(true)
  lastHistoryId        String? // Phase 2.8: ì ì§„ì  ë™ê¸°í™”ë¥¼ ìœ„í•œ ë§ˆì§€ë§‰ historyId

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_email_preferences")
}

// ì´ë©”ì¼ ìŠ¤ë ˆë“œ ì •ë³´
model EmailThread {
  id             String       @id @default(cuid())
  userId         String       @map("user_id")
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organizationId String       @map("organization_id")
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  gmailThreadId String   @map("gmail_thread_id") // Gmailì—ì„œ ì œê³µí•˜ëŠ” ìŠ¤ë ˆë“œ ID
  subject       String
  participants  String[] // ì°¸ì—¬ì ì´ë©”ì¼ ì£¼ì†Œ ë°°ì—´
  lastMessageAt DateTime @map("last_message_at")
  messageCount  Int      @default(1) @map("message_count")

  isRead      Boolean  @default(false) @map("is_read")
  isImportant Boolean  @default(false) @map("is_important")
  labels      String[] // Gmail ë¼ë²¨ë“¤

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // ê´€ê³„
  emails Email[]

  @@unique([userId, gmailThreadId])
  @@index([userId])
  @@index([organizationId])
  @@index([userId, lastMessageAt])
  @@index([organizationId, lastMessageAt])
  @@map("email_threads")
}

// ê°œë³„ ì´ë©”ì¼ ì •ë³´
model Email {
  id             String       @id @default(cuid())
  userId         String
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organizationId String // Page 5: Organization ì°¸ì¡°
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  threadId       String
  thread         EmailThread  @relation(fields: [threadId], references: [id], onDelete: Cascade)

  gmailMessageId String // Gmailì—ì„œ ì œê³µí•˜ëŠ” ë©”ì‹œì§€ ID
  messageId      String? // RFC 5322 Message-ID í—¤ë” (ì „ì—­ ê³ ìœ , ì¡°ì§ ë‚´ ì¤‘ë³µ ì²´í¬ìš©)
  inReplyTo      String? // RFC 5322 In-Reply-To í—¤ë” (ë‹µì¥ ëŒ€ìƒ Message-ID)
  references     String[] // RFC 5322 References í—¤ë” (ìŠ¤ë ˆë“œ ë‚´ ëª¨ë“  Message-ID ë°°ì—´)
  sender         String // ë°œì‹ ì ì´ë©”ì¼
  senderName     String? // ë°œì‹ ì ì´ë¦„ (ìŒë”°ì˜´í‘œ ì œê±°)
  recipients     String[] // ìˆ˜ì‹ ì ì´ë©”ì¼ ë°°ì—´ (To)
  ccRecipients   String[] // ì°¸ì¡° ìˆ˜ì‹ ì ë°°ì—´ (Cc)
  bccRecipients  String[] // ìˆ¨ì€ ì°¸ì¡° ìˆ˜ì‹ ì ë°°ì—´ (Bcc)

  subject    String
  snippet    String? // Gmailì—ì„œ ì œê³µí•˜ëŠ” ìŠ¤ë‹ˆí«
  sentAt     DateTime // ë°œì‹  ì‹œê°„
  receivedAt DateTime // ìˆ˜ì‹  ì‹œê°„

  emailType   EmailType @default(RECEIVED) @map("email_type") // ì´ë©”ì¼ íƒ€ì… (ë°›ì€ ë©”ì¼, ë³´ë‚¸ ë©”ì¼, ì´ˆì•ˆ)
  isRead      Boolean   @default(false)
  isImportant Boolean   @default(false)
  isDraft     Boolean   @default(false) // @deprecated emailType ì‚¬ìš© ê¶Œì¥
  labels      String[] // Gmail ë¼ë²¨ë“¤

  // AI ë¶„ì„ ì œì™¸ ì—¬ë¶€
  excludeFromAnalysis Boolean @default(false) @map("exclude_from_analysis") // AI ë¶„ì„ ëŒ€ìƒì—ì„œ ì œì™¸ ì—¬ë¶€

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // -- Full-text search vectors (managed by db triggers) --
  subject_tsvector Unsupported("tsvector")?
  body_tsvector    Unsupported("tsvector")?

  // ê´€ê³„
  content         EmailContent?
  attachments     EmailAttachment[]
  classifications EmailClassification[] // AI ì œì•ˆ íˆìŠ¤í† ë¦¬ (1:N ê´€ê³„)

  // ìµœì¢… ë¶„ë¥˜ (M:N ê´€ê³„, ë©€í‹° í”„ë¡œì íŠ¸ ì§€ì›)
  emailTasks    EmailTask[] // ì´ ì´ë©”ì¼ì´ ì—°ê²°ëœ íƒœìŠ¤í¬ë“¤
  emailProjects EmailProject[] // ì´ ì´ë©”ì¼ì´ ì—°ê²°ëœ í”„ë¡œì íŠ¸ë“¤

  // ì‚¬ìš©ì ë¶„ë¥˜ ìŠ¹ì¸ ìƒíƒœ
  emailApproval EmailApproval?

  @@unique([userId, gmailMessageId])
  @@index([userId, sentAt])
  @@index([userId, sender])
  @@index([userId, emailType]) // ì´ë©”ì¼ íƒ€ì…ë³„ ì¡°íšŒ
  @@index([userId, emailType, sentAt]) // ì´ë©”ì¼ íƒ€ì…ë³„ ì‹œê°„ìˆœ ì¡°íšŒ
  @@index([threadId])
  @@index([organizationId])
  @@index([organizationId, sentAt])
  @@index([organizationId, emailType]) // ì¡°ì§ë³„ ì´ë©”ì¼ íƒ€ì… ì¡°íšŒ
  @@index([messageId]) // ì „ì—­ Message-ID ì¡°íšŒ
  @@index([organizationId, messageId]) // ì¡°ì§ ë‚´ ì¤‘ë³µ ì²´í¬
  @@index([organizationId, inReplyTo]) // ì¡°ì§ ë‚´ ìŠ¤ë ˆë“œ ì¶”ì  (ë‹µì¥ ëŒ€ìƒ)
  @@index([organizationId, references]) // ì¡°ì§ ë‚´ ìŠ¤ë ˆë“œ ì¶”ì  (ë³µí•© ì¡°ê±´)
  @@index([references], type: Gin, map: "idx_emails_references_gin") // ë°°ì—´ ê²€ìƒ‰ìš© GIN ì¸ë±ìŠ¤ (Step 2 í•„ìˆ˜!)
  @@index([subject_tsvector], type: Gin, name: "idx_emails_subject_tsvector")
  @@index([body_tsvector], type: Gin, name: "idx_emails_body_tsvector")
  @@index([userId, excludeFromAnalysis]) // ì‚¬ìš©ìë³„ ë¶„ì„ ëŒ€ìƒ ì´ë©”ì¼ í•„í„°ë§
  @@index([organizationId, excludeFromAnalysis]) // ì¡°ì§ë³„ ë¶„ì„ ëŒ€ìƒ ì´ë©”ì¼ í•„í„°ë§
  @@map("emails")
}

// ì´ë©”ì¼ ë³¸ë¬¸ ë‚´ìš©
model EmailContent {
  id      String @id @default(cuid())
  emailId String @unique
  email   Email  @relation(fields: [emailId], references: [id], onDelete: Cascade)

  textBody String? // í…ìŠ¤íŠ¸ ë³¸ë¬¸
  htmlBody String? // HTML ë³¸ë¬¸

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("email_contents")
}

// ì´ë©”ì¼ ì²¨ë¶€íŒŒì¼ ë©”íƒ€ë°ì´í„°
model EmailAttachment {
  id      String @id @default(cuid())
  emailId String
  email   Email  @relation(fields: [emailId], references: [id], onDelete: Cascade)

  gmailAttachmentId String // Gmailì—ì„œ ì œê³µí•˜ëŠ” ì²¨ë¶€íŒŒì¼ ID
  filename          String
  mimeType          String
  size              Int // ë°”ì´íŠ¸ ë‹¨ìœ„ í¬ê¸°

  // OpenAI íŒŒì¼ ê´€ë ¨ í•„ë“œ
  openaiFileId        String? // OpenAIì— ì—…ë¡œë“œëœ íŒŒì¼ ID
  openaiFileExpiresAt DateTime? // OpenAI íŒŒì¼ ë§Œë£Œ ì‹œê°

  createdAt DateTime @default(now())

  // Relations
  document  Document? // í”„ë¡œì íŠ¸/íƒœìŠ¤í¬ì— ì—°ê²°ëœ ê²½ìš°
  updatedAt DateTime  @updatedAt

  @@unique([emailId, gmailAttachmentId]) // Prevent duplicate attachments for same email
  @@index([emailId])
  @@index([filename])
  @@index([mimeType])
  @@index([openaiFileId])
  @@map("email_attachments")
}

// ============================================
// ì´ë©”ì¼-íƒœìŠ¤í¬/í”„ë¡œì íŠ¸ ìµœì¢… ë¶„ë¥˜ (M:N ê´€ê³„)
// ============================================

// ì´ë©”ì¼-íƒœìŠ¤í¬ M:N ê´€ê³„ (ìµœì¢… ë¶„ë¥˜)
model EmailTask {
  id      String @id @default(cuid())
  emailId String
  email   Email  @relation(fields: [emailId], references: [id], onDelete: Cascade)
  taskId  String
  task    Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)

  assignedAt DateTime @default(now())
  assignedBy String // User ID (ìŠ¹ì¸í•œ ì‚¬ìš©ì)

  createdAt DateTime @default(now())

  @@unique([emailId, taskId])
  @@index([emailId])
  @@index([taskId])
  @@index([assignedBy])
  @@map("email_tasks")
}

// ì´ë©”ì¼-í”„ë¡œì íŠ¸ M:N ê´€ê³„ (ìµœì¢… ë¶„ë¥˜)
model EmailProject {
  id        String  @id @default(cuid())
  emailId   String
  email     Email   @relation(fields: [emailId], references: [id], onDelete: Cascade)
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  assignedAt DateTime @default(now())
  assignedBy String // User ID (ìŠ¹ì¸í•œ ì‚¬ìš©ì)

  createdAt DateTime @default(now())

  @@unique([emailId, projectId])
  @@index([emailId])
  @@index([projectId])
  @@index([assignedBy])
  @@map("email_projects")
}

// ì´ë©”ì¼ ë¶„ë¥˜ ìŠ¹ì¸ ìƒíƒœ (ì‚¬ìš©ì ê²°ì • ì¶”ì )
model EmailApproval {
  id      String @id @default(cuid())
  emailId String @unique
  email   Email  @relation(fields: [emailId], references: [id], onDelete: Cascade)

  status ClassificationStatus @default(PENDING)

  classifiedBy String? // User ID (ë¶„ë¥˜/ë¯¸ë¶„ë¥˜ ê²°ì •í•œ ì‚¬ìš©ì)
  classifiedAt DateTime?

  // ì‚¬ìš©ì ì½”ë©˜íŠ¸ (ë¶„ë¥˜/ë¯¸ë¶„ë¥˜ ì´ìœ  ë“±)
  comment String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([classifiedBy])
  @@index([emailId, status])
  @@map("email_approvals")
}

// ============================================
// AI ì´ë©”ì¼ ë¶„ë¥˜ ì œì•ˆ (íˆìŠ¤í† ë¦¬ ì „ìš©, Read-only)
// ============================================
//
// ì´ ëª¨ë¸ì€ AIì˜ ì œì•ˆë§Œ ì €ì¥í•˜ë©°, ìŠ¹ì¸ ìƒíƒœëŠ” ê´€ë¦¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
// ì‹¤ì œ ì´ë©”ì¼ì´ ì–´ë–¤ í”„ë¡œì íŠ¸/íƒœìŠ¤í¬ë¡œ ë¶„ë¥˜ë˜ì—ˆëŠ”ì§€ëŠ” EmailTask, EmailProjectë¥¼ í™•ì¸í•˜ì„¸ìš”.
//
// suggestedData êµ¬ì¡° (í”„ë¡ íŠ¸ì—”ë“œ ìŠ¤í™ì— ë§ì¶¤):
// - EXISTING: { 
//     extractedCompanies: [{ id, name, domain, industry }],
//     extractedContacts: [{ id, name, email, phone, role, company_id }]
//   }
// - NEW_TASK: { 
//     suggestedTaskName: string,
//     suggestedAssignee: { userId, name, organizationMemberId } | null,
//     suggestedDueDate: string | null,
//     extractedCompanies: [{ id, name, domain, industry }],
//     extractedContacts: [{ id, name, email, phone, role, company_id }]
//   }
// - NEW_PROJECT: { 
//     suggestedProjectName: string,
//     suggestedTasks: [{
//       name: string,
//       description: string,
//       assignee: { userId, name, organizationMemberId } | null,
//       dueDate: "YYYY-MM-DD" | null
//     }],
//     selectedTaskForEmail: string,
//     extractedCompanies: [{ id, name, domain, industry }],
//     extractedContacts: [{ id, name, email, phone, role, company_id }]
//   }
//
// ğŸ“ Note: ë°±ì—”ë“œ ë‚´ë¶€ì—ì„œëŠ” ë‹¤ë¥¸ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ,
//           save_classification.pyì—ì„œ ì´ ìŠ¤í™ìœ¼ë¡œ ìë™ ë³€í™˜ë©ë‹ˆë‹¤.

// í”„ë¡œì íŠ¸ ì œì•ˆ (ì‹ ê·œ) - ì›Œì»¤ê°€ ì œì•ˆí•œ í”„ë¡œì íŠ¸
model ProjectProposal {
  id             String       @id @default(cuid())
  organizationId String
  organization   Organization @relation("ProjectProposals", fields: [organizationId], references: [id], onDelete: Cascade)

  proposedName        String // ì œì•ˆëœ í”„ë¡œì íŠ¸ëª…
  proposedDescription String? // ì œì•ˆëœ í”„ë¡œì íŠ¸ ì„¤ëª…
  proposedTasks       Json? // ì œì•ˆëœ íƒœìŠ¤í¬ ë°°ì—´ (suggestedTasks)

  createdProjectId String? // ì‹¤ì œ ìƒì„±ëœ í”„ë¡œì íŠ¸ ID (API ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸)
  createdTaskIds   String[] @default([]) // ì‹¤ì œ ìƒì„±ëœ íƒœìŠ¤í¬ ID ë°°ì—´ (API ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸)
  resolvedAs       String? // í•´ê²° ë°©ì‹ (approved, rejected, merged ë“±)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // ê´€ê³„
  classifications EmailClassification[]

  @@unique([organizationId, proposedName])
  @@index([organizationId])
  @@index([createdProjectId])
  @@map("project_proposals")
}

// íƒœìŠ¤í¬ ì œì•ˆ (ì‹ ê·œ) - ì›Œì»¤ê°€ ì œì•ˆí•œ íƒœìŠ¤í¬
model TaskProposal {
  id             String       @id @default(cuid())
  organizationId String
  organization   Organization @relation("TaskProposals", fields: [organizationId], references: [id], onDelete: Cascade)
  projectId      String? // ì œì•ˆë  í”„ë¡œì íŠ¸ ID (ì„ íƒ)
  project        Project?     @relation("TaskProposals", fields: [projectId], references: [id], onDelete: SetNull)

  proposedTaskName    String // ì œì•ˆëœ íƒœìŠ¤í¬ëª…
  proposedDescription String? // ì œì•ˆëœ íƒœìŠ¤í¬ ì„¤ëª…
  proposedAssignee    Json? // ì œì•ˆëœ ë‹´ë‹¹ì ì •ë³´ (userId, name, organizationMemberId)
  proposedDueDate     String? // ì œì•ˆëœ ë§ˆê°ì¼ (YYYY-MM-DD)

  createdTaskId String? // ì‹¤ì œ ìƒì„±ëœ íƒœìŠ¤í¬ ID (API ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸)
  resolvedAs    String? // í•´ê²° ë°©ì‹ (approved, rejected ë“±)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // ê´€ê³„
  classifications EmailClassification[]

  @@unique([organizationId, projectId, proposedTaskName])
  @@index([organizationId])
  @@index([projectId])
  @@index([createdTaskId])
  @@map("task_proposals")
}

model EmailClassification {
  id      String @id @default(cuid())
  emailId String
  email   Email  @relation(fields: [emailId], references: [id], onDelete: Cascade)

  classificationType ClassificationType

  // AI ì œì•ˆ (ì ˆëŒ€ ë³€ê²½ë˜ì§€ ì•ŠìŒ!)
  suggestedProjectId String? // AIê°€ ì œì•ˆí•œ í”„ë¡œì íŠ¸ ID
  suggestedTaskId    String? // AIê°€ ì œì•ˆí•œ íƒœìŠ¤í¬ ID
  suggestedData      Json? // AI ì œì•ˆ ìƒì„¸ ì •ë³´

  tags       String[] @default([]) // AIê°€ ì¶”ì¶œí•œ íƒœê·¸
  confidence Float // 0.0 ~ 1.0
  reason     String? // AI ë¶„ì„ ì´ìœ 
  metadata   Json? // ì›Œì»¤ì˜ ì¶”ë¡  ê³¼ì • ë° ë””ë²„ê¹… ì •ë³´ (decisionPath, step1~4 ì •ë³´, entities ë“±)

  // ì›Œì»¤ ì œì•ˆ ê´€ê³„ (ì›Œì»¤ê°€ ìƒì„±í•œ proposalë¡œ ë³€í™˜ë¨)
  projectProposalId String?
  projectProposal   ProjectProposal? @relation(fields: [projectProposalId], references: [id], onDelete: SetNull)
  taskProposalId    String?
  taskProposal      TaskProposal?    @relation(fields: [taskProposalId], references: [id], onDelete: SetNull)

  // ë³€í™˜ ì´ë ¥ ì¶”ì  (API ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸)
  originalType ClassificationType? // ì›Œì»¤ê°€ ë³€í™˜í•˜ê¸° ì „ ì›ë³¸ ë¶„ë¥˜ íƒ€ì…
  originalData Json? // ì›Œì»¤ê°€ ë³€í™˜í•˜ê¸° ì „ ì›ë³¸ ì œì•ˆ ë°ì´í„°
  convertedAt  DateTime?           @map("converted_at") // proposalë¡œ ë³€í™˜ëœ ì‹œê°

  createdAt DateTime @default(now())

  @@index([emailId])
  @@index([classificationType])
  @@index([suggestedProjectId])
  @@index([suggestedTaskId])
  @@index([projectProposalId])
  @@index([taskProposalId])
  @@map("email_classifications")
}

// ê²€ìƒ‰ ê²°ê³¼ ìºì‹œ
model SearchCache {
  id        String   @id @default(cuid())
  userId    String
  queryHash String // ê²€ìƒ‰ ì¿¼ë¦¬ì˜ í•´ì‹œê°’
  results   Json // ê²€ìƒ‰ ê²°ê³¼ (JSON)
  expiresAt DateTime // ìºì‹œ ë§Œë£Œ ì‹œê°„

  createdAt DateTime @default(now())

  @@unique([userId, queryHash])
  @@index([expiresAt])
  @@map("search_cache")
}

// ì±„íŒ… íˆìŠ¤í† ë¦¬ ì €ì¥ì†Œ (ì±„íŒ… íˆìŠ¤í† ë¦¬ ê¸°ë°˜ ì ‘ê·¼ë²•)
model ConversationHistory {
  id        String   @id @default(cuid())
  threadId  String   @unique
  messages  String // JSON í˜•íƒœë¡œ ì €ì¥ëœ BaseMessage ë°°ì—´
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("conversation_histories")
}

// Debezium ì†ŒìŠ¤ ì»¤ë„¥í„°ì™€ ì—°ë™í•˜ê¸° ìœ„í•œ ì•„ì›ƒë°•ìŠ¤ í…Œì´ë¸”
model OutboxEvent {
  id         BigInt   @id @default(autoincrement())
  topic      String // ì˜ˆ: 'gmail.history.sync', 'ingest.email', ...
  key        String // íŒŒí‹°ì…˜/ë©±ë“± í‚¤ (ì˜ˆ: userId, messageId)
  eventType  String   @map("event_type") // optional: create/update/delete ë“±
  payload    Json // ë©”ì‹œì§€ ë³¸ë¬¸
  headers    Json? // optional: tracing, dedup, schema ver
  occurredAt DateTime @default(now()) @map("occurred_at") @db.Timestamp(3)
  status     String   @default("pending") // ì•± ë‚´ë¶€ í™•ì¸ìš©

  @@index([topic, occurredAt])
  @@map("outbox_event")
}

// ============================================
// Page 1: ì¸ì¦ ë° ì˜¨ë³´ë”© (auth-onboarding.md)
// ============================================

// ì¡°ì§ (Organization)
model Organization {
  id                  String   @id @default(cuid())
  clerkOrganizationId String   @unique // Clerk Organization ID
  name                String
  description         String? // Page 2: ì¡°ì§ ì„¤ëª…
  imageUrl            String? // Page 2: ì¡°ì§ ë¡œê³  URL
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  // Relations
  members          OrganizationMember[]
  invitations      OrganizationInvitation[] // Page 2: ì¡°ì§ ì´ˆëŒ€ ê´€ê³„ ì¶”ê°€
  emailThreads     EmailThread[] // ì´ë©”ì¼ ìŠ¤ë ˆë“œ ê´€ê³„ ì¶”ê°€
  emails           Email[] // Page 5: Email ê´€ê³„ ì¶”ê°€
  projects         Project[] // Page 6: Project ê´€ê³„ ì¶”ê°€
  companies        OrganizationCompany[] // Page 6: ì¡°ì§ì´ ê´€ë¦¬í•˜ëŠ” íšŒì‚¬ ëª©ë¡
  contacts         Contact[] // Page 6: ì™¸ë¶€ ì—°ë½ì²˜ ê´€ê³„ ì¶”ê°€
  projectProposals ProjectProposal[]        @relation("ProjectProposals") // ì›Œì»¤ê°€ ì œì•ˆí•œ í”„ë¡œì íŠ¸
  taskProposals    TaskProposal[]           @relation("TaskProposals") // ì›Œì»¤ê°€ ì œì•ˆí•œ íƒœìŠ¤í¬
  agentFiles       AgentFile[]

  @@map("organizations")
}

// ì¡°ì§ ë©¤ë²„ì‹­ (OrganizationMember)
model OrganizationMember {
  id                String           @id @default(cuid())
  clerkMembershipId String           @unique // Clerk Membership ID
  organizationId    String
  userId            String
  role              OrganizationRole

  // AI ë‹´ë‹¹ì ìë™ ë°°ì •ì„ ìœ„í•œ ìì—°ì–´ ê·œì¹™ ë°°ì—´ (Page 2: Organization Settings)
  assignmentRules String[] @default([]) // ì˜ˆ: ["ë§ˆì¼€íŒ… ê´€ë ¨ íƒœìŠ¤í¬", "SNS ìº í˜ì¸ ê¸°íš"]

  joinedAt  DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([organizationId, userId]) // 1 User per Organization
  @@index([organizationId])
  @@index([userId])
  @@index([role])
  @@map("organization_members")
}

// ì¡°ì§ ì´ˆëŒ€ (OrganizationInvitation)
model OrganizationInvitation {
  id                String       @id @default(cuid())
  clerkInvitationId String       @unique // Clerk Invitation ID
  organizationId    String
  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  email     String
  role      OrganizationRole
  status    InvitationStatus @default(PENDING)
  invitedBy String // User ID (ì´ˆëŒ€í•œ ì‚¬ìš©ì)

  // Audit Trail (ê°ì‚¬ ì¶”ì )
  createdAt  DateTime  @default(now())
  expiresAt  DateTime? // ì´ˆëŒ€ ë§Œë£Œ ì‹œê°„
  acceptedAt DateTime? // ìˆ˜ë½ ì‹œê°„
  revokedAt  DateTime? // ì·¨ì†Œ ì‹œê°„
  revokedBy  String? // ì´ˆëŒ€ë¥¼ ì·¨ì†Œí•œ ì‚¬ìš©ì ID
  updatedAt  DateTime  @updatedAt

  // ì¬ì „ì†¡ ì¶”ì 
  resendCount  Int       @default(0) // ì¬ì „ì†¡ íšŸìˆ˜
  lastResendBy String? // ë§ˆì§€ë§‰ ì¬ì „ì†¡í•œ ì‚¬ìš©ì ID
  lastResendAt DateTime? // ë§ˆì§€ë§‰ ì¬ì „ì†¡ ì‹œê°

  @@index([organizationId])
  @@index([status])
  @@index([organizationId, status]) // ì¡°ì§ë³„ ìƒíƒœ í•„í„°ë§
  @@index([email])
  @@map("organization_invitations")
}

// ============================================
// Page 6: í”„ë¡œì íŠ¸ ìƒì„¸ (project-detail.md)
// ============================================

// í”„ë¡œì íŠ¸ (Project)
model Project {
  id             String       @id @default(cuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  name        String
  description String?
  status      ProjectStatus @default(IN_PROGRESS)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  members   ProjectMember[]
  tasks     Task[] // í”„ë¡œì íŠ¸ì˜ íƒœìŠ¤í¬ë“¤
  companies ProjectCompany[] // í”„ë¡œì íŠ¸ ê´€ë ¨ íšŒì‚¬ë“¤
  contacts  ProjectContact[] // í”„ë¡œì íŠ¸ ê´€ë ¨ ì—°ë½ì²˜ë“¤
  documents ProjectDocument[] // í”„ë¡œì íŠ¸-ë¬¸ì„œ M:N ê´€ê³„
  tags      ProjectTag[] // í”„ë¡œì íŠ¸ íƒœê·¸ë“¤ (ìë™ + ìˆ˜ë™)

  // ì´ í”„ë¡œì íŠ¸ì— ë¶„ë¥˜ëœ ì´ë©”ì¼ë“¤
  emailProjects EmailProject[]
  taskProposals TaskProposal[] @relation("TaskProposals") // ì›Œì»¤ê°€ ì œì•ˆí•œ íƒœìŠ¤í¬ë“¤

  @@unique([organizationId, name]) // í•œ ì¡°ì§ ë‚´ ë™ì¼ ì´ë¦„ í”„ë¡œì íŠ¸ ë°©ì§€
  @@index([organizationId])
  @@index([status])
  @@index([organizationId, status])
  @@map("projects")
}

// í”„ë¡œì íŠ¸ íƒœê·¸ (ProjectTag)
model ProjectTag {
  id        String  @id @default(cuid())
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  name     String // íƒœê·¸ëª…
  type     ProjectTagType
  sourceId String? // type='company'ì¼ ë•Œ Company ID
  company  Company?       @relation("CompanyTags", fields: [sourceId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([projectId, name]) // í”„ë¡œì íŠ¸ ë‚´ íƒœê·¸ëª… ì¤‘ë³µ ë°©ì§€
  @@index([projectId])
  @@index([type])
  @@index([sourceId])
  @@index([projectId, type]) // íƒ€ì…ë³„ í•„í„°ë§
  @@map("project_tags")
}

// í”„ë¡œì íŠ¸ ë©¤ë²„ì‹­ (ProjectMember) - M:N ê´€ê³„
model ProjectMember {
  id        String  @id @default(cuid())
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  userId    String
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  role      ProjectRole @default(MEMBER)
  joinedAt  DateTime    @default(now())
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  // Relations
  assignedTasks Task[] @relation("TaskAssignee")

  @@unique([projectId, userId]) // 1 User per Project
  @@index([projectId])
  @@index([userId])
  @@map("project_members")
}

// íƒœìŠ¤í¬ (Task)
model Task {
  id        String  @id @default(cuid())
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  title       String
  description String?
  status      TaskStatus     @default(TODO)
  assigneeId  String? // ë‹´ë‹¹ì ProjectMember ID
  assignee    ProjectMember? @relation("TaskAssignee", fields: [assigneeId], references: [id], onDelete: SetNull)
  dueDate     DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  // ì´ íƒœìŠ¤í¬ì— ë¶„ë¥˜ëœ ì´ë©”ì¼ë“¤
  emailTasks EmailTask[]

  @@unique([projectId, title]) // í•œ í”„ë¡œì íŠ¸ ë‚´ ë™ì¼ ì´ë¦„ íƒœìŠ¤í¬ ë°©ì§€
  @@index([projectId])
  @@index([assigneeId])
  @@index([status])
  @@index([dueDate])
  @@index([projectId, status]) // í”„ë¡œì íŠ¸ ë‚´ ìƒíƒœë³„ ì¡°íšŒ
  @@map("tasks")
}

// í”„ë¡œì íŠ¸-íšŒì‚¬ ê´€ê³„ (ProjectCompany) - M:N ê´€ê³„
model ProjectCompany {
  id        String  @id @default(cuid())
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  companyId String
  company   Company @relation("ProjectCompanyLinks", fields: [companyId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([projectId, companyId])
  @@index([projectId])
  @@index([companyId])
  @@map("project_companies")
}

// í”„ë¡œì íŠ¸-ì—°ë½ì²˜ ê´€ê³„ (ProjectContact) - M:N ê´€ê³„
model ProjectContact {
  id        String  @id @default(cuid())
  projectId String
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  contactId String
  contact   Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@unique([projectId, contactId])
  @@index([projectId])
  @@index([contactId])
  @@map("project_contacts")
}

// ë¬¸ì„œ (Document)
model Document {
  id     String         @id @default(cuid())
  name   String // íŒŒì¼ëª…
  type   String // 'pdf', 'docx', 'xlsx', 'pptx', 'png', 'jpg', 'zip', 'etc'
  size   Int // íŒŒì¼ í¬ê¸° (bytes)
  url    String? // íŒŒì¼ URL (S3 ë“±, Gmail ì²¨ë¶€íŒŒì¼ì€ null)
  source DocumentSource

  // ì§ì ‘ ì—…ë¡œë“œì¸ ê²½ìš°
  uploadedBy String? // User ID (source='UPLOAD'ì¼ ë•Œë§Œ)

  // ì´ë©”ì¼ ì²¨ë¶€íŒŒì¼ì¸ ê²½ìš°
  emailAttachmentId String?          @unique // EmailAttachment ID (source='EMAIL'ì¼ ë•Œë§Œ)
  emailAttachment   EmailAttachment? @relation(fields: [emailAttachmentId], references: [id], onDelete: Cascade)

  aiImportance DocumentImportance?
  aiReason     String? // AI íŒë‹¨ ì´ìœ 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // M:N ê´€ê³„
  projectLinks ProjectDocument[]

  @@index([source])
  @@index([uploadedBy])
  @@index([aiImportance])
  @@map("documents")
}

// í”„ë¡œì íŠ¸-ë¬¸ì„œ ë§¤í•‘ í…Œì´ë¸” (M:N)
model ProjectDocument {
  id         String   @id @default(cuid())
  projectId  String
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  documentId String
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  linkedAt  DateTime @default(now())
  linkedBy  String // User ID
  createdAt DateTime @default(now())

  @@unique([projectId, documentId])
  @@index([projectId])
  @@index([documentId])
  @@index([linkedBy])
  @@map("project_documents")
}

// ============================================
// Audit Log (ê°ì‚¬ ë¡œê·¸)
// ============================================

// ì‚¬ìš©ì í–‰ìœ„ ì¶”ì  ë° ë³´ì•ˆ ê°ì‚¬ë¥¼ ìœ„í•œ Audit Log
model AuditLog {
  id         String   @id @default(cuid())
  userId     String // í–‰ìœ„ì ID (ë‚´ë¶€ User ID)
  clerkId    String? // Clerk User ID (ì°¸ê³ ìš©)
  action     String // í–‰ìœ„ (ì˜ˆ: "ì£¼ë¬¸ ìƒì„±", "í”„ë¡œì íŠ¸ ì‚­ì œ")
  context    String // API ì •ë³´ (ì˜ˆ: "POST /v1/orders")
  targetData Json? // ê²°ê³¼ê°’ì˜ ì¼ë¶€ (JSON í˜•íƒœ)
  metadata   Json? // ì¶”ê°€ ë©”íƒ€ë°ì´í„° (ì„ íƒ)
  createdAt  DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@map("audit_logs")
}

model AgentFile {
  id                  String        @id @default(cuid())
  userId              String
  user                User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  organizationId      String?
  organization        Organization? @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  filename            String
  mimeType            String
  size                Int
  url                 String
  blobKey             String
  openaiFileId        String?
  openaiFileExpiresAt DateTime?
  vectorStoreId       String?
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  deletedAt           DateTime?

  @@index([userId])
  @@index([createdAt])
  @@index([openaiFileId])
  @@map("agent_files")
}

model AgentUserVectorStore {
  id            String    @id @default(cuid())
  userId        String    @unique
  vectorStoreId String
  expiresAt     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@map("agent_user_vector_stores")
}

// ============================================
// User Rules (ì‚¬ìš©ì ë§ì¶¤ ê·œì¹™)
// ============================================

// ì‚¬ìš©ìë³„ AI ì—ì´ì „íŠ¸ ê·œì¹™ ì €ì¥
// ì˜ˆ: ì´ë©”ì¼ ì‘ì„± ìŠ¤íƒ€ì¼, ì‘ë‹µ í†¤, ë¶„ë¥˜ ì„ í˜¸ì‚¬í•­ ë“±
model UserRule {
  id        String           @id @default(cuid())
  userId    String
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  category  UserRuleCategory
  content   String           @db.Text // ê·œì¹™ ë‚´ìš©
  isActive  Boolean          @default(true) // í™œì„±í™” ì—¬ë¶€
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  @@index([userId])
  @@index([userId, category])
  @@index([userId, isActive])
  @@map("user_rules")
}

// ============================================
// Email Indexing Job (ì´ë©”ì¼ ìˆ˜ì§‘ ì§„í–‰ ìƒí™© ì¶”ì )
// ============================================

// ì´ë©”ì¼ ìˆ˜ì§‘ ì‘ì—… ì¶”ì  í…Œì´ë¸”
// ì˜¨ë³´ë”© ì‹œ SENT/INBOX 2ê°œ ì‘ì—… ìƒì„±, ì™¸ë¶€ ì›Œì»¤ê°€ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
model EmailIndexingJob {
  id             String @id @default(cuid())
  jobId          String @unique // UUID (correlationIdì™€ ë™ì¼)
  userId         String
  organizationId String

  jobType EmailIndexingJobType
  status  EmailIndexingJobStatus

  totalEmails     Int @default(0)
  processedEmails Int @default(0)
  failedEmails    Int @default(0)

  sinceDate DateTime? // ìˆ˜ì§‘ ì‹œì‘ ë‚ ì§œ
  untilDate DateTime? // ìˆ˜ì§‘ ì¢…ë£Œ ë‚ ì§œ
  emailType String? // 'SENT' | 'INBOX'

  startedAt      DateTime? // ì‘ì—… ì‹œì‘ ì‹œê°„
  completedAt    DateTime? // ì‘ì—… ì™„ë£Œ ì‹œê°„
  lastProgressAt DateTime? // ë§ˆì§€ë§‰ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ ì‹œê°„
  errorMessage   String?   @db.Text // ì—ëŸ¬ ë©”ì‹œì§€

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, status]) // ì‚¬ìš©ìë³„ ì§„í–‰ ì¤‘ì¸ ì‘ì—… ì¡°íšŒ
  @@index([organizationId, status]) // ì¡°ì§ë³„ í•„í„°ë§
  @@index([jobId]) // ê°œë³„ ì‘ì—… ì¡°íšŒ (SSE)
  @@index([status, lastProgressAt]) // Stale ì‘ì—… ê°ì§€ìš©
  @@map("email_indexing_jobs")
}

// Python client generator (used only in CI via --schema ./prisma)
// Requires python package `prisma` installed in the environment running `prisma generate`.
generator client_pkg_py {
  provider = "prisma-client-py"
  output   = "../packages/db-clients/py/src/sprintsolo_sally_db_client"
}
